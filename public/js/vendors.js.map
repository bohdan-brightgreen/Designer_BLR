{"version":3,"sources":["jquery-ui-1.9.2.custom.min.js","jquery.ui.touch-punch.min.js","jquery.class.js","paper.brightgreen.js","cropper.min.js","jquery.maxlength.min.js","jquery.mousewheel.js","lodash.min.js","bootstrap.tooltip.min.js","handlebars.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1tUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/CA;AACA;AACA;AACA;AACA;AACA;AACA;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"vendors.js","sourcesContent":["/*! jQuery UI - v1.9.2 - 2015-11-27\n* http://jqueryui.com\n* Includes: jquery.ui.core.js, jquery.ui.widget.js, jquery.ui.mouse.js, jquery.ui.position.js, jquery.ui.draggable.js, jquery.ui.droppable.js, jquery.ui.resizable.js, jquery.ui.selectable.js, jquery.ui.sortable.js, jquery.ui.button.js, jquery.ui.dialog.js, jquery.ui.progressbar.js, jquery.ui.slider.js, jquery.ui.tabs.js, jquery.ui.tooltip.js, jquery.ui.effect.js, jquery.ui.effect-bounce.js, jquery.ui.effect-clip.js, jquery.ui.effect-drop.js, jquery.ui.effect-fade.js, jquery.ui.effect-fold.js, jquery.ui.effect-highlight.js, jquery.ui.effect-slide.js\n* Copyright jQuery Foundation and other contributors; Licensed MIT */\n\n(function(e,t){function i(t,i){var n,a,o,r=t.nodeName.toLowerCase();return\"area\"===r?(n=t.parentNode,a=n.name,t.href&&a&&\"map\"===n.nodeName.toLowerCase()?(o=e(\"img[usemap=#\"+a+\"]\")[0],!!o&&s(o)):!1):(/input|select|textarea|button|object/.test(r)?!t.disabled:\"a\"===r?t.href||i:i)&&s(t)}function s(t){return e.expr.filters.visible(t)&&!e(t).parents().andSelf().filter(function(){return\"hidden\"===e.css(this,\"visibility\")}).length}var n=0,a=/^ui-id-\\d+$/;e.ui=e.ui||{},e.ui.version||(e.extend(e.ui,{version:\"1.9.2\",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({_focus:e.fn.focus,focus:function(t,i){return\"number\"==typeof t?this.each(function(){var s=this;setTimeout(function(){e(s).focus(),i&&i.call(s)},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var t;return t=e.ui.ie&&/(static|relative)/.test(this.css(\"position\"))||/absolute/.test(this.css(\"position\"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,\"position\"))&&/(auto|scroll)/.test(e.css(this,\"overflow\")+e.css(this,\"overflow-y\")+e.css(this,\"overflow-x\"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,\"overflow\")+e.css(this,\"overflow-y\")+e.css(this,\"overflow-x\"))}).eq(0),/fixed/.test(this.css(\"position\"))||!t.length?e(document):t},zIndex:function(i){if(i!==t)return this.css(\"zIndex\",i);if(this.length)for(var s,n,a=e(this[0]);a.length&&a[0]!==document;){if(s=a.css(\"position\"),(\"absolute\"===s||\"relative\"===s||\"fixed\"===s)&&(n=parseInt(a.css(\"zIndex\"),10),!isNaN(n)&&0!==n))return n;a=a.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id=\"ui-id-\"+ ++n)})},removeUniqueId:function(){return this.each(function(){a.test(this.id)&&e(this).removeAttr(\"id\")})}}),e.extend(e.expr[\":\"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,s){return!!e.data(t,s[3])},focusable:function(t){return i(t,!isNaN(e.attr(t,\"tabindex\")))},tabbable:function(t){var s=e.attr(t,\"tabindex\"),n=isNaN(s);return(n||s>=0)&&i(t,!n)}}),e(function(){var t=document.body,i=t.appendChild(i=document.createElement(\"div\"));i.offsetHeight,e.extend(i.style,{minHeight:\"100px\",height:\"auto\",padding:0,borderWidth:0}),e.support.minHeight=100===i.offsetHeight,e.support.selectstart=\"onselectstart\"in i,t.removeChild(i).style.display=\"none\"}),e(\"<a>\").outerWidth(1).jquery||e.each([\"Width\",\"Height\"],function(i,s){function n(t,i,s,n){return e.each(a,function(){i-=parseFloat(e.css(t,\"padding\"+this))||0,s&&(i-=parseFloat(e.css(t,\"border\"+this+\"Width\"))||0),n&&(i-=parseFloat(e.css(t,\"margin\"+this))||0)}),i}var a=\"Width\"===s?[\"Left\",\"Right\"]:[\"Top\",\"Bottom\"],o=s.toLowerCase(),r={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn[\"inner\"+s]=function(i){return i===t?r[\"inner\"+s].call(this):this.each(function(){e(this).css(o,n(this,i)+\"px\")})},e.fn[\"outer\"+s]=function(t,i){return\"number\"!=typeof t?r[\"outer\"+s].call(this,t):this.each(function(){e(this).css(o,n(this,t,!0,i)+\"px\")})}}),e(\"<a>\").data(\"a-b\",\"a\").removeData(\"a-b\").data(\"a-b\")&&(e.fn.removeData=function(t){return function(i){return arguments.length?t.call(this,e.camelCase(i)):t.call(this)}}(e.fn.removeData)),function(){var t=/msie ([\\w.]+)/.exec(navigator.userAgent.toLowerCase())||[];e.ui.ie=t.length?!0:!1,e.ui.ie6=6===parseFloat(t[1],10)}(),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?\"selectstart\":\"mousedown\")+\".ui-disableSelection\",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(\".ui-disableSelection\")}}),e.extend(e.ui,{plugin:{add:function(t,i,s){var n,a=e.ui[t].prototype;for(n in s)a.plugins[n]=a.plugins[n]||[],a.plugins[n].push([i,s[n]])},call:function(e,t,i){var s,n=e.plugins[t];if(n&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(s=0;n.length>s;s++)e.options[n[s][0]]&&n[s][1].apply(e.element,i)}},contains:e.contains,hasScroll:function(t,i){if(\"hidden\"===e(t).css(\"overflow\"))return!1;var s=i&&\"left\"===i?\"scrollLeft\":\"scrollTop\",n=!1;return t[s]>0?!0:(t[s]=1,n=t[s]>0,t[s]=0,n)},isOverAxis:function(e,t,i){return e>t&&t+i>e},isOver:function(t,i,s,n,a,o){return e.ui.isOverAxis(t,s,a)&&e.ui.isOverAxis(i,n,o)}}))})(jQuery);(function(e,t){var i=0,s=Array.prototype.slice,n=e.cleanData;e.cleanData=function(t){for(var i,s=0;null!=(i=t[s]);s++)try{e(i).triggerHandler(\"remove\")}catch(a){}n(t)},e.widget=function(i,s,n){var a,o,r,h,l=i.split(\".\")[0];i=i.split(\".\")[1],a=l+\"-\"+i,n||(n=s,s=e.Widget),e.expr[\":\"][a.toLowerCase()]=function(t){return!!e.data(t,a)},e[l]=e[l]||{},o=e[l][i],r=e[l][i]=function(e,i){return this._createWidget?(arguments.length&&this._createWidget(e,i),t):new r(e,i)},e.extend(r,o,{version:n.version,_proto:e.extend({},n),_childConstructors:[]}),h=new s,h.options=e.widget.extend({},h.options),e.each(n,function(t,i){e.isFunction(i)&&(n[t]=function(){var e=function(){return s.prototype[t].apply(this,arguments)},n=function(e){return s.prototype[t].apply(this,e)};return function(){var t,s=this._super,a=this._superApply;return this._super=e,this._superApply=n,t=i.apply(this,arguments),this._super=s,this._superApply=a,t}}())}),r.prototype=e.widget.extend(h,{widgetEventPrefix:o?h.widgetEventPrefix:i},n,{constructor:r,namespace:l,widgetName:i,widgetBaseClass:a,widgetFullName:a}),o?(e.each(o._childConstructors,function(t,i){var s=i.prototype;e.widget(s.namespace+\".\"+s.widgetName,r,i._proto)}),delete o._childConstructors):s._childConstructors.push(r),e.widget.bridge(i,r)},e.widget.extend=function(i){for(var n,a,o=s.call(arguments,1),r=0,h=o.length;h>r;r++)for(n in o[r])a=o[r][n],o[r].hasOwnProperty(n)&&a!==t&&(i[n]=e.isPlainObject(a)?e.isPlainObject(i[n])?e.widget.extend({},i[n],a):e.widget.extend({},a):a);return i},e.widget.bridge=function(i,n){var a=n.prototype.widgetFullName||i;e.fn[i]=function(o){var r=\"string\"==typeof o,h=s.call(arguments,1),l=this;return o=!r&&h.length?e.widget.extend.apply(null,[o].concat(h)):o,r?this.each(function(){var s,n=e.data(this,a);return n?e.isFunction(n[o])&&\"_\"!==o.charAt(0)?(s=n[o].apply(n,h),s!==n&&s!==t?(l=s&&s.jquery?l.pushStack(s.get()):s,!1):t):e.error(\"no such method '\"+o+\"' for \"+i+\" widget instance\"):e.error(\"cannot call methods on \"+i+\" prior to initialization; \"+\"attempted to call method '\"+o+\"'\")}):this.each(function(){var t=e.data(this,a);t?t.option(o||{})._init():e.data(this,a,new n(o,this))}),l}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:\"widget\",widgetEventPrefix:\"\",defaultElement:\"<div>\",options:{disabled:!1,create:null},_createWidget:function(t,s){s=e(s||this.defaultElement||this)[0],this.element=e(s),this.uuid=i++,this.eventNamespace=\".\"+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),s!==this&&(e.data(s,this.widgetName,this),e.data(s,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===s&&this.destroy()}}),this.document=e(s.style?s.ownerDocument:s.document||s),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger(\"create\",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr(\"aria-disabled\").removeClass(this.widgetFullName+\"-disabled \"+\"ui-state-disabled\"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass(\"ui-state-hover\"),this.focusable.removeClass(\"ui-state-focus\")},_destroy:e.noop,widget:function(){return this.element},option:function(i,s){var n,a,o,r=i;if(0===arguments.length)return e.widget.extend({},this.options);if(\"string\"==typeof i)if(r={},n=i.split(\".\"),i=n.shift(),n.length){for(a=r[i]=e.widget.extend({},this.options[i]),o=0;n.length-1>o;o++)a[n[o]]=a[n[o]]||{},a=a[n[o]];if(i=n.pop(),s===t)return a[i]===t?null:a[i];a[i]=s}else{if(s===t)return this.options[i]===t?null:this.options[i];r[i]=s}return this._setOptions(r),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,\"disabled\"===e&&(this.widget().toggleClass(this.widgetFullName+\"-disabled ui-state-disabled\",!!t).attr(\"aria-disabled\",t),this.hoverable.removeClass(\"ui-state-hover\"),this.focusable.removeClass(\"ui-state-focus\")),this},enable:function(){return this._setOption(\"disabled\",!1)},disable:function(){return this._setOption(\"disabled\",!0)},_on:function(i,s,n){var a,o=this;\"boolean\"!=typeof i&&(n=s,s=i,i=!1),n?(s=a=e(s),this.bindings=this.bindings.add(s)):(n=s,s=this.element,a=this.widget()),e.each(n,function(n,r){function h(){return i||o.options.disabled!==!0&&!e(this).hasClass(\"ui-state-disabled\")?(\"string\"==typeof r?o[r]:r).apply(o,arguments):t}\"string\"!=typeof r&&(h.guid=r.guid=r.guid||h.guid||e.guid++);var l=n.match(/^(\\w+)\\s*(.*)$/),u=l[1]+o.eventNamespace,c=l[2];c?a.delegate(c,u,h):s.bind(u,h)})},_off:function(e,t){t=(t||\"\").split(\" \").join(this.eventNamespace+\" \")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function i(){return(\"string\"==typeof e?s[e]:e).apply(s,arguments)}var s=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass(\"ui-state-hover\")},mouseleave:function(t){e(t.currentTarget).removeClass(\"ui-state-hover\")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass(\"ui-state-focus\")},focusout:function(t){e(t.currentTarget).removeClass(\"ui-state-focus\")}})},_trigger:function(t,i,s){var n,a,o=this.options[t];if(s=s||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],a=i.originalEvent)for(n in a)n in i||(i[n]=a[n]);return this.element.trigger(i,s),!(e.isFunction(o)&&o.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},e.each({show:\"fadeIn\",hide:\"fadeOut\"},function(t,i){e.Widget.prototype[\"_\"+t]=function(s,n,a){\"string\"==typeof n&&(n={effect:n});var o,r=n?n===!0||\"number\"==typeof n?i:n.effect||i:t;n=n||{},\"number\"==typeof n&&(n={duration:n}),o=!e.isEmptyObject(n),n.complete=a,n.delay&&s.delay(n.delay),o&&e.effects&&(e.effects.effect[r]||e.uiBackCompat!==!1&&e.effects[r])?s[t](n):r!==t&&s[r]?s[r](n.duration,n.easing,a):s.queue(function(i){e(this)[t](),a&&a.call(s[0]),i()})}}),e.uiBackCompat!==!1&&(e.Widget.prototype._getCreateOptions=function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName]})})(jQuery);(function(e){var t=!1;e(document).mouseup(function(){t=!1}),e.widget(\"ui.mouse\",{version:\"1.9.2\",options:{cancel:\"input,textarea,button,select,option\",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind(\"mousedown.\"+this.widgetName,function(e){return t._mouseDown(e)}).bind(\"click.\"+this.widgetName,function(i){return!0===e.data(i.target,t.widgetName+\".preventClickEvent\")?(e.removeData(i.target,t.widgetName+\".preventClickEvent\"),i.stopImmediatePropagation(),!1):undefined}),this.started=!1},_mouseDestroy:function(){this.element.unbind(\".\"+this.widgetName),this._mouseMoveDelegate&&e(document).unbind(\"mousemove.\"+this.widgetName,this._mouseMoveDelegate).unbind(\"mouseup.\"+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(i){if(!t){this._mouseStarted&&this._mouseUp(i),this._mouseDownEvent=i;var s=this,n=1===i.which,a=\"string\"==typeof this.options.cancel&&i.target.nodeName?e(i.target).closest(this.options.cancel).length:!1;return n&&!a&&this._mouseCapture(i)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){s.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(i)&&this._mouseDelayMet(i)&&(this._mouseStarted=this._mouseStart(i)!==!1,!this._mouseStarted)?(i.preventDefault(),!0):(!0===e.data(i.target,this.widgetName+\".preventClickEvent\")&&e.removeData(i.target,this.widgetName+\".preventClickEvent\"),this._mouseMoveDelegate=function(e){return s._mouseMove(e)},this._mouseUpDelegate=function(e){return s._mouseUp(e)},e(document).bind(\"mousemove.\"+this.widgetName,this._mouseMoveDelegate).bind(\"mouseup.\"+this.widgetName,this._mouseUpDelegate),i.preventDefault(),t=!0,!0)):!0}},_mouseMove:function(t){return!e.ui.ie||document.documentMode>=9||t.button?this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted):this._mouseUp(t)},_mouseUp:function(t){return e(document).unbind(\"mousemove.\"+this.widgetName,this._mouseMoveDelegate).unbind(\"mouseup.\"+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+\".preventClickEvent\",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})})(jQuery);(function(e,t){function i(e,t,i){return[parseInt(e[0],10)*(d.test(e[0])?t/100:1),parseInt(e[1],10)*(d.test(e[1])?i/100:1)]}function s(t,i){return parseInt(e.css(t,i),10)||0}e.ui=e.ui||{};var n,a=Math.max,o=Math.abs,r=Math.round,h=/left|center|right/,l=/top|center|bottom/,u=/[\\+\\-]\\d+%?/,c=/^\\w+/,d=/%$/,p=e.fn.position;e.position={scrollbarWidth:function(){if(n!==t)return n;var i,s,a=e(\"<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>\"),o=a.children()[0];return e(\"body\").append(a),i=o.offsetWidth,a.css(\"overflow\",\"scroll\"),s=o.offsetWidth,i===s&&(s=a[0].clientWidth),a.remove(),n=i-s},getScrollInfo:function(t){var i=t.isWindow?\"\":t.element.css(\"overflow-x\"),s=t.isWindow?\"\":t.element.css(\"overflow-y\"),n=\"scroll\"===i||\"auto\"===i&&t.width<t.element[0].scrollWidth,a=\"scroll\"===s||\"auto\"===s&&t.height<t.element[0].scrollHeight;return{width:n?e.position.scrollbarWidth():0,height:a?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var i=e(t||window),s=e.isWindow(i[0]);return{element:i,isWindow:s,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:s?i.width():i.outerWidth(),height:s?i.height():i.outerHeight()}}},e.fn.position=function(t){if(!t||!t.of)return p.apply(this,arguments);t=e.extend({},t);var n,d,f,m,g,v=e(t.of),b=e.position.getWithinInfo(t.within),y=e.position.getScrollInfo(b),_=v[0],x=(t.collision||\"flip\").split(\" \"),w={};return 9===_.nodeType?(d=v.width(),f=v.height(),m={top:0,left:0}):e.isWindow(_)?(d=v.width(),f=v.height(),m={top:v.scrollTop(),left:v.scrollLeft()}):_.preventDefault?(t.at=\"left top\",d=f=0,m={top:_.pageY,left:_.pageX}):(d=v.outerWidth(),f=v.outerHeight(),m=v.offset()),g=e.extend({},m),e.each([\"my\",\"at\"],function(){var e,i,s=(t[this]||\"\").split(\" \");1===s.length&&(s=h.test(s[0])?s.concat([\"center\"]):l.test(s[0])?[\"center\"].concat(s):[\"center\",\"center\"]),s[0]=h.test(s[0])?s[0]:\"center\",s[1]=l.test(s[1])?s[1]:\"center\",e=u.exec(s[0]),i=u.exec(s[1]),w[this]=[e?e[0]:0,i?i[0]:0],t[this]=[c.exec(s[0])[0],c.exec(s[1])[0]]}),1===x.length&&(x[1]=x[0]),\"right\"===t.at[0]?g.left+=d:\"center\"===t.at[0]&&(g.left+=d/2),\"bottom\"===t.at[1]?g.top+=f:\"center\"===t.at[1]&&(g.top+=f/2),n=i(w.at,d,f),g.left+=n[0],g.top+=n[1],this.each(function(){var h,l,u=e(this),c=u.outerWidth(),p=u.outerHeight(),_=s(this,\"marginLeft\"),k=s(this,\"marginTop\"),D=c+_+s(this,\"marginRight\")+y.width,T=p+k+s(this,\"marginBottom\")+y.height,S=e.extend({},g),M=i(w.my,u.outerWidth(),u.outerHeight());\"right\"===t.my[0]?S.left-=c:\"center\"===t.my[0]&&(S.left-=c/2),\"bottom\"===t.my[1]?S.top-=p:\"center\"===t.my[1]&&(S.top-=p/2),S.left+=M[0],S.top+=M[1],e.support.offsetFractions||(S.left=r(S.left),S.top=r(S.top)),h={marginLeft:_,marginTop:k},e.each([\"left\",\"top\"],function(i,s){e.ui.position[x[i]]&&e.ui.position[x[i]][s](S,{targetWidth:d,targetHeight:f,elemWidth:c,elemHeight:p,collisionPosition:h,collisionWidth:D,collisionHeight:T,offset:[n[0]+M[0],n[1]+M[1]],my:t.my,at:t.at,within:b,elem:u})}),e.fn.bgiframe&&u.bgiframe(),t.using&&(l=function(e){var i=m.left-S.left,s=i+d-c,n=m.top-S.top,r=n+f-p,h={target:{element:v,left:m.left,top:m.top,width:d,height:f},element:{element:u,left:S.left,top:S.top,width:c,height:p},horizontal:0>s?\"left\":i>0?\"right\":\"center\",vertical:0>r?\"top\":n>0?\"bottom\":\"middle\"};c>d&&d>o(i+s)&&(h.horizontal=\"center\"),p>f&&f>o(n+r)&&(h.vertical=\"middle\"),h.important=a(o(i),o(s))>a(o(n),o(r))?\"horizontal\":\"vertical\",t.using.call(this,e,h)}),u.offset(e.extend(S,{using:l}))})},e.ui.position={fit:{left:function(e,t){var i,s=t.within,n=s.isWindow?s.scrollLeft:s.offset.left,o=s.width,r=e.left-t.collisionPosition.marginLeft,h=n-r,l=r+t.collisionWidth-o-n;t.collisionWidth>o?h>0&&0>=l?(i=e.left+h+t.collisionWidth-o-n,e.left+=h-i):e.left=l>0&&0>=h?n:h>l?n+o-t.collisionWidth:n:h>0?e.left+=h:l>0?e.left-=l:e.left=a(e.left-r,e.left)},top:function(e,t){var i,s=t.within,n=s.isWindow?s.scrollTop:s.offset.top,o=t.within.height,r=e.top-t.collisionPosition.marginTop,h=n-r,l=r+t.collisionHeight-o-n;t.collisionHeight>o?h>0&&0>=l?(i=e.top+h+t.collisionHeight-o-n,e.top+=h-i):e.top=l>0&&0>=h?n:h>l?n+o-t.collisionHeight:n:h>0?e.top+=h:l>0?e.top-=l:e.top=a(e.top-r,e.top)}},flip:{left:function(e,t){var i,s,n=t.within,a=n.offset.left+n.scrollLeft,r=n.width,h=n.isWindow?n.scrollLeft:n.offset.left,l=e.left-t.collisionPosition.marginLeft,u=l-h,c=l+t.collisionWidth-r-h,d=\"left\"===t.my[0]?-t.elemWidth:\"right\"===t.my[0]?t.elemWidth:0,p=\"left\"===t.at[0]?t.targetWidth:\"right\"===t.at[0]?-t.targetWidth:0,f=-2*t.offset[0];0>u?(i=e.left+d+p+f+t.collisionWidth-r-a,(0>i||o(u)>i)&&(e.left+=d+p+f)):c>0&&(s=e.left-t.collisionPosition.marginLeft+d+p+f-h,(s>0||c>o(s))&&(e.left+=d+p+f))},top:function(e,t){var i,s,n=t.within,a=n.offset.top+n.scrollTop,r=n.height,h=n.isWindow?n.scrollTop:n.offset.top,l=e.top-t.collisionPosition.marginTop,u=l-h,c=l+t.collisionHeight-r-h,d=\"top\"===t.my[1],p=d?-t.elemHeight:\"bottom\"===t.my[1]?t.elemHeight:0,f=\"top\"===t.at[1]?t.targetHeight:\"bottom\"===t.at[1]?-t.targetHeight:0,m=-2*t.offset[1];0>u?(s=e.top+p+f+m+t.collisionHeight-r-a,e.top+p+f+m>u&&(0>s||o(u)>s)&&(e.top+=p+f+m)):c>0&&(i=e.top-t.collisionPosition.marginTop+p+f+m-h,e.top+p+f+m>c&&(i>0||c>o(i))&&(e.top+=p+f+m))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,i,s,n,a,o=document.getElementsByTagName(\"body\")[0],r=document.createElement(\"div\");t=document.createElement(o?\"div\":\"body\"),s={visibility:\"hidden\",width:0,height:0,border:0,margin:0,background:\"none\"},o&&e.extend(s,{position:\"absolute\",left:\"-1000px\",top:\"-1000px\"});for(a in s)t.style[a]=s[a];t.appendChild(r),i=o||document.documentElement,i.insertBefore(t,i.firstChild),r.style.cssText=\"position: absolute; left: 10.7432222px;\",n=e(r).offset().left,e.support.offsetFractions=n>10&&11>n,t.innerHTML=\"\",i.removeChild(t)}(),e.uiBackCompat!==!1&&function(e){var i=e.fn.position;e.fn.position=function(s){if(!s||!s.offset)return i.call(this,s);var n=s.offset.split(\" \"),a=s.at.split(\" \");return 1===n.length&&(n[1]=n[0]),/^\\d/.test(n[0])&&(n[0]=\"+\"+n[0]),/^\\d/.test(n[1])&&(n[1]=\"+\"+n[1]),1===a.length&&(/left|center|right/.test(a[0])?a[1]=\"center\":(a[1]=a[0],a[0]=\"center\")),i.call(this,e.extend(s,{at:a[0]+n[0]+\" \"+a[1]+n[1],offset:t}))}}(jQuery)})(jQuery);(function(e){e.widget(\"ui.draggable\",e.ui.mouse,{version:\"1.9.2\",widgetEventPrefix:\"drag\",options:{addClasses:!0,appendTo:\"parent\",axis:!1,connectToSortable:!1,containment:!1,cursor:\"auto\",cursorAt:!1,grid:!1,handle:!1,helper:\"original\",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:\"default\",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:\"both\",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){\"original\"!=this.options.helper||/^(?:r|a|f)/.test(this.element.css(\"position\"))||(this.element[0].style.position=\"relative\"),this.options.addClasses&&this.element.addClass(\"ui-draggable\"),this.options.disabled&&this.element.addClass(\"ui-draggable-disabled\"),this._mouseInit()},_destroy:function(){this.element.removeClass(\"ui-draggable ui-draggable-dragging ui-draggable-disabled\"),this._mouseDestroy()},_mouseCapture:function(t){var i=this.options;return this.helper||i.disabled||e(t.target).is(\".ui-resizable-handle\")?!1:(this.handle=this._getHandle(t),this.handle?(e(i.iframeFix===!0?\"iframe\":i.iframeFix).each(function(){e('<div class=\"ui-draggable-iframeFix\" style=\"background: #fff;\"></div>').css({width:this.offsetWidth+\"px\",height:this.offsetHeight+\"px\",position:\"absolute\",opacity:\"0.001\",zIndex:1e3}).css(e(this).offset()).appendTo(\"body\")}),!0):!1)},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this.helper.addClass(\"ui-draggable-dragging\"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css(\"position\"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),i.containment&&this._setContainment(),this._trigger(\"start\",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,i){if(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo(\"absolute\"),!i){var s=this._uiHash();if(this._trigger(\"drag\",t,s)===!1)return this._mouseUp({}),!1;this.position=s.position}return this.options.axis&&\"y\"==this.options.axis||(this.helper[0].style.left=this.position.left+\"px\"),this.options.axis&&\"x\"==this.options.axis||(this.helper[0].style.top=this.position.top+\"px\"),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=!1;e.ui.ddmanager&&!this.options.dropBehaviour&&(i=e.ui.ddmanager.drop(this,t)),this.dropped&&(i=this.dropped,this.dropped=!1);for(var s=this.element[0],n=!1;s&&(s=s.parentNode);)s==document&&(n=!0);if(!n&&\"original\"===this.options.helper)return!1;if(\"invalid\"==this.options.revert&&!i||\"valid\"==this.options.revert&&i||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,i)){var a=this;e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){a._trigger(\"stop\",t)!==!1&&a._clear()})}else this._trigger(\"stop\",t)!==!1&&this._clear();return!1},_mouseUp:function(t){return e(\"div.ui-draggable-iframeFix\").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(\".ui-draggable-dragging\")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){var i=this.options.handle&&e(this.options.handle,this.element).length?!1:!0;return e(this.options.handle,this.element).find(\"*\").andSelf().each(function(){this==t.target&&(i=!0)}),i},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t])):\"clone\"==i.helper?this.element.clone().removeAttr(\"id\"):this.element;return s.parents(\"body\").length||s.appendTo(\"parent\"==i.appendTo?this.element[0].parentNode:i.appendTo),s[0]==this.element[0]||/(fixed|absolute)/.test(s.css(\"position\"))||s.css(\"position\",\"absolute\"),s},_adjustOffsetFromHelper:function(t){\"string\"==typeof t&&(t=t.split(\" \")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),\"left\"in t&&(this.offset.click.left=t.left+this.margins.left),\"right\"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),\"top\"in t&&(this.offset.click.top=t.top+this.margins.top),\"bottom\"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return\"absolute\"==this.cssPosition&&this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&\"html\"==this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css(\"borderTopWidth\"),10)||0),left:t.left+(parseInt(this.offsetParent.css(\"borderLeftWidth\"),10)||0)}},_getRelativeOffset:function(){if(\"relative\"==this.cssPosition){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css(\"top\"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css(\"left\"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css(\"marginLeft\"),10)||0,top:parseInt(this.element.css(\"marginTop\"),10)||0,right:parseInt(this.element.css(\"marginRight\"),10)||0,bottom:parseInt(this.element.css(\"marginBottom\"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;if(\"parent\"==t.containment&&(t.containment=this.helper[0].parentNode),(\"document\"==t.containment||\"window\"==t.containment)&&(this.containment=[\"document\"==t.containment?0:e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,\"document\"==t.containment?0:e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(\"document\"==t.containment?0:e(window).scrollLeft())+e(\"document\"==t.containment?document:window).width()-this.helperProportions.width-this.margins.left,(\"document\"==t.containment?0:e(window).scrollTop())+(e(\"document\"==t.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(t.containment)||t.containment.constructor==Array)t.containment.constructor==Array&&(this.containment=t.containment);else{var i=e(t.containment),s=i[0];if(!s)return;i.offset();var n=\"hidden\"!=e(s).css(\"overflow\");this.containment=[(parseInt(e(s).css(\"borderLeftWidth\"),10)||0)+(parseInt(e(s).css(\"paddingLeft\"),10)||0),(parseInt(e(s).css(\"borderTopWidth\"),10)||0)+(parseInt(e(s).css(\"paddingTop\"),10)||0),(n?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(e(s).css(\"borderLeftWidth\"),10)||0)-(parseInt(e(s).css(\"paddingRight\"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(n?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(e(s).css(\"borderTopWidth\"),10)||0)-(parseInt(e(s).css(\"paddingBottom\"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=i}},_convertPositionTo:function(t,i){i||(i=this.position);var s=\"absolute\"==t?1:-1,n=(this.options,\"absolute\"!=this.cssPosition||this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent),a=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-(\"fixed\"==this.cssPosition?-this.scrollParent.scrollTop():a?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-(\"fixed\"==this.cssPosition?-this.scrollParent.scrollLeft():a?0:n.scrollLeft())*s}},_generatePosition:function(t){var i=this.options,s=\"absolute\"!=this.cssPosition||this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,n=/(html|body)/i.test(s[0].tagName),a=t.pageX,o=t.pageY;if(this.originalPosition){var r;if(this.containment){if(this.relative_container){var h=this.relative_container.offset();r=[this.containment[0]+h.left,this.containment[1]+h.top,this.containment[2]+h.left,this.containment[3]+h.top]}else r=this.containment;t.pageX-this.offset.click.left<r[0]&&(a=r[0]+this.offset.click.left),t.pageY-this.offset.click.top<r[1]&&(o=r[1]+this.offset.click.top),t.pageX-this.offset.click.left>r[2]&&(a=r[2]+this.offset.click.left),t.pageY-this.offset.click.top>r[3]&&(o=r[3]+this.offset.click.top)}if(i.grid){var l=i.grid[1]?this.originalPageY+Math.round((o-this.originalPageY)/i.grid[1])*i.grid[1]:this.originalPageY;o=r?l-this.offset.click.top<r[1]||l-this.offset.click.top>r[3]?l-this.offset.click.top<r[1]?l+i.grid[1]:l-i.grid[1]:l:l;var u=i.grid[0]?this.originalPageX+Math.round((a-this.originalPageX)/i.grid[0])*i.grid[0]:this.originalPageX;a=r?u-this.offset.click.left<r[0]||u-this.offset.click.left>r[2]?u-this.offset.click.left<r[0]?u+i.grid[0]:u-i.grid[0]:u:u}}return{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(\"fixed\"==this.cssPosition?-this.scrollParent.scrollTop():n?0:s.scrollTop()),left:a-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(\"fixed\"==this.cssPosition?-this.scrollParent.scrollLeft():n?0:s.scrollLeft())}},_clear:function(){this.helper.removeClass(\"ui-draggable-dragging\"),this.helper[0]==this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,i,s){return s=s||this._uiHash(),e.ui.plugin.call(this,t,[i,s]),\"drag\"==t&&(this.positionAbs=this._convertPositionTo(\"absolute\")),e.Widget.prototype._trigger.call(this,t,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add(\"draggable\",\"connectToSortable\",{start:function(t,i){var s=e(this).data(\"draggable\"),n=s.options,a=e.extend({},i,{item:s.element});s.sortables=[],e(n.connectToSortable).each(function(){var i=e.data(this,\"sortable\");i&&!i.options.disabled&&(s.sortables.push({instance:i,shouldRevert:i.options.revert}),i.refreshPositions(),i._trigger(\"activate\",t,a))})},stop:function(t,i){var s=e(this).data(\"draggable\"),n=e.extend({},i,{item:s.element});e.each(s.sortables,function(){this.instance.isOver?(this.instance.isOver=0,s.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,\"original\"==s.options.helper&&this.instance.currentItem.css({top:\"auto\",left:\"auto\"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger(\"deactivate\",t,n))})},drag:function(t,i){var s=e(this).data(\"draggable\"),n=this;e.each(s.sortables,function(){var a=!1,o=this;this.instance.positionAbs=s.positionAbs,this.instance.helperProportions=s.helperProportions,this.instance.offset.click=s.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(a=!0,e.each(s.sortables,function(){return this.instance.positionAbs=s.positionAbs,this.instance.helperProportions=s.helperProportions,this.instance.offset.click=s.offset.click,this!=o&&this.instance._intersectsWith(this.instance.containerCache)&&e.ui.contains(o.instance.element[0],this.instance.element[0])&&(a=!1),a})),a?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(n).clone().removeAttr(\"id\").appendTo(this.instance.element).data(\"sortable-item\",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return i.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=s.offset.click.top,this.instance.offset.click.left=s.offset.click.left,this.instance.offset.parent.left-=s.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=s.offset.parent.top-this.instance.offset.parent.top,s._trigger(\"toSortable\",t),s.dropped=this.instance.element,s.currentItem=s.element,this.instance.fromOutside=s),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger(\"out\",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),s._trigger(\"fromSortable\",t),s.dropped=!1)})}}),e.ui.plugin.add(\"draggable\",\"cursor\",{start:function(){var t=e(\"body\"),i=e(this).data(\"draggable\").options;t.css(\"cursor\")&&(i._cursor=t.css(\"cursor\")),t.css(\"cursor\",i.cursor)},stop:function(){var t=e(this).data(\"draggable\").options;t._cursor&&e(\"body\").css(\"cursor\",t._cursor)}}),e.ui.plugin.add(\"draggable\",\"opacity\",{start:function(t,i){var s=e(i.helper),n=e(this).data(\"draggable\").options;s.css(\"opacity\")&&(n._opacity=s.css(\"opacity\")),s.css(\"opacity\",n.opacity)},stop:function(t,i){var s=e(this).data(\"draggable\").options;s._opacity&&e(i.helper).css(\"opacity\",s._opacity)}}),e.ui.plugin.add(\"draggable\",\"scroll\",{start:function(){var t=e(this).data(\"draggable\");t.scrollParent[0]!=document&&\"HTML\"!=t.scrollParent[0].tagName&&(t.overflowOffset=t.scrollParent.offset())},drag:function(t){var i=e(this).data(\"draggable\"),s=i.options,n=!1;i.scrollParent[0]!=document&&\"HTML\"!=i.scrollParent[0].tagName?(s.axis&&\"x\"==s.axis||(i.overflowOffset.top+i.scrollParent[0].offsetHeight-t.pageY<s.scrollSensitivity?i.scrollParent[0].scrollTop=n=i.scrollParent[0].scrollTop+s.scrollSpeed:t.pageY-i.overflowOffset.top<s.scrollSensitivity&&(i.scrollParent[0].scrollTop=n=i.scrollParent[0].scrollTop-s.scrollSpeed)),s.axis&&\"y\"==s.axis||(i.overflowOffset.left+i.scrollParent[0].offsetWidth-t.pageX<s.scrollSensitivity?i.scrollParent[0].scrollLeft=n=i.scrollParent[0].scrollLeft+s.scrollSpeed:t.pageX-i.overflowOffset.left<s.scrollSensitivity&&(i.scrollParent[0].scrollLeft=n=i.scrollParent[0].scrollLeft-s.scrollSpeed))):(s.axis&&\"x\"==s.axis||(t.pageY-e(document).scrollTop()<s.scrollSensitivity?n=e(document).scrollTop(e(document).scrollTop()-s.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<s.scrollSensitivity&&(n=e(document).scrollTop(e(document).scrollTop()+s.scrollSpeed))),s.axis&&\"y\"==s.axis||(t.pageX-e(document).scrollLeft()<s.scrollSensitivity?n=e(document).scrollLeft(e(document).scrollLeft()-s.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<s.scrollSensitivity&&(n=e(document).scrollLeft(e(document).scrollLeft()+s.scrollSpeed)))),n!==!1&&e.ui.ddmanager&&!s.dropBehaviour&&e.ui.ddmanager.prepareOffsets(i,t)}}),e.ui.plugin.add(\"draggable\",\"snap\",{start:function(){var t=e(this).data(\"draggable\"),i=t.options;t.snapElements=[],e(i.snap.constructor!=String?i.snap.items||\":data(draggable)\":i.snap).each(function(){var i=e(this),s=i.offset();this!=t.element[0]&&t.snapElements.push({item:this,width:i.outerWidth(),height:i.outerHeight(),top:s.top,left:s.left})})},drag:function(t,i){for(var s=e(this).data(\"draggable\"),n=s.options,a=n.snapTolerance,o=i.offset.left,r=o+s.helperProportions.width,h=i.offset.top,l=h+s.helperProportions.height,u=s.snapElements.length-1;u>=0;u--){var d=s.snapElements[u].left,c=d+s.snapElements[u].width,p=s.snapElements[u].top,f=p+s.snapElements[u].height;if(o>d-a&&c+a>o&&h>p-a&&f+a>h||o>d-a&&c+a>o&&l>p-a&&f+a>l||r>d-a&&c+a>r&&h>p-a&&f+a>h||r>d-a&&c+a>r&&l>p-a&&f+a>l){if(\"inner\"!=n.snapMode){var m=a>=Math.abs(p-l),g=a>=Math.abs(f-h),v=a>=Math.abs(d-r),y=a>=Math.abs(c-o);m&&(i.position.top=s._convertPositionTo(\"relative\",{top:p-s.helperProportions.height,left:0}).top-s.margins.top),g&&(i.position.top=s._convertPositionTo(\"relative\",{top:f,left:0}).top-s.margins.top),v&&(i.position.left=s._convertPositionTo(\"relative\",{top:0,left:d-s.helperProportions.width}).left-s.margins.left),y&&(i.position.left=s._convertPositionTo(\"relative\",{top:0,left:c}).left-s.margins.left)}var _=m||g||v||y;if(\"outer\"!=n.snapMode){var m=a>=Math.abs(p-h),g=a>=Math.abs(f-l),v=a>=Math.abs(d-o),y=a>=Math.abs(c-r);m&&(i.position.top=s._convertPositionTo(\"relative\",{top:p,left:0}).top-s.margins.top),g&&(i.position.top=s._convertPositionTo(\"relative\",{top:f-s.helperProportions.height,left:0}).top-s.margins.top),v&&(i.position.left=s._convertPositionTo(\"relative\",{top:0,left:d}).left-s.margins.left),y&&(i.position.left=s._convertPositionTo(\"relative\",{top:0,left:c-s.helperProportions.width}).left-s.margins.left)}!s.snapElements[u].snapping&&(m||g||v||y||_)&&s.options.snap.snap&&s.options.snap.snap.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[u].item})),s.snapElements[u].snapping=m||g||v||y||_}else s.snapElements[u].snapping&&s.options.snap.release&&s.options.snap.release.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[u].item})),s.snapElements[u].snapping=!1}}}),e.ui.plugin.add(\"draggable\",\"stack\",{start:function(){var t=e(this).data(\"draggable\").options,i=e.makeArray(e(t.stack)).sort(function(t,i){return(parseInt(e(t).css(\"zIndex\"),10)||0)-(parseInt(e(i).css(\"zIndex\"),10)||0)});if(i.length){var s=parseInt(i[0].style.zIndex)||0;e(i).each(function(e){this.style.zIndex=s+e}),this[0].style.zIndex=s+i.length}}}),e.ui.plugin.add(\"draggable\",\"zIndex\",{start:function(t,i){var s=e(i.helper),n=e(this).data(\"draggable\").options;s.css(\"zIndex\")&&(n._zIndex=s.css(\"zIndex\")),s.css(\"zIndex\",n.zIndex)},stop:function(t,i){var s=e(this).data(\"draggable\").options;s._zIndex&&e(i.helper).css(\"zIndex\",s._zIndex)}})})(jQuery);(function(e){e.widget(\"ui.droppable\",{version:\"1.9.2\",widgetEventPrefix:\"drop\",options:{accept:\"*\",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:\"default\",tolerance:\"intersect\"},_create:function(){var t=this.options,i=t.accept;this.isover=0,this.isout=1,this.accept=e.isFunction(i)?i:function(e){return e.is(i)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},e.ui.ddmanager.droppables[t.scope]=e.ui.ddmanager.droppables[t.scope]||[],e.ui.ddmanager.droppables[t.scope].push(this),t.addClasses&&this.element.addClass(\"ui-droppable\")},_destroy:function(){for(var t=e.ui.ddmanager.droppables[this.options.scope],i=0;t.length>i;i++)t[i]==this&&t.splice(i,1);this.element.removeClass(\"ui-droppable ui-droppable-disabled\")},_setOption:function(t,i){\"accept\"==t&&(this.accept=e.isFunction(i)?i:function(e){return e.is(i)}),e.Widget.prototype._setOption.apply(this,arguments)},_activate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger(\"activate\",t,this.ui(i))},_deactivate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger(\"deactivate\",t,this.ui(i))},_over:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!=this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger(\"over\",t,this.ui(i)))},_out:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!=this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger(\"out\",t,this.ui(i)))},_drop:function(t,i){var s=i||e.ui.ddmanager.current;if(!s||(s.currentItem||s.element)[0]==this.element[0])return!1;var n=!1;return this.element.find(\":data(droppable)\").not(\".ui-draggable-dragging\").each(function(){var t=e.data(this,\"droppable\");return t.options.greedy&&!t.options.disabled&&t.options.scope==s.options.scope&&t.accept.call(t.element[0],s.currentItem||s.element)&&e.ui.intersect(s,e.extend(t,{offset:t.element.offset()}),t.options.tolerance)?(n=!0,!1):undefined}),n?!1:this.accept.call(this.element[0],s.currentItem||s.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger(\"drop\",t,this.ui(s)),this.element):!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(t,i,s){if(!i.offset)return!1;var n=(t.positionAbs||t.position.absolute).left,a=n+t.helperProportions.width,o=(t.positionAbs||t.position.absolute).top,r=o+t.helperProportions.height,h=i.offset.left,l=h+i.proportions.width,u=i.offset.top,d=u+i.proportions.height;switch(s){case\"fit\":return n>=h&&l>=a&&o>=u&&d>=r;case\"intersect\":return n+t.helperProportions.width/2>h&&l>a-t.helperProportions.width/2&&o+t.helperProportions.height/2>u&&d>r-t.helperProportions.height/2;case\"pointer\":var c=(t.positionAbs||t.position.absolute).left+(t.clickOffset||t.offset.click).left,p=(t.positionAbs||t.position.absolute).top+(t.clickOffset||t.offset.click).top,f=e.ui.isOver(p,c,u,h,i.proportions.height,i.proportions.width);return f;case\"touch\":return(o>=u&&d>=o||r>=u&&d>=r||u>o&&r>d)&&(n>=h&&l>=n||a>=h&&l>=a||h>n&&a>l);default:return!1}},e.ui.ddmanager={current:null,droppables:{\"default\":[]},prepareOffsets:function(t,i){var s=e.ui.ddmanager.droppables[t.options.scope]||[],n=i?i.type:null,a=(t.currentItem||t.element).find(\":data(droppable)\").andSelf();e:for(var o=0;s.length>o;o++)if(!(s[o].options.disabled||t&&!s[o].accept.call(s[o].element[0],t.currentItem||t.element))){for(var r=0;a.length>r;r++)if(a[r]==s[o].element[0]){s[o].proportions.height=0;continue e}s[o].visible=\"none\"!=s[o].element.css(\"display\"),s[o].visible&&(\"mousedown\"==n&&s[o]._activate.call(s[o],i),s[o].offset=s[o].element.offset(),s[o].proportions={width:s[o].element[0].offsetWidth,height:s[o].element[0].offsetHeight})}},drop:function(t,i){var s=!1;return e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance)&&(s=this._drop.call(this,i)||s),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=1,this.isover=0,this._deactivate.call(this,i)))}),s},dragStart:function(t,i){t.element.parentsUntil(\"body\").bind(\"scroll.droppable\",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)})},drag:function(t,i){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,i),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var s=e.ui.intersect(t,this,this.options.tolerance),n=s||1!=this.isover?s&&0==this.isover?\"isover\":null:\"isout\";if(n){var a;if(this.options.greedy){var o=this.options.scope,r=this.element.parents(\":data(droppable)\").filter(function(){return e.data(this,\"droppable\").options.scope===o});r.length&&(a=e.data(r[0],\"droppable\"),a.greedyChild=\"isover\"==n?1:0)}a&&\"isover\"==n&&(a.isover=0,a.isout=1,a._out.call(a,i)),this[n]=1,this[\"isout\"==n?\"isover\":\"isout\"]=0,this[\"isover\"==n?\"_over\":\"_out\"].call(this,i),a&&\"isout\"==n&&(a.isout=0,a.isover=1,a._over.call(a,i))}}})},dragStop:function(t,i){t.element.parentsUntil(\"body\").unbind(\"scroll.droppable\"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)}}})(jQuery);(function(e){e.widget(\"ui.resizable\",e.ui.mouse,{version:\"1.9.2\",widgetEventPrefix:\"resize\",options:{alsoResize:!1,animate:!1,animateDuration:\"slow\",animateEasing:\"swing\",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:\"e,s,se\",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1e3},_create:function(){var t=this,i=this.options;if(this.element.addClass(\"ui-resizable\"),e.extend(this,{_aspectRatio:!!i.aspectRatio,aspectRatio:i.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:i.helper||i.ghost||i.animate?i.helper||\"ui-resizable-helper\":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(e('<div class=\"ui-wrapper\" style=\"overflow: hidden;\"></div>').css({position:this.element.css(\"position\"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css(\"top\"),left:this.element.css(\"left\")})),this.element=this.element.parent().data(\"resizable\",this.element.data(\"resizable\")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css(\"marginLeft\"),marginTop:this.originalElement.css(\"marginTop\"),marginRight:this.originalElement.css(\"marginRight\"),marginBottom:this.originalElement.css(\"marginBottom\")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css(\"resize\"),this.originalElement.css(\"resize\",\"none\"),this._proportionallyResizeElements.push(this.originalElement.css({position:\"static\",zoom:1,display:\"block\"})),this.originalElement.css({margin:this.originalElement.css(\"margin\")}),this._proportionallyResize()),this.handles=i.handles||(e(\".ui-resizable-handle\",this.element).length?{n:\".ui-resizable-n\",e:\".ui-resizable-e\",s:\".ui-resizable-s\",w:\".ui-resizable-w\",se:\".ui-resizable-se\",sw:\".ui-resizable-sw\",ne:\".ui-resizable-ne\",nw:\".ui-resizable-nw\"}:\"e,s,se\"),this.handles.constructor==String){\"all\"==this.handles&&(this.handles=\"n,e,s,w,se,sw,ne,nw\");var s=this.handles.split(\",\");this.handles={};for(var n=0;s.length>n;n++){var a=e.trim(s[n]),o=\"ui-resizable-\"+a,r=e('<div class=\"ui-resizable-handle '+o+'\"></div>');r.css({zIndex:i.zIndex}),\"se\"==a&&r.addClass(\"ui-icon ui-icon-gripsmall-diagonal-se\"),this.handles[a]=\".ui-resizable-\"+a,this.element.append(r)}}this._renderAxis=function(t){t=t||this.element;for(var i in this.handles){if(this.handles[i].constructor==String&&(this.handles[i]=e(this.handles[i],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var s=e(this.handles[i],this.element),n=0;n=/sw|ne|nw|se|n|s/.test(i)?s.outerHeight():s.outerWidth();var a=[\"padding\",/ne|nw|n/.test(i)?\"Top\":/se|sw|s/.test(i)?\"Bottom\":/^e$/.test(i)?\"Right\":\"Left\"].join(\"\");t.css(a,n),this._proportionallyResize()}e(this.handles[i]).length}},this._renderAxis(this.element),this._handles=e(\".ui-resizable-handle\",this.element).disableSelection(),this._handles.mouseover(function(){if(!t.resizing){if(this.className)var e=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);t.axis=e&&e[1]?e[1]:\"se\"}}),i.autoHide&&(this._handles.hide(),e(this.element).addClass(\"ui-resizable-autohide\").mouseenter(function(){i.disabled||(e(this).removeClass(\"ui-resizable-autohide\"),t._handles.show())}).mouseleave(function(){i.disabled||t.resizing||(e(this).addClass(\"ui-resizable-autohide\"),t._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t=function(t){e(t).removeClass(\"ui-resizable ui-resizable-disabled ui-resizable-resizing\").removeData(\"resizable\").removeData(\"ui-resizable\").unbind(\".resizable\").find(\".ui-resizable-handle\").remove()};if(this.elementIsWrapper){t(this.element);var i=this.element;this.originalElement.css({position:i.css(\"position\"),width:i.outerWidth(),height:i.outerHeight(),top:i.css(\"top\"),left:i.css(\"left\")}).insertAfter(i),i.remove()}return this.originalElement.css(\"resize\",this.originalResizeStyle),t(this.originalElement),this},_mouseCapture:function(t){var i=!1;for(var s in this.handles)e(this.handles[s])[0]==t.target&&(i=!0);return!this.options.disabled&&i},_mouseStart:function(i){var s=this.options,n=this.element.position(),a=this.element;this.resizing=!0,this.documentScroll={top:e(document).scrollTop(),left:e(document).scrollLeft()},(a.is(\".ui-draggable\")||/absolute/.test(a.css(\"position\")))&&a.css({position:\"absolute\",top:n.top,left:n.left}),this._renderProxy();var o=t(this.helper.css(\"left\")),r=t(this.helper.css(\"top\"));s.containment&&(o+=e(s.containment).scrollLeft()||0,r+=e(s.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:o,top:r},this.size=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:a.width(),height:a.height()},this.originalSize=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:a.width(),height:a.height()},this.originalPosition={left:o,top:r},this.sizeDiff={width:a.outerWidth()-a.width(),height:a.outerHeight()-a.height()},this.originalMousePosition={left:i.pageX,top:i.pageY},this.aspectRatio=\"number\"==typeof s.aspectRatio?s.aspectRatio:this.originalSize.width/this.originalSize.height||1;var h=e(\".ui-resizable-\"+this.axis).css(\"cursor\");return e(\"body\").css(\"cursor\",\"auto\"==h?this.axis+\"-resize\":h),a.addClass(\"ui-resizable-resizing\"),this._propagate(\"start\",i),!0},_mouseDrag:function(e){var t=this.helper,i=(this.options,this.originalMousePosition),s=this.axis,n=e.pageX-i.left||0,a=e.pageY-i.top||0,o=this._change[s];if(!o)return!1;var r=o.apply(this,[e,n,a]);return this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(r=this._updateRatio(r,e)),r=this._respectSize(r,e),this._propagate(\"resize\",e),t.css({top:this.position.top+\"px\",left:this.position.left+\"px\",width:this.size.width+\"px\",height:this.size.height+\"px\"}),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),this._updateCache(r),this._trigger(\"resize\",e,this.ui()),!1},_mouseStop:function(t){this.resizing=!1;var i=this.options,s=this;if(this._helper){var n=this._proportionallyResizeElements,a=n.length&&/textarea/i.test(n[0].nodeName),o=a&&e.ui.hasScroll(n[0],\"left\")?0:s.sizeDiff.height,r=a?0:s.sizeDiff.width,h={width:s.helper.width()-r,height:s.helper.height()-o},l=parseInt(s.element.css(\"left\"),10)+(s.position.left-s.originalPosition.left)||null,u=parseInt(s.element.css(\"top\"),10)+(s.position.top-s.originalPosition.top)||null;i.animate||this.element.css(e.extend(h,{top:u,left:l})),s.helper.height(s.size.height),s.helper.width(s.size.width),this._helper&&!i.animate&&this._proportionallyResize()}return e(\"body\").css(\"cursor\",\"auto\"),this.element.removeClass(\"ui-resizable-resizing\"),this._propagate(\"stop\",t),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(e){var t,s,n,a,o,r=this.options;o={minWidth:i(r.minWidth)?r.minWidth:0,maxWidth:i(r.maxWidth)?r.maxWidth:1/0,minHeight:i(r.minHeight)?r.minHeight:0,maxHeight:i(r.maxHeight)?r.maxHeight:1/0},(this._aspectRatio||e)&&(t=o.minHeight*this.aspectRatio,n=o.minWidth/this.aspectRatio,s=o.maxHeight*this.aspectRatio,a=o.maxWidth/this.aspectRatio,t>o.minWidth&&(o.minWidth=t),n>o.minHeight&&(o.minHeight=n),o.maxWidth>s&&(o.maxWidth=s),o.maxHeight>a&&(o.maxHeight=a)),this._vBoundaries=o},_updateCache:function(e){this.options,this.offset=this.helper.offset(),i(e.left)&&(this.position.left=e.left),i(e.top)&&(this.position.top=e.top),i(e.height)&&(this.size.height=e.height),i(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=(this.options,this.position),s=this.size,n=this.axis;return i(e.height)?e.width=e.height*this.aspectRatio:i(e.width)&&(e.height=e.width/this.aspectRatio),\"sw\"==n&&(e.left=t.left+(s.width-e.width),e.top=null),\"nw\"==n&&(e.top=t.top+(s.height-e.height),e.left=t.left+(s.width-e.width)),e},_respectSize:function(e,t){var s=(this.helper,this._vBoundaries),n=(this._aspectRatio||t.shiftKey,this.axis),a=i(e.width)&&s.maxWidth&&s.maxWidth<e.width,o=i(e.height)&&s.maxHeight&&s.maxHeight<e.height,r=i(e.width)&&s.minWidth&&s.minWidth>e.width,h=i(e.height)&&s.minHeight&&s.minHeight>e.height;r&&(e.width=s.minWidth),h&&(e.height=s.minHeight),a&&(e.width=s.maxWidth),o&&(e.height=s.maxHeight);var l=this.originalPosition.left+this.originalSize.width,u=this.position.top+this.size.height,c=/sw|nw|w/.test(n),d=/nw|ne|n/.test(n);r&&c&&(e.left=l-s.minWidth),a&&c&&(e.left=l-s.maxWidth),h&&d&&(e.top=u-s.minHeight),o&&d&&(e.top=u-s.maxHeight);var p=!e.width&&!e.height;return p&&!e.left&&e.top?e.top=null:p&&!e.top&&e.left&&(e.left=null),e},_proportionallyResize:function(){if(this.options,this._proportionallyResizeElements.length)for(var t=this.helper||this.element,i=0;this._proportionallyResizeElements.length>i;i++){var s=this._proportionallyResizeElements[i];if(!this.borderDif){var n=[s.css(\"borderTopWidth\"),s.css(\"borderRightWidth\"),s.css(\"borderBottomWidth\"),s.css(\"borderLeftWidth\")],a=[s.css(\"paddingTop\"),s.css(\"paddingRight\"),s.css(\"paddingBottom\"),s.css(\"paddingLeft\")];this.borderDif=e.map(n,function(e,t){var i=parseInt(e,10)||0,s=parseInt(a[t],10)||0;return i+s})}s.css({height:t.height()-this.borderDif[0]-this.borderDif[2]||0,width:t.width()-this.borderDif[1]-this.borderDif[3]||0})}},_renderProxy:function(){var t=this.element,i=this.options;if(this.elementOffset=t.offset(),this._helper){this.helper=this.helper||e('<div style=\"overflow:hidden;\"></div>');var s=e.ui.ie6?1:0,n=e.ui.ie6?2:-1;this.helper.addClass(this._helper).css({width:this.element.outerWidth()+n,height:this.element.outerHeight()+n,position:\"absolute\",left:this.elementOffset.left-s+\"px\",top:this.elementOffset.top-s+\"px\",zIndex:++i.zIndex}),this.helper.appendTo(\"body\").disableSelection()}else this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var i=(this.options,this.originalSize),s=this.originalPosition;return{left:s.left+t,width:i.width-t}},n:function(e,t,i){var s=(this.options,this.originalSize),n=this.originalPosition;return{top:n.top+i,height:s.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(t,i,s){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,i,s]))},sw:function(t,i,s){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,i,s]))},ne:function(t,i,s){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,i,s]))},nw:function(t,i,s){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,i,s]))}},_propagate:function(t,i){e.ui.plugin.call(this,t,[i,this.ui()]),\"resize\"!=t&&this._trigger(t,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add(\"resizable\",\"alsoResize\",{start:function(){var t=e(this).data(\"resizable\"),i=t.options,s=function(t){e(t).each(function(){var t=e(this);t.data(\"resizable-alsoresize\",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css(\"left\"),10),top:parseInt(t.css(\"top\"),10)})})};\"object\"!=typeof i.alsoResize||i.alsoResize.parentNode?s(i.alsoResize):i.alsoResize.length?(i.alsoResize=i.alsoResize[0],s(i.alsoResize)):e.each(i.alsoResize,function(e){s(e)})},resize:function(t,i){var s=e(this).data(\"resizable\"),n=s.options,a=s.originalSize,o=s.originalPosition,r={height:s.size.height-a.height||0,width:s.size.width-a.width||0,top:s.position.top-o.top||0,left:s.position.left-o.left||0},h=function(t,s){e(t).each(function(){var t=e(this),n=e(this).data(\"resizable-alsoresize\"),a={},o=s&&s.length?s:t.parents(i.originalElement[0]).length?[\"width\",\"height\"]:[\"width\",\"height\",\"top\",\"left\"];e.each(o,function(e,t){var i=(n[t]||0)+(r[t]||0);i&&i>=0&&(a[t]=i||null)}),t.css(a)})};\"object\"!=typeof n.alsoResize||n.alsoResize.nodeType?h(n.alsoResize):e.each(n.alsoResize,function(e,t){h(e,t)})},stop:function(){e(this).removeData(\"resizable-alsoresize\")}}),e.ui.plugin.add(\"resizable\",\"animate\",{stop:function(t){var i=e(this).data(\"resizable\"),s=i.options,n=i._proportionallyResizeElements,a=n.length&&/textarea/i.test(n[0].nodeName),o=a&&e.ui.hasScroll(n[0],\"left\")?0:i.sizeDiff.height,r=a?0:i.sizeDiff.width,h={width:i.size.width-r,height:i.size.height-o},l=parseInt(i.element.css(\"left\"),10)+(i.position.left-i.originalPosition.left)||null,u=parseInt(i.element.css(\"top\"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(e.extend(h,u&&l?{top:u,left:l}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var s={width:parseInt(i.element.css(\"width\"),10),height:parseInt(i.element.css(\"height\"),10),top:parseInt(i.element.css(\"top\"),10),left:parseInt(i.element.css(\"left\"),10)};n&&n.length&&e(n[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate(\"resize\",t)}})}}),e.ui.plugin.add(\"resizable\",\"containment\",{start:function(){var i=e(this).data(\"resizable\"),s=i.options,n=i.element,a=s.containment,o=a instanceof e?a.get(0):/parent/.test(a)?n.parent().get(0):a;if(o)if(i.containerElement=e(o),/document/.test(a)||a==document)i.containerOffset={left:0,top:0},i.containerPosition={left:0,top:0},i.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight};else{var r=e(o),h=[];e([\"Top\",\"Right\",\"Left\",\"Bottom\"]).each(function(e,i){h[e]=t(r.css(\"padding\"+i))}),i.containerOffset=r.offset(),i.containerPosition=r.position(),i.containerSize={height:r.innerHeight()-h[3],width:r.innerWidth()-h[1]};var l=i.containerOffset,u=i.containerSize.height,c=i.containerSize.width,d=e.ui.hasScroll(o,\"left\")?o.scrollWidth:c,p=e.ui.hasScroll(o)?o.scrollHeight:u;i.parentData={element:o,left:l.left,top:l.top,width:d,height:p}}},resize:function(t){var i=e(this).data(\"resizable\"),s=i.options,n=(i.containerSize,i.containerOffset),a=(i.size,i.position),o=i._aspectRatio||t.shiftKey,r={top:0,left:0},h=i.containerElement;h[0]!=document&&/static/.test(h.css(\"position\"))&&(r=n),a.left<(i._helper?n.left:0)&&(i.size.width=i.size.width+(i._helper?i.position.left-n.left:i.position.left-r.left),o&&(i.size.height=i.size.width/i.aspectRatio),i.position.left=s.helper?n.left:0),a.top<(i._helper?n.top:0)&&(i.size.height=i.size.height+(i._helper?i.position.top-n.top:i.position.top),o&&(i.size.width=i.size.height*i.aspectRatio),i.position.top=i._helper?n.top:0),i.offset.left=i.parentData.left+i.position.left,i.offset.top=i.parentData.top+i.position.top;var l=Math.abs((i._helper?i.offset.left-r.left:i.offset.left-r.left)+i.sizeDiff.width),u=Math.abs((i._helper?i.offset.top-r.top:i.offset.top-n.top)+i.sizeDiff.height),c=i.containerElement.get(0)==i.element.parent().get(0),d=/relative|absolute/.test(i.containerElement.css(\"position\"));c&&d&&(l-=i.parentData.left),l+i.size.width>=i.parentData.width&&(i.size.width=i.parentData.width-l,o&&(i.size.height=i.size.width/i.aspectRatio)),u+i.size.height>=i.parentData.height&&(i.size.height=i.parentData.height-u,o&&(i.size.width=i.size.height*i.aspectRatio))},stop:function(){var t=e(this).data(\"resizable\"),i=t.options,s=(t.position,t.containerOffset),n=t.containerPosition,a=t.containerElement,o=e(t.helper),r=o.offset(),h=o.outerWidth()-t.sizeDiff.width,l=o.outerHeight()-t.sizeDiff.height;t._helper&&!i.animate&&/relative/.test(a.css(\"position\"))&&e(this).css({left:r.left-n.left-s.left,width:h,height:l}),t._helper&&!i.animate&&/static/.test(a.css(\"position\"))&&e(this).css({left:r.left-n.left-s.left,width:h,height:l})}}),e.ui.plugin.add(\"resizable\",\"ghost\",{start:function(){var t=e(this).data(\"resizable\"),i=t.options,s=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:\"block\",position:\"relative\",height:s.height,width:s.width,margin:0,left:0,top:0}).addClass(\"ui-resizable-ghost\").addClass(\"string\"==typeof i.ghost?i.ghost:\"\"),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).data(\"resizable\");t.options,t.ghost&&t.ghost.css({position:\"relative\",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).data(\"resizable\");t.options,t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add(\"resizable\",\"grid\",{resize:function(t){var i=e(this).data(\"resizable\"),s=i.options,n=i.size,a=i.originalSize,o=i.originalPosition,r=i.axis;s._aspectRatio||t.shiftKey,s.grid=\"number\"==typeof s.grid?[s.grid,s.grid]:s.grid;var h=Math.round((n.width-a.width)/(s.grid[0]||1))*(s.grid[0]||1),l=Math.round((n.height-a.height)/(s.grid[1]||1))*(s.grid[1]||1);/^(se|s|e)$/.test(r)?(i.size.width=a.width+h,i.size.height=a.height+l):/^(ne)$/.test(r)?(i.size.width=a.width+h,i.size.height=a.height+l,i.position.top=o.top-l):/^(sw)$/.test(r)?(i.size.width=a.width+h,i.size.height=a.height+l,i.position.left=o.left-h):(i.size.width=a.width+h,i.size.height=a.height+l,i.position.top=o.top-l,i.position.left=o.left-h)}});var t=function(e){return parseInt(e,10)||0},i=function(e){return!isNaN(parseInt(e,10))}})(jQuery);(function(e){e.widget(\"ui.selectable\",e.ui.mouse,{version:\"1.9.2\",options:{appendTo:\"body\",autoRefresh:!0,distance:0,filter:\"*\",tolerance:\"touch\"},_create:function(){var t=this;this.element.addClass(\"ui-selectable\"),this.dragged=!1;var i;this.refresh=function(){i=e(t.options.filter,t.element[0]),i.addClass(\"ui-selectee\"),i.each(function(){var t=e(this),i=t.offset();e.data(this,\"selectable-item\",{element:this,$element:t,left:i.left,top:i.top,right:i.left+t.outerWidth(),bottom:i.top+t.outerHeight(),startselected:!1,selected:t.hasClass(\"ui-selected\"),selecting:t.hasClass(\"ui-selecting\"),unselecting:t.hasClass(\"ui-unselecting\")})})},this.refresh(),this.selectees=i.addClass(\"ui-selectee\"),this._mouseInit(),this.helper=e(\"<div class='ui-selectable-helper'></div>\")},_destroy:function(){this.selectees.removeClass(\"ui-selectee\").removeData(\"selectable-item\"),this.element.removeClass(\"ui-selectable ui-selectable-disabled\"),this._mouseDestroy()},_mouseStart:function(t){var i=this;if(this.opos=[t.pageX,t.pageY],!this.options.disabled){var s=this.options;this.selectees=e(s.filter,this.element[0]),this._trigger(\"start\",t),e(s.appendTo).append(this.helper),this.helper.css({left:t.clientX,top:t.clientY,width:0,height:0}),s.autoRefresh&&this.refresh(),this.selectees.filter(\".ui-selected\").each(function(){var s=e.data(this,\"selectable-item\");s.startselected=!0,t.metaKey||t.ctrlKey||(s.$element.removeClass(\"ui-selected\"),s.selected=!1,s.$element.addClass(\"ui-unselecting\"),s.unselecting=!0,i._trigger(\"unselecting\",t,{unselecting:s.element}))}),e(t.target).parents().andSelf().each(function(){var s=e.data(this,\"selectable-item\");if(s){var n=!t.metaKey&&!t.ctrlKey||!s.$element.hasClass(\"ui-selected\");return s.$element.removeClass(n?\"ui-unselecting\":\"ui-selected\").addClass(n?\"ui-selecting\":\"ui-unselecting\"),s.unselecting=!n,s.selecting=n,s.selected=n,n?i._trigger(\"selecting\",t,{selecting:s.element}):i._trigger(\"unselecting\",t,{unselecting:s.element}),!1}})}},_mouseDrag:function(t){var i=this;if(this.dragged=!0,!this.options.disabled){var s=this.options,n=this.opos[0],a=this.opos[1],o=t.pageX,r=t.pageY;if(n>o){var h=o;o=n,n=h}if(a>r){var h=r;r=a,a=h}return this.helper.css({left:n,top:a,width:o-n,height:r-a}),this.selectees.each(function(){var h=e.data(this,\"selectable-item\");if(h&&h.element!=i.element[0]){var l=!1;\"touch\"==s.tolerance?l=!(h.left>o||n>h.right||h.top>r||a>h.bottom):\"fit\"==s.tolerance&&(l=h.left>n&&o>h.right&&h.top>a&&r>h.bottom),l?(h.selected&&(h.$element.removeClass(\"ui-selected\"),h.selected=!1),h.unselecting&&(h.$element.removeClass(\"ui-unselecting\"),h.unselecting=!1),h.selecting||(h.$element.addClass(\"ui-selecting\"),h.selecting=!0,i._trigger(\"selecting\",t,{selecting:h.element}))):(h.selecting&&((t.metaKey||t.ctrlKey)&&h.startselected?(h.$element.removeClass(\"ui-selecting\"),h.selecting=!1,h.$element.addClass(\"ui-selected\"),h.selected=!0):(h.$element.removeClass(\"ui-selecting\"),h.selecting=!1,h.startselected&&(h.$element.addClass(\"ui-unselecting\"),h.unselecting=!0),i._trigger(\"unselecting\",t,{unselecting:h.element}))),h.selected&&(t.metaKey||t.ctrlKey||h.startselected||(h.$element.removeClass(\"ui-selected\"),h.selected=!1,h.$element.addClass(\"ui-unselecting\"),h.unselecting=!0,i._trigger(\"unselecting\",t,{unselecting:h.element}))))}}),!1}},_mouseStop:function(t){var i=this;return this.dragged=!1,this.options,e(\".ui-unselecting\",this.element[0]).each(function(){var s=e.data(this,\"selectable-item\");s.$element.removeClass(\"ui-unselecting\"),s.unselecting=!1,s.startselected=!1,i._trigger(\"unselected\",t,{unselected:s.element})}),e(\".ui-selecting\",this.element[0]).each(function(){var s=e.data(this,\"selectable-item\");s.$element.removeClass(\"ui-selecting\").addClass(\"ui-selected\"),s.selecting=!1,s.selected=!0,s.startselected=!0,i._trigger(\"selected\",t,{selected:s.element})}),this._trigger(\"stop\",t),this.helper.remove(),!1}})})(jQuery);(function(e){e.widget(\"ui.sortable\",e.ui.mouse,{version:\"1.9.2\",widgetEventPrefix:\"sort\",ready:!1,options:{appendTo:\"parent\",axis:!1,connectWith:!1,containment:!1,cursor:\"auto\",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:\"original\",items:\"> *\",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:\"default\",tolerance:\"intersect\",zIndex:1e3},_create:function(){var e=this.options;this.containerCache={},this.element.addClass(\"ui-sortable\"),this.refresh(),this.floating=this.items.length?\"x\"===e.axis||/left|right/.test(this.items[0].item.css(\"float\"))||/inline|table-cell/.test(this.items[0].item.css(\"display\")):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass(\"ui-sortable ui-sortable-disabled\"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+\"-item\");return this},_setOption:function(t,i){\"disabled\"===t?(this.options[t]=i,this.widget().toggleClass(\"ui-sortable-disabled\",!!i)):e.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,i){var s=this;if(this.reverting)return!1;if(this.options.disabled||\"static\"==this.options.type)return!1;this._refreshItems(t);var n=null;if(e(t.target).parents().each(function(){return e.data(this,s.widgetName+\"-item\")==s?(n=e(this),!1):undefined}),e.data(t.target,s.widgetName+\"-item\")==s&&(n=e(t.target)),!n)return!1;if(this.options.handle&&!i){var a=!1;if(e(this.options.handle,n).find(\"*\").andSelf().each(function(){this==t.target&&(a=!0)}),!a)return!1}return this.currentItem=n,this._removeCurrentsFromItems(),!0},_mouseStart:function(t,i,s){var n=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css(\"position\",\"absolute\"),this.cssPosition=this.helper.css(\"position\"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!=this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),n.containment&&this._setContainment(),n.cursor&&(e(\"body\").css(\"cursor\")&&(this._storedCursor=e(\"body\").css(\"cursor\")),e(\"body\").css(\"cursor\",n.cursor)),n.opacity&&(this.helper.css(\"opacity\")&&(this._storedOpacity=this.helper.css(\"opacity\")),this.helper.css(\"opacity\",n.opacity)),n.zIndex&&(this.helper.css(\"zIndex\")&&(this._storedZIndex=this.helper.css(\"zIndex\")),this.helper.css(\"zIndex\",n.zIndex)),this.scrollParent[0]!=document&&\"HTML\"!=this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger(\"start\",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(var a=this.containers.length-1;a>=0;a--)this.containers[a]._trigger(\"activate\",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass(\"ui-sortable-helper\"),this._mouseDrag(t),!0},_mouseDrag:function(t){if(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo(\"absolute\"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll){var i=this.options,s=!1;this.scrollParent[0]!=document&&\"HTML\"!=this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<i.scrollSensitivity?this.scrollParent[0].scrollTop=s=this.scrollParent[0].scrollTop+i.scrollSpeed:t.pageY-this.overflowOffset.top<i.scrollSensitivity&&(this.scrollParent[0].scrollTop=s=this.scrollParent[0].scrollTop-i.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<i.scrollSensitivity?this.scrollParent[0].scrollLeft=s=this.scrollParent[0].scrollLeft+i.scrollSpeed:t.pageX-this.overflowOffset.left<i.scrollSensitivity&&(this.scrollParent[0].scrollLeft=s=this.scrollParent[0].scrollLeft-i.scrollSpeed)):(t.pageY-e(document).scrollTop()<i.scrollSensitivity?s=e(document).scrollTop(e(document).scrollTop()-i.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<i.scrollSensitivity&&(s=e(document).scrollTop(e(document).scrollTop()+i.scrollSpeed)),t.pageX-e(document).scrollLeft()<i.scrollSensitivity?s=e(document).scrollLeft(e(document).scrollLeft()-i.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<i.scrollSensitivity&&(s=e(document).scrollLeft(e(document).scrollLeft()+i.scrollSpeed))),s!==!1&&e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)}this.positionAbs=this._convertPositionTo(\"absolute\"),this.options.axis&&\"y\"==this.options.axis||(this.helper[0].style.left=this.position.left+\"px\"),this.options.axis&&\"x\"==this.options.axis||(this.helper[0].style.top=this.position.top+\"px\");for(var n=this.items.length-1;n>=0;n--){var a=this.items[n],o=a.item[0],r=this._intersectsWithPointer(a);if(r&&a.instance===this.currentContainer&&o!=this.currentItem[0]&&this.placeholder[1==r?\"next\":\"prev\"]()[0]!=o&&!e.contains(this.placeholder[0],o)&&(\"semi-dynamic\"==this.options.type?!e.contains(this.element[0],o):!0)){if(this.direction=1==r?\"down\":\"up\",\"pointer\"!=this.options.tolerance&&!this._intersectsWithSides(a))break;this._rearrange(t,a),this._trigger(\"change\",t,this._uiHash());break}}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger(\"sort\",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var s=this,n=this.placeholder.offset();this.reverting=!0,e(this.helper).animate({left:n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){s._clear(t)})}else this._clear(t,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),\"original\"==this.options.helper?this.currentItem.css(this._storedCSS).removeClass(\"ui-sortable-helper\"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger(\"deactivate\",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger(\"out\",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),\"original\"!=this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},e(i).each(function(){var i=(e(t.item||this).attr(t.attribute||\"id\")||\"\").match(t.expression||/(.+)[-=_](.+)/);i&&s.push((t.key||i[1]+\"[]\")+\"=\"+(t.key&&t.expression?i[1]:i[2]))}),!s.length&&t.key&&s.push(t.key+\"=\"),s.join(\"&\")},toArray:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},i.each(function(){s.push(e(t.item||this).attr(t.attribute||\"id\")||\"\")}),s},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,a=e.left,o=a+e.width,r=e.top,h=r+e.height,l=this.offset.click.top,u=this.offset.click.left,c=s+l>r&&h>s+l&&t+u>a&&o>t+u;return\"pointer\"==this.options.tolerance||this.options.forcePointerForContainers||\"pointer\"!=this.options.tolerance&&this.helperProportions[this.floating?\"width\":\"height\"]>e[this.floating?\"width\":\"height\"]?c:t+this.helperProportions.width/2>a&&o>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>r&&h>n-this.helperProportions.height/2},_intersectsWithPointer:function(t){var i=\"x\"===this.options.axis||e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),s=\"y\"===this.options.axis||e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),n=i&&s,a=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return n?this.floating?o&&\"right\"==o||\"down\"==a?2:1:a&&(\"down\"==a?2:1):!1},_intersectsWithSides:function(t){var i=e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),s=e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),n=this._getDragVerticalDirection(),a=this._getDragHorizontalDirection();return this.floating&&a?\"right\"==a&&s||\"left\"==a&&!s:n&&(\"down\"==n&&i||\"up\"==n&&!i)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!=e&&(e>0?\"down\":\"up\")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!=e&&(e>0?\"right\":\"left\")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor==String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){var i=[],s=[],n=this._connectWith();if(n&&t)for(var a=n.length-1;a>=0;a--)for(var o=e(n[a]),r=o.length-1;r>=0;r--){var h=e.data(o[r],this.widgetName);h&&h!=this&&!h.options.disabled&&s.push([e.isFunction(h.options.items)?h.options.items.call(h.element):e(h.options.items,h.element).not(\".ui-sortable-helper\").not(\".ui-sortable-placeholder\"),h])}s.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(\".ui-sortable-helper\").not(\".ui-sortable-placeholder\"),this]);for(var a=s.length-1;a>=0;a--)s[a][0].each(function(){i.push(this)});return e(i)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(\":data(\"+this.widgetName+\"-item)\");this.items=e.grep(this.items,function(e){for(var i=0;t.length>i;i++)if(t[i]==e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var i=this.items,s=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],n=this._connectWith();if(n&&this.ready)for(var a=n.length-1;a>=0;a--)for(var o=e(n[a]),r=o.length-1;r>=0;r--){var h=e.data(o[r],this.widgetName);h&&h!=this&&!h.options.disabled&&(s.push([e.isFunction(h.options.items)?h.options.items.call(h.element[0],t,{item:this.currentItem}):e(h.options.items,h.element),h]),this.containers.push(h))}for(var a=s.length-1;a>=0;a--)for(var l=s[a][1],u=s[a][0],r=0,c=u.length;c>r;r++){var d=e(u[r]);d.data(this.widgetName+\"-item\",l),i.push({item:d,instance:l,width:0,height:0,left:0,top:0})}},refreshPositions:function(t){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());for(var i=this.items.length-1;i>=0;i--){var s=this.items[i];if(s.instance==this.currentContainer||!this.currentContainer||s.item[0]==this.currentItem[0]){var n=this.options.toleranceElement?e(this.options.toleranceElement,s.item):s.item;t||(s.width=n.outerWidth(),s.height=n.outerHeight());var a=n.offset();s.left=a.left,s.top=a.top}}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(var i=this.containers.length-1;i>=0;i--){var a=this.containers[i].element.offset();this.containers[i].containerCache.left=a.left,this.containers[i].containerCache.top=a.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight()}return this},_createPlaceholder:function(t){t=t||this;var i=t.options;if(!i.placeholder||i.placeholder.constructor==String){var s=i.placeholder;i.placeholder={element:function(){var i=e(document.createElement(t.currentItem[0].nodeName)).addClass(s||t.currentItem[0].className+\" ui-sortable-placeholder\").removeClass(\"ui-sortable-helper\")[0];return s||(i.style.visibility=\"hidden\"),i},update:function(e,n){(!s||i.forcePlaceholderSize)&&(n.height()||n.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css(\"paddingTop\")||0,10)-parseInt(t.currentItem.css(\"paddingBottom\")||0,10)),n.width()||n.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css(\"paddingLeft\")||0,10)-parseInt(t.currentItem.css(\"paddingRight\")||0,10)))}}}t.placeholder=e(i.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),i.placeholder.update(t,t.placeholder)},_contactContainers:function(t){for(var i=null,s=null,n=this.containers.length-1;n>=0;n--)if(!e.contains(this.currentItem[0],this.containers[n].element[0]))if(this._intersectsWith(this.containers[n].containerCache)){if(i&&e.contains(this.containers[n].element[0],i.element[0]))continue;i=this.containers[n],s=n}else this.containers[n].containerCache.over&&(this.containers[n]._trigger(\"out\",t,this._uiHash(this)),this.containers[n].containerCache.over=0);if(i)if(1===this.containers.length)this.containers[s]._trigger(\"over\",t,this._uiHash(this)),this.containers[s].containerCache.over=1;else{for(var a=1e4,o=null,r=this.containers[s].floating?\"left\":\"top\",h=this.containers[s].floating?\"width\":\"height\",l=this.positionAbs[r]+this.offset.click[r],u=this.items.length-1;u>=0;u--)if(e.contains(this.containers[s].element[0],this.items[u].item[0])&&this.items[u].item[0]!=this.currentItem[0]){var c=this.items[u].item.offset()[r],d=!1;Math.abs(c-l)>Math.abs(c+this.items[u][h]-l)&&(d=!0,c+=this.items[u][h]),a>Math.abs(c-l)&&(a=Math.abs(c-l),o=this.items[u],this.direction=d?\"up\":\"down\")}if(!o&&!this.options.dropOnEmpty)return;this.currentContainer=this.containers[s],o?this._rearrange(t,o,null,!0):this._rearrange(t,null,this.containers[s].element,!0),this._trigger(\"change\",t,this._uiHash()),this.containers[s]._trigger(\"change\",t,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[s]._trigger(\"over\",t,this._uiHash(this)),this.containers[s].containerCache.over=1}},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):\"clone\"==i.helper?this.currentItem.clone():this.currentItem;return s.parents(\"body\").length||e(\"parent\"!=i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css(\"position\"),top:this.currentItem.css(\"top\"),left:this.currentItem.css(\"left\")}),(\"\"==s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(\"\"==s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(t){\"string\"==typeof t&&(t=t.split(\" \")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),\"left\"in t&&(this.offset.click.left=t.left+this.margins.left),\"right\"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),\"top\"in t&&(this.offset.click.top=t.top+this.margins.top),\"bottom\"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return\"absolute\"==this.cssPosition&&this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&\"html\"==this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css(\"borderTopWidth\"),10)||0),left:t.left+(parseInt(this.offsetParent.css(\"borderLeftWidth\"),10)||0)}},_getRelativeOffset:function(){if(\"relative\"==this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css(\"top\"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css(\"left\"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css(\"marginLeft\"),10)||0,top:parseInt(this.currentItem.css(\"marginTop\"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;if(\"parent\"==t.containment&&(t.containment=this.helper[0].parentNode),(\"document\"==t.containment||\"window\"==t.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e(\"document\"==t.containment?document:window).width()-this.helperProportions.width-this.margins.left,(e(\"document\"==t.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),!/^(document|window|parent)$/.test(t.containment)){var i=e(t.containment)[0],s=e(t.containment).offset(),n=\"hidden\"!=e(i).css(\"overflow\");this.containment=[s.left+(parseInt(e(i).css(\"borderLeftWidth\"),10)||0)+(parseInt(e(i).css(\"paddingLeft\"),10)||0)-this.margins.left,s.top+(parseInt(e(i).css(\"borderTopWidth\"),10)||0)+(parseInt(e(i).css(\"paddingTop\"),10)||0)-this.margins.top,s.left+(n?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(e(i).css(\"borderLeftWidth\"),10)||0)-(parseInt(e(i).css(\"paddingRight\"),10)||0)-this.helperProportions.width-this.margins.left,s.top+(n?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(e(i).css(\"borderTopWidth\"),10)||0)-(parseInt(e(i).css(\"paddingBottom\"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(t,i){i||(i=this.position);var s=\"absolute\"==t?1:-1,n=(this.options,\"absolute\"!=this.cssPosition||this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent),a=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-(\"fixed\"==this.cssPosition?-this.scrollParent.scrollTop():a?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-(\"fixed\"==this.cssPosition?-this.scrollParent.scrollLeft():a?0:n.scrollLeft())*s}},_generatePosition:function(t){var i=this.options,s=\"absolute\"!=this.cssPosition||this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,n=/(html|body)/i.test(s[0].tagName);\"relative\"!=this.cssPosition||this.scrollParent[0]!=document&&this.scrollParent[0]!=this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset());var a=t.pageX,o=t.pageY;if(this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(a=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(a=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top)),i.grid)){var r=this.originalPageY+Math.round((o-this.originalPageY)/i.grid[1])*i.grid[1];o=this.containment?r-this.offset.click.top<this.containment[1]||r-this.offset.click.top>this.containment[3]?r-this.offset.click.top<this.containment[1]?r+i.grid[1]:r-i.grid[1]:r:r;var h=this.originalPageX+Math.round((a-this.originalPageX)/i.grid[0])*i.grid[0];a=this.containment?h-this.offset.click.left<this.containment[0]||h-this.offset.click.left>this.containment[2]?h-this.offset.click.left<this.containment[0]?h+i.grid[0]:h-i.grid[0]:h:h}return{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(\"fixed\"==this.cssPosition?-this.scrollParent.scrollTop():n?0:s.scrollTop()),left:a-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(\"fixed\"==this.cssPosition?-this.scrollParent.scrollLeft():n?0:s.scrollLeft())}},_rearrange:function(e,t,i,s){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],\"down\"==this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n==this.counter&&this.refreshPositions(!s)})},_clear:function(t,i){this.reverting=!1;var s=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]==this.currentItem[0]){for(var n in this._storedCSS)(\"auto\"==this._storedCSS[n]||\"static\"==this._storedCSS[n])&&(this._storedCSS[n]=\"\");this.currentItem.css(this._storedCSS).removeClass(\"ui-sortable-helper\")}else this.currentItem.show();this.fromOutside&&!i&&s.push(function(e){this._trigger(\"receive\",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev==this.currentItem.prev().not(\".ui-sortable-helper\")[0]&&this.domPosition.parent==this.currentItem.parent()[0]||i||s.push(function(e){this._trigger(\"update\",e,this._uiHash())}),this!==this.currentContainer&&(i||(s.push(function(e){this._trigger(\"remove\",e,this._uiHash())}),s.push(function(e){return function(t){e._trigger(\"receive\",t,this._uiHash(this))}}.call(this,this.currentContainer)),s.push(function(e){return function(t){e._trigger(\"update\",t,this._uiHash(this))}}.call(this,this.currentContainer))));for(var n=this.containers.length-1;n>=0;n--)i||s.push(function(e){return function(t){e._trigger(\"deactivate\",t,this._uiHash(this))}}.call(this,this.containers[n])),this.containers[n].containerCache.over&&(s.push(function(e){return function(t){e._trigger(\"out\",t,this._uiHash(this))}}.call(this,this.containers[n])),this.containers[n].containerCache.over=0);if(this._storedCursor&&e(\"body\").css(\"cursor\",this._storedCursor),this._storedOpacity&&this.helper.css(\"opacity\",this._storedOpacity),this._storedZIndex&&this.helper.css(\"zIndex\",\"auto\"==this._storedZIndex?\"\":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!i){this._trigger(\"beforeStop\",t,this._uiHash());for(var n=0;s.length>n;n++)s[n].call(this,t);this._trigger(\"stop\",t,this._uiHash())}return this.fromOutside=!1,!1}if(i||this._trigger(\"beforeStop\",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!=this.currentItem[0]&&this.helper.remove(),this.helper=null,!i){for(var n=0;s.length>n;n++)s[n].call(this,t);this._trigger(\"stop\",t,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}})})(jQuery);(function(e){var t,i,s,n,a=\"ui-button ui-widget ui-state-default ui-corner-all\",o=\"ui-state-hover ui-state-active \",r=\"ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only\",h=function(){var t=e(this).find(\":ui-button\");setTimeout(function(){t.button(\"refresh\")},1)},l=function(t){var i=t.name,s=t.form,n=e([]);return i&&(n=s?e(s).find(\"[name='\"+i+\"']\"):e(\"[name='\"+i+\"']\",t.ownerDocument).filter(function(){return!this.form})),n};e.widget(\"ui.button\",{version:\"1.9.2\",defaultElement:\"<button>\",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest(\"form\").unbind(\"reset\"+this.eventNamespace).bind(\"reset\"+this.eventNamespace,h),\"boolean\"!=typeof this.options.disabled?this.options.disabled=!!this.element.prop(\"disabled\"):this.element.prop(\"disabled\",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr(\"title\");var o=this,r=this.options,u=\"checkbox\"===this.type||\"radio\"===this.type,d=u?\"\":\"ui-state-active\",c=\"ui-state-focus\";null===r.label&&(r.label=\"input\"===this.type?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(a).attr(\"role\",\"button\").bind(\"mouseenter\"+this.eventNamespace,function(){r.disabled||this===t&&e(this).addClass(\"ui-state-active\")}).bind(\"mouseleave\"+this.eventNamespace,function(){r.disabled||e(this).removeClass(d)}).bind(\"click\"+this.eventNamespace,function(e){r.disabled&&(e.preventDefault(),e.stopImmediatePropagation())}),this.element.bind(\"focus\"+this.eventNamespace,function(){o.buttonElement.addClass(c)}).bind(\"blur\"+this.eventNamespace,function(){o.buttonElement.removeClass(c)}),u&&(this.element.bind(\"change\"+this.eventNamespace,function(){n||o.refresh()}),this.buttonElement.bind(\"mousedown\"+this.eventNamespace,function(e){r.disabled||(n=!1,i=e.pageX,s=e.pageY)}).bind(\"mouseup\"+this.eventNamespace,function(e){r.disabled||(i!==e.pageX||s!==e.pageY)&&(n=!0)})),\"checkbox\"===this.type?this.buttonElement.bind(\"click\"+this.eventNamespace,function(){return r.disabled||n?!1:(e(this).toggleClass(\"ui-state-active\"),o.buttonElement.attr(\"aria-pressed\",o.element[0].checked),undefined)}):\"radio\"===this.type?this.buttonElement.bind(\"click\"+this.eventNamespace,function(){if(r.disabled||n)return!1;e(this).addClass(\"ui-state-active\"),o.buttonElement.attr(\"aria-pressed\",\"true\");var t=o.element[0];l(t).not(t).map(function(){return e(this).button(\"widget\")[0]}).removeClass(\"ui-state-active\").attr(\"aria-pressed\",\"false\")}):(this.buttonElement.bind(\"mousedown\"+this.eventNamespace,function(){return r.disabled?!1:(e(this).addClass(\"ui-state-active\"),t=this,o.document.one(\"mouseup\",function(){t=null}),undefined)}).bind(\"mouseup\"+this.eventNamespace,function(){return r.disabled?!1:(e(this).removeClass(\"ui-state-active\"),undefined)}).bind(\"keydown\"+this.eventNamespace,function(t){return r.disabled?!1:((t.keyCode===e.ui.keyCode.SPACE||t.keyCode===e.ui.keyCode.ENTER)&&e(this).addClass(\"ui-state-active\"),undefined)}).bind(\"keyup\"+this.eventNamespace,function(){e(this).removeClass(\"ui-state-active\")}),this.buttonElement.is(\"a\")&&this.buttonElement.keyup(function(t){t.keyCode===e.ui.keyCode.SPACE&&e(this).click()})),this._setOption(\"disabled\",r.disabled),this._resetButton()},_determineButtonType:function(){var e,t,i;this.type=this.element.is(\"[type=checkbox]\")?\"checkbox\":this.element.is(\"[type=radio]\")?\"radio\":this.element.is(\"input\")?\"input\":\"button\",\"checkbox\"===this.type||\"radio\"===this.type?(e=this.element.parents().last(),t=\"label[for='\"+this.element.attr(\"id\")+\"']\",this.buttonElement=e.find(t),this.buttonElement.length||(e=e.length?e.siblings():this.element.siblings(),this.buttonElement=e.filter(t),this.buttonElement.length||(this.buttonElement=e.find(t))),this.element.addClass(\"ui-helper-hidden-accessible\"),i=this.element.is(\":checked\"),i&&this.buttonElement.addClass(\"ui-state-active\"),this.buttonElement.prop(\"aria-pressed\",i)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass(\"ui-helper-hidden-accessible\"),this.buttonElement.removeClass(a+\" \"+o+\" \"+r).removeAttr(\"role\").removeAttr(\"aria-pressed\").html(this.buttonElement.find(\".ui-button-text\").html()),this.hasTitle||this.buttonElement.removeAttr(\"title\")},_setOption:function(e,t){return this._super(e,t),\"disabled\"===e?(t?this.element.prop(\"disabled\",!0):this.element.prop(\"disabled\",!1),undefined):(this._resetButton(),undefined)},refresh:function(){var t=this.element.is(\"input, button\")?this.element.is(\":disabled\"):this.element.hasClass(\"ui-button-disabled\");t!==this.options.disabled&&this._setOption(\"disabled\",t),\"radio\"===this.type?l(this.element[0]).each(function(){e(this).is(\":checked\")?e(this).button(\"widget\").addClass(\"ui-state-active\").attr(\"aria-pressed\",\"true\"):e(this).button(\"widget\").removeClass(\"ui-state-active\").attr(\"aria-pressed\",\"false\")}):\"checkbox\"===this.type&&(this.element.is(\":checked\")?this.buttonElement.addClass(\"ui-state-active\").attr(\"aria-pressed\",\"true\"):this.buttonElement.removeClass(\"ui-state-active\").attr(\"aria-pressed\",\"false\"))},_resetButton:function(){if(\"input\"===this.type)return this.options.label&&this.element.val(this.options.label),undefined;var t=this.buttonElement.removeClass(r),i=e(\"<span></span>\",this.document[0]).addClass(\"ui-button-text\").html(this.options.label).appendTo(t.empty()).text(),s=this.options.icons,n=s.primary&&s.secondary,a=[];s.primary||s.secondary?(this.options.text&&a.push(\"ui-button-text-icon\"+(n?\"s\":s.primary?\"-primary\":\"-secondary\")),s.primary&&t.prepend(\"<span class='ui-button-icon-primary ui-icon \"+s.primary+\"'></span>\"),s.secondary&&t.append(\"<span class='ui-button-icon-secondary ui-icon \"+s.secondary+\"'></span>\"),this.options.text||(a.push(n?\"ui-button-icons-only\":\"ui-button-icon-only\"),this.hasTitle||t.attr(\"title\",e.trim(i)))):a.push(\"ui-button-text-only\"),t.addClass(a.join(\" \"))}}),e.widget(\"ui.buttonset\",{version:\"1.9.2\",options:{items:\"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(button)\"},_create:function(){this.element.addClass(\"ui-buttonset\")},_init:function(){this.refresh()},_setOption:function(e,t){\"disabled\"===e&&this.buttons.button(\"option\",e,t),this._super(e,t)},refresh:function(){var t=\"rtl\"===this.element.css(\"direction\");this.buttons=this.element.find(this.options.items).filter(\":ui-button\").button(\"refresh\").end().not(\":ui-button\").button().end().map(function(){return e(this).button(\"widget\")[0]}).removeClass(\"ui-corner-all ui-corner-left ui-corner-right\").filter(\":first\").addClass(t?\"ui-corner-right\":\"ui-corner-left\").end().filter(\":last\").addClass(t?\"ui-corner-left\":\"ui-corner-right\").end().end()},_destroy:function(){this.element.removeClass(\"ui-buttonset\"),this.buttons.map(function(){return e(this).button(\"widget\")[0]}).removeClass(\"ui-corner-left ui-corner-right\").end().button(\"destroy\")}})})(jQuery);(function(e,t){var i=\"ui-dialog ui-widget ui-widget-content ui-corner-all \",s={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},n={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0};e.widget(\"ui.dialog\",{version:\"1.9.2\",options:{autoOpen:!0,buttons:{},closeOnEscape:!0,closeText:\"close\",dialogClass:\"\",draggable:!0,hide:null,height:\"auto\",maxHeight:!1,maxWidth:!1,minHeight:150,minWidth:150,modal:!1,position:{my:\"center\",at:\"center\",of:window,collision:\"fit\",using:function(t){var i=e(this).css(t).offset().top;0>i&&e(this).css(\"top\",t.top-i)}},resizable:!0,show:null,stack:!0,title:\"\",width:300,zIndex:1e3},_create:function(){this.originalTitle=this.element.attr(\"title\"),\"string\"!=typeof this.originalTitle&&(this.originalTitle=\"\"),this.oldPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.options.title=this.options.title||this.originalTitle;var s,n,a,o,r,h=this,l=this.options,u=l.title||\"&#160;\";s=(this.uiDialog=e(\"<div>\")).addClass(i+l.dialogClass).css({display:\"none\",outline:0,zIndex:l.zIndex}).attr(\"tabIndex\",-1).keydown(function(t){l.closeOnEscape&&!t.isDefaultPrevented()&&t.keyCode&&t.keyCode===e.ui.keyCode.ESCAPE&&(h.close(t),t.preventDefault())}).mousedown(function(e){h.moveToTop(!1,e)}).appendTo(\"body\"),this.element.show().removeAttr(\"title\").addClass(\"ui-dialog-content ui-widget-content\").appendTo(s),n=(this.uiDialogTitlebar=e(\"<div>\")).addClass(\"ui-dialog-titlebar  ui-widget-header  ui-corner-all  ui-helper-clearfix\").bind(\"mousedown\",function(){s.focus()}).prependTo(s),a=e(\"<a href='#'></a>\").addClass(\"ui-dialog-titlebar-close  ui-corner-all\").attr(\"role\",\"button\").click(function(e){e.preventDefault(),h.close(e)}).appendTo(n),(this.uiDialogTitlebarCloseText=e(\"<span>\")).addClass(\"ui-icon ui-icon-closethick\").text(l.closeText).appendTo(a),o=e(\"<span>\").uniqueId().addClass(\"ui-dialog-title\").html(u).prependTo(n),r=(this.uiDialogButtonPane=e(\"<div>\")).addClass(\"ui-dialog-buttonpane ui-widget-content ui-helper-clearfix\"),(this.uiButtonSet=e(\"<div>\")).addClass(\"ui-dialog-buttonset\").appendTo(r),s.attr({role:\"dialog\",\"aria-labelledby\":o.attr(\"id\")}),n.find(\"*\").add(n).disableSelection(),this._hoverable(a),this._focusable(a),l.draggable&&e.fn.draggable&&this._makeDraggable(),l.resizable&&e.fn.resizable&&this._makeResizable(),this._createButtons(l.buttons),this._isOpen=!1,e.fn.bgiframe&&s.bgiframe(),this._on(s,{keydown:function(i){if(l.modal&&i.keyCode===e.ui.keyCode.TAB){var n=e(\":tabbable\",s),a=n.filter(\":first\"),o=n.filter(\":last\");return i.target!==o[0]||i.shiftKey?i.target===a[0]&&i.shiftKey?(o.focus(1),!1):t:(a.focus(1),!1)}}})},_init:function(){this.options.autoOpen&&this.open()},_destroy:function(){var e,t=this.oldPosition;this.overlay&&this.overlay.destroy(),this.uiDialog.hide(),this.element.removeClass(\"ui-dialog-content ui-widget-content\").hide().appendTo(\"body\"),this.uiDialog.remove(),this.originalTitle&&this.element.attr(\"title\",this.originalTitle),e=t.parent.children().eq(t.index),e.length&&e[0]!==this.element[0]?e.before(this.element):t.parent.append(this.element)},widget:function(){return this.uiDialog},close:function(t){var i,s,n=this;if(this._isOpen&&!1!==this._trigger(\"beforeClose\",t))return this._isOpen=!1,this.overlay&&this.overlay.destroy(),this.options.hide?this._hide(this.uiDialog,this.options.hide,function(){n._trigger(\"close\",t)}):(this.uiDialog.hide(),this._trigger(\"close\",t)),e.ui.dialog.overlay.resize(),this.options.modal&&(i=0,e(\".ui-dialog\").each(function(){this!==n.uiDialog[0]&&(s=e(this).css(\"z-index\"),isNaN(s)||(i=Math.max(i,s)))}),e.ui.dialog.maxZ=i),this},isOpen:function(){return this._isOpen},moveToTop:function(t,i){var s,n=this.options;return n.modal&&!t||!n.stack&&!n.modal?this._trigger(\"focus\",i):(n.zIndex>e.ui.dialog.maxZ&&(e.ui.dialog.maxZ=n.zIndex),this.overlay&&(e.ui.dialog.maxZ+=1,e.ui.dialog.overlay.maxZ=e.ui.dialog.maxZ,this.overlay.$el.css(\"z-index\",e.ui.dialog.overlay.maxZ)),s={scrollTop:this.element.scrollTop(),scrollLeft:this.element.scrollLeft()},e.ui.dialog.maxZ+=1,this.uiDialog.css(\"z-index\",e.ui.dialog.maxZ),this.element.attr(s),this._trigger(\"focus\",i),this)},open:function(){if(!this._isOpen){var t,i=this.options,s=this.uiDialog;return this._size(),this._position(i.position),s.show(i.show),this.overlay=i.modal?new e.ui.dialog.overlay(this):null,this.moveToTop(!0),t=this.element.find(\":tabbable\"),t.length||(t=this.uiDialogButtonPane.find(\":tabbable\"),t.length||(t=s)),t.eq(0).focus(),this._isOpen=!0,this._trigger(\"open\"),this}},_createButtons:function(t){var i=this,s=!1;this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),\"object\"==typeof t&&null!==t&&e.each(t,function(){return!(s=!0)}),s?(e.each(t,function(t,s){var n,a;s=e.isFunction(s)?{click:s,text:t}:s,s=e.extend({type:\"button\"},s),a=s.click,s.click=function(){a.apply(i.element[0],arguments)},n=e(\"<button></button>\",s).appendTo(i.uiButtonSet),e.fn.button&&n.button()}),this.uiDialog.addClass(\"ui-dialog-buttons\"),this.uiDialogButtonPane.appendTo(this.uiDialog)):this.uiDialog.removeClass(\"ui-dialog-buttons\")},_makeDraggable:function(){function t(e){return{position:e.position,offset:e.offset}}var i=this,s=this.options;this.uiDialog.draggable({cancel:\".ui-dialog-content, .ui-dialog-titlebar-close\",handle:\".ui-dialog-titlebar\",containment:\"document\",start:function(s,n){e(this).addClass(\"ui-dialog-dragging\"),i._trigger(\"dragStart\",s,t(n))},drag:function(e,s){i._trigger(\"drag\",e,t(s))},stop:function(n,a){s.position=[a.position.left-i.document.scrollLeft(),a.position.top-i.document.scrollTop()],e(this).removeClass(\"ui-dialog-dragging\"),i._trigger(\"dragStop\",n,t(a)),e.ui.dialog.overlay.resize()}})},_makeResizable:function(i){function s(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size}}i=i===t?this.options.resizable:i;var n=this,a=this.options,o=this.uiDialog.css(\"position\"),r=\"string\"==typeof i?i:\"n,e,s,w,se,sw,ne,nw\";this.uiDialog.resizable({cancel:\".ui-dialog-content\",containment:\"document\",alsoResize:this.element,maxWidth:a.maxWidth,maxHeight:a.maxHeight,minWidth:a.minWidth,minHeight:this._minHeight(),handles:r,start:function(t,i){e(this).addClass(\"ui-dialog-resizing\"),n._trigger(\"resizeStart\",t,s(i))},resize:function(e,t){n._trigger(\"resize\",e,s(t))},stop:function(t,i){e(this).removeClass(\"ui-dialog-resizing\"),a.height=e(this).height(),a.width=e(this).width(),n._trigger(\"resizeStop\",t,s(i)),e.ui.dialog.overlay.resize()}}).css(\"position\",o).find(\".ui-resizable-se\").addClass(\"ui-icon ui-icon-grip-diagonal-se\")},_minHeight:function(){var e=this.options;return\"auto\"===e.height?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(t){var i,s=[],n=[0,0];t?((\"string\"==typeof t||\"object\"==typeof t&&\"0\"in t)&&(s=t.split?t.split(\" \"):[t[0],t[1]],1===s.length&&(s[1]=s[0]),e.each([\"left\",\"top\"],function(e,t){+s[e]===s[e]&&(n[e]=s[e],s[e]=t)}),t={my:s[0]+(0>n[0]?n[0]:\"+\"+n[0])+\" \"+s[1]+(0>n[1]?n[1]:\"+\"+n[1]),at:s.join(\" \")}),t=e.extend({},e.ui.dialog.prototype.options.position,t)):t=e.ui.dialog.prototype.options.position,i=this.uiDialog.is(\":visible\"),i||this.uiDialog.show(),this.uiDialog.position(t),i||this.uiDialog.hide()},_setOptions:function(t){var i=this,a={},o=!1;e.each(t,function(e,t){i._setOption(e,t),e in s&&(o=!0),e in n&&(a[e]=t)}),o&&this._size(),this.uiDialog.is(\":data(resizable)\")&&this.uiDialog.resizable(\"option\",a)},_setOption:function(t,s){var n,a,o=this.uiDialog;switch(t){case\"buttons\":this._createButtons(s);break;case\"closeText\":this.uiDialogTitlebarCloseText.text(\"\"+s);break;case\"dialogClass\":o.removeClass(this.options.dialogClass).addClass(i+s);break;case\"disabled\":s?o.addClass(\"ui-dialog-disabled\"):o.removeClass(\"ui-dialog-disabled\");break;case\"draggable\":n=o.is(\":data(draggable)\"),n&&!s&&o.draggable(\"destroy\"),!n&&s&&this._makeDraggable();break;case\"position\":this._position(s);break;case\"resizable\":a=o.is(\":data(resizable)\"),a&&!s&&o.resizable(\"destroy\"),a&&\"string\"==typeof s&&o.resizable(\"option\",\"handles\",s),a||s===!1||this._makeResizable(s);break;case\"title\":e(\".ui-dialog-title\",this.uiDialogTitlebar).html(\"\"+(s||\"&#160;\"))}this._super(t,s)},_size:function(){var t,i,s,n=this.options,a=this.uiDialog.is(\":visible\");this.element.show().css({width:\"auto\",minHeight:0,height:0}),n.minWidth>n.width&&(n.width=n.minWidth),t=this.uiDialog.css({height:\"auto\",width:n.width}).outerHeight(),i=Math.max(0,n.minHeight-t),\"auto\"===n.height?e.support.minHeight?this.element.css({minHeight:i,height:\"auto\"}):(this.uiDialog.show(),s=this.element.css(\"height\",\"auto\").height(),a||this.uiDialog.hide(),this.element.height(Math.max(s,i))):this.element.height(Math.max(n.height-t,0)),this.uiDialog.is(\":data(resizable)\")&&this.uiDialog.resizable(\"option\",\"minHeight\",this._minHeight())}}),e.extend(e.ui.dialog,{uuid:0,maxZ:0,getTitleId:function(e){var t=e.attr(\"id\");return t||(this.uuid+=1,t=this.uuid),\"ui-dialog-title-\"+t},overlay:function(t){this.$el=e.ui.dialog.overlay.create(t)}}),e.extend(e.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:e.map(\"focus,mousedown,mouseup,keydown,keypress,click\".split(\",\"),function(e){return e+\".dialog-overlay\"}).join(\" \"),create:function(i){0===this.instances.length&&(setTimeout(function(){e.ui.dialog.overlay.instances.length&&e(document).bind(e.ui.dialog.overlay.events,function(i){return e(i.target).zIndex()<e.ui.dialog.overlay.maxZ?!1:t})},1),e(window).bind(\"resize.dialog-overlay\",e.ui.dialog.overlay.resize));var s=this.oldInstances.pop()||e(\"<div>\").addClass(\"ui-widget-overlay\");return e(document).bind(\"keydown.dialog-overlay\",function(t){var n=e.ui.dialog.overlay.instances;0!==n.length&&n[n.length-1]===s&&i.options.closeOnEscape&&!t.isDefaultPrevented()&&t.keyCode&&t.keyCode===e.ui.keyCode.ESCAPE&&(i.close(t),t.preventDefault())}),s.appendTo(document.body).css({width:this.width(),height:this.height()}),e.fn.bgiframe&&s.bgiframe(),this.instances.push(s),s},destroy:function(t){var i=e.inArray(t,this.instances),s=0;-1!==i&&this.oldInstances.push(this.instances.splice(i,1)[0]),0===this.instances.length&&e([document,window]).unbind(\".dialog-overlay\"),t.height(0).width(0).remove(),e.each(this.instances,function(){s=Math.max(s,this.css(\"z-index\"))}),this.maxZ=s},height:function(){var t,i;return e.ui.ie?(t=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),i=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight),i>t?e(window).height()+\"px\":t+\"px\"):e(document).height()+\"px\"},width:function(){var t,i;return e.ui.ie?(t=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth),i=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth),i>t?e(window).width()+\"px\":t+\"px\"):e(document).width()+\"px\"},resize:function(){var t=e([]);e.each(e.ui.dialog.overlay.instances,function(){t=t.add(this)}),t.css({width:0,height:0}).css({width:e.ui.dialog.overlay.width(),height:e.ui.dialog.overlay.height()})}}),e.extend(e.ui.dialog.overlay.prototype,{destroy:function(){e.ui.dialog.overlay.destroy(this.$el)}})})(jQuery);(function(e,t){e.widget(\"ui.progressbar\",{version:\"1.9.2\",options:{value:0,max:100},min:0,_create:function(){this.element.addClass(\"ui-progressbar ui-widget ui-widget-content ui-corner-all\").attr({role:\"progressbar\",\"aria-valuemin\":this.min,\"aria-valuemax\":this.options.max,\"aria-valuenow\":this._value()}),this.valueDiv=e(\"<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>\").appendTo(this.element),this.oldValue=this._value(),this._refreshValue()},_destroy:function(){this.element.removeClass(\"ui-progressbar ui-widget ui-widget-content ui-corner-all\").removeAttr(\"role\").removeAttr(\"aria-valuemin\").removeAttr(\"aria-valuemax\").removeAttr(\"aria-valuenow\"),this.valueDiv.remove()},value:function(e){return e===t?this._value():(this._setOption(\"value\",e),this)},_setOption:function(e,t){\"value\"===e&&(this.options.value=t,this._refreshValue(),this._value()===this.options.max&&this._trigger(\"complete\")),this._super(e,t)},_value:function(){var e=this.options.value;return\"number\"!=typeof e&&(e=0),Math.min(this.options.max,Math.max(this.min,e))},_percentage:function(){return 100*this._value()/this.options.max},_refreshValue:function(){var e=this.value(),t=this._percentage();this.oldValue!==e&&(this.oldValue=e,this._trigger(\"change\")),this.valueDiv.toggle(e>this.min).toggleClass(\"ui-corner-right\",e===this.options.max).width(t.toFixed(0)+\"%\"),this.element.attr(\"aria-valuenow\",e)}})})(jQuery);(function(e){var t=5;e.widget(\"ui.slider\",e.ui.mouse,{version:\"1.9.2\",widgetEventPrefix:\"slide\",options:{animate:!1,distance:0,max:100,min:0,orientation:\"horizontal\",range:!1,step:1,value:0,values:null},_create:function(){var i,s,n=this.options,a=this.element.find(\".ui-slider-handle\").addClass(\"ui-state-default ui-corner-all\"),o=\"<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>\",r=[];for(this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass(\"ui-slider ui-slider-\"+this.orientation+\" ui-widget\"+\" ui-widget-content\"+\" ui-corner-all\"+(n.disabled?\" ui-slider-disabled ui-disabled\":\"\")),this.range=e([]),n.range&&(n.range===!0&&(n.values||(n.values=[this._valueMin(),this._valueMin()]),n.values.length&&2!==n.values.length&&(n.values=[n.values[0],n.values[0]])),this.range=e(\"<div></div>\").appendTo(this.element).addClass(\"ui-slider-range ui-widget-header\"+(\"min\"===n.range||\"max\"===n.range?\" ui-slider-range-\"+n.range:\"\"))),s=n.values&&n.values.length||1,i=a.length;s>i;i++)r.push(o);this.handles=a.add(e(r.join(\"\")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.add(this.range).filter(\"a\").click(function(e){e.preventDefault()}).mouseenter(function(){n.disabled||e(this).addClass(\"ui-state-hover\")}).mouseleave(function(){e(this).removeClass(\"ui-state-hover\")}).focus(function(){n.disabled?e(this).blur():(e(\".ui-slider .ui-state-focus\").removeClass(\"ui-state-focus\"),e(this).addClass(\"ui-state-focus\"))}).blur(function(){e(this).removeClass(\"ui-state-focus\")}),this.handles.each(function(t){e(this).data(\"ui-slider-handle-index\",t)}),this._on(this.handles,{keydown:function(i){var s,n,a,o,r=e(i.target).data(\"ui-slider-handle-index\");switch(i.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(i.preventDefault(),!this._keySliding&&(this._keySliding=!0,e(i.target).addClass(\"ui-state-active\"),s=this._start(i,r),s===!1))return}switch(o=this.options.step,n=a=this.options.values&&this.options.values.length?this.values(r):this.value(),i.keyCode){case e.ui.keyCode.HOME:a=this._valueMin();break;case e.ui.keyCode.END:a=this._valueMax();break;case e.ui.keyCode.PAGE_UP:a=this._trimAlignValue(n+(this._valueMax()-this._valueMin())/t);break;case e.ui.keyCode.PAGE_DOWN:a=this._trimAlignValue(n-(this._valueMax()-this._valueMin())/t);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(n===this._valueMax())return;a=this._trimAlignValue(n+o);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(n===this._valueMin())return;a=this._trimAlignValue(n-o)}this._slide(i,r,a)},keyup:function(t){var i=e(t.target).data(\"ui-slider-handle-index\");this._keySliding&&(this._keySliding=!1,this._stop(t,i),this._change(t,i),e(t.target).removeClass(\"ui-state-active\"))}}),this._refreshValue(),this._animateOff=!1},_destroy:function(){this.handles.remove(),this.range.remove(),this.element.removeClass(\"ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all\"),this._mouseDestroy()},_mouseCapture:function(t){var i,s,n,a,o,r,h,l,u=this,c=this.options;return c.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:t.pageX,y:t.pageY},s=this._normValueFromMouse(i),n=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var i=Math.abs(s-u.values(t));n>i&&(n=i,a=e(this),o=t)}),c.range===!0&&this.values(1)===c.min&&(o+=1,a=e(this.handles[o])),r=this._start(t,o),r===!1?!1:(this._mouseSliding=!0,this._handleIndex=o,a.addClass(\"ui-state-active\").focus(),h=a.offset(),l=!e(t.target).parents().andSelf().is(\".ui-slider-handle\"),this._clickOffset=l?{left:0,top:0}:{left:t.pageX-h.left-a.width()/2,top:t.pageY-h.top-a.height()/2-(parseInt(a.css(\"borderTopWidth\"),10)||0)-(parseInt(a.css(\"borderBottomWidth\"),10)||0)+(parseInt(a.css(\"marginTop\"),10)||0)},this.handles.hasClass(\"ui-state-hover\")||this._slide(t,o,s),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},i=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,i),!1},_mouseStop:function(e){return this.handles.removeClass(\"ui-state-active\"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation=\"vertical\"===this.options.orientation?\"vertical\":\"horizontal\"},_normValueFromMouse:function(e){var t,i,s,n,a;return\"horizontal\"===this.orientation?(t=this.elementSize.width,i=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,i=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),s=i/t,s>1&&(s=1),0>s&&(s=0),\"vertical\"===this.orientation&&(s=1-s),n=this._valueMax()-this._valueMin(),a=this._valueMin()+s*n,this._trimAlignValue(a)},_start:function(e,t){var i={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger(\"start\",e,i)},_slide:function(e,t,i){var s,n,a;this.options.values&&this.options.values.length?(s=this.values(t?0:1),2===this.options.values.length&&this.options.range===!0&&(0===t&&i>s||1===t&&s>i)&&(i=s),i!==this.values(t)&&(n=this.values(),n[t]=i,a=this._trigger(\"slide\",e,{handle:this.handles[t],value:i,values:n}),s=this.values(t?0:1),a!==!1&&this.values(t,i,!0))):i!==this.value()&&(a=this._trigger(\"slide\",e,{handle:this.handles[t],value:i}),a!==!1&&this.value(i))},_stop:function(e,t){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger(\"stop\",e,i)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger(\"change\",e,i)}},value:function(e){return arguments.length?(this.options.value=this._trimAlignValue(e),this._refreshValue(),this._change(null,0),undefined):this._value()},values:function(t,i){var s,n,a;if(arguments.length>1)return this.options.values[t]=this._trimAlignValue(i),this._refreshValue(),this._change(null,t),undefined;if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();for(s=this.options.values,n=arguments[0],a=0;s.length>a;a+=1)s[a]=this._trimAlignValue(n[a]),this._change(null,a);this._refreshValue()},_setOption:function(t,i){var s,n=0;switch(e.isArray(this.options.values)&&(n=this.options.values.length),e.Widget.prototype._setOption.apply(this,arguments),t){case\"disabled\":i?(this.handles.filter(\".ui-state-focus\").blur(),this.handles.removeClass(\"ui-state-hover\"),this.handles.prop(\"disabled\",!0),this.element.addClass(\"ui-disabled\")):(this.handles.prop(\"disabled\",!1),this.element.removeClass(\"ui-disabled\"));break;case\"orientation\":this._detectOrientation(),this.element.removeClass(\"ui-slider-horizontal ui-slider-vertical\").addClass(\"ui-slider-\"+this.orientation),this._refreshValue();break;case\"value\":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case\"values\":for(this._animateOff=!0,this._refreshValue(),s=0;n>s;s+=1)this._change(null,s);this._animateOff=!1;break;case\"min\":case\"max\":this._animateOff=!0,this._refreshValue(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e)},_values:function(e){var t,i,s;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t);for(i=this.options.values.slice(),s=0;i.length>s;s+=1)i[s]=this._trimAlignValue(i[s]);return i},_trimAlignValue:function(e){if(this._valueMin()>=e)return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,i=(e-this._valueMin())%t,s=e-i;return 2*Math.abs(i)>=t&&(s+=i>0?t:-t),parseFloat(s.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t,i,s,n,a,o=this.options.range,r=this.options,h=this,l=this._animateOff?!1:r.animate,u={};this.options.values&&this.options.values.length?this.handles.each(function(s){i=100*((h.values(s)-h._valueMin())/(h._valueMax()-h._valueMin())),u[\"horizontal\"===h.orientation?\"left\":\"bottom\"]=i+\"%\",e(this).stop(1,1)[l?\"animate\":\"css\"](u,r.animate),h.options.range===!0&&(\"horizontal\"===h.orientation?(0===s&&h.range.stop(1,1)[l?\"animate\":\"css\"]({left:i+\"%\"},r.animate),1===s&&h.range[l?\"animate\":\"css\"]({width:i-t+\"%\"},{queue:!1,duration:r.animate})):(0===s&&h.range.stop(1,1)[l?\"animate\":\"css\"]({bottom:i+\"%\"},r.animate),1===s&&h.range[l?\"animate\":\"css\"]({height:i-t+\"%\"},{queue:!1,duration:r.animate}))),t=i}):(s=this.value(),n=this._valueMin(),a=this._valueMax(),i=a!==n?100*((s-n)/(a-n)):0,u[\"horizontal\"===this.orientation?\"left\":\"bottom\"]=i+\"%\",this.handle.stop(1,1)[l?\"animate\":\"css\"](u,r.animate),\"min\"===o&&\"horizontal\"===this.orientation&&this.range.stop(1,1)[l?\"animate\":\"css\"]({width:i+\"%\"},r.animate),\"max\"===o&&\"horizontal\"===this.orientation&&this.range[l?\"animate\":\"css\"]({width:100-i+\"%\"},{queue:!1,duration:r.animate}),\"min\"===o&&\"vertical\"===this.orientation&&this.range.stop(1,1)[l?\"animate\":\"css\"]({height:i+\"%\"},r.animate),\"max\"===o&&\"vertical\"===this.orientation&&this.range[l?\"animate\":\"css\"]({height:100-i+\"%\"},{queue:!1,duration:r.animate}))}})})(jQuery);(function(e,t){function i(){return++n}function s(e){return e.hash.length>1&&e.href.replace(a,\"\")===location.href.replace(a,\"\").replace(/\\s/g,\"%20\")}var n=0,a=/#.*$/;e.widget(\"ui.tabs\",{version:\"1.9.2\",delay:300,options:{active:null,collapsible:!1,event:\"click\",heightStyle:\"content\",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_create:function(){var i=this,s=this.options,n=s.active,a=location.hash.substring(1);this.running=!1,this.element.addClass(\"ui-tabs ui-widget ui-widget-content ui-corner-all\").toggleClass(\"ui-tabs-collapsible\",s.collapsible).delegate(\".ui-tabs-nav > li\",\"mousedown\"+this.eventNamespace,function(t){e(this).is(\".ui-state-disabled\")&&t.preventDefault()}).delegate(\".ui-tabs-anchor\",\"focus\"+this.eventNamespace,function(){e(this).closest(\"li\").is(\".ui-state-disabled\")&&this.blur()}),this._processTabs(),null===n&&(a&&this.tabs.each(function(i,s){return e(s).attr(\"aria-controls\")===a?(n=i,!1):t}),null===n&&(n=this.tabs.index(this.tabs.filter(\".ui-tabs-active\"))),(null===n||-1===n)&&(n=this.tabs.length?0:!1)),n!==!1&&(n=this.tabs.index(this.tabs.eq(n)),-1===n&&(n=s.collapsible?!1:0)),s.active=n,!s.collapsible&&s.active===!1&&this.anchors.length&&(s.active=0),e.isArray(s.disabled)&&(s.disabled=e.unique(s.disabled.concat(e.map(this.tabs.filter(\".ui-state-disabled\"),function(e){return i.tabs.index(e)}))).sort()),this.active=this.options.active!==!1&&this.anchors.length?this._findActive(this.options.active):e(),this._refresh(),this.active.length&&this.load(s.active)},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):e()}},_tabKeydown:function(i){var s=e(this.document[0].activeElement).closest(\"li\"),n=this.tabs.index(s),a=!0;if(!this._handlePageNav(i)){switch(i.keyCode){case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:n++;break;case e.ui.keyCode.UP:case e.ui.keyCode.LEFT:a=!1,n--;break;case e.ui.keyCode.END:n=this.anchors.length-1;break;case e.ui.keyCode.HOME:n=0;break;case e.ui.keyCode.SPACE:return i.preventDefault(),clearTimeout(this.activating),this._activate(n),t;case e.ui.keyCode.ENTER:return i.preventDefault(),clearTimeout(this.activating),this._activate(n===this.options.active?!1:n),t;default:return}i.preventDefault(),clearTimeout(this.activating),n=this._focusNextTab(n,a),i.ctrlKey||(s.attr(\"aria-selected\",\"false\"),this.tabs.eq(n).attr(\"aria-selected\",\"true\"),this.activating=this._delay(function(){this.option(\"active\",n)},this.delay))}},_panelKeydown:function(t){this._handlePageNav(t)||t.ctrlKey&&t.keyCode===e.ui.keyCode.UP&&(t.preventDefault(),this.active.focus())},_handlePageNav:function(i){return i.altKey&&i.keyCode===e.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):i.altKey&&i.keyCode===e.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):t},_findNextTab:function(t,i){function s(){return t>n&&(t=0),0>t&&(t=n),t}for(var n=this.tabs.length-1;-1!==e.inArray(s(),this.options.disabled);)t=i?t+1:t-1;return t},_focusNextTab:function(e,t){return e=this._findNextTab(e,t),this.tabs.eq(e).focus(),e},_setOption:function(e,i){return\"active\"===e?(this._activate(i),t):\"disabled\"===e?(this._setupDisabled(i),t):(this._super(e,i),\"collapsible\"===e&&(this.element.toggleClass(\"ui-tabs-collapsible\",i),i||this.options.active!==!1||this._activate(0)),\"event\"===e&&this._setupEvents(i),\"heightStyle\"===e&&this._setupHeightStyle(i),t)},_tabId:function(e){return e.attr(\"aria-controls\")||\"ui-tabs-\"+i()},_sanitizeSelector:function(e){return e?e.replace(/[!\"$%&'()*+,.\\/:;<=>?@\\[\\]\\^`{|}~]/g,\"\\\\$&\"):\"\"},refresh:function(){var t=this.options,i=this.tablist.children(\":has(a[href])\");t.disabled=e.map(i.filter(\".ui-state-disabled\"),function(e){return i.index(e)}),this._processTabs(),t.active!==!1&&this.anchors.length?this.active.length&&!e.contains(this.tablist[0],this.active[0])?this.tabs.length===t.disabled.length?(t.active=!1,this.active=e()):this._activate(this._findNextTab(Math.max(0,t.active-1),!1)):t.active=this.tabs.index(this.active):(t.active=!1,this.active=e()),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({\"aria-selected\":\"false\",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({\"aria-expanded\":\"false\",\"aria-hidden\":\"true\"}),this.active.length?(this.active.addClass(\"ui-tabs-active ui-state-active\").attr({\"aria-selected\":\"true\",tabIndex:0}),this._getPanelForTab(this.active).show().attr({\"aria-expanded\":\"true\",\"aria-hidden\":\"false\"})):this.tabs.eq(0).attr(\"tabIndex\",0)},_processTabs:function(){var t=this;this.tablist=this._getList().addClass(\"ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all\").attr(\"role\",\"tablist\"),this.tabs=this.tablist.find(\"> li:has(a[href])\").addClass(\"ui-state-default ui-corner-top\").attr({role:\"tab\",tabIndex:-1}),this.anchors=this.tabs.map(function(){return e(\"a\",this)[0]}).addClass(\"ui-tabs-anchor\").attr({role:\"presentation\",tabIndex:-1}),this.panels=e(),this.anchors.each(function(i,n){var a,o,r,h=e(n).uniqueId().attr(\"id\"),l=e(n).closest(\"li\"),u=l.attr(\"aria-controls\");s(n)?(a=n.hash,o=t.element.find(t._sanitizeSelector(a))):(r=t._tabId(l),a=\"#\"+r,o=t.element.find(a),o.length||(o=t._createPanel(r),o.insertAfter(t.panels[i-1]||t.tablist)),o.attr(\"aria-live\",\"polite\")),o.length&&(t.panels=t.panels.add(o)),u&&l.data(\"ui-tabs-aria-controls\",u),l.attr({\"aria-controls\":a.substring(1),\"aria-labelledby\":h}),o.attr(\"aria-labelledby\",h)}),this.panels.addClass(\"ui-tabs-panel ui-widget-content ui-corner-bottom\").attr(\"role\",\"tabpanel\")},_getList:function(){return this.element.find(\"ol,ul\").eq(0)},_createPanel:function(t){return e(\"<div>\").attr(\"id\",t).addClass(\"ui-tabs-panel ui-widget-content ui-corner-bottom\").data(\"ui-tabs-destroy\",!0)},_setupDisabled:function(t){e.isArray(t)&&(t.length?t.length===this.anchors.length&&(t=!0):t=!1);for(var i,s=0;i=this.tabs[s];s++)t===!0||-1!==e.inArray(s,t)?e(i).addClass(\"ui-state-disabled\").attr(\"aria-disabled\",\"true\"):e(i).removeClass(\"ui-state-disabled\").removeAttr(\"aria-disabled\");this.options.disabled=t},_setupEvents:function(t){var i={click:function(e){e.preventDefault()}};t&&e.each(t.split(\" \"),function(e,t){i[t]=\"_eventHandler\"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(this.anchors,i),this._on(this.tabs,{keydown:\"_tabKeydown\"}),this._on(this.panels,{keydown:\"_panelKeydown\"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(t){var i,s,n=this.element.parent();\"fill\"===t?(e.support.minHeight||(s=n.css(\"overflow\"),n.css(\"overflow\",\"hidden\")),i=n.height(),this.element.siblings(\":visible\").each(function(){var t=e(this),s=t.css(\"position\");\"absolute\"!==s&&\"fixed\"!==s&&(i-=t.outerHeight(!0))}),s&&n.css(\"overflow\",s),this.element.children().not(this.panels).each(function(){i-=e(this).outerHeight(!0)}),this.panels.each(function(){e(this).height(Math.max(0,i-e(this).innerHeight()+e(this).height()))}).css(\"overflow\",\"auto\")):\"auto\"===t&&(i=0,this.panels.each(function(){i=Math.max(i,e(this).height(\"\").height())}).height(i))},_eventHandler:function(t){var i=this.options,s=this.active,n=e(t.currentTarget),a=n.closest(\"li\"),o=a[0]===s[0],r=o&&i.collapsible,h=r?e():this._getPanelForTab(a),l=s.length?this._getPanelForTab(s):e(),u={oldTab:s,oldPanel:l,newTab:r?e():a,newPanel:h};t.preventDefault(),a.hasClass(\"ui-state-disabled\")||a.hasClass(\"ui-tabs-loading\")||this.running||o&&!i.collapsible||this._trigger(\"beforeActivate\",t,u)===!1||(i.active=r?!1:this.tabs.index(a),this.active=o?e():a,this.xhr&&this.xhr.abort(),l.length||h.length||e.error(\"jQuery UI Tabs: Mismatching fragment identifier.\"),h.length&&this.load(this.tabs.index(a),t),this._toggle(t,u))},_toggle:function(t,i){function s(){a.running=!1,a._trigger(\"activate\",t,i)}function n(){i.newTab.closest(\"li\").addClass(\"ui-tabs-active ui-state-active\"),o.length&&a.options.show?a._show(o,a.options.show,s):(o.show(),s())}var a=this,o=i.newPanel,r=i.oldPanel;this.running=!0,r.length&&this.options.hide?this._hide(r,this.options.hide,function(){i.oldTab.closest(\"li\").removeClass(\"ui-tabs-active ui-state-active\"),n()}):(i.oldTab.closest(\"li\").removeClass(\"ui-tabs-active ui-state-active\"),r.hide(),n()),r.attr({\"aria-expanded\":\"false\",\"aria-hidden\":\"true\"}),i.oldTab.attr(\"aria-selected\",\"false\"),o.length&&r.length?i.oldTab.attr(\"tabIndex\",-1):o.length&&this.tabs.filter(function(){return 0===e(this).attr(\"tabIndex\")}).attr(\"tabIndex\",-1),o.attr({\"aria-expanded\":\"true\",\"aria-hidden\":\"false\"}),i.newTab.attr({\"aria-selected\":\"true\",tabIndex:0})},_activate:function(t){var i,s=this._findActive(t);s[0]!==this.active[0]&&(s.length||(s=this.active),i=s.find(\".ui-tabs-anchor\")[0],this._eventHandler({target:i,currentTarget:i,preventDefault:e.noop}))},_findActive:function(t){return t===!1?e():this.tabs.eq(t)},_getIndex:function(e){return\"string\"==typeof e&&(e=this.anchors.index(this.anchors.filter(\"[href$='\"+e+\"']\"))),e},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass(\"ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible\"),this.tablist.removeClass(\"ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all\").removeAttr(\"role\"),this.anchors.removeClass(\"ui-tabs-anchor\").removeAttr(\"role\").removeAttr(\"tabIndex\").removeData(\"href.tabs\").removeData(\"load.tabs\").removeUniqueId(),this.tabs.add(this.panels).each(function(){e.data(this,\"ui-tabs-destroy\")?e(this).remove():e(this).removeClass(\"ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel\").removeAttr(\"tabIndex\").removeAttr(\"aria-live\").removeAttr(\"aria-busy\").removeAttr(\"aria-selected\").removeAttr(\"aria-labelledby\").removeAttr(\"aria-hidden\").removeAttr(\"aria-expanded\").removeAttr(\"role\")}),this.tabs.each(function(){var t=e(this),i=t.data(\"ui-tabs-aria-controls\");i?t.attr(\"aria-controls\",i):t.removeAttr(\"aria-controls\")}),this.panels.show(),\"content\"!==this.options.heightStyle&&this.panels.css(\"height\",\"\")},enable:function(i){var s=this.options.disabled;s!==!1&&(i===t?s=!1:(i=this._getIndex(i),s=e.isArray(s)?e.map(s,function(e){return e!==i?e:null}):e.map(this.tabs,function(e,t){return t!==i?t:null})),this._setupDisabled(s))},disable:function(i){var s=this.options.disabled;if(s!==!0){if(i===t)s=!0;else{if(i=this._getIndex(i),-1!==e.inArray(i,s))return;s=e.isArray(s)?e.merge([i],s).sort():[i]}this._setupDisabled(s)}},load:function(t,i){t=this._getIndex(t);var n=this,a=this.tabs.eq(t),o=a.find(\".ui-tabs-anchor\"),r=this._getPanelForTab(a),h={tab:a,panel:r};s(o[0])||(this.xhr=e.ajax(this._ajaxSettings(o,i,h)),this.xhr&&\"canceled\"!==this.xhr.statusText&&(a.addClass(\"ui-tabs-loading\"),r.attr(\"aria-busy\",\"true\"),this.xhr.success(function(e){setTimeout(function(){r.html(e),n._trigger(\"load\",i,h)},1)}).complete(function(e,t){setTimeout(function(){\"abort\"===t&&n.panels.stop(!1,!0),a.removeClass(\"ui-tabs-loading\"),r.removeAttr(\"aria-busy\"),e===n.xhr&&delete n.xhr},1)})))},_ajaxSettings:function(t,i,s){var n=this;return{url:t.attr(\"href\"),beforeSend:function(t,a){return n._trigger(\"beforeLoad\",i,e.extend({jqXHR:t,ajaxSettings:a},s))}}},_getPanelForTab:function(t){var i=e(t).attr(\"aria-controls\");return this.element.find(this._sanitizeSelector(\"#\"+i))}}),e.uiBackCompat!==!1&&(e.ui.tabs.prototype._ui=function(e,t){return{tab:e,panel:t,index:this.anchors.index(e)}},e.widget(\"ui.tabs\",e.ui.tabs,{url:function(e,t){this.anchors.eq(e).attr(\"href\",t)}}),e.widget(\"ui.tabs\",e.ui.tabs,{options:{ajaxOptions:null,cache:!1},_create:function(){this._super();var i=this;this._on({tabsbeforeload:function(s,n){return e.data(n.tab[0],\"cache.tabs\")?(s.preventDefault(),t):(n.jqXHR.success(function(){i.options.cache&&e.data(n.tab[0],\"cache.tabs\",!0)}),t)}})},_ajaxSettings:function(t,i,s){var n=this.options.ajaxOptions;return e.extend({},n,{error:function(e,t){try{n.error(e,t,s.tab.closest(\"li\").index(),s.tab[0])}catch(i){}}},this._superApply(arguments))},_setOption:function(e,t){\"cache\"===e&&t===!1&&this.anchors.removeData(\"cache.tabs\"),this._super(e,t)},_destroy:function(){this.anchors.removeData(\"cache.tabs\"),this._super()},url:function(e){this.anchors.eq(e).removeData(\"cache.tabs\"),this._superApply(arguments)}}),e.widget(\"ui.tabs\",e.ui.tabs,{abort:function(){this.xhr&&this.xhr.abort()}}),e.widget(\"ui.tabs\",e.ui.tabs,{options:{spinner:\"<em>Loading&#8230;</em>\"},_create:function(){this._super(),this._on({tabsbeforeload:function(e,t){if(e.target===this.element[0]&&this.options.spinner){var i=t.tab.find(\"span\"),s=i.html();i.html(this.options.spinner),t.jqXHR.complete(function(){i.html(s)})}}})}}),e.widget(\"ui.tabs\",e.ui.tabs,{options:{enable:null,disable:null},enable:function(t){var i,s=this.options;(t&&s.disabled===!0||e.isArray(s.disabled)&&-1!==e.inArray(t,s.disabled))&&(i=!0),this._superApply(arguments),i&&this._trigger(\"enable\",null,this._ui(this.anchors[t],this.panels[t]))},disable:function(t){var i,s=this.options;(t&&s.disabled===!1||e.isArray(s.disabled)&&-1===e.inArray(t,s.disabled))&&(i=!0),this._superApply(arguments),i&&this._trigger(\"disable\",null,this._ui(this.anchors[t],this.panels[t]))}}),e.widget(\"ui.tabs\",e.ui.tabs,{options:{add:null,remove:null,tabTemplate:\"<li><a href='#{href}'><span>#{label}</span></a></li>\"},add:function(i,s,n){n===t&&(n=this.anchors.length);var a,o,r=this.options,h=e(r.tabTemplate.replace(/#\\{href\\}/g,i).replace(/#\\{label\\}/g,s)),l=i.indexOf(\"#\")?this._tabId(h):i.replace(\"#\",\"\");return h.addClass(\"ui-state-default ui-corner-top\").data(\"ui-tabs-destroy\",!0),h.attr(\"aria-controls\",l),a=n>=this.tabs.length,o=this.element.find(\"#\"+l),o.length||(o=this._createPanel(l),a?n>0?o.insertAfter(this.panels.eq(-1)):o.appendTo(this.element):o.insertBefore(this.panels[n])),o.addClass(\"ui-tabs-panel ui-widget-content ui-corner-bottom\").hide(),a?h.appendTo(this.tablist):h.insertBefore(this.tabs[n]),r.disabled=e.map(r.disabled,function(e){return e>=n?++e:e}),this.refresh(),1===this.tabs.length&&r.active===!1&&this.option(\"active\",0),this._trigger(\"add\",null,this._ui(this.anchors[n],this.panels[n])),this},remove:function(t){t=this._getIndex(t);var i=this.options,s=this.tabs.eq(t).remove(),n=this._getPanelForTab(s).remove();return s.hasClass(\"ui-tabs-active\")&&this.anchors.length>2&&this._activate(t+(this.anchors.length>t+1?1:-1)),i.disabled=e.map(e.grep(i.disabled,function(e){return e!==t}),function(e){return e>=t?--e:e}),this.refresh(),this._trigger(\"remove\",null,this._ui(s.find(\"a\")[0],n[0])),this}}),e.widget(\"ui.tabs\",e.ui.tabs,{length:function(){return this.anchors.length}}),e.widget(\"ui.tabs\",e.ui.tabs,{options:{idPrefix:\"ui-tabs-\"},_tabId:function(t){var s=t.is(\"li\")?t.find(\"a[href]\"):t;return s=s[0],e(s).closest(\"li\").attr(\"aria-controls\")||s.title&&s.title.replace(/\\s/g,\"_\").replace(/[^\\w\\u00c0-\\uFFFF\\-]/g,\"\")||this.options.idPrefix+i()}}),e.widget(\"ui.tabs\",e.ui.tabs,{options:{panelTemplate:\"<div></div>\"},_createPanel:function(t){return e(this.options.panelTemplate).attr(\"id\",t).addClass(\"ui-tabs-panel ui-widget-content ui-corner-bottom\").data(\"ui-tabs-destroy\",!0)}}),e.widget(\"ui.tabs\",e.ui.tabs,{_create:function(){var e=this.options;null===e.active&&e.selected!==t&&(e.active=-1===e.selected?!1:e.selected),this._super(),e.selected=e.active,e.selected===!1&&(e.selected=-1)},_setOption:function(e,t){if(\"selected\"!==e)return this._super(e,t);var i=this.options;this._super(\"active\",-1===t?!1:t),i.selected=i.active,i.selected===!1&&(i.selected=-1)},_eventHandler:function(){this._superApply(arguments),this.options.selected=this.options.active,this.options.selected===!1&&(this.options.selected=-1)}}),e.widget(\"ui.tabs\",e.ui.tabs,{options:{show:null,select:null},_create:function(){this._super(),this.options.active!==!1&&this._trigger(\"show\",null,this._ui(this.active.find(\".ui-tabs-anchor\")[0],this._getPanelForTab(this.active)[0]))},_trigger:function(e,t,i){var s,n,a=this._superApply(arguments);return a?(\"beforeActivate\"===e?(s=i.newTab.length?i.newTab:i.oldTab,n=i.newPanel.length?i.newPanel:i.oldPanel,a=this._super(\"select\",t,{tab:s.find(\".ui-tabs-anchor\")[0],panel:n[0],index:s.closest(\"li\").index()})):\"activate\"===e&&i.newTab.length&&(a=this._super(\"show\",t,{tab:i.newTab.find(\".ui-tabs-anchor\")[0],panel:i.newPanel[0],index:i.newTab.closest(\"li\").index()})),a):!1}}),e.widget(\"ui.tabs\",e.ui.tabs,{select:function(e){if(e=this._getIndex(e),-1===e){if(!this.options.collapsible||-1===this.options.selected)return;e=this.options.selected}this.anchors.eq(e).trigger(this.options.event+this.eventNamespace)}}),function(){var t=0;e.widget(\"ui.tabs\",e.ui.tabs,{options:{cookie:null},_create:function(){var e,t=this.options;null==t.active&&t.cookie&&(e=parseInt(this._cookie(),10),-1===e&&(e=!1),t.active=e),this._super()},_cookie:function(i){var s=[this.cookie||(this.cookie=this.options.cookie.name||\"ui-tabs-\"+ ++t)];return arguments.length&&(s.push(i===!1?-1:i),s.push(this.options.cookie)),e.cookie.apply(null,s)},_refresh:function(){this._super(),this.options.cookie&&this._cookie(this.options.active,this.options.cookie)},_eventHandler:function(){this._superApply(arguments),this.options.cookie&&this._cookie(this.options.active,this.options.cookie)},_destroy:function(){this._super(),this.options.cookie&&this._cookie(null,this.options.cookie)}})}(),e.widget(\"ui.tabs\",e.ui.tabs,{_trigger:function(t,i,s){var n=e.extend({},s);return\"load\"===t&&(n.panel=n.panel[0],n.tab=n.tab.find(\".ui-tabs-anchor\")[0]),this._super(t,i,n)}}),e.widget(\"ui.tabs\",e.ui.tabs,{options:{fx:null},_getFx:function(){var t,i,s=this.options.fx;return s&&(e.isArray(s)?(t=s[0],i=s[1]):t=i=s),s?{show:i,hide:t}:null},_toggle:function(e,i){function s(){a.running=!1,a._trigger(\"activate\",e,i)}function n(){i.newTab.closest(\"li\").addClass(\"ui-tabs-active ui-state-active\"),o.length&&h.show?o.animate(h.show,h.show.duration,function(){s()}):(o.show(),s())}var a=this,o=i.newPanel,r=i.oldPanel,h=this._getFx();return h?(a.running=!0,r.length&&h.hide?r.animate(h.hide,h.hide.duration,function(){i.oldTab.closest(\"li\").removeClass(\"ui-tabs-active ui-state-active\"),n()}):(i.oldTab.closest(\"li\").removeClass(\"ui-tabs-active ui-state-active\"),r.hide(),n()),t):this._super(e,i)}}))})(jQuery);(function(e){function t(t,i){var s=(t.attr(\"aria-describedby\")||\"\").split(/\\s+/);s.push(i),t.data(\"ui-tooltip-id\",i).attr(\"aria-describedby\",e.trim(s.join(\" \")))}function i(t){var i=t.data(\"ui-tooltip-id\"),s=(t.attr(\"aria-describedby\")||\"\").split(/\\s+/),n=e.inArray(i,s);-1!==n&&s.splice(n,1),t.removeData(\"ui-tooltip-id\"),s=e.trim(s.join(\" \")),s?t.attr(\"aria-describedby\",s):t.removeAttr(\"aria-describedby\")}var s=0;e.widget(\"ui.tooltip\",{version:\"1.9.2\",options:{content:function(){return e(this).attr(\"title\")},hide:!0,items:\"[title]:not([disabled])\",position:{my:\"left top+15\",at:\"left bottom\",collision:\"flipfit flip\"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_create:function(){this._on({mouseover:\"open\",focusin:\"open\"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable()},_setOption:function(t,i){var s=this;return\"disabled\"===t?(this[i?\"_disable\":\"_enable\"](),this.options[t]=i,void 0):(this._super(t,i),\"content\"===t&&e.each(this.tooltips,function(e,t){s._updateContent(t)}),void 0)},_disable:function(){var t=this;e.each(this.tooltips,function(i,s){var n=e.Event(\"blur\");n.target=n.currentTarget=s[0],t.close(n,!0)}),this.element.find(this.options.items).andSelf().each(function(){var t=e(this);t.is(\"[title]\")&&t.data(\"ui-tooltip-title\",t.attr(\"title\")).attr(\"title\",\"\")})},_enable:function(){this.element.find(this.options.items).andSelf().each(function(){var t=e(this);t.data(\"ui-tooltip-title\")&&t.attr(\"title\",t.data(\"ui-tooltip-title\"))})},open:function(t){var i=this,s=e(t?t.target:this.element).closest(this.options.items);s.length&&!s.data(\"ui-tooltip-id\")&&(s.attr(\"title\")&&s.data(\"ui-tooltip-title\",s.attr(\"title\")),s.data(\"ui-tooltip-open\",!0),t&&\"mouseover\"===t.type&&s.parents().each(function(){var t,s=e(this);s.data(\"ui-tooltip-open\")&&(t=e.Event(\"blur\"),t.target=t.currentTarget=this,i.close(t,!0)),s.attr(\"title\")&&(s.uniqueId(),i.parents[this.id]={element:this,title:s.attr(\"title\")},s.attr(\"title\",\"\"))}),this._updateContent(s,t))},_updateContent:function(e,t){var i,s=this.options.content,n=this,a=t?t.type:null;return\"string\"==typeof s?this._open(t,e,s):(i=s.call(e[0],function(i){e.data(\"ui-tooltip-open\")&&n._delay(function(){t&&(t.type=a),this._open(t,e,i)})}),i&&this._open(t,e,i),void 0)},_open:function(i,s,n){function a(e){l.of=e,o.is(\":hidden\")||o.position(l)}var o,r,h,l=e.extend({},this.options.position);if(n){if(o=this._find(s),o.length)return o.find(\".ui-tooltip-content\").html(n),void 0;s.is(\"[title]\")&&(i&&\"mouseover\"===i.type?s.attr(\"title\",\"\"):s.removeAttr(\"title\")),o=this._tooltip(s),t(s,o.attr(\"id\")),o.find(\".ui-tooltip-content\").html(n),this.options.track&&i&&/^mouse/.test(i.type)?(this._on(this.document,{mousemove:a}),a(i)):o.position(e.extend({of:s},this.options.position)),o.hide(),this._show(o,this.options.show),this.options.show&&this.options.show.delay&&(h=setInterval(function(){o.is(\":visible\")&&(a(l.of),clearInterval(h))},e.fx.interval)),this._trigger(\"open\",i,{tooltip:o}),r={keyup:function(t){if(t.keyCode===e.ui.keyCode.ESCAPE){var i=e.Event(t);i.currentTarget=s[0],this.close(i,!0)}},remove:function(){this._removeTooltip(o)}},i&&\"mouseover\"!==i.type||(r.mouseleave=\"close\"),i&&\"focusin\"!==i.type||(r.focusout=\"close\"),this._on(!0,s,r)}},close:function(t){var s=this,n=e(t?t.currentTarget:this.element),a=this._find(n);this.closing||(n.data(\"ui-tooltip-title\")&&n.attr(\"title\",n.data(\"ui-tooltip-title\")),i(n),a.stop(!0),this._hide(a,this.options.hide,function(){s._removeTooltip(e(this))}),n.removeData(\"ui-tooltip-open\"),this._off(n,\"mouseleave focusout keyup\"),n[0]!==this.element[0]&&this._off(n,\"remove\"),this._off(this.document,\"mousemove\"),t&&\"mouseleave\"===t.type&&e.each(this.parents,function(t,i){e(i.element).attr(\"title\",i.title),delete s.parents[t]}),this.closing=!0,this._trigger(\"close\",t,{tooltip:a}),this.closing=!1)},_tooltip:function(t){var i=\"ui-tooltip-\"+s++,n=e(\"<div>\").attr({id:i,role:\"tooltip\"}).addClass(\"ui-tooltip ui-widget ui-corner-all ui-widget-content \"+(this.options.tooltipClass||\"\"));return e(\"<div>\").addClass(\"ui-tooltip-content\").appendTo(n),n.appendTo(this.document[0].body),e.fn.bgiframe&&n.bgiframe(),this.tooltips[i]=t,n},_find:function(t){var i=t.data(\"ui-tooltip-id\");return i?e(\"#\"+i):e()},_removeTooltip:function(e){e.remove(),delete this.tooltips[e.attr(\"id\")]},_destroy:function(){var t=this;e.each(this.tooltips,function(i,s){var n=e.Event(\"blur\");n.target=n.currentTarget=s[0],t.close(n,!0),e(\"#\"+i).remove(),s.data(\"ui-tooltip-title\")&&(s.attr(\"title\",s.data(\"ui-tooltip-title\")),s.removeData(\"ui-tooltip-title\"))})}})})(jQuery);jQuery.effects||function(e,t){var i=e.uiBackCompat!==!1,s=\"ui-effects-\";e.effects={effect:{}},function(t,i){function s(e,t,i){var s=d[t.type]||{};return null==e?i||!t.def?null:t.def:(e=s.floor?~~e:parseFloat(e),isNaN(e)?t.def:s.mod?(e+s.mod)%s.mod:0>e?0:e>s.max?s.max:e)}function n(e){var s=u(),n=s._rgba=[];return e=e.toLowerCase(),m(l,function(t,a){var o,r=a.re.exec(e),h=r&&a.parse(r),l=a.space||\"rgba\";return h?(o=s[l](h),s[c[l].cache]=o[c[l].cache],n=s._rgba=o._rgba,!1):i}),n.length?(\"0,0,0,0\"===n.join()&&t.extend(n,o.transparent),s):o[e]}function a(e,t,i){return i=(i+1)%1,1>6*i?e+6*(t-e)*i:1>2*i?t:2>3*i?e+6*(t-e)*(2/3-i):e}var o,r=\"backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor\".split(\" \"),h=/^([\\-+])=\\s*(\\d+\\.?\\d*)/,l=[{re:/rgba?\\(\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3})\\s*(?:,\\s*(\\d+(?:\\.\\d+)?)\\s*)?\\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\\(\\s*(\\d+(?:\\.\\d+)?)\\%\\s*,\\s*(\\d+(?:\\.\\d+)?)\\%\\s*,\\s*(\\d+(?:\\.\\d+)?)\\%\\s*(?:,\\s*(\\d+(?:\\.\\d+)?)\\s*)?\\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\\(\\s*(\\d+(?:\\.\\d+)?)\\s*,\\s*(\\d+(?:\\.\\d+)?)\\%\\s*,\\s*(\\d+(?:\\.\\d+)?)\\%\\s*(?:,\\s*(\\d+(?:\\.\\d+)?)\\s*)?\\)/,space:\"hsla\",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],u=t.Color=function(e,i,s,n){return new t.Color.fn.parse(e,i,s,n)},c={rgba:{props:{red:{idx:0,type:\"byte\"},green:{idx:1,type:\"byte\"},blue:{idx:2,type:\"byte\"}}},hsla:{props:{hue:{idx:0,type:\"degrees\"},saturation:{idx:1,type:\"percent\"},lightness:{idx:2,type:\"percent\"}}}},d={\"byte\":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},p=u.support={},f=t(\"<p>\")[0],m=t.each;f.style.cssText=\"background-color:rgba(1,1,1,.5)\",p.rgba=f.style.backgroundColor.indexOf(\"rgba\")>-1,m(c,function(e,t){t.cache=\"_\"+e,t.props.alpha={idx:3,type:\"percent\",def:1}}),u.fn=t.extend(u.prototype,{parse:function(a,r,h,l){if(a===i)return this._rgba=[null,null,null,null],this;(a.jquery||a.nodeType)&&(a=t(a).css(r),r=i);var d=this,p=t.type(a),f=this._rgba=[];return r!==i&&(a=[a,r,h,l],p=\"array\"),\"string\"===p?this.parse(n(a)||o._default):\"array\"===p?(m(c.rgba.props,function(e,t){f[t.idx]=s(a[t.idx],t)}),this):\"object\"===p?(a instanceof u?m(c,function(e,t){a[t.cache]&&(d[t.cache]=a[t.cache].slice())}):m(c,function(t,i){var n=i.cache;m(i.props,function(e,t){if(!d[n]&&i.to){if(\"alpha\"===e||null==a[e])return;d[n]=i.to(d._rgba)}d[n][t.idx]=s(a[e],t,!0)}),d[n]&&0>e.inArray(null,d[n].slice(0,3))&&(d[n][3]=1,i.from&&(d._rgba=i.from(d[n])))}),this):i},is:function(e){var t=u(e),s=!0,n=this;return m(c,function(e,a){var o,r=t[a.cache];return r&&(o=n[a.cache]||a.to&&a.to(n._rgba)||[],m(a.props,function(e,t){return null!=r[t.idx]?s=r[t.idx]===o[t.idx]:i})),s}),s},_space:function(){var e=[],t=this;return m(c,function(i,s){t[s.cache]&&e.push(i)}),e.pop()},transition:function(e,t){var i=u(e),n=i._space(),a=c[n],o=0===this.alpha()?u(\"transparent\"):this,r=o[a.cache]||a.to(o._rgba),h=r.slice();return i=i[a.cache],m(a.props,function(e,n){var a=n.idx,o=r[a],l=i[a],u=d[n.type]||{};null!==l&&(null===o?h[a]=l:(u.mod&&(l-o>u.mod/2?o+=u.mod:o-l>u.mod/2&&(o-=u.mod)),h[a]=s((l-o)*t+o,n)))}),this[n](h)},blend:function(e){if(1===this._rgba[3])return this;var i=this._rgba.slice(),s=i.pop(),n=u(e)._rgba;return u(t.map(i,function(e,t){return(1-s)*n[t]+s*e}))},toRgbaString:function(){var e=\"rgba(\",i=t.map(this._rgba,function(e,t){return null==e?t>2?1:0:e});return 1===i[3]&&(i.pop(),e=\"rgb(\"),e+i.join()+\")\"},toHslaString:function(){var e=\"hsla(\",i=t.map(this.hsla(),function(e,t){return null==e&&(e=t>2?1:0),t&&3>t&&(e=Math.round(100*e)+\"%\"),e});return 1===i[3]&&(i.pop(),e=\"hsl(\"),e+i.join()+\")\"},toHexString:function(e){var i=this._rgba.slice(),s=i.pop();return e&&i.push(~~(255*s)),\"#\"+t.map(i,function(e){return e=(e||0).toString(16),1===e.length?\"0\"+e:e}).join(\"\")},toString:function(){return 0===this._rgba[3]?\"transparent\":this.toRgbaString()}}),u.fn.parse.prototype=u.fn,c.hsla.to=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t,i,s=e[0]/255,n=e[1]/255,a=e[2]/255,o=e[3],r=Math.max(s,n,a),h=Math.min(s,n,a),l=r-h,u=r+h,c=.5*u;return t=h===r?0:s===r?60*(n-a)/l+360:n===r?60*(a-s)/l+120:60*(s-n)/l+240,i=0===c||1===c?c:.5>=c?l/u:l/(2-u),[Math.round(t)%360,i,c,null==o?1:o]},c.hsla.from=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t=e[0]/360,i=e[1],s=e[2],n=e[3],o=.5>=s?s*(1+i):s+i-s*i,r=2*s-o;return[Math.round(255*a(r,o,t+1/3)),Math.round(255*a(r,o,t)),Math.round(255*a(r,o,t-1/3)),n]},m(c,function(e,n){var a=n.props,o=n.cache,r=n.to,l=n.from;u.fn[e]=function(e){if(r&&!this[o]&&(this[o]=r(this._rgba)),e===i)return this[o].slice();var n,h=t.type(e),c=\"array\"===h||\"object\"===h?e:arguments,d=this[o].slice();return m(a,function(e,t){var i=c[\"object\"===h?e:t.idx];null==i&&(i=d[t.idx]),d[t.idx]=s(i,t)}),l?(n=u(l(d)),n[o]=d,n):u(d)},m(a,function(i,s){u.fn[i]||(u.fn[i]=function(n){var a,o=t.type(n),r=\"alpha\"===i?this._hsla?\"hsla\":\"rgba\":e,l=this[r](),u=l[s.idx];return\"undefined\"===o?u:(\"function\"===o&&(n=n.call(this,u),o=t.type(n)),null==n&&s.empty?this:(\"string\"===o&&(a=h.exec(n),a&&(n=u+parseFloat(a[2])*(\"+\"===a[1]?1:-1))),l[s.idx]=n,this[r](l)))})})}),m(r,function(e,i){t.cssHooks[i]={set:function(e,s){var a,o,r=\"\";if(\"string\"!==t.type(s)||(a=n(s))){if(s=u(a||s),!p.rgba&&1!==s._rgba[3]){for(o=\"backgroundColor\"===i?e.parentNode:e;(\"\"===r||\"transparent\"===r)&&o&&o.style;)try{r=t.css(o,\"backgroundColor\"),o=o.parentNode}catch(h){}s=s.blend(r&&\"transparent\"!==r?r:\"_default\")}s=s.toRgbaString()}try{e.style[i]=s}catch(l){}}},t.fx.step[i]=function(e){e.colorInit||(e.start=u(e.elem,i),e.end=u(e.end),e.colorInit=!0),t.cssHooks[i].set(e.elem,e.start.transition(e.end,e.pos))}}),t.cssHooks.borderColor={expand:function(e){var t={};return m([\"Top\",\"Right\",\"Bottom\",\"Left\"],function(i,s){t[\"border\"+s+\"Color\"]=e}),t}},o=t.Color.names={aqua:\"#00ffff\",black:\"#000000\",blue:\"#0000ff\",fuchsia:\"#ff00ff\",gray:\"#808080\",green:\"#008000\",lime:\"#00ff00\",maroon:\"#800000\",navy:\"#000080\",olive:\"#808000\",purple:\"#800080\",red:\"#ff0000\",silver:\"#c0c0c0\",teal:\"#008080\",white:\"#ffffff\",yellow:\"#ffff00\",transparent:[null,null,null,0],_default:\"#ffffff\"}}(jQuery),function(){function i(){var t,i,s=this.ownerDocument.defaultView?this.ownerDocument.defaultView.getComputedStyle(this,null):this.currentStyle,n={};if(s&&s.length&&s[0]&&s[s[0]])for(i=s.length;i--;)t=s[i],\"string\"==typeof s[t]&&(n[e.camelCase(t)]=s[t]);else for(t in s)\"string\"==typeof s[t]&&(n[t]=s[t]);return n}function s(t,i){var s,n,o={};for(s in i)n=i[s],t[s]!==n&&(a[s]||(e.fx.step[s]||!isNaN(parseFloat(n)))&&(o[s]=n));return o}var n=[\"add\",\"remove\",\"toggle\"],a={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};e.each([\"borderLeftStyle\",\"borderRightStyle\",\"borderBottomStyle\",\"borderTopStyle\"],function(t,i){e.fx.step[i]=function(e){(\"none\"!==e.end&&!e.setAttr||1===e.pos&&!e.setAttr)&&(jQuery.style(e.elem,i,e.end),e.setAttr=!0)}}),e.effects.animateClass=function(t,a,o,r){var h=e.speed(a,o,r);return this.queue(function(){var a,o=e(this),r=o.attr(\"class\")||\"\",l=h.children?o.find(\"*\").andSelf():o;l=l.map(function(){var t=e(this);return{el:t,start:i.call(this)}}),a=function(){e.each(n,function(e,i){t[i]&&o[i+\"Class\"](t[i])})},a(),l=l.map(function(){return this.end=i.call(this.el[0]),this.diff=s(this.start,this.end),this}),o.attr(\"class\",r),l=l.map(function(){var t=this,i=e.Deferred(),s=jQuery.extend({},h,{queue:!1,complete:function(){i.resolve(t)}});return this.el.animate(this.diff,s),i.promise()}),e.when.apply(e,l.get()).done(function(){a(),e.each(arguments,function(){var t=this.el;e.each(this.diff,function(e){t.css(e,\"\")})}),h.complete.call(o[0])})})},e.fn.extend({_addClass:e.fn.addClass,addClass:function(t,i,s,n){return i?e.effects.animateClass.call(this,{add:t},i,s,n):this._addClass(t)},_removeClass:e.fn.removeClass,removeClass:function(t,i,s,n){return i?e.effects.animateClass.call(this,{remove:t},i,s,n):this._removeClass(t)},_toggleClass:e.fn.toggleClass,toggleClass:function(i,s,n,a,o){return\"boolean\"==typeof s||s===t?n?e.effects.animateClass.call(this,s?{add:i}:{remove:i},n,a,o):this._toggleClass(i,s):e.effects.animateClass.call(this,{toggle:i},s,n,a)},switchClass:function(t,i,s,n,a){return e.effects.animateClass.call(this,{add:i,remove:t},s,n,a)}})}(),function(){function n(t,i,s,n){return e.isPlainObject(t)&&(i=t,t=t.effect),t={effect:t},null==i&&(i={}),e.isFunction(i)&&(n=i,s=null,i={}),(\"number\"==typeof i||e.fx.speeds[i])&&(n=s,s=i,i={}),e.isFunction(s)&&(n=s,s=null),i&&e.extend(t,i),s=s||i.duration,t.duration=e.fx.off?0:\"number\"==typeof s?s:s in e.fx.speeds?e.fx.speeds[s]:e.fx.speeds._default,t.complete=n||i.complete,t}function a(t){return!t||\"number\"==typeof t||e.fx.speeds[t]?!0:\"string\"!=typeof t||e.effects.effect[t]?!1:i&&e.effects[t]?!1:!0}e.extend(e.effects,{version:\"1.9.2\",save:function(e,t){for(var i=0;t.length>i;i++)null!==t[i]&&e.data(s+t[i],e[0].style[t[i]])},restore:function(e,i){var n,a;for(a=0;i.length>a;a++)null!==i[a]&&(n=e.data(s+i[a]),n===t&&(n=\"\"),e.css(i[a],n))},setMode:function(e,t){return\"toggle\"===t&&(t=e.is(\":hidden\")?\"show\":\"hide\"),t},getBaseline:function(e,t){var i,s;switch(e[0]){case\"top\":i=0;break;case\"middle\":i=.5;break;case\"bottom\":i=1;break;default:i=e[0]/t.height}switch(e[1]){case\"left\":s=0;break;case\"center\":s=.5;break;case\"right\":s=1;break;default:s=e[1]/t.width}return{x:s,y:i}},createWrapper:function(t){if(t.parent().is(\".ui-effects-wrapper\"))return t.parent();var i={width:t.outerWidth(!0),height:t.outerHeight(!0),\"float\":t.css(\"float\")},s=e(\"<div></div>\").addClass(\"ui-effects-wrapper\").css({fontSize:\"100%\",background:\"transparent\",border:\"none\",margin:0,padding:0}),n={width:t.width(),height:t.height()},a=document.activeElement;try{a.id}catch(o){a=document.body}return t.wrap(s),(t[0]===a||e.contains(t[0],a))&&e(a).focus(),s=t.parent(),\"static\"===t.css(\"position\")?(s.css({position:\"relative\"}),t.css({position:\"relative\"})):(e.extend(i,{position:t.css(\"position\"),zIndex:t.css(\"z-index\")}),e.each([\"top\",\"left\",\"bottom\",\"right\"],function(e,s){i[s]=t.css(s),isNaN(parseInt(i[s],10))&&(i[s]=\"auto\")}),t.css({position:\"relative\",top:0,left:0,right:\"auto\",bottom:\"auto\"})),t.css(n),s.css(i).show()},removeWrapper:function(t){var i=document.activeElement;return t.parent().is(\".ui-effects-wrapper\")&&(t.parent().replaceWith(t),(t[0]===i||e.contains(t[0],i))&&e(i).focus()),t},setTransition:function(t,i,s,n){return n=n||{},e.each(i,function(e,i){var a=t.cssUnit(i);a[0]>0&&(n[i]=a[0]*s+a[1])}),n}}),e.fn.extend({effect:function(){function t(t){function i(){e.isFunction(a)&&a.call(n[0]),e.isFunction(t)&&t()}var n=e(this),a=s.complete,o=s.mode;(n.is(\":hidden\")?\"hide\"===o:\"show\"===o)?i():r.call(n[0],s,i)}var s=n.apply(this,arguments),a=s.mode,o=s.queue,r=e.effects.effect[s.effect],h=!r&&i&&e.effects[s.effect];return e.fx.off||!r&&!h?a?this[a](s.duration,s.complete):this.each(function(){s.complete&&s.complete.call(this)}):r?o===!1?this.each(t):this.queue(o||\"fx\",t):h.call(this,{options:s,duration:s.duration,callback:s.complete,mode:s.mode})},_show:e.fn.show,show:function(e){if(a(e))return this._show.apply(this,arguments);var t=n.apply(this,arguments);return t.mode=\"show\",this.effect.call(this,t)},_hide:e.fn.hide,hide:function(e){if(a(e))return this._hide.apply(this,arguments);var t=n.apply(this,arguments);return t.mode=\"hide\",this.effect.call(this,t)},__toggle:e.fn.toggle,toggle:function(t){if(a(t)||\"boolean\"==typeof t||e.isFunction(t))return this.__toggle.apply(this,arguments);var i=n.apply(this,arguments);return i.mode=\"toggle\",this.effect.call(this,i)},cssUnit:function(t){var i=this.css(t),s=[];return e.each([\"em\",\"px\",\"%\",\"pt\"],function(e,t){i.indexOf(t)>0&&(s=[parseFloat(i),t])}),s}})}(),function(){var t={};e.each([\"Quad\",\"Cubic\",\"Quart\",\"Quint\",\"Expo\"],function(e,i){t[i]=function(t){return Math.pow(t,e+2)}}),e.extend(t,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){for(var t,i=4;((t=Math.pow(2,--i))-1)/11>e;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*t-2)/22-e,2)}}),e.each(t,function(t,i){e.easing[\"easeIn\"+t]=i,e.easing[\"easeOut\"+t]=function(e){return 1-i(1-e)},e.easing[\"easeInOut\"+t]=function(e){return.5>e?i(2*e)/2:1-i(-2*e+2)/2}})}()}(jQuery);(function(e){e.effects.effect.bounce=function(t,i){var s,n,a,o=e(this),r=[\"position\",\"top\",\"bottom\",\"left\",\"right\",\"height\",\"width\"],h=e.effects.setMode(o,t.mode||\"effect\"),l=\"hide\"===h,u=\"show\"===h,d=t.direction||\"up\",c=t.distance,p=t.times||5,f=2*p+(u||l?1:0),m=t.duration/f,g=t.easing,v=\"up\"===d||\"down\"===d?\"top\":\"left\",b=\"up\"===d||\"left\"===d,y=o.queue(),_=y.length;for((u||l)&&r.push(\"opacity\"),e.effects.save(o,r),o.show(),e.effects.createWrapper(o),c||(c=o[\"top\"===v?\"outerHeight\":\"outerWidth\"]()/3),u&&(a={opacity:1},a[v]=0,o.css(\"opacity\",0).css(v,b?2*-c:2*c).animate(a,m,g)),l&&(c/=Math.pow(2,p-1)),a={},a[v]=0,s=0;p>s;s++)n={},n[v]=(b?\"-=\":\"+=\")+c,o.animate(n,m,g).animate(a,m,g),c=l?2*c:c/2;l&&(n={opacity:0},n[v]=(b?\"-=\":\"+=\")+c,o.animate(n,m,g)),o.queue(function(){l&&o.hide(),e.effects.restore(o,r),e.effects.removeWrapper(o),i()}),_>1&&y.splice.apply(y,[1,0].concat(y.splice(_,f+1))),o.dequeue()}})(jQuery);(function(e){e.effects.effect.clip=function(t,i){var s,n,a,o=e(this),r=[\"position\",\"top\",\"bottom\",\"left\",\"right\",\"height\",\"width\"],h=e.effects.setMode(o,t.mode||\"hide\"),l=\"show\"===h,u=t.direction||\"vertical\",d=\"vertical\"===u,c=d?\"height\":\"width\",p=d?\"top\":\"left\",f={};e.effects.save(o,r),o.show(),s=e.effects.createWrapper(o).css({overflow:\"hidden\"}),n=\"IMG\"===o[0].tagName?s:o,a=n[c](),l&&(n.css(c,0),n.css(p,a/2)),f[c]=l?a:0,f[p]=l?0:a/2,n.animate(f,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){l||o.hide(),e.effects.restore(o,r),e.effects.removeWrapper(o),i()}})}})(jQuery);(function(e){e.effects.effect.drop=function(t,i){var s,n=e(this),a=[\"position\",\"top\",\"bottom\",\"left\",\"right\",\"opacity\",\"height\",\"width\"],o=e.effects.setMode(n,t.mode||\"hide\"),r=\"show\"===o,h=t.direction||\"left\",l=\"up\"===h||\"down\"===h?\"top\":\"left\",u=\"up\"===h||\"left\"===h?\"pos\":\"neg\",d={opacity:r?1:0};e.effects.save(n,a),n.show(),e.effects.createWrapper(n),s=t.distance||n[\"top\"===l?\"outerHeight\":\"outerWidth\"](!0)/2,r&&n.css(\"opacity\",0).css(l,\"pos\"===u?-s:s),d[l]=(r?\"pos\"===u?\"+=\":\"-=\":\"pos\"===u?\"-=\":\"+=\")+s,n.animate(d,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){\"hide\"===o&&n.hide(),e.effects.restore(n,a),e.effects.removeWrapper(n),i()}})}})(jQuery);(function(e){e.effects.effect.fade=function(t,i){var s=e(this),n=e.effects.setMode(s,t.mode||\"toggle\");s.animate({opacity:n},{queue:!1,duration:t.duration,easing:t.easing,complete:i})}})(jQuery);(function(e){e.effects.effect.fold=function(t,i){var s,n,a=e(this),o=[\"position\",\"top\",\"bottom\",\"left\",\"right\",\"height\",\"width\"],r=e.effects.setMode(a,t.mode||\"hide\"),h=\"show\"===r,l=\"hide\"===r,u=t.size||15,d=/([0-9]+)%/.exec(u),c=!!t.horizFirst,p=h!==c,f=p?[\"width\",\"height\"]:[\"height\",\"width\"],m=t.duration/2,g={},v={};e.effects.save(a,o),a.show(),s=e.effects.createWrapper(a).css({overflow:\"hidden\"}),n=p?[s.width(),s.height()]:[s.height(),s.width()],d&&(u=parseInt(d[1],10)/100*n[l?0:1]),h&&s.css(c?{height:0,width:u}:{height:u,width:0}),g[f[0]]=h?n[0]:u,v[f[1]]=h?n[1]:0,s.animate(g,m,t.easing).animate(v,m,t.easing,function(){l&&a.hide(),e.effects.restore(a,o),e.effects.removeWrapper(a),i()})}})(jQuery);(function(e){e.effects.effect.highlight=function(t,i){var s=e(this),n=[\"backgroundImage\",\"backgroundColor\",\"opacity\"],a=e.effects.setMode(s,t.mode||\"show\"),o={backgroundColor:s.css(\"backgroundColor\")};\"hide\"===a&&(o.opacity=0),e.effects.save(s,n),s.show().css({backgroundImage:\"none\",backgroundColor:t.color||\"#ffff99\"}).animate(o,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){\"hide\"===a&&s.hide(),e.effects.restore(s,n),i()}})}})(jQuery);(function(e){e.effects.effect.slide=function(t,i){var s,n=e(this),a=[\"position\",\"top\",\"bottom\",\"left\",\"right\",\"width\",\"height\"],o=e.effects.setMode(n,t.mode||\"show\"),r=\"show\"===o,h=t.direction||\"left\",l=\"up\"===h||\"down\"===h?\"top\":\"left\",u=\"up\"===h||\"left\"===h,d={};e.effects.save(n,a),n.show(),s=t.distance||n[\"top\"===l?\"outerHeight\":\"outerWidth\"](!0),e.effects.createWrapper(n).css({overflow:\"hidden\"}),r&&n.css(l,u?isNaN(s)?\"-\"+s:-s:s),d[l]=(r?u?\"+=\":\"-=\":u?\"-=\":\"+=\")+s,n.animate(d,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){\"hide\"===o&&n.hide(),e.effects.restore(n,a),e.effects.removeWrapper(n),i()}})}})(jQuery);","/*\r\n * jQuery UI Touch Punch 0.2.2\r\n *\r\n * Copyright 2011, Dave Furfero\r\n * Dual licensed under the MIT or GPL Version 2 licenses.\r\n *\r\n * Depends:\r\n *  jquery.ui.widget.js\r\n *  jquery.ui.mouse.js\r\n */\r\n(function(b){b.support.touch=\"ontouchend\" in document;if(!b.support.touch){return;}var c=b.ui.mouse.prototype,e=c._mouseInit,a;function d(g,h){if(g.originalEvent.touches.length>1){return;}g.preventDefault();var i=g.originalEvent.changedTouches[0],f=document.createEvent(\"MouseEvents\");f.initMouseEvent(h,true,true,window,1,i.screenX,i.screenY,i.clientX,i.clientY,false,false,false,false,0,null);g.target.dispatchEvent(f);}c._touchStart=function(g){var f=this;if(a||!f._mouseCapture(g.originalEvent.changedTouches[0])){return;}a=true;f._touchMoved=false;d(g,\"mouseover\");d(g,\"mousemove\");d(g,\"mousedown\");};c._touchMove=function(f){if(!a){return;}this._touchMoved=true;d(f,\"mousemove\");};c._touchEnd=function(f){if(!a){return;}d(f,\"mouseup\");d(f,\"mouseout\");if(!this._touchMoved){d(f,\"click\");}a=false;};c._mouseInit=function(){var f=this;f.element.bind(\"touchstart\",b.proxy(f,\"_touchStart\")).bind(\"touchmove\",b.proxy(f,\"_touchMove\")).bind(\"touchend\",b.proxy(f,\"_touchEnd\"));e.call(f);};})(jQuery);","/* Simple JavaScript Inheritance\r\n * By John Resig http://ejohn.org/\r\n * MIT Licensed.\r\n */\r\n// Inspired by base2 and Prototype\r\n(function(){\r\n  var initializing = false, fnTest = /xyz/.test(function(){xyz;}) ? /\\b_super\\b/ : /.*/;\r\n  // The base Class implementation (does nothing)\r\n  this.Class = function(){};\r\n  \r\n  // Create a new Class that inherits from this class\r\n  Class.extend = function(prop) {\r\n    var _super = this.prototype;\r\n    \r\n    // Instantiate a base class (but only create the instance,\r\n    // don't run the init constructor)\r\n    initializing = true;\r\n    var prototype = new this();\r\n    initializing = false;\r\n    \r\n    // Copy the properties over onto the new prototype\r\n    for (var name in prop) {\r\n      // Check if we're overwriting an existing function\r\n      prototype[name] = typeof prop[name] == \"function\" && \r\n        typeof _super[name] == \"function\" && fnTest.test(prop[name]) ?\r\n        (function(name, fn){\r\n          return function() {\r\n            var tmp = this._super;\r\n            \r\n            // Add a new ._super() method that is the same method\r\n            // but on the super-class\r\n            this._super = _super[name];\r\n            \r\n            // The method only need to be bound temporarily, so we\r\n            // remove it when we're done executing\r\n            var ret = fn.apply(this, arguments);        \r\n            this._super = tmp;\r\n            \r\n            return ret;\r\n          };\r\n        })(name, prop[name]) :\r\n        prop[name];\r\n    }\r\n    \r\n    // The dummy class constructor\r\n    function Class() {\r\n      // All construction is actually done in the init method\r\n      if ( !initializing && this.init )\r\n        this.init.apply(this, arguments);\r\n    }\r\n    \r\n    // Populate our constructed prototype object\r\n    Class.prototype = prototype;\r\n    \r\n    // Enforce the constructor to be what we expect\r\n    Class.prototype.constructor = Class;\r\n\r\n    // And make this class extendable\r\n    Class.extend = arguments.callee;\r\n    \r\n    return Class;\r\n  };\r\n})();","/*!\r\n * Note: Paper.js has had some bugfixes and enhancements specifically\r\n * for Brightgreen Lighting designer. To find, search for 'brightgreen'\r\n *\r\n *\r\n * Paper.js v0.8 - The Swiss Army Knife of Vector Graphics Scripting.\r\n * http://paperjs.org/\r\n *\r\n * Copyright (c) 2011 - 2013, Juerg Lehni & Jonathan Puckey\r\n * http://lehni.org/ & http://jonathanpuckey.com/\r\n *\r\n * Distributed under the MIT license. See LICENSE file for details.\r\n *\r\n * All rights reserved.\r\n *\r\n * Date: Tue Apr 9 22:38:23 2013 -0700\r\n *\r\n ***\r\n *\r\n * Bootstrap.js JavaScript Inheritance Micro-Framework\r\n * Copyright (c) 2006 - 2013 Juerg Lehni\r\n * http://lehni.org/\r\n *\r\n * Distributed under the MIT license.\r\n *\r\n ***\r\n *\r\n * Acorn.js\r\n * http://marijnhaverbeke.nl/acorn/\r\n *\r\n * Acorn is a tiny, fast JavaScript parser written in JavaScript,\r\n * created by Marijn Haverbeke and released under an MIT license.\r\n *\r\n */\r\n\r\nvar paper = new function() {\r\n\r\nvar Base = new function() {\r\n\tvar hidden = /^(statics|generics|preserve|enumerable|prototype|toString|valueOf)$/,\r\n\t\tproto = Object.prototype,\r\n\t\ttoString = proto.toString,\r\n\t\tproto = Array.prototype,\r\n\t\tisArray = Array.isArray = Array.isArray || function(obj) {\r\n\t\t\treturn toString.call(obj) === '[object Array]';\r\n\t\t},\r\n\t\tslice = proto.slice,\r\n\t\tforEach = proto.forEach || function(iter, bind) {\r\n\t\t\tfor (var i = 0, l = this.length; i < l; i++)\r\n\t\t\t\titer.call(bind, this[i], i, this);\r\n\t\t},\r\n\t\tforIn = function(iter, bind) {\r\n\t\t\tfor (var i in this)\r\n\t\t\t\tif (this.hasOwnProperty(i))\r\n\t\t\t\t\titer.call(bind, this[i], i, this);\r\n\t\t},\r\n\t\tcreate = Object.create || function(proto) {\r\n\t\t\treturn { __proto__: proto };\r\n\t\t},\r\n\t\t_define = Object.defineProperty,\r\n\t\t_describe = Object.getOwnPropertyDescriptor;\r\n\r\n\tfunction define(obj, name, desc) {\r\n\t\tif (_define) {\r\n\t\t\ttry {\r\n\t\t\t\tdelete obj[name];\r\n\t\t\t\treturn _define(obj, name, desc);\r\n\t\t\t} catch (e) {}\r\n\t\t}\r\n\t\tif ((desc.get || desc.set) && obj.__defineGetter__) {\r\n\t\t\tdesc.get && obj.__defineGetter__(name, desc.get);\r\n\t\t\tdesc.set && obj.__defineSetter__(name, desc.set);\r\n\t\t} else {\r\n\t\t\tobj[name] = desc.value;\r\n\t\t}\r\n\t\treturn obj;\r\n\t}\r\n\r\n\tfunction describe(obj, name) {\r\n\t\tif (_describe) {\r\n\t\t\ttry {\r\n\t\t\t\treturn _describe(obj, name);\r\n\t\t\t} catch (e) {}\r\n\t\t}\r\n\t\tvar get = obj.__lookupGetter__ && obj.__lookupGetter__(name);\r\n\t\treturn get\r\n\t\t\t? { get: get, set: obj.__lookupSetter__(name), enumerable: true,\r\n\t\t\t\t\tconfigurable: true }\r\n\t\t\t: obj.hasOwnProperty(name)\r\n\t\t\t\t? { value: obj[name], enumerable: true, configurable: true,\r\n\t\t\t\t\t\twritable: true }\r\n\t\t\t\t: null;\r\n\t}\r\n\r\n\tfunction inject(dest, src, enumerable, base, preserve, generics) {\r\n\t\tvar beans, bean;\r\n\r\n\t\tfunction field(name, val, dontCheck, generics) {\r\n\t\t\tvar val = val || (val = describe(src, name))\r\n\t\t\t\t\t&& (val.get ? val : val.value),\r\n\t\t\t\tfunc = typeof val === 'function',\r\n\t\t\t\tres = val,\r\n\t\t\t\tprev = preserve || func\r\n\t\t\t\t\t? (val && val.get ? name in dest : dest[name]) : null;\r\n\t\t\tif ((dontCheck || val !== undefined && src.hasOwnProperty(name))\r\n\t\t\t\t\t&& (!preserve || !prev)) {\r\n\t\t\t\tif (func) {\r\n\t\t\t\t\tif (prev && /\\bthis\\.base\\b/.test(val)) {\r\n\t\t\t\t\t\tvar fromBase = base && base[name] == prev;\r\n\t\t\t\t\t\tres = function() {\r\n\t\t\t\t\t\t\tvar tmp = describe(this, 'base');\r\n\t\t\t\t\t\t\tdefine(this, 'base', { value: fromBase\r\n\t\t\t\t\t\t\t\t? base[name] : prev, configurable: true });\r\n\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\treturn val.apply(this, arguments);\r\n\t\t\t\t\t\t\t} finally {\r\n\t\t\t\t\t\t\t\ttmp ? define(this, 'base', tmp)\r\n\t\t\t\t\t\t\t\t\t: delete this.base;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tres.toString = function() {\r\n\t\t\t\t\t\t\treturn val.toString();\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tres.valueOf = function() {\r\n\t\t\t\t\t\t\treturn val.valueOf();\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (beans && val.length === 0\r\n\t\t\t\t\t\t\t&& (bean = name.match(/^(get|is)(([A-Z])(.*))$/)))\r\n\t\t\t\t\t\tbeans.push([ bean[3].toLowerCase() + bean[4], bean[2] ]);\r\n\t\t\t\t}\r\n\t\t\t\tif (!res || func || !res.get)\r\n\t\t\t\t\tres = { value: res, writable: true };\r\n\t\t\t\tif ((describe(dest, name)\r\n\t\t\t\t\t\t|| { configurable: true }).configurable) {\r\n\t\t\t\t\tres.configurable = true;\r\n\t\t\t\t\tres.enumerable = enumerable;\r\n\t\t\t\t}\r\n\t\t\t\tdefine(dest, name, res);\r\n\t\t\t}\r\n\t\t\tif (generics && func && (!preserve || !generics[name])) {\r\n\t\t\t\tgenerics[name] = function(bind) {\r\n\t\t\t\t\treturn bind && dest[name].apply(bind,\r\n\t\t\t\t\t\t\tslice.call(arguments, 1));\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (src) {\r\n\t\t\tbeans = [];\r\n\t\t\tfor (var name in src)\r\n\t\t\t\tif (src.hasOwnProperty(name) && !hidden.test(name))\r\n\t\t\t\t\tfield(name, null, true, generics);\r\n\t\t\tfield('toString');\r\n\t\t\tfield('valueOf');\r\n\t\t\tfor (var i = 0, l = beans && beans.length; i < l; i++)\r\n\t\t\t\ttry {\r\n\t\t\t\t\tvar bean = beans[i], part = bean[1];\r\n\t\t\t\t\tfield(bean[0], {\r\n\t\t\t\t\t\tget: dest['get' + part] || dest['is' + part],\r\n\t\t\t\t\t\tset: dest['set' + part]\r\n\t\t\t\t\t}, true);\r\n\t\t\t\t} catch (e) {}\r\n\t\t}\r\n\t\treturn dest;\r\n\t}\r\n\r\n\tfunction each(obj, iter, bind, asArray) {\r\n\t\ttry {\r\n\t\t\tif (obj)\r\n\t\t\t\t(asArray || asArray === undefined && isArray(obj)\r\n\t\t\t\t\t? forEach : forIn).call(obj, iter, bind = bind || obj);\r\n\t\t} catch (e) {\r\n\t\t\tif (e !== Base.stop) throw e;\r\n\t\t}\r\n\t\treturn bind;\r\n\t}\r\n\r\n\tfunction clone(obj) {\r\n\t\treturn each(obj, function(val, i) {\r\n\t\t\tthis[i] = val;\r\n\t\t}, new obj.constructor());\r\n\t}\r\n\r\n\treturn inject(function() {}, {\r\n\t\tinject: function(src) {\r\n\t\t\tif (src) {\r\n\t\t\t\tvar proto = this.prototype,\r\n\t\t\t\t\tbase = Object.getPrototypeOf(proto).constructor,\r\n\t\t\t\t\tstatics = src.statics === true ? src : src.statics;\r\n\t\t\t\tif (statics != src)\r\n\t\t\t\t\tinject(proto, src, src.enumerable, base && base.prototype,\r\n\t\t\t\t\t\t\tsrc.preserve, src.generics && this);\r\n\t\t\t\tinject(this, statics, true, base, src.preserve);\r\n\t\t\t}\r\n\t\t\tfor (var i = 1, l = arguments.length; i < l; i++)\r\n\t\t\t\tthis.inject(arguments[i]);\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\textend: function(src) {\r\n\t\t\tvar ctor = function() {\r\n\t\t\t\tif (this.initialize)\r\n\t\t\t\t\treturn this.initialize.apply(this, arguments);\r\n\t\t\t};\r\n\t\t\tctor.prototype = create(this.prototype);\r\n\t\t\tctor.toString = function() {\r\n\t\t\t\treturn (this.prototype.initialize || function() {}).toString();\r\n\t\t\t};\r\n\t\t\tdefine(ctor.prototype, 'constructor',\r\n\t\t\t\t\t{ value: ctor, writable: true, configurable: true });\r\n\t\t\tinject(ctor, this, true);\r\n\t\t\treturn arguments.length ? this.inject.apply(ctor, arguments) : ctor;\r\n\t\t}\r\n\t}, true).inject({\r\n\t\tinject: function() {\r\n\t\t\tfor (var i = 0, l = arguments.length; i < l; i++)\r\n\t\t\t\tinject(this, arguments[i], arguments[i].enumerable);\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\textend: function() {\r\n\t\t\tvar res = create(this);\r\n\t\t\treturn res.inject.apply(res, arguments);\r\n\t\t},\r\n\r\n\t\teach: function(iter, bind) {\r\n\t\t\treturn each(this, iter, bind);\r\n\t\t},\r\n\r\n\t\tclone: function() {\r\n\t\t\treturn clone(this);\r\n\t\t},\r\n\r\n\t\tstatics: {\r\n\t\t\teach: each,\r\n\t\t\tclone: clone,\r\n\t\t\tdefine: define,\r\n\t\t\tdescribe: describe,\r\n\r\n\t\t\tcreate: function(ctor) {\r\n\t\t\t\treturn create(ctor.prototype);\r\n\t\t\t},\r\n\r\n\t\t\tisPlainObject: function(obj) {\r\n\t\t\t\tvar proto = obj !== null && typeof obj === 'object'\r\n\t\t\t\t\t&& Object.getPrototypeOf(obj);\r\n\t\t\t\treturn proto && (proto === Object.prototype\r\n\t\t\t\t\t\t|| proto === Base.prototype);\r\n\t\t\t},\r\n\r\n\t\t\tcheck: function(obj) {\r\n\t\t\t\treturn !!(obj || obj === 0);\r\n\t\t\t},\r\n\r\n\t\t\tpick: function() {\r\n\t\t\t\tfor (var i = 0, l = arguments.length; i < l; i++)\r\n\t\t\t\t\tif (arguments[i] !== undefined)\r\n\t\t\t\t\t\treturn arguments[i];\r\n\t\t\t\treturn null;\r\n\t\t\t},\r\n\r\n\t\t\tstop: {}\r\n\t\t}\r\n\t});\r\n};\r\n\r\nthis.Base = Base.inject({\r\n\tgenerics: true,\r\n\r\n\tclone: function() {\r\n\t\treturn new this.constructor(this);\r\n\t},\r\n\r\n\ttoString: function() {\r\n\t\treturn this._id != null\r\n\t\t\t?  (this._class || 'Object') + (this._name\r\n\t\t\t\t? \" '\" + this._name + \"'\"\r\n\t\t\t\t: ' @' + this._id)\r\n\t\t\t: '{ ' + Base.each(this, function(value, key) {\r\n\t\t\t\tif (!/^_/.test(key)) {\r\n\t\t\t\t\tvar type = typeof value;\r\n\t\t\t\t\tthis.push(key + ': ' + (type === 'number'\r\n\t\t\t\t\t\t\t? Formatter.instance.number(value)\r\n\t\t\t\t\t\t\t: type === 'string' ? \"'\" + value + \"'\" : value));\r\n\t\t\t\t}\r\n\t\t\t}, []).join(', ') + ' }';\r\n\t},\r\n\r\n\texportJson: function(options) {\r\n\t\treturn Base.exportJson(this, options);\r\n\t},\r\n\r\n\ttoJSON: function() {\r\n\t\treturn Base.serialize(this);\r\n\t},\r\n\r\n\t_set: function(props) {\r\n\t\tif (props && Base.isPlainObject(props)) {\r\n\t\t\tfor (var key in props)\r\n\t\t\t\tif (props.hasOwnProperty(key) && key in this)\r\n\t\t\t\t\tthis[key] = props[key];\r\n\t\t\treturn true;\r\n\t\t}\r\n\t},\r\n\r\n\tstatics: {\r\n\r\n\t\t_classes: {},\r\n\r\n\t\t_uid: 0,\r\n\r\n\t\textend: function(src) {\r\n\t\t\tvar res = this.base.apply(this, arguments);\r\n\t\t\tif (src._class)\r\n\t\t\t\tBase._classes[src._class] = res;\r\n\t\t\treturn res;\r\n\t\t},\r\n\r\n\t\tequals: function(obj1, obj2) {\r\n\t\t\tfunction checkKeys(o1, o2) {\r\n\t\t\t\tfor (var i in o1)\r\n\t\t\t\t\tif (o1.hasOwnProperty(i) && typeof o2[i] === 'undefined')\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tif (obj1 == obj2)\r\n\t\t\t\treturn true;\r\n\t\t\tif (obj1 && obj1.equals)\r\n\t\t\t\treturn obj1.equals(obj2);\r\n\t\t\tif (obj2 && obj2.equals)\r\n\t\t\t\treturn obj2.equals(obj1);\r\n\t\t\tif (Array.isArray(obj1) && Array.isArray(obj2)) {\r\n\t\t\t\tif (obj1.length !== obj2.length)\r\n\t\t\t\t\treturn false;\r\n\t\t\t\tfor (var i = 0, l = obj1.length; i < l; i++) {\r\n\t\t\t\t\tif (!Base.equals(obj1[i], obj2[i]))\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tif (obj1 && typeof obj1 === 'object'\r\n\t\t\t\t\t&& obj2 && typeof obj2 === 'object') {\r\n\t\t\t\tif (!checkKeys(obj1, obj2) || !checkKeys(obj2, obj1))\r\n\t\t\t\t\treturn false;\r\n\t\t\t\tfor (var i in obj1) {\r\n\t\t\t\t\tif (obj1.hasOwnProperty(i) && !Base.equals(obj1[i], obj2[i]))\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\tread: function(list, start, length, clone, readNull) {\r\n\t\t\tif (this === Base) {\r\n\t\t\t\tvar value = this.peek(list, start);\r\n\t\t\t\tlist._index++;\r\n\t\t\t\tlist._read = 1;\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t\tvar proto = this.prototype,\r\n\t\t\t\treadIndex = proto._readIndex,\r\n\t\t\t\tindex = start || readIndex && list._index || 0;\r\n\t\t\tif (!length)\r\n\t\t\t\tlength = list.length - index;\r\n\t\t\tvar obj = list[index];\r\n\t\t\tif (obj instanceof this\r\n\t\t\t\t|| (proto._readNull || readNull) && obj == null && length <= 1) {\r\n\t\t\t\tif (readIndex)\r\n\t\t\t\t\tlist._index = index + 1;\r\n\t\t\t\treturn obj && clone ? obj.clone() : obj;\r\n\t\t\t}\r\n\t\t\tobj = Base.create(this);\r\n\t\t\tif (readIndex)\r\n\t\t\t\tobj._read = true;\r\n\t\t\tobj = obj.initialize.apply(obj, index > 0 || length < list.length\r\n\t\t\t\t? Array.prototype.slice.call(list, index, index + length)\r\n\t\t\t\t: list) || obj;\r\n\t\t\tif (readIndex) {\r\n\t\t\t\tlist._index = index + obj._read;\r\n\t\t\t\tlist._read = obj._read;\r\n\t\t\t\tdelete obj._read;\r\n\t\t\t}\r\n\t\t\treturn obj;\r\n\t\t},\r\n\r\n\t\tpeek: function(list, start) {\r\n\t\t\treturn list[list._index = start || list._index || 0];\r\n\t\t},\r\n\r\n\t\treadAll: function(list, start, clone) {\r\n\t\t\tvar res = [], entry;\r\n\t\t\tfor (var i = start || 0, l = list.length; i < l; i++) {\r\n\t\t\t\tres.push(Array.isArray(entry = list[i])\r\n\t\t\t\t\t? this.read(entry, 0, 0, clone)\r\n\t\t\t\t\t: this.read(list, i, 1, clone));\r\n\t\t\t}\r\n\t\t\treturn res;\r\n\t\t},\r\n\r\n\t\treadNamed: function(list, name) {\r\n\t\t\tvar value = this.getNamed(list, name);\r\n\t\t\treturn this.read(value != null ? [value] : list);\r\n\t\t},\r\n\r\n\t\tgetNamed: function(list, name) {\r\n\t\t\tvar arg = list[0];\r\n\t\t\tif (list._hasObject === undefined)\r\n\t\t\t\tlist._hasObject = list.length === 1 && Base.isPlainObject(arg);\r\n\t\t\tif (list._hasObject)\r\n\t\t\t\treturn name ? arg[name] : arg;\r\n\t\t},\r\n\r\n\t\thasNamed: function(list, name) {\r\n\t\t\treturn !!this.getNamed(list, name);\r\n\t\t},\r\n\r\n\t\tserialize: function(obj, options, compact, dictionary) {\r\n\t\t\toptions = options || {};\r\n\r\n\t\t\tvar root = !dictionary,\r\n\t\t\t\tres;\r\n\t\t\tif (root) {\r\n\t\t\t\toptions.formatter = new Formatter(options.precision);\r\n\t\t\t\tdictionary = {\r\n\t\t\t\t\tlength: 0,\r\n\t\t\t\t\tdefinitions: {},\r\n\t\t\t\t\treferences: {},\r\n\t\t\t\t\tadd: function(item, create) {\r\n\t\t\t\t\t\tvar id = '#' + item._id,\r\n\t\t\t\t\t\t\tref = this.references[id];\r\n\t\t\t\t\t\tif (!ref) {\r\n\t\t\t\t\t\t\tthis.length++;\r\n\t\t\t\t\t\t\tvar res = create.call(item);\r\n\t\t\t\t\t\t\tif (item._class && res[0] !== item._class)\r\n\t\t\t\t\t\t\t\tres.unshift(item._class);\r\n\t\t\t\t\t\t\tthis.definitions[id] = res;\r\n\t\t\t\t\t\t\tref = this.references[id] = [id];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn ref;\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tif (obj && obj._serialize) {\r\n\t\t\t\tres = obj._serialize(options, dictionary);\r\n\t\t\t\tif (obj._class && !compact && res[0] !== obj._class)\r\n\t\t\t\t\tres.unshift(obj._class);\r\n\t\t\t} else if (Array.isArray(obj)) {\r\n\t\t\t\tres = [];\r\n\t\t\t\tfor (var i = 0, l = obj.length; i < l; i++)\r\n\t\t\t\t\tres[i] = Base.serialize(obj[i], options, compact,\r\n\t\t\t\t\t\t\tdictionary);\r\n\t\t\t} else if (Base.isPlainObject(obj)) {\r\n\t\t\t\tres = {};\r\n\t\t\t\tfor (var i in obj)\r\n\t\t\t\t\tif (obj.hasOwnProperty(i))\r\n\t\t\t\t\t\tres[i] = Base.serialize(obj[i], options, compact,\r\n\t\t\t\t\t\t\t\tdictionary);\r\n\t\t\t} else if (typeof obj === 'number') {\r\n\t\t\t\tres = options.formatter.number(obj, options.precision);\r\n\t\t\t} else {\r\n\t\t\t\tres = obj;\r\n\t\t\t}\r\n\t\t\treturn root && dictionary.length > 0\r\n\t\t\t\t\t? [['dictionary', dictionary.definitions], res]\r\n\t\t\t\t\t: res;\r\n\t\t},\r\n\r\n\t\tdeserialize: function(obj, data) {\r\n\t\t\tvar res = obj;\r\n\t\t\tdata = data || {};\r\n\t\t\tif (Array.isArray(obj)) {\r\n\t\t\t\tvar type = obj[0],\r\n\t\t\t\t\tisDictionary = type === 'dictionary';\r\n\t\t\t\tif (!isDictionary) {\r\n\t\t\t\t\tif (data.dictionary && obj.length == 1 && /^#/.test(type))\r\n\t\t\t\t\t\treturn data.dictionary[type];\r\n\t\t\t\t\ttype = Base._classes[type];\r\n\t\t\t\t}\r\n\t\t\t\tres = [];\r\n\t\t\t\tfor (var i = type ? 1 : 0, l = obj.length; i < l; i++)\r\n\t\t\t\t\tres.push(Base.deserialize(obj[i], data));\r\n\t\t\t\tif (isDictionary) {\r\n\t\t\t\t\tdata.dictionary = res[0];\r\n\t\t\t\t} else if (type) {\r\n\t\t\t\t\tvar args = res;\r\n\t\t\t\t\tres = Base.create(type);\r\n\t\t\t\t\tres.initialize.apply(res, args);\r\n\t\t\t\t}\r\n\t\t\t} else if (Base.isPlainObject(obj)) {\r\n\t\t\t\tres = {};\r\n\t\t\t\tfor (var key in obj)\r\n\t\t\t\t\tres[key] = Base.deserialize(obj[key], data);\r\n\t\t\t}\r\n\t\t\treturn res;\r\n\t\t},\r\n\r\n\t\texportJson: function(obj, options) {\r\n\t\t\treturn JSON.stringify(Base.serialize(obj, options));\r\n\t\t},\r\n\r\n\t\timportJson: function(json) {\r\n\t\t\treturn Base.deserialize(\r\n\t\t\t\t\ttypeof json === 'string' ? JSON.parse(json) : json);\r\n\t\t},\r\n\r\n\t\tsplice: function(list, items, index, remove) {\r\n\t\t\tvar amount = items && items.length,\r\n\t\t\t\tappend = index === undefined;\r\n\t\t\tindex = append ? list.length : index;\r\n\t\t\tif (index > list.length)\r\n\t\t\t\tindex = list.length;\r\n\t\t\tfor (var i = 0; i < amount; i++)\r\n\t\t\t\titems[i]._index = index + i;\r\n\t\t\tif (append) {\r\n\t\t\t\tlist.push.apply(list, items);\r\n\t\t\t\treturn [];\r\n\t\t\t} else {\r\n\t\t\t\tvar args = [index, remove];\r\n\t\t\t\tif (items)\r\n\t\t\t\t\targs.push.apply(args, items);\r\n\t\t\t\tvar removed = list.splice.apply(list, args);\r\n\t\t\t\tfor (var i = 0, l = removed.length; i < l; i++)\r\n\t\t\t\t\tdelete removed[i]._index;\r\n\t\t\t\tfor (var i = index + amount, l = list.length; i < l; i++)\r\n\t\t\t\t\tlist[i]._index = i;\r\n\t\t\t\treturn removed;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tmerge: function() {\r\n\t\t\treturn Base.each(arguments, function(hash) {\r\n\t\t\t\tBase.each(hash, function(value, key) {\r\n\t\t\t\t\tthis[key] = value;\r\n\t\t\t\t}, this);\r\n\t\t\t}, new Base(), true);\r\n\t\t},\r\n\r\n\t\tcapitalize: function(str) {\r\n\t\t\treturn str.replace(/\\b[a-z]/g, function(match) {\r\n\t\t\t\treturn match.toUpperCase();\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tcamelize: function(str) {\r\n\t\t\treturn str.replace(/-(.)/g, function(all, chr) {\r\n\t\t\t\treturn chr.toUpperCase();\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\thyphenate: function(str) {\r\n\t\t\treturn str.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();\r\n\t\t}\r\n\t}\r\n});\r\n\r\nvar Callback = {\r\n\tattach: function(type, func) {\r\n\t\tif (typeof type !== 'string') {\r\n\t\t\tBase.each(type, function(value, key) {\r\n\t\t\t\tthis.attach(key, value);\r\n\t\t\t}, this);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar entry = this._eventTypes[type];\r\n\t\tif (entry) {\r\n\t\t\tvar handlers = this._handlers = this._handlers || {};\r\n\t\t\thandlers = handlers[type] = handlers[type] || [];\r\n\t\t\tif (handlers.indexOf(func) == -1) {\r\n\t\t\t\thandlers.push(func);\r\n\t\t\t\tif (entry.install && handlers.length == 1)\r\n\t\t\t\t\tentry.install.call(this, type);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tdetach: function(type, func) {\r\n\t\tif (typeof type !== 'string') {\r\n\t\t\tBase.each(type, function(value, key) {\r\n\t\t\t\tthis.detach(key, value);\r\n\t\t\t}, this);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar entry = this._eventTypes[type],\r\n\t\t\thandlers = this._handlers && this._handlers[type],\r\n\t\t\tindex;\r\n\t\tif (entry && handlers) {\r\n\t\t\tif (!func || (index = handlers.indexOf(func)) != -1\r\n\t\t\t\t\t&& handlers.length == 1) {\r\n\t\t\t\tif (entry.uninstall)\r\n\t\t\t\t\tentry.uninstall.call(this, type);\r\n\t\t\t\tdelete this._handlers[type];\r\n\t\t\t} else if (index != -1) {\r\n\t\t\t\thandlers.splice(index, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tfire: function(type, event) {\r\n\t\tvar handlers = this._handlers && this._handlers[type];\r\n\t\tif (!handlers)\r\n\t\t\treturn false;\r\n\t\tvar args = [].slice.call(arguments, 1);\r\n\t\tBase.each(handlers, function(func) {\r\n\t\t\tif (func.apply(this, args) === false && event && event.stop)\r\n\t\t\t\tevent.stop();\r\n\t\t}, this);\r\n\t\treturn true;\r\n\t},\r\n\r\n\tresponds: function(type) {\r\n\t\treturn !!(this._handlers && this._handlers[type]);\r\n\t},\r\n\r\n\tstatics: {\r\n\t\tinject: function() {\r\n\t\t\tfor (var i = 0, l = arguments.length; i < l; i++) {\r\n\t\t\t\tvar src = arguments[i],\r\n\t\t\t\t\tevents = src._events;\r\n\t\t\t\tif (events) {\r\n\t\t\t\t\tvar types = {};\r\n\t\t\t\t\tBase.each(events, function(entry, key) {\r\n\t\t\t\t\t\tvar isString = typeof entry === 'string',\r\n\t\t\t\t\t\t\tname = isString ? entry : key,\r\n\t\t\t\t\t\t\tpart = Base.capitalize(name),\r\n\t\t\t\t\t\t\ttype = name.substring(2).toLowerCase();\r\n\t\t\t\t\t\ttypes[type] = isString ? {} : entry;\r\n\t\t\t\t\t\tname = '_' + name;\r\n\t\t\t\t\t\tsrc['get' + part] = function() {\r\n\t\t\t\t\t\t\treturn this[name];\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tsrc['set' + part] = function(func) {\r\n\t\t\t\t\t\t\tif (func) {\r\n\t\t\t\t\t\t\t\tthis.attach(type, func);\r\n\t\t\t\t\t\t\t} else if (this[name]) {\r\n\t\t\t\t\t\t\t\tthis.detach(type, this[name]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthis[name] = func;\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t});\r\n\t\t\t\t\tsrc._eventTypes = types;\r\n\t\t\t\t}\r\n\t\t\t\tthis.base(src);\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t}\r\n\t}\r\n};\r\n\r\nvar PaperScope = this.PaperScope = Base.extend({\r\n\r\n\tinitialize: function(script) {\r\n\t\tpaper = this;\r\n\t\tthis.project = null;\r\n\t\tthis.projects = [];\r\n\t\tthis.tools = [];\r\n\t\tthis.palettes = [];\r\n\t\tthis._id = script && (script.getAttribute('id') || script.src)\r\n\t\t\t\t|| ('paperscope-' + (PaperScope._id++));\r\n\t\tif (script)\r\n\t\t\tscript.setAttribute('id', this._id);\r\n\t\tPaperScope._scopes[this._id] = this;\r\n\t\tif (!this.support) {\r\n\t\t\tvar ctx = CanvasProvider.getContext(1, 1);\r\n\t\t\tPaperScope.prototype.support = {\r\n\t\t\t\tnativeDash: 'setLineDash' in ctx || 'mozDash' in ctx\r\n\t\t\t};\r\n\t\t\tCanvasProvider.release(ctx);\r\n\t\t}\r\n\t},\r\n\r\n\tversion: 0.8,\r\n\r\n\tgetView: function() {\r\n\t\treturn this.project && this.project.view;\r\n\t},\r\n\r\n\tgetTool: function() {\r\n\t\tif (!this._tool)\r\n\t\t\tthis._tool = new Tool();\r\n\t\treturn this._tool;\r\n\t},\r\n\r\n\tevaluate: function(code) {\r\n\t\tvar res = PaperScript.evaluate(code, this);\r\n\t\tView.updateFocus();\r\n\t\treturn res;\r\n\t},\r\n\r\n\tinstall: function(scope) {\r\n\t\tvar that = this;\r\n\t\tBase.each(['project', 'view', 'tool'], function(key) {\r\n\t\t\tBase.define(scope, key, {\r\n\t\t\t\tconfigurable: true,\r\n\t\t\t\twritable: true,\r\n\t\t\t\tget: function() {\r\n\t\t\t\t\treturn that[key];\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t\tfor (var key in this) {\r\n\t\t\tif (!/^(version|_id)/.test(key) && !(key in scope))\r\n\t\t\t\tscope[key] = this[key];\r\n\t\t}\r\n\t},\r\n\r\n\tsetup: function(canvas) {\r\n\t\tpaper = this;\r\n\t\tthis.project = new Project(canvas);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tclear: function() {\r\n\t\tfor (var i = this.projects.length - 1; i >= 0; i--)\r\n\t\t\tthis.projects[i].remove();\r\n\t\tfor (var i = this.tools.length - 1; i >= 0; i--)\r\n\t\t\tthis.tools[i].remove();\r\n\t\tfor (var i = this.palettes.length - 1; i >= 0; i--)\r\n\t\t\tthis.palettes[i].remove();\r\n\t},\r\n\r\n\tremove: function() {\r\n\t\tthis.clear();\r\n\t\tdelete PaperScope._scopes[this._id];\r\n\t},\r\n\r\n\tstatics: {\r\n\t\t_scopes: {},\r\n\t\t_id: 0,\r\n\r\n\t\tget: function(id) {\r\n\t\t\tif (typeof id === 'object')\r\n\t\t\t\tid = id.getAttribute('id');\r\n\t\t\treturn this._scopes[id] || null;\r\n\t\t}\r\n\t}\r\n});\r\n\r\nvar PaperScopeItem = Base.extend(Callback, {\r\n\r\n\tinitialize: function(activate) {\r\n\t\tthis._scope = paper;\r\n\t\tthis._index = this._scope[this._list].push(this) - 1;\r\n\t\tif (activate || !this._scope[this._reference])\r\n\t\t\tthis.activate();\r\n\t},\r\n\r\n\tactivate: function() {\r\n\t\tif (!this._scope)\r\n\t\t\treturn false;\r\n\t\tvar prev = this._scope[this._reference];\r\n\t\tif (prev && prev != this)\r\n\t\t\tprev.fire('deactivate');\r\n\t\tthis._scope[this._reference] = this;\r\n\t\tthis.fire('activate', prev);\r\n\t\treturn true;\r\n\t},\r\n\r\n\tisActive: function() {\r\n\t\treturn this._scope[this._reference] === this;\r\n\t},\r\n\r\n\tremove: function() {\r\n\t\tif (this._index == null)\r\n\t\t\treturn false;\r\n\t\tBase.splice(this._scope[this._list], null, this._index, 1);\r\n\t\tif (this._scope[this._reference] == this)\r\n\t\t\tthis._scope[this._reference] = null;\r\n\t\tthis._scope = null;\r\n\t\treturn true;\r\n\t}\r\n});\r\n\r\nvar Point = this.Point = Base.extend({\r\n\t_class: 'Point',\r\n\t_readIndex: true,\r\n\r\n\tinitialize: function(arg0, arg1) {\r\n\t\tvar type = typeof arg0;\r\n\t\tif (type === 'number') {\r\n\t\t\tvar hasY = typeof arg1 === 'number';\r\n\t\t\tthis.x = arg0;\r\n\t\t\tthis.y = hasY ? arg1 : arg0;\r\n\t\t\tif (this._read)\r\n\t\t\t\tthis._read = hasY ? 2 : 1;\r\n\t\t} else if (type === 'undefined' || arg0 === null) {\r\n\t\t\tthis.x = this.y = 0;\r\n\t\t\tif (this._read)\r\n\t\t\t\tthis._read = arg0 === null ? 1 : 0;\r\n\t\t} else {\r\n\t\t\tif (Array.isArray(arg0)) {\r\n\t\t\t\tthis.x = arg0[0];\r\n\t\t\t\tthis.y = arg0.length > 1 ? arg0[1] : arg0[0];\r\n\t\t\t} else if (arg0.x != null) {\r\n\t\t\t\tthis.x = arg0.x;\r\n\t\t\t\tthis.y = arg0.y;\r\n\t\t\t} else if (arg0.width != null) {\r\n\t\t\t\tthis.x = arg0.width;\r\n\t\t\t\tthis.y = arg0.height;\r\n\t\t\t} else if (arg0.angle != null) {\r\n\t\t\t\tthis.x = arg0.length;\r\n\t\t\t\tthis.y = 0;\r\n\t\t\t\tthis.setAngle(arg0.angle);\r\n\t\t\t} else {\r\n\t\t\t\tthis.x = this.y = 0;\r\n\t\t\t\tif (this._read)\r\n\t\t\t\t\tthis._read = 0;\r\n\t\t\t}\r\n\t\t\tif (this._read)\r\n\t\t\t\tthis._read = 1;\r\n\t\t}\r\n\t},\r\n\r\n\tset: function(x, y) {\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tequals: function(point) {\r\n\t\tpoint = Point.read(arguments);\r\n\t\treturn this.x == point.x && this.y == point.y;\r\n\t},\r\n\r\n\tclone: function() {\r\n\t\treturn Point.create(this.x, this.y);\r\n\t},\r\n\r\n\ttoString: function() {\r\n\t\tvar f = Formatter.instance;\r\n\t\treturn '{ x: ' + f.number(this.x) + ', y: ' + f.number(this.y) + ' }';\r\n\t},\r\n\r\n\t_serialize: function(options) {\r\n\t\tvar f = options.formatter;\r\n\t\treturn [f.number(this.x),\r\n\t\t\t\tf.number(this.y)];\r\n\t},\r\n\r\n\tadd: function(point) {\r\n\t\tpoint = Point.read(arguments);\r\n\t\treturn Point.create(this.x + point.x, this.y + point.y);\r\n\t},\r\n\r\n\tsubtract: function(point) {\r\n\t\tpoint = Point.read(arguments);\r\n\t\treturn Point.create(this.x - point.x, this.y - point.y);\r\n\t},\r\n\r\n\tmultiply: function(point) {\r\n\t\tpoint = Point.read(arguments);\r\n\t\treturn Point.create(this.x * point.x, this.y * point.y);\r\n\t},\r\n\r\n\tdivide: function(point) {\r\n\t\tpoint = Point.read(arguments);\r\n\t\treturn Point.create(this.x / point.x, this.y / point.y);\r\n\t},\r\n\r\n\tmodulo: function(point) {\r\n\t\tpoint = Point.read(arguments);\r\n\t\treturn Point.create(this.x % point.x, this.y % point.y);\r\n\t},\r\n\r\n\tnegate: function() {\r\n\t\treturn Point.create(-this.x, -this.y);\r\n\t},\r\n\r\n\ttransform: function(matrix) {\r\n\t\treturn matrix ? matrix._transformPoint(this) : this;\r\n\t},\r\n\r\n\tgetDistance: function(point, squared) {\r\n\t\tpoint = Point.read(arguments);\r\n\t\tvar x = point.x - this.x,\r\n\t\t\ty = point.y - this.y,\r\n\t\t\td = x * x + y * y;\r\n\t\treturn squared ? d : Math.sqrt(d);\r\n\t},\r\n\r\n\tgetLength: function() {\r\n\t\tvar l = this.x * this.x + this.y * this.y;\r\n\t\treturn arguments.length && arguments[0] ? l : Math.sqrt(l);\r\n\t},\r\n\r\n\tsetLength: function(length) {\r\n\t\tif (this.isZero()) {\r\n\t\t\tvar angle = this._angle || 0;\r\n\t\t\tthis.set(\r\n\t\t\t\tMath.cos(angle) * length,\r\n\t\t\t\tMath.sin(angle) * length\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tvar scale = length / this.getLength();\r\n\t\t\tif (scale == 0)\r\n\t\t\t\tthis.getAngle();\r\n\t\t\tthis.set(\r\n\t\t\t\tthis.x * scale,\r\n\t\t\t\tthis.y * scale\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tnormalize: function(length) {\r\n\t\tif (length === undefined)\r\n\t\t\tlength = 1;\r\n\t\tvar current = this.getLength(),\r\n\t\t\tscale = current != 0 ? length / current : 0,\r\n\t\t\tpoint = Point.create(this.x * scale, this.y * scale);\r\n\t\tpoint._angle = this._angle;\r\n\t\treturn point;\r\n\t},\r\n\r\n\tgetAngle: function() {\r\n\t\treturn this.getAngleInRadians(arguments[0]) * 180 / Math.PI;\r\n\t},\r\n\r\n\tsetAngle: function(angle) {\r\n\t\tangle = this._angle = angle * Math.PI / 180;\r\n\t\tif (!this.isZero()) {\r\n\t\t\tvar length = this.getLength();\r\n\t\t\tthis.set(\r\n\t\t\t\tMath.cos(angle) * length,\r\n\t\t\t\tMath.sin(angle) * length\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetAngleInRadians: function() {\r\n\t\tif (arguments[0] === undefined) {\r\n\t\t\tif (this._angle == null)\r\n\t\t\t\tthis._angle = Math.atan2(this.y, this.x);\r\n\t\t\treturn this._angle;\r\n\t\t} else {\r\n\t\t\tvar point = Point.read(arguments),\r\n\t\t\t\tdiv = this.getLength() * point.getLength();\r\n\t\t\tif (Numerical.isZero(div)) {\r\n\t\t\t\treturn NaN;\r\n\t\t\t} else {\r\n\t\t\t\treturn Math.acos(this.dot(point) / div);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tgetAngleInDegrees: function() {\r\n\t\treturn this.getAngle(arguments[0]);\r\n\t},\r\n\r\n\tgetQuadrant: function() {\r\n\t\treturn this.x >= 0 ? this.y >= 0 ? 1 : 4 : this.y >= 0 ? 2 : 3;\r\n\t},\r\n\r\n\tgetDirectedAngle: function(point) {\r\n\t\tpoint = Point.read(arguments);\r\n\t\treturn Math.atan2(this.cross(point), this.dot(point)) * 180 / Math.PI;\r\n\t},\r\n\r\n\trotate: function(angle, center) {\r\n\t\tif (angle === 0)\r\n\t\t\treturn this.clone();\r\n\t\tangle = angle * Math.PI / 180;\r\n\t\tvar point = center ? this.subtract(center) : this,\r\n\t\t\ts = Math.sin(angle),\r\n\t\t\tc = Math.cos(angle);\r\n\t\tpoint = Point.create(\r\n\t\t\tpoint.x * c - point.y * s,\r\n\t\t\tpoint.y * c + point.x * s\r\n\t\t);\r\n\t\treturn center ? point.add(center) : point;\r\n\t},\r\n\r\n\tisInside: function(rect) {\r\n\t\treturn rect.contains(this);\r\n\t},\r\n\r\n\tisClose: function(point, tolerance) {\r\n\t\treturn this.getDistance(point) < tolerance;\r\n\t},\r\n\r\n\tisColinear: function(point) {\r\n\t\treturn this.cross(point) < 0.00001;\r\n\t},\r\n\r\n\tisOrthogonal: function(point) {\r\n\t\treturn this.dot(point) < 0.00001;\r\n\t},\r\n\r\n\tisZero: function() {\r\n\t\treturn Numerical.isZero(this.x) && Numerical.isZero(this.y);\r\n\t},\r\n\r\n\tisNaN: function() {\r\n\t\treturn isNaN(this.x) || isNaN(this.y);\r\n\t},\r\n\r\n\tdot: function(point) {\r\n\t\tpoint = Point.read(arguments);\r\n\t\treturn this.x * point.x + this.y * point.y;\r\n\t},\r\n\r\n\tcross: function(point) {\r\n\t\tpoint = Point.read(arguments);\r\n\t\treturn this.x * point.y - this.y * point.x;\r\n\t},\r\n\r\n\tproject: function(point) {\r\n\t\tpoint = Point.read(arguments);\r\n\t\tif (point.isZero()) {\r\n\t\t\treturn Point.create(0, 0);\r\n\t\t} else {\r\n\t\t\tvar scale = this.dot(point) / point.dot(point);\r\n\t\t\treturn Point.create(\r\n\t\t\t\tpoint.x * scale,\r\n\t\t\t\tpoint.y * scale\r\n\t\t\t);\r\n\t\t}\r\n\t},\r\n\r\n\tstatics: {\r\n\t\tcreate: function(x, y) {\r\n\t\t\tvar point = Base.create(Point);\r\n\t\t\tpoint.x = x;\r\n\t\t\tpoint.y = y;\r\n\t\t\treturn point;\r\n\t\t},\r\n\r\n\t\tmin: function(point1, point2) {\r\n\t\t\tvar _point1 = Point.read(arguments);\r\n\t\t\t\t_point2 = Point.read(arguments);\r\n\t\t\treturn Point.create(\r\n\t\t\t\tMath.min(_point1.x, _point2.x),\r\n\t\t\t\tMath.min(_point1.y, _point2.y)\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\tmax: function(point1, point2) {\r\n\t\t\tvar _point1 = Point.read(arguments);\r\n\t\t\t\t_point2 = Point.read(arguments);\r\n\t\t\treturn Point.create(\r\n\t\t\t\tMath.max(_point1.x, _point2.x),\r\n\t\t\t\tMath.max(_point1.y, _point2.y)\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\trandom: function() {\r\n\t\t\treturn Point.create(Math.random(), Math.random());\r\n\t\t}\r\n\t}\r\n}, new function() {\r\n\r\n\treturn Base.each(['round', 'ceil', 'floor', 'abs'], function(name) {\r\n\t\tvar op = Math[name];\r\n\t\tthis[name] = function() {\r\n\t\t\treturn Point.create(op(this.x), op(this.y));\r\n\t\t};\r\n\t}, {});\r\n});\r\n\r\nvar LinkedPoint = Point.extend({\r\n\tset: function(x, y, dontNotify) {\r\n\t\tthis._x = x;\r\n\t\tthis._y = y;\r\n\t\tif (!dontNotify)\r\n\t\t\tthis._owner[this._setter](this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetX: function() {\r\n\t\treturn this._x;\r\n\t},\r\n\r\n\tsetX: function(x) {\r\n\t\tthis._x = x;\r\n\t\tthis._owner[this._setter](this);\r\n\t},\r\n\r\n\tgetY: function() {\r\n\t\treturn this._y;\r\n\t},\r\n\r\n\tsetY: function(y) {\r\n\t\tthis._y = y;\r\n\t\tthis._owner[this._setter](this);\r\n\t},\r\n\r\n\tstatics: {\r\n\t\tcreate: function(owner, setter, x, y, dontLink) {\r\n\t\t\tif (dontLink)\r\n\t\t\t\treturn Point.create(x, y);\r\n\t\t\tvar point = Base.create(LinkedPoint);\r\n\t\t\tpoint._x = x;\r\n\t\t\tpoint._y = y;\r\n\t\t\tpoint._owner = owner;\r\n\t\t\tpoint._setter = setter;\r\n\t\t\treturn point;\r\n\t\t}\r\n\t}\r\n});\r\n\r\nvar Size = this.Size = Base.extend({\r\n\t_class: 'Size',\r\n\t_readIndex: true,\r\n\r\n\tinitialize: function(arg0, arg1) {\r\n\t\tvar type = typeof arg0;\r\n\t\tif (type === 'number') {\r\n\t\t\tvar hasHeight = typeof arg1 === 'number';\r\n\t\t\tthis.width = arg0;\r\n\t\t\tthis.height = hasHeight ? arg1 : arg0;\r\n\t\t\tif (this._read)\r\n\t\t\t\tthis._read = hasHeight ? 2 : 1;\r\n\t\t} else if (type === 'undefined' || arg0 === null) {\r\n\t\t\tthis.width = this.height = 0;\r\n\t\t\tif (this._read)\r\n\t\t\t\tthis._read = arg0 === null ? 1 : 0;\r\n\t\t} else {\r\n\t\t\tif (Array.isArray(arg0)) {\r\n\t\t\t\tthis.width = arg0[0];\r\n\t\t\t\tthis.height = arg0.length > 1 ? arg0[1] : arg0[0];\r\n\t\t\t} else if (arg0.width != null) {\r\n\t\t\t\tthis.width = arg0.width;\r\n\t\t\t\tthis.height = arg0.height;\r\n\t\t\t} else if (arg0.x != null) {\r\n\t\t\t\tthis.width = arg0.x;\r\n\t\t\t\tthis.height = arg0.y;\r\n\t\t\t} else {\r\n\t\t\t\tthis.width = this.height = 0;\r\n\t\t\t\tif (this._read)\r\n\t\t\t\t\tthis._read = 0;\r\n\t\t\t}\r\n\t\t\tif (this._read)\r\n\t\t\t\tthis._read = 1;\r\n\t\t}\r\n\t},\r\n\r\n\tset: function(width, height) {\r\n\t\tthis.width = width;\r\n\t\tthis.height = height;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tequals: function(size) {\r\n\t\tsize = Size.read(arguments);\r\n\t\treturn this.width == size.width && this.height == size.height;\r\n\t},\r\n\r\n\tclone: function() {\r\n\t\treturn Size.create(this.width, this.height);\r\n\t},\r\n\r\n\ttoString: function() {\r\n\t\tvar f = Formatter.instance;\r\n\t\treturn '{ width: ' + f.number(this.width)\r\n\t\t\t\t+ ', height: ' + f.number(this.height) + ' }';\r\n\t},\r\n\r\n\t_serialize: function(options) {\r\n\t\tvar f = options.formatter;\r\n\t\treturn [f.number(this.width),\r\n\t\t\t\tf.number(this.height)];\r\n\t},\r\n\r\n\tadd: function(size) {\r\n\t\tsize = Size.read(arguments);\r\n\t\treturn Size.create(this.width + size.width, this.height + size.height);\r\n\t},\r\n\r\n\tsubtract: function(size) {\r\n\t\tsize = Size.read(arguments);\r\n\t\treturn Size.create(this.width - size.width, this.height - size.height);\r\n\t},\r\n\r\n\tmultiply: function(size) {\r\n\t\tsize = Size.read(arguments);\r\n\t\treturn Size.create(this.width * size.width, this.height * size.height);\r\n\t},\r\n\r\n\tdivide: function(size) {\r\n\t\tsize = Size.read(arguments);\r\n\t\treturn Size.create(this.width / size.width, this.height / size.height);\r\n\t},\r\n\r\n\tmodulo: function(size) {\r\n\t\tsize = Size.read(arguments);\r\n\t\treturn Size.create(this.width % size.width, this.height % size.height);\r\n\t},\r\n\r\n\tnegate: function() {\r\n\t\treturn Size.create(-this.width, -this.height);\r\n\t},\r\n\r\n\tisZero: function() {\r\n\t\treturn Numerical.isZero(this.width) && Numerical.isZero(this.height);\r\n\t},\r\n\r\n\tisNaN: function() {\r\n\t\treturn isNaN(this.width) || isNaN(this.height);\r\n\t},\r\n\r\n\tstatics: {\r\n\t\tcreate: function(width, height) {\r\n\t\t\treturn Base.create(Size).set(width, height);\r\n\t\t},\r\n\r\n\t\tmin: function(size1, size2) {\r\n\t\t\treturn Size.create(\r\n\t\t\t\tMath.min(size1.width, size2.width),\r\n\t\t\t\tMath.min(size1.height, size2.height));\r\n\t\t},\r\n\r\n\t\tmax: function(size1, size2) {\r\n\t\t\treturn Size.create(\r\n\t\t\t\tMath.max(size1.width, size2.width),\r\n\t\t\t\tMath.max(size1.height, size2.height));\r\n\t\t},\r\n\r\n\t\trandom: function() {\r\n\t\t\treturn Size.create(Math.random(), Math.random());\r\n\t\t}\r\n\t}\r\n}, new function() {\r\n\r\n\treturn Base.each(['round', 'ceil', 'floor', 'abs'], function(name) {\r\n\t\tvar op = Math[name];\r\n\t\tthis[name] = function() {\r\n\t\t\treturn Size.create(op(this.width), op(this.height));\r\n\t\t};\r\n\t}, {});\r\n});\r\n\r\nvar LinkedSize = Size.extend({\r\n\tset: function(width, height, dontNotify) {\r\n\t\tthis._width = width;\r\n\t\tthis._height = height;\r\n\t\tif (!dontNotify)\r\n\t\t\tthis._owner[this._setter](this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetWidth: function() {\r\n\t\treturn this._width;\r\n\t},\r\n\r\n\tsetWidth: function(width) {\r\n\t\tthis._width = width;\r\n\t\tthis._owner[this._setter](this);\r\n\t},\r\n\r\n\tgetHeight: function() {\r\n\t\treturn this._height;\r\n\t},\r\n\r\n\tsetHeight: function(height) {\r\n\t\tthis._height = height;\r\n\t\tthis._owner[this._setter](this);\r\n\t},\r\n\r\n\tstatics: {\r\n\t\tcreate: function(owner, setter, width, height, dontLink) {\r\n\t\t\tif (dontLink)\r\n\t\t\t\treturn Size.create(width, height);\r\n\t\t\tvar size = Base.create(LinkedSize);\r\n\t\t\tsize._width = width;\r\n\t\t\tsize._height = height;\r\n\t\t\tsize._owner = owner;\r\n\t\t\tsize._setter = setter;\r\n\t\t\treturn size;\r\n\t\t}\r\n\t}\r\n});\r\n\r\nvar Rectangle = this.Rectangle = Base.extend({\r\n\t_class: 'Rectangle',\r\n\t_readIndex: true,\r\n\r\n\tinitialize: function(arg0, arg1, arg2, arg3) {\r\n\t\tvar type = typeof arg0,\r\n\t\t\tread = 0;\r\n\t\tif (type === 'number') {\r\n\t\t\tthis.x = arg0;\r\n\t\t\tthis.y = arg1;\r\n\t\t\tthis.width = arg2;\r\n\t\t\tthis.height = arg3;\r\n\t\t\tread = 4;\r\n\t\t} else if (type === 'undefined' || arg0 === null) {\r\n\t\t\tthis.x = this.y = this.width = this.height = 0;\r\n\t\t\tread = arg0 === null ? 1 : 0;\r\n\t\t} else if (arguments.length === 1) {\r\n\t\t\tif (Array.isArray(arg0)) {\r\n\t\t\t\tthis.x = arg0[0];\r\n\t\t\t\tthis.y = arg0[1];\r\n\t\t\t\tthis.width = arg0[2];\r\n\t\t\t\tthis.height = arg0[3];\r\n\t\t\t\tread = 1;\r\n\t\t\t} else if (arg0.x !== undefined || arg0.width !== undefined) {\r\n\t\t\t\tthis.x = arg0.x || 0;\r\n\t\t\t\tthis.y = arg0.y || 0;\r\n\t\t\t\tthis.width = arg0.width || 0;\r\n\t\t\t\tthis.height = arg0.height || 0;\r\n\t\t\t\tread = 1;\r\n\t\t\t} else if (arg0.from === undefined && arg0.to === undefined) {\r\n\t\t\t\tthis.x = this.y = this.width = this.height = 0;\r\n\t\t\t\tthis._set(arg0);\r\n\t\t\t\tread = 1;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!read) {\r\n\t\t\tvar point = Point.readNamed(arguments, 'from'),\r\n\t\t\t\tnext = Base.peek(arguments);\r\n\t\t\tthis.x = point.x;\r\n\t\t\tthis.y = point.y;\r\n\t\t\tif (next && next.x !== undefined || Base.hasNamed(arguments, 'to')) {\r\n\t\t\t\tvar to = Point.readNamed(arguments, 'to');\r\n\t\t\t\tthis.width = to.x - point.x;\r\n\t\t\t\tthis.height = to.y - point.y;\r\n\t\t\t\tif (this.width < 0) {\r\n\t\t\t\t\tthis.x = to.x;\r\n\t\t\t\t\tthis.width = -this.width;\r\n\t\t\t\t}\r\n\t\t\t\tif (this.height < 0) {\r\n\t\t\t\t\tthis.y = to.y;\r\n\t\t\t\t\tthis.height = -this.height;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvar size = Size.read(arguments);\r\n\t\t\t\tthis.width = size.width;\r\n\t\t\t\tthis.height = size.height;\r\n\t\t\t}\r\n\t\t\tread = arguments._index;\r\n\t\t}\r\n\t\tif (this._read)\r\n\t\t\tthis._read = read;\r\n\t},\r\n\r\n\tset: function(x, y, width, height) {\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.width = width;\r\n\t\tthis.height = height;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tclone: function() {\r\n\t\treturn Rectangle.create(this.x, this.y, this.width, this.height);\r\n\t},\r\n\r\n\tequals: function(rect) {\r\n\t\trect = Rectangle.read(arguments);\r\n\t\treturn this.x == rect.x && this.y == rect.y\r\n\t\t\t\t&& this.width == rect.width && this.height == rect.height;\r\n\t},\r\n\r\n\ttoString: function() {\r\n\t\tvar f = Formatter.instance;\r\n\t\treturn '{ x: ' + f.number(this.x)\r\n\t\t\t\t+ ', y: ' + f.number(this.y)\r\n\t\t\t\t+ ', width: ' + f.number(this.width)\r\n\t\t\t\t+ ', height: ' + f.number(this.height)\r\n\t\t\t\t+ ' }';\r\n\t},\r\n\r\n\t_serialize: function(options) {\r\n\t\tvar f = options.formatter;\r\n\t\treturn [f.number(this.x),\r\n\t\t\t\tf.number(this.y),\r\n\t\t\t\tf.number(this.width),\r\n\t\t\t\tf.number(this.height)];\r\n\t},\r\n\r\n\tgetPoint: function() {\r\n\t\treturn LinkedPoint.create(this, 'setPoint', this.x, this.y, arguments[0]);\r\n\t},\r\n\r\n\tsetPoint: function(point) {\r\n\t\tpoint = Point.read(arguments);\r\n\t\tthis.x = point.x;\r\n\t\tthis.y = point.y;\r\n\t},\r\n\r\n\tgetSize: function() {\r\n\t\treturn LinkedSize.create(this, 'setSize', this.width, this.height,\r\n\t\t\t\targuments[0]);\r\n\t},\r\n\r\n\tsetSize: function(size) {\r\n\t\tsize = Size.read(arguments);\r\n\t\tthis.width = size.width;\r\n\t\tthis.height = size.height;\r\n\t},\r\n\r\n\tgetLeft: function() {\r\n\t\treturn this.x;\r\n\t},\r\n\r\n\tsetLeft: function(left) {\r\n\t\tthis.width -= left - this.x;\r\n\t\tthis.x = left;\r\n\t},\r\n\r\n\tgetTop: function() {\r\n\t\treturn this.y;\r\n\t},\r\n\r\n\tsetTop: function(top) {\r\n\t\tthis.height -= top - this.y;\r\n\t\tthis.y = top;\r\n\t},\r\n\r\n\tgetRight: function() {\r\n\t\treturn this.x + this.width;\r\n\t},\r\n\r\n\tsetRight: function(right) {\r\n\t\tthis.width = right - this.x;\r\n\t},\r\n\r\n\tgetBottom: function() {\r\n\t\treturn this.y + this.height;\r\n\t},\r\n\r\n\tsetBottom: function(bottom) {\r\n\t\tthis.height = bottom - this.y;\r\n\t},\r\n\r\n\tgetCenterX: function() {\r\n\t\treturn this.x + this.width * 0.5;\r\n\t},\r\n\r\n\tsetCenterX: function(x) {\r\n\t\tthis.x = x - this.width * 0.5;\r\n\t},\r\n\r\n\tgetCenterY: function() {\r\n\t\treturn this.y + this.height * 0.5;\r\n\t},\r\n\r\n\tsetCenterY: function(y) {\r\n\t\tthis.y = y - this.height * 0.5;\r\n\t},\r\n\r\n\tgetCenter: function() {\r\n\t\treturn LinkedPoint.create(this, 'setCenter',\r\n\t\t\t\tthis.getCenterX(), this.getCenterY(), arguments[0]);\r\n\t},\r\n\r\n\tsetCenter: function(point) {\r\n\t\tpoint = Point.read(arguments);\r\n\t\tthis.setCenterX(point.x);\r\n\t\tthis.setCenterY(point.y);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tisEmpty: function() {\r\n\t\treturn this.width == 0 || this.height == 0;\r\n\t},\r\n\r\n\tcontains: function(arg) {\r\n\t\treturn arg && arg.width !== undefined\r\n\t\t\t\t|| (Array.isArray(arg) ? arg : arguments).length == 4\r\n\t\t\t\t? this._containsRectangle(Rectangle.read(arguments))\r\n\t\t\t\t: this._containsPoint(Point.read(arguments));\r\n\t},\r\n\r\n\t_containsPoint: function(point) {\r\n\t\tvar x = point.x,\r\n\t\t\ty = point.y;\r\n\t\treturn x >= this.x && y >= this.y\r\n\t\t\t\t&& x <= this.x + this.width\r\n\t\t\t\t&& y <= this.y + this.height;\r\n\t},\r\n\r\n\t_containsRectangle: function(rect) {\r\n\t\tvar x = rect.x,\r\n\t\t\ty = rect.y;\r\n\t\treturn x >= this.x && y >= this.y\r\n\t\t\t\t&& x + rect.width <= this.x + this.width\r\n\t\t\t\t&& y + rect.height <= this.y + this.height;\r\n\t},\r\n\r\n\tintersects: function(rect) {\r\n\t\trect = Rectangle.read(arguments);\r\n\t\treturn rect.x + rect.width > this.x\r\n\t\t\t\t&& rect.y + rect.height > this.y\r\n\t\t\t\t&& rect.x < this.x + this.width\r\n\t\t\t\t&& rect.y < this.y + this.height;\r\n\t},\r\n\r\n\ttouches: function(rect) {\r\n\t\trect = Rectangle.read(arguments);\r\n\t\treturn rect.x + rect.width >= this.x\r\n\t\t\t\t&& rect.y + rect.height >= this.y\r\n\t\t\t\t&& rect.x <= this.x + this.width\r\n\t\t\t\t&& rect.y <= this.y + this.height;\r\n\t},\r\n\r\n\tintersect: function(rect) {\r\n\t\trect = Rectangle.read(arguments);\r\n\t\tvar x1 = Math.max(this.x, rect.x),\r\n\t\t\ty1 = Math.max(this.y, rect.y),\r\n\t\t\tx2 = Math.min(this.x + this.width, rect.x + rect.width),\r\n\t\t\ty2 = Math.min(this.y + this.height, rect.y + rect.height);\r\n\t\treturn Rectangle.create(x1, y1, x2 - x1, y2 - y1);\r\n\t},\r\n\r\n\tunite: function(rect) {\r\n\t\trect = Rectangle.read(arguments);\r\n\t\tvar x1 = Math.min(this.x, rect.x),\r\n\t\t\ty1 = Math.min(this.y, rect.y),\r\n\t\t\tx2 = Math.max(this.x + this.width, rect.x + rect.width),\r\n\t\t\ty2 = Math.max(this.y + this.height, rect.y + rect.height);\r\n\t\treturn Rectangle.create(x1, y1, x2 - x1, y2 - y1);\r\n\t},\r\n\r\n\tinclude: function(point) {\r\n\t\tpoint = Point.read(arguments);\r\n\t\tvar x1 = Math.min(this.x, point.x),\r\n\t\t\ty1 = Math.min(this.y, point.y),\r\n\t\t\tx2 = Math.max(this.x + this.width, point.x),\r\n\t\t\ty2 = Math.max(this.y + this.height, point.y);\r\n\t\treturn Rectangle.create(x1, y1, x2 - x1, y2 - y1);\r\n\t},\r\n\r\n\texpand: function(hor, ver) {\r\n\t\tif (ver === undefined)\r\n\t\t\tver = hor;\r\n\t\treturn Rectangle.create(this.x - hor / 2, this.y - ver / 2,\r\n\t\t\t\tthis.width + hor, this.height + ver);\r\n\t},\r\n\r\n\tscale: function(hor, ver) {\r\n\t\treturn this.expand(this.width * hor - this.width,\r\n\t\t\t\tthis.height * (ver === undefined ? hor : ver) - this.height);\r\n\t},\r\n\r\n\tstatics: {\r\n\t\tcreate: function(x, y, width, height) {\r\n\t\t\treturn Base.create(Rectangle).set(x, y, width, height);\r\n\t\t}\r\n\t}\r\n}, new function() {\r\n\treturn Base.each([\r\n\t\t\t['Top', 'Left'], ['Top', 'Right'],\r\n\t\t\t['Bottom', 'Left'], ['Bottom', 'Right'],\r\n\t\t\t['Left', 'Center'], ['Top', 'Center'],\r\n\t\t\t['Right', 'Center'], ['Bottom', 'Center']\r\n\t\t],\r\n\t\tfunction(parts, index) {\r\n\t\t\tvar part = parts.join('');\r\n\t\t\tvar xFirst = /^[RL]/.test(part);\r\n\t\t\tif (index >= 4)\r\n\t\t\t\tparts[1] += xFirst ? 'Y' : 'X';\r\n\t\t\tvar x = parts[xFirst ? 0 : 1],\r\n\t\t\t\ty = parts[xFirst ? 1 : 0],\r\n\t\t\t\tgetX = 'get' + x,\r\n\t\t\t\tgetY = 'get' + y,\r\n\t\t\t\tsetX = 'set' + x,\r\n\t\t\t\tsetY = 'set' + y,\r\n\t\t\t\tget = 'get' + part,\r\n\t\t\t\tset = 'set' + part;\r\n\t\t\tthis[get] = function() {\r\n\t\t\t\treturn LinkedPoint.create(this, set,\r\n\t\t\t\t\t\tthis[getX](), this[getY](), arguments[0]);\r\n\t\t\t};\r\n\t\t\tthis[set] = function(point) {\r\n\t\t\t\tpoint = Point.read(arguments);\r\n\t\t\t\tthis[setX](point.x);\r\n\t\t\t\tthis[setY](point.y);\r\n\t\t\t};\r\n\t\t}, {});\r\n});\r\n\r\nvar LinkedRectangle = Rectangle.extend({\r\n\tset: function(x, y, width, height, dontNotify) {\r\n\t\tthis._x = x;\r\n\t\tthis._y = y;\r\n\t\tthis._width = width;\r\n\t\tthis._height = height;\r\n\t\tif (!dontNotify)\r\n\t\t\tthis._owner[this._setter](this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tstatics: {\r\n\t\tcreate: function(owner, setter, x, y, width, height) {\r\n\t\t\tvar rect = Base.create(LinkedRectangle).set(x, y, width, height, true);\r\n\t\t\trect._owner = owner;\r\n\t\t\trect._setter = setter;\r\n\t\t\treturn rect;\r\n\t\t}\r\n\t}\r\n}, new function() {\r\n\tvar proto = Rectangle.prototype;\r\n\r\n\treturn Base.each(['x', 'y', 'width', 'height'], function(key) {\r\n\t\tvar part = Base.capitalize(key);\r\n\t\tvar internal = '_' + key;\r\n\t\tthis['get' + part] = function() {\r\n\t\t\treturn this[internal];\r\n\t\t};\r\n\r\n\t\tthis['set' + part] = function(value) {\r\n\t\t\tthis[internal] = value;\r\n\t\t\tif (!this._dontNotify)\r\n\t\t\t\tthis._owner[this._setter](this);\r\n\t\t};\r\n\t}, Base.each(['Point', 'Size', 'Center',\r\n\t\t\t'Left', 'Top', 'Right', 'Bottom', 'CenterX', 'CenterY',\r\n\t\t\t'TopLeft', 'TopRight', 'BottomLeft', 'BottomRight',\r\n\t\t\t'LeftCenter', 'TopCenter', 'RightCenter', 'BottomCenter'],\r\n\t\tfunction(key) {\r\n\t\t\tvar name = 'set' + key;\r\n\t\t\tthis[name] = function(value) {\r\n\t\t\t\tthis._dontNotify = true;\r\n\t\t\t\tproto[name].apply(this, arguments);\r\n\t\t\t\tdelete this._dontNotify;\r\n\t\t\t\tthis._owner[this._setter](this);\r\n\t\t\t};\r\n\t\t}, {\r\n\t\t\tisSelected: function() {\r\n\t\t\t\treturn this._owner._boundsSelected;\r\n\t\t\t},\r\n\r\n\t\t\tsetSelected: function(selected) {\r\n\t\t\t\tvar owner = this._owner;\r\n\t\t\t\tif (owner.setSelected) {\r\n\t\t\t\t\towner._boundsSelected = selected;\r\n\t\t\t\t\towner.setSelected(selected || owner._selectedSegmentState > 0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t);\r\n});\r\n\r\nvar Matrix = this.Matrix = Base.extend({\r\n\t_class: 'Matrix',\r\n\r\n\tinitialize: function(arg) {\r\n\t\tvar count = arguments.length,\r\n\t\t\tok = true;\r\n\t\tif (count == 6) {\r\n\t\t\tthis.set.apply(this, arguments);\r\n\t\t} else if (count == 1) {\r\n\t\t\tif (arg instanceof Matrix) {\r\n\t\t\t\tthis.set(arg._a, arg._c, arg._b, arg._d, arg._tx, arg._ty);\r\n\t\t\t} else if (Array.isArray(arg)) {\r\n\t\t\t\tthis.set.apply(this, arg);\r\n\t\t\t} else {\r\n\t\t\t\tok = false;\r\n\t\t\t}\r\n\t\t} else if (count == 0) {\r\n\t\t\tthis.reset();\r\n\t\t} else {\r\n\t\t\tok = false;\r\n\t\t}\r\n\t\tif (!ok)\r\n\t\t\tthrow new Error('Unsupported matrix parameters');\r\n\t},\r\n\r\n\tset: function(a, c, b, d, tx, ty) {\r\n\t\tthis._a = a;\r\n\t\tthis._c = c;\r\n\t\tthis._b = b;\r\n\t\tthis._d = d;\r\n\t\tthis._tx = tx;\r\n\t\tthis._ty = ty;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_serialize: function(options) {\r\n\t\treturn Base.serialize(this.getValues(), options);\r\n\t},\r\n\r\n\tclone: function() {\r\n\t\treturn Matrix.create(this._a, this._c, this._b, this._d,\r\n\t\t\t\tthis._tx, this._ty);\r\n\t},\r\n\r\n\tequals: function(mx) {\r\n\t\treturn mx && this._a == mx._a && this._b == mx._b && this._c == mx._c\r\n\t\t\t\t&& this._d == mx._d && this._tx == mx._tx && this._ty == mx._ty;\r\n\t},\r\n\r\n\ttoString: function() {\r\n\t\tvar f = Formatter.instance;\r\n\t\treturn '[[' + [f.number(this._a), f.number(this._b),\r\n\t\t\t\t\tf.number(this._tx)].join(', ') + '], ['\r\n\t\t\t\t+ [f.number(this._c), f.number(this._d),\r\n\t\t\t\t\tf.number(this._ty)].join(', ') + ']]';\r\n\t},\r\n\r\n\treset: function() {\r\n\t\tthis._a = this._d = 1;\r\n\t\tthis._c = this._b = this._tx = this._ty = 0;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tscale: function(scale, center) {\r\n\t\tvar _scale = Point.read(arguments),\r\n\t\t\t_center = Point.read(arguments, 0, 0, false, true);\r\n\t\tif (_center)\r\n\t\t\tthis.translate(_center);\r\n\t\tthis._a *= _scale.x;\r\n\t\tthis._c *= _scale.x;\r\n\t\tthis._b *= _scale.y;\r\n\t\tthis._d *= _scale.y;\r\n\t\tif (_center)\r\n\t\t\tthis.translate(_center.negate());\r\n\t\treturn this;\r\n\t},\r\n\r\n\ttranslate: function(point) {\r\n\t\tpoint = Point.read(arguments);\r\n\t\tvar x = point.x,\r\n\t\t\ty = point.y;\r\n\t\tthis._tx += x * this._a + y * this._b;\r\n\t\tthis._ty += x * this._c + y * this._d;\r\n\t\treturn this;\r\n\t},\r\n\r\n\trotate: function(angle, center) {\r\n\t\tcenter = Point.read(arguments, 1);\r\n\t\tangle = angle * Math.PI / 180;\r\n\t\tvar x = center.x,\r\n\t\t\ty = center.y,\r\n\t\t\tcos = Math.cos(angle),\r\n\t\t\tsin = Math.sin(angle),\r\n\t\t\ttx = x - x * cos + y * sin,\r\n\t\t\tty = y - x * sin - y * cos,\r\n\t\t\ta = this._a,\r\n\t\t\tb = this._b,\r\n\t\t\tc = this._c,\r\n\t\t\td = this._d;\r\n\t\tthis._a = cos * a + sin * b;\r\n\t\tthis._b = -sin * a + cos * b;\r\n\t\tthis._c = cos * c + sin * d;\r\n\t\tthis._d = -sin * c + cos * d;\r\n\t\tthis._tx += tx * a + ty * b;\r\n\t\tthis._ty += tx * c + ty * d;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tshear: function(point, center) {\r\n\t\tvar _point = Point.read(arguments),\r\n\t\t\t_center = Point.read(arguments);\r\n\t\tif (_center)\r\n\t\t\tthis.translate(_center);\r\n\t\tvar a = this._a,\r\n\t\t\tc = this._c;\r\n\t\tthis._a += _point.y * this._b;\r\n\t\tthis._c += _point.y * this._d;\r\n\t\tthis._b += _point.x * a;\r\n\t\tthis._d += _point.x * c;\r\n\t\tif (_center)\r\n\t\t\tthis.translate(_center.negate());\r\n\t\treturn this;\r\n\t},\r\n\r\n\tisIdentity: function() {\r\n\t\treturn this._a == 1 && this._c == 0 && this._b == 0 && this._d == 1\r\n\t\t\t\t&& this._tx == 0 && this._ty == 0;\r\n\t},\r\n\r\n\tisInvertible: function() {\r\n\t\treturn !!this._getDeterminant();\r\n\t},\r\n\r\n\tisSingular: function() {\r\n\t\treturn !this._getDeterminant();\r\n\t},\r\n\r\n\tconcatenate: function(mx) {\r\n\t\tvar a = this._a,\r\n\t\t\tb = this._b,\r\n\t\t\tc = this._c,\r\n\t\t\td = this._d;\r\n\t\tthis._a = mx._a * a + mx._c * b;\r\n\t\tthis._b = mx._b * a + mx._d * b;\r\n\t\tthis._c = mx._a * c + mx._c * d;\r\n\t\tthis._d = mx._b * c + mx._d * d;\r\n\t\tthis._tx += mx._tx * a + mx._ty * b;\r\n\t\tthis._ty += mx._tx * c + mx._ty * d;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tpreConcatenate: function(mx) {\r\n\t\tvar a = this._a,\r\n\t\t\tb = this._b,\r\n\t\t\tc = this._c,\r\n\t\t\td = this._d,\r\n\t\t\ttx = this._tx,\r\n\t\t\tty = this._ty;\r\n\t\tthis._a = mx._a * a + mx._b * c;\r\n\t\tthis._b = mx._a * b + mx._b * d;\r\n\t\tthis._c = mx._c * a + mx._d * c;\r\n\t\tthis._d = mx._c * b + mx._d * d;\r\n\t\tthis._tx = mx._a * tx + mx._b * ty + mx._tx;\r\n\t\tthis._ty = mx._c * tx + mx._d * ty + mx._ty;\r\n\t\treturn this;\r\n\t},\r\n\r\n\ttransform: function( src, srcOff, dst, dstOff, numPts) {\r\n\t\treturn arguments.length < 5\r\n\t\t\t? this._transformPoint(Point.read(arguments))\r\n\t\t\t: this._transformCoordinates(src, srcOff, dst, dstOff, numPts);\r\n\t},\r\n\r\n\t_transformPoint: function(point, dest, dontNotify) {\r\n\t\tvar x = point.x,\r\n\t\t\ty = point.y;\r\n\t\tif (!dest)\r\n\t\t\tdest = Base.create(Point);\r\n\t\treturn dest.set(\r\n\t\t\tx * this._a + y * this._b + this._tx,\r\n\t\t\tx * this._c + y * this._d + this._ty,\r\n\t\t\tdontNotify\r\n\t\t);\r\n\t},\r\n\r\n\t_transformCoordinates: function(src, srcOff, dst, dstOff, numPts) {\r\n\t\tvar i = srcOff, j = dstOff,\r\n\t\t\tsrcEnd = srcOff + 2 * numPts;\r\n\t\twhile (i < srcEnd) {\r\n\t\t\tvar x = src[i++],\r\n\t\t\t\ty = src[i++];\r\n\t\t\tdst[j++] = x * this._a + y * this._b + this._tx;\r\n\t\t\tdst[j++] = x * this._c + y * this._d + this._ty;\r\n\t\t}\r\n\t\treturn dst;\r\n\t},\r\n\r\n\t_transformCorners: function(rect) {\r\n\t\tvar x1 = rect.x,\r\n\t\t\ty1 = rect.y,\r\n\t\t\tx2 = x1 + rect.width,\r\n\t\t\ty2 = y1 + rect.height,\r\n\t\t\tcoords = [ x1, y1, x2, y1, x2, y2, x1, y2 ];\r\n\t\treturn this._transformCoordinates(coords, 0, coords, 0, 4);\r\n\t},\r\n\r\n\t_transformBounds: function(bounds, dest, dontNotify) {\r\n\t\tvar coords = this._transformCorners(bounds),\r\n\t\t\tmin = coords.slice(0, 2),\r\n\t\t\tmax = coords.slice();\r\n\t\tfor (var i = 2; i < 8; i++) {\r\n\t\t\tvar val = coords[i],\r\n\t\t\t\tj = i & 1;\r\n\t\t\tif (val < min[j])\r\n\t\t\t\tmin[j] = val;\r\n\t\t\telse if (val > max[j])\r\n\t\t\t\tmax[j] = val;\r\n\t\t}\r\n\t\tif (!dest)\r\n\t\t\tdest = Base.create(Rectangle);\r\n\t\treturn dest.set(min[0], min[1], max[0] - min[0], max[1] - min[1],\r\n\t\t\t\tdontNotify);\r\n\t},\r\n\r\n\tinverseTransform: function(point) {\r\n\t\treturn this._inverseTransform(Point.read(arguments));\r\n\t},\r\n\r\n\t_getDeterminant: function() {\r\n\t\tvar det = this._a * this._d - this._b * this._c;\r\n\t\treturn isFinite(det) && !Numerical.isZero(det)\r\n\t\t\t\t&& isFinite(this._tx) && isFinite(this._ty)\r\n\t\t\t\t? det : null;\r\n\t},\r\n\r\n\t_inverseTransform: function(point, dest, dontNotify) {\r\n\t\tvar det = this._getDeterminant();\r\n\t\tif (!det)\r\n\t\t\treturn null;\r\n\t\tvar x = point.x - this._tx,\r\n\t\t\ty = point.y - this._ty;\r\n\t\tif (!dest)\r\n\t\t\tdest = Base.create(Point);\r\n\t\treturn dest.set(\r\n\t\t\t(x * this._d - y * this._b) / det,\r\n\t\t\t(y * this._a - x * this._c) / det,\r\n\t\t\tdontNotify\r\n\t\t);\r\n\t},\r\n\r\n\tdecompose: function() {\r\n\t\tvar a = this._a, b = this._b, c = this._c, d = this._d;\r\n\t\tif (Numerical.isZero(a * d - b * c))\r\n\t\t\treturn null;\r\n\r\n\t\tvar scaleX = Math.sqrt(a * a + b * b);\r\n\t\ta /= scaleX;\r\n\t\tb /= scaleX;\r\n\r\n\t\tvar shear = a * c + b * d;\r\n\t\tc -= a * shear;\r\n\t\td -= b * shear;\r\n\r\n\t\tvar scaleY = Math.sqrt(c * c + d * d);\r\n\t\tc /= scaleY;\r\n\t\td /= scaleY;\r\n\t\tshear /= scaleY;\r\n\r\n\t\tif (a * d < b * c) {\r\n\t\t\ta = -a;\r\n\t\t\tb = -b;\r\n\t\t\tshear = -shear;\r\n\t\t\tscaleX = -scaleX;\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\ttranslation: this.getTranslation(),\r\n\t\t\tscaling: Point.create(scaleX, scaleY),\r\n\t\t\trotation: -Math.atan2(b, a) * 180 / Math.PI,\r\n\t\t\tshearing: shear\r\n\t\t};\r\n\t},\r\n\r\n\tgetValues: function() {\r\n\t\treturn [ this._a, this._c, this._b, this._d, this._tx, this._ty ];\r\n\t},\r\n\r\n\tgetTranslation: function() {\r\n\t\treturn Point.create(this._tx, this._ty);\r\n\t},\r\n\r\n\tgetScaling: function() {\r\n\t\treturn (this.decompose() || {}).scaling;\r\n\t},\r\n\r\n\tgetRotation: function() {\r\n\t\treturn (this.decompose() || {}).rotation;\r\n\t},\r\n\r\n\tinverted: function() {\r\n\t\tvar det = this._getDeterminant();\r\n\t\treturn det && Matrix.create(\r\n\t\t\t\tthis._d / det,\r\n\t\t\t\t-this._c / det,\r\n\t\t\t\t-this._b / det,\r\n\t\t\t\tthis._a / det,\r\n\t\t\t\t(this._b * this._ty - this._d * this._tx) / det,\r\n\t\t\t\t(this._c * this._tx - this._a * this._ty) / det);\r\n\t},\r\n\r\n\tshiftless: function() {\r\n\t\treturn Matrix.create(this._a, this._c, this._b, this._d, 0, 0);\r\n\t},\r\n\r\n\tapplyToContext: function(ctx) {\r\n\t\tctx.transform(this._a, this._c, this._b, this._d, this._tx, this._ty);\r\n\t},\r\n\r\n\tstatics: {\r\n\t\tcreate: function(a, c, b, d, tx, ty) {\r\n\t\t\treturn Base.create(Matrix).set(a, c, b, d, tx, ty);\r\n\t\t}\r\n\t}\r\n}, new function() {\r\n\treturn Base.each({\r\n\t\tscaleX: '_a',\r\n\t\tscaleY: '_d',\r\n\t\ttranslateX: '_tx',\r\n\t\ttranslateY: '_ty',\r\n\t\tshearX: '_b',\r\n\t\tshearY: '_c'\r\n\t}, function(prop, name) {\r\n\t\tname = Base.capitalize(name);\r\n\t\tthis['get' + name] = function() {\r\n\t\t\treturn this[prop];\r\n\t\t};\r\n\t\tthis['set' + name] = function(value) {\r\n\t\t\tthis[prop] = value;\r\n\t\t};\r\n\t}, {});\r\n});\r\n\r\nvar Line = this.Line = Base.extend({\r\n\tinitialize: function(point1, point2, infinite) {\r\n\t\tvar _point1 = Point.read(arguments),\r\n\t\t\t_point2 = Point.read(arguments),\r\n\t\t\t_infinite = Base.read(arguments);\r\n\t\tif (_infinite !== undefined) {\r\n\t\t\tthis.point = _point1;\r\n\t\t\tthis.vector = _point2.subtract(_point1);\r\n\t\t\tthis.infinite = _infinite;\r\n\t\t} else {\r\n\t\t\tthis.point = _point1;\r\n\t\t\tthis.vector = _point2;\r\n\t\t\tthis.infinite = true;\r\n\t\t}\r\n\t},\r\n\r\n\tintersect: function(line, excludeStart, excludeEnd) {\r\n\t\tvar cross = this.vector.cross(line.vector);\r\n\t\tif (Numerical.isZero(cross))\r\n\t\t\treturn null;\r\n\t\tvar v = line.point.subtract(this.point),\r\n\t\t\tt1 = v.cross(line.vector) / cross,\r\n\t\t\tt2 = v.cross(this.vector) / cross;\r\n\t\treturn (this.infinite || (excludeStart ? 0 < t1 : 0 <= t1)\r\n\t\t\t\t&& (excludeEnd ? t1 < 1 : t1 <= 1))\r\n\t\t\t&& (line.infinite || (excludeStart ? 0 < t2 : 0 <= t2)\r\n\t\t\t\t&& (excludeEnd ? t2 < 1 : t2 <= 1))\r\n\t\t\t? this.point.add(this.vector.multiply(t1)) : null;\r\n\t},\r\n\r\n\tgetSide: function(point) {\r\n\t\tvar v1 = this.vector,\r\n\t\t\tv2 = point.subtract(this.point),\r\n\t\t\tccw = v2.cross(v1);\r\n\t\tif (ccw === 0) {\r\n\t\t\tccw = v2.dot(v1);\r\n\t\t\tif (ccw > 0) {\r\n\t\t\t\tccw = v2.subtract(v1).dot(v1);\r\n\t\t\t\tif (ccw < 0)\r\n\t\t\t\t    ccw = 0;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn ccw < 0 ? -1 : ccw > 0 ? 1 : 0;\r\n\t},\r\n\r\n\tgetDistance: function(point) {\r\n\t\tvar m = this.vector.y / this.vector.x,\r\n\t\t\tb = this.point.y - (m * this.point.x);\r\n\t\tvar dist = Math.abs(point.y - (m * point.x) - b) / Math.sqrt(m * m + 1);\r\n\t\treturn this.infinite ? dist : Math.min(dist,\r\n\t\t\t\tpoint.getDistance(this.point),\r\n\t\t\t\tpoint.getDistance(this.point.add(this.vector)));\r\n\t}\r\n});\r\n\r\nvar Project = this.Project = PaperScopeItem.extend({\r\n\t_list: 'projects',\r\n\t_reference: 'project',\r\n\r\n\tinitialize: function(view) {\r\n\t\tthis.base(true);\r\n\t\tthis.layers = [];\r\n\t\tthis.symbols = [];\r\n\t\tthis.activeLayer = new Layer();\r\n\t\tif (view)\r\n\t\t\tthis.view = view instanceof View ? view : View.create(view);\r\n\t\tthis._currentStyle = new Style();\r\n\t\tthis._selectedItems = {};\r\n\t\tthis._selectedItemCount = 0;\r\n\t\tthis._drawCount = 0;\r\n\t\tthis.options = {};\r\n\t},\r\n\r\n\t_serialize: function(options, dictionary) {\r\n\t\treturn Base.serialize(this.layers, options, false, dictionary);\r\n\t},\r\n\r\n\t_needsRedraw: function() {\r\n\t\tif (this.view)\r\n\t\t\tthis.view._redrawNeeded = true;\r\n\t},\r\n\r\n\tremove: function() {\r\n\t\tif (!this.base())\r\n\t\t\treturn false;\r\n\t\tif (this.view)\r\n\t\t\tthis.view.remove();\r\n\t\treturn true;\r\n\t},\r\n\r\n\tgetCurrentStyle: function() {\r\n\t\treturn this._currentStyle;\r\n\t},\r\n\r\n\tsetCurrentStyle: function(style) {\r\n\t\tthis._currentStyle.initialize(style);\r\n\t},\r\n\r\n\tgetIndex: function() {\r\n\t\treturn this._index;\r\n\t},\r\n\r\n\tgetSelectedItems: function() {\r\n\t\tvar items = [];\r\n\t\tfor (var id in this._selectedItems) {\r\n\t\t\tvar item = this._selectedItems[id];\r\n\t\t\tif (item._drawCount === this._drawCount)\r\n\t\t\t\titems.push(item);\r\n\t\t}\r\n\t\treturn items;\r\n\t},\r\n\r\n\t_updateSelection: function(item) {\r\n\t\tif (item._selected) {\r\n\t\t\tthis._selectedItemCount++;\r\n\t\t\tthis._selectedItems[item._id] = item;\r\n\t\t\tif (item.isInserted())\r\n\t\t\t\titem._drawCount = this._drawCount;\r\n\t\t} else {\r\n\t\t\tthis._selectedItemCount--;\r\n\t\t\tdelete this._selectedItems[item._id];\r\n\t\t}\r\n\t},\r\n\r\n\tselectAll: function() {\r\n\t\tfor (var i = 0, l = this.layers.length; i < l; i++)\r\n\t\t\tthis.layers[i].setSelected(true);\r\n\t},\r\n\r\n\tdeselectAll: function() {\r\n\t\tfor (var i in this._selectedItems)\r\n\t\t\tthis._selectedItems[i].setSelected(false);\r\n\t},\r\n\r\n\thitTest: function(point, options) {\r\n\t\tpoint = Point.read(arguments);\r\n\t\toptions = HitResult.getOptions(Base.read(arguments));\r\n\t\tfor (var i = this.layers.length - 1; i >= 0; i--) {\r\n\t\t\tvar res = this.layers[i].hitTest(point, options);\r\n\t\t\tif (res) return res;\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\r\n\timportJson: function(json) {\r\n\t\treturn Base.importJson(json);\r\n\t},\r\n\r\n\tdraw: function(ctx, matrix) {\r\n\t\tthis._drawCount++;\r\n\t\tctx.save();\r\n\t\tmatrix.applyToContext(ctx);\r\n\t\tvar param = {\r\n\t\t\toffset: new Point(0, 0),\r\n\t\t\ttransforms: [matrix]\r\n\t\t};\r\n\t\tfor (var i = 0, l = this.layers.length; i < l; i++)\r\n\t\t\tItem.draw(this.layers[i], ctx, param);\r\n\t\tctx.restore();\r\n\r\n\t\tif (this._selectedItemCount > 0) {\r\n\t\t\tctx.save();\r\n\t\t\tctx.strokeWidth = 1;\r\n\t\t\tctx.strokeStyle = ctx.fillStyle = '#009dec';\r\n\t\t\tfor (var id in this._selectedItems) {\r\n\t\t\t\tvar item = this._selectedItems[id];\r\n\t\t\t\tif (item._drawCount === this._drawCount\r\n\t\t\t\t\t\t&& (item.drawSelected || item._boundsSelected)) {\r\n\t\t\t\t\tvar mx = item._globalMatrix;\r\n\t\t\t\t\tif (item.drawSelected)\r\n\t\t\t\t\t\titem.drawSelected(ctx, mx);\r\n\t\t\t\t\tif (item._boundsSelected)\r\n\t\t\t\t\t\tItem.drawSelectedBounds(item._getBounds('getBounds'),\r\n\t\t\t\t\t\t\t\tctx, mx);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tctx.restore();\r\n\t\t}\r\n\t}\r\n});\r\n\r\nvar Symbol = this.Symbol = Base.extend({\r\n\t_class: 'Symbol',\r\n\r\n\tinitialize: function(item, dontCenter) {\r\n\t\tthis._id = ++Base._uid;\r\n\t\tthis.project = paper.project;\r\n\t\tthis.project.symbols.push(this);\r\n\t\tif (item)\r\n\t\t\tthis.setDefinition(item, dontCenter);\r\n\t\tthis._instances = {};\r\n\t},\r\n\r\n\t_serialize: function(options, dictionary) {\r\n\t\treturn dictionary.add(this, function() {\r\n\t\t\treturn Base.serialize([this._class, this._definition],\r\n\t\t\t\t\toptions, false, dictionary);\r\n\t\t});\r\n\t},\r\n\r\n\t_changed: function(flags) {\r\n\t\tBase.each(this._instances, function(item) {\r\n\t\t\titem._changed(flags);\r\n\t\t});\r\n\t},\r\n\r\n\tgetDefinition: function() {\r\n\t\treturn this._definition;\r\n\t},\r\n\r\n\tsetDefinition: function(item ) {\r\n\t\tif (item._parentSymbol)\r\n\t\t\titem = item.clone();\r\n\t\tif (this._definition)\r\n\t\t\tdelete this._definition._parentSymbol;\r\n\t\tthis._definition = item;\r\n\t\titem.remove();\r\n\t\titem.setSelected(false);\r\n\t\tif (!arguments[1])\r\n\t\t\titem.setPosition(new Point());\r\n\t\titem._parentSymbol = this;\r\n\t\tthis._changed(5);\r\n\t},\r\n\r\n\tplace: function(position) {\r\n\t\treturn new PlacedSymbol(this, position);\r\n\t},\r\n\r\n\tclone: function() {\r\n\t\treturn new Symbol(this._definition.clone());\r\n\t}\r\n});\r\n\r\nvar Item = this.Item = Base.extend(Callback, {\r\n\tstatics: {\r\n\t\textend: function(src) {\r\n\t\t\tif (src._serializeFields)\r\n\t\t\t\tsrc._serializeFields = Base.merge(\r\n\t\t\t\t\t\tthis.prototype._serializeFields, src._serializeFields);\r\n\t\t\tif (src._class)\r\n\t\t\t\tsrc._type = Base.hyphenate(src._class);\r\n\t\t\treturn this.base.apply(this, arguments);\r\n\t\t}\r\n\t}\r\n}, {\r\n\t_boundsSelected: false,\r\n\t_serializeFields: {\r\n\t\tname: null,\r\n\t\tmatrix: new Matrix(),\r\n\t\tlocked: false,\r\n\t\tvisible: true,\r\n\t\tblendMode: 'normal',\r\n\t\topacity: 1,\r\n\t\tguide: false,\r\n\t\tclipMask: false,\r\n\t\tdata: {}\r\n\t},\r\n\r\n\tinitialize: function(point) {\r\n\t\tthis._id = ++Base._uid;\r\n\t\tif (!this._project)\r\n\t\t\tpaper.project.activeLayer.addChild(this);\r\n\t\tthis._style = Style.create(this);\r\n\t\tthis.setStyle(this._project.getCurrentStyle());\r\n\t\tthis._matrix = new Matrix();\r\n\t\tif (point)\r\n\t\t\tthis._matrix.translate(point);\r\n\t},\r\n\r\n\t_events: new function() {\r\n\r\n\t\tvar mouseFlags = {\r\n\t\t\tmousedown: {\r\n\t\t\t\tmousedown: 1,\r\n\t\t\t\tmousedrag: 1,\r\n\t\t\t\tclick: 1,\r\n\t\t\t\tdoubleclick: 1\r\n\t\t\t},\r\n\t\t\tmouseup: {\r\n\t\t\t\tmouseup: 1,\r\n\t\t\t\tmousedrag: 1,\r\n\t\t\t\tclick: 1,\r\n\t\t\t\tdoubleclick: 1\r\n\t\t\t},\r\n\t\t\tmousemove: {\r\n\t\t\t\tmousedrag: 1,\r\n\t\t\t\tmousemove: 1,\r\n\t\t\t\tmouseenter: 1,\r\n\t\t\t\tmouseleave: 1\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvar mouseEvent = {\r\n\t\t\tinstall: function(type) {\r\n\t\t\t\tvar counters = this._project.view._eventCounters;\r\n\t\t\t\tif (counters) {\r\n\t\t\t\t\tfor (var key in mouseFlags) {\r\n\t\t\t\t\t\tcounters[key] = (counters[key] || 0)\r\n\t\t\t\t\t\t\t\t+ (mouseFlags[key][type] || 0);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tuninstall: function(type) {\r\n\t\t\t\tvar counters = this._project.view._eventCounters;\r\n\t\t\t\tif (counters) {\r\n\t\t\t\t\tfor (var key in mouseFlags)\r\n\t\t\t\t\t\tcounters[key] -= mouseFlags[key][type] || 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\treturn Base.each(['onMouseDown', 'onMouseUp', 'onMouseDrag', 'onClick',\r\n\t\t\t'onDoubleClick', 'onMouseMove', 'onMouseEnter', 'onMouseLeave'],\r\n\t\t\tfunction(name) {\r\n\t\t\t\tthis[name] = mouseEvent;\r\n\t\t\t}, {\r\n\t\t\t\tonFrame: {\r\n\t\t\t\t\tinstall: function() {\r\n\t\t\t\t\t\tthis._project.view._animateItem(this, true);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tuninstall: function() {\r\n\t\t\t\t\t\tthis._project.view._animateItem(this, false);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\t\t\t\tonLoad: {}\r\n\t\t\t}\r\n\t\t);\r\n\t},\r\n\r\n\t_serialize: function(options, dictionary) {\r\n\t\tvar props = {},\r\n\t\t\tthat = this;\r\n\r\n\t\tfunction serialize(fields) {\r\n\t\t\tfor (var key in fields) {\r\n\t\t\t\tvar value = that[key];\r\n\t\t\t\tif (!Base.equals(value, fields[key]))\r\n\t\t\t\t\tprops[key] = Base.serialize(value, options,\r\n\t\t\t\t\t\t\tkey !== 'data', dictionary);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tserialize(this._serializeFields);\r\n\t\tif (!(this instanceof Group))\r\n\t\t\tserialize(this._style.getDefaults());\r\n\t\treturn [ this._class, props ];\r\n\t},\r\n\r\n\t_changed: function(flags) {\r\n\t\tif (flags & 4) {\r\n\t\t\tdelete this._bounds;\r\n\t\t\tdelete this._position;\r\n\t\t}\r\n\t\tif (this._parent\r\n\t\t\t\t&& (flags & (4 | 8))) {\r\n\t\t\tthis._parent._clearBoundsCache();\r\n\t\t}\r\n\t\tif (flags & 2) {\r\n\t\t\tthis._clearBoundsCache();\r\n\t\t}\r\n\t\tif (flags & 1) {\r\n\t\t\tthis._project._needsRedraw();\r\n\t\t}\r\n\t\tif (this._parentSymbol)\r\n\t\t\tthis._parentSymbol._changed(flags);\r\n\t\tif (this._project._changes) {\r\n\t\t\tvar entry = this._project._changesById[this._id];\r\n\t\t\tif (entry) {\r\n\t\t\t\tentry.flags |= flags;\r\n\t\t\t} else {\r\n\t\t\t\tentry = { item: this, flags: flags };\r\n\t\t\t\tthis._project._changesById[this._id] = entry;\r\n\t\t\t\tthis._project._changes.push(entry);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tset: function(props) {\r\n\t\tif (props)\r\n\t\t\tthis._set(props);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetId: function() {\r\n\t\treturn this._id;\r\n\t},\r\n\r\n\tgetType: function() {\r\n\t\treturn this._type;\r\n\t},\r\n\r\n\tgetName: function() {\r\n\t\treturn this._name;\r\n\t},\r\n\r\n\tsetName: function(name, unique) {\r\n\r\n\t\tif (this._name)\r\n\t\t\tthis._removeFromNamed();\r\n\t\tif (name && this._parent) {\r\n\t\t\tvar children = this._parent._children,\r\n\t\t\t\tnamedChildren = this._parent._namedChildren,\r\n\t\t\t\torig = name,\r\n\t\t\t\ti = 1;\r\n\t\t\twhile (unique && children[name])\r\n\t\t\t\tname = orig + ' ' + (i++);\r\n\t\t\t(namedChildren[name] = namedChildren[name] || []).push(this);\r\n\t\t\tchildren[name] = this;\r\n\t\t}\r\n\t\tthis._name = name || undefined;\r\n\t\tthis._changed(32);\r\n\t},\r\n\r\n\tgetStyle: function() {\r\n\t\treturn this._style;\r\n\t},\r\n\r\n\tsetStyle: function(style) {\r\n\t\tthis._style.initialize(style);\r\n\t}\r\n}, Base.each(['locked', 'visible', 'blendMode', 'opacity', 'guide'],\r\n\tfunction(name) {\r\n\t\tvar part = Base.capitalize(name),\r\n\t\t\tname = '_' + name;\r\n\t\tthis['get' + part] = function() {\r\n\t\t\treturn this[name];\r\n\t\t};\r\n\t\tthis['set' + part] = function(value) {\r\n\t\t\tif (value != this[name]) {\r\n\t\t\t\tthis[name] = value;\r\n\t\t\t\tthis._changed(name === '_locked'\r\n\t\t\t\t\t\t? 32 : 33);\r\n\t\t\t}\r\n\t\t};\r\n}, {}), {\r\n\r\n\t_locked: false,\r\n\r\n\t_visible: true,\r\n\r\n\t_blendMode: 'normal',\r\n\r\n\t_opacity: 1,\r\n\r\n\t_guide: false,\r\n\r\n\tapplyMatrix: false,\r\n\r\n\tisSelected: function() {\r\n\t\tif (this._children) {\r\n\t\t\tfor (var i = 0, l = this._children.length; i < l; i++)\r\n\t\t\t\tif (this._children[i].isSelected())\r\n\t\t\t\t\treturn true;\r\n\t\t}\r\n\t\treturn this._selected;\r\n\t},\r\n\r\n\tsetSelected: function(selected ) {\r\n\t\tif (this._children && !arguments[1]) {\r\n\t\t\tfor (var i = 0, l = this._children.length; i < l; i++)\r\n\t\t\t\tthis._children[i].setSelected(selected);\r\n\t\t}\r\n\t\tif ((selected = !!selected) != this._selected) {\r\n\t\t\tthis._selected = selected;\r\n\t\t\tthis._project._updateSelection(this);\r\n\t\t\tthis._changed(33);\r\n\t\t}\r\n\t},\r\n\r\n\t_selected: false,\r\n\r\n\tisFullySelected: function() {\r\n\t\tif (this._children && this._selected) {\r\n\t\t\tfor (var i = 0, l = this._children.length; i < l; i++)\r\n\t\t\t\tif (!this._children[i].isFullySelected())\r\n\t\t\t\t\treturn false;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn this._selected;\r\n\t},\r\n\r\n\tsetFullySelected: function(selected) {\r\n\t\tif (this._children) {\r\n\t\t\tfor (var i = 0, l = this._children.length; i < l; i++)\r\n\t\t\t\tthis._children[i].setFullySelected(selected);\r\n\t\t}\r\n\t\tthis.setSelected(selected, true);\r\n\t},\r\n\r\n\tisClipMask: function() {\r\n\t\treturn this._clipMask;\r\n\t},\r\n\r\n\tsetClipMask: function(clipMask) {\r\n\t\tif (this._clipMask != (clipMask = !!clipMask)) {\r\n\t\t\tthis._clipMask = clipMask;\r\n\t\t\tif (clipMask) {\r\n\t\t\t\tthis.setFillColor(null);\r\n\t\t\t\tthis.setStrokeColor(null);\r\n\t\t\t}\r\n\t\t\tthis._changed(33);\r\n\t\t\tif (this._parent)\r\n\t\t\t\tthis._parent._changed(256);\r\n\t\t}\r\n\t},\r\n\r\n\t_clipMask: false,\r\n\r\n\tgetData: function() {\r\n\t\tif (!this._data)\r\n\t\t\tthis._data = {};\r\n\t\treturn this._data;\r\n\t},\r\n\r\n\tsetData: function(data) {\r\n\t\tthis._data = data;\r\n\t},\r\n\r\n\tgetPosition: function() {\r\n\t\tvar pos = this._position\r\n\t\t\t\t|| (this._position = this.getBounds().getCenter(true));\r\n\t\treturn arguments[0] ? pos\r\n\t\t\t\t: LinkedPoint.create(this, 'setPosition', pos.x, pos.y);\r\n\t},\r\n\r\n\tsetPosition: function(point) {\r\n\t\tthis.translate(Point.read(arguments).subtract(this.getPosition(true)));\r\n\t},\r\n\r\n\tgetMatrix: function() {\r\n\t\treturn this._matrix;\r\n\t},\r\n\r\n\tsetMatrix: function(matrix) {\r\n\t\tthis._matrix.initialize(matrix);\r\n\t\tthis._changed(5);\r\n\t},\r\n\r\n\tisEmpty: function() {\r\n\t\treturn this._children.length == 0;\r\n\t}\r\n}, Base.each(['getBounds', 'getStrokeBounds', 'getHandleBounds', 'getRoughBounds'],\r\n\tfunction(name) {\r\n\t\tthis[name] = function() {\r\n\t\t\tvar getter = this._boundsGetter,\r\n\t\t\t\tbounds = this._getCachedBounds(typeof getter == 'string'\r\n\t\t\t\t\t\t? getter : getter && getter[name] || name, arguments[0]);\r\n\t\t\treturn name == 'getBounds'\r\n\t\t\t\t\t? LinkedRectangle.create(this, 'setBounds',\r\n\t\t\t\t\t\t\tbounds.x, bounds.y, bounds.width, bounds.height)\r\n\t\t\t\t\t: bounds;\r\n\t\t};\r\n\t},\r\n{\r\n\t_getCachedBounds: function(getter, matrix, cacheItem) {\r\n\t\tvar cache = (!matrix || matrix.equals(this._matrix)) && getter;\r\n\t\tif (cacheItem && this._parent) {\r\n\t\t\tvar id = cacheItem._id,\r\n\t\t\t\tref = this._parent._boundsCache\r\n\t\t\t\t\t= this._parent._boundsCache || {\r\n\t\t\t\tids: {},\r\n\t\t\t\tlist: []\r\n\t\t\t};\r\n\t\t\tif (!ref.ids[id]) {\r\n\t\t\t\tref.list.push(cacheItem);\r\n\t\t\t\tref.ids[id] = cacheItem;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (cache && this._bounds && this._bounds[cache])\r\n\t\t\treturn this._bounds[cache].clone();\r\n\t\tvar identity = this._matrix.isIdentity();\r\n\t\tmatrix = !matrix || matrix.isIdentity()\r\n\t\t\t\t? identity ? null : this._matrix\r\n\t\t\t\t: identity ? matrix : matrix.clone().concatenate(this._matrix);\r\n\t\tvar bounds = this._getBounds(getter, matrix, cache ? this : cacheItem);\r\n\t\tif (cache) {\r\n\t\t\tif (!this._bounds)\r\n\t\t\t\tthis._bounds = {};\r\n\t\t\tthis._bounds[cache] = bounds.clone();\r\n\t\t}\r\n\t\treturn bounds;\r\n\t},\r\n\r\n\t_clearBoundsCache: function() {\r\n\t\tif (this._boundsCache) {\r\n\t\t\tfor (var i = 0, list = this._boundsCache.list, l = list.length;\r\n\t\t\t\t\ti < l; i++) {\r\n\t\t\t\tvar item = list[i];\r\n\t\t\t\tdelete item._bounds;\r\n\t\t\t\tif (item != this && item._boundsCache)\r\n\t\t\t\t\titem._clearBoundsCache();\r\n\t\t\t}\r\n\t\t\tdelete this._boundsCache;\r\n\t\t}\r\n\t},\r\n\r\n\t_getBounds: function(getter, matrix, cacheItem) {\r\n\t\tvar children = this._children;\r\n\t\tif (!children || children.length == 0)\r\n\t\t\treturn new Rectangle();\r\n\t\tvar x1 = Infinity,\r\n\t\t\tx2 = -x1,\r\n\t\t\ty1 = x1,\r\n\t\t\ty2 = x2;\r\n\t\tfor (var i = 0, l = children.length; i < l; i++) {\r\n\t\t\tvar child = children[i];\r\n\t\t\tif (child._visible && !child.isEmpty()) {\r\n\t\t\t\tvar rect = child._getCachedBounds(getter, matrix, cacheItem);\r\n\t\t\t\tx1 = Math.min(rect.x, x1);\r\n\t\t\t\ty1 = Math.min(rect.y, y1);\r\n\t\t\t\tx2 = Math.max(rect.x + rect.width, x2);\r\n\t\t\t\ty2 = Math.max(rect.y + rect.height, y2);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn isFinite(x1)\r\n\t\t\t\t? Rectangle.create(x1, y1, x2 - x1, y2 - y1)\r\n\t\t\t\t: new Rectangle();\r\n\t},\r\n\r\n\tsetBounds: function(rect) {\r\n\t\trect = Rectangle.read(arguments);\r\n\t\tvar bounds = this.getBounds(),\r\n\t\t\tmatrix = new Matrix(),\r\n\t\t\tcenter = rect.getCenter();\r\n\t\tmatrix.translate(center);\r\n\t\tif (rect.width != bounds.width || rect.height != bounds.height) {\r\n\t\t\tmatrix.scale(\r\n\t\t\t\t\tbounds.width != 0 ? rect.width / bounds.width : 1,\r\n\t\t\t\t\tbounds.height != 0 ? rect.height / bounds.height : 1);\r\n\t\t}\r\n\t\tcenter = bounds.getCenter();\r\n\t\tmatrix.translate(-center.x, -center.y);\r\n\t\tthis.transform(matrix);\r\n\t}\r\n\r\n}), {\r\n\tgetProject: function() {\r\n\t\treturn this._project;\r\n\t},\r\n\r\n\t_setProject: function(project) {\r\n\t\tif (this._project != project) {\r\n\t\t\tthis._project = project;\r\n\t\t\tif (this._children) {\r\n\t\t\t\tfor (var i = 0, l = this._children.length; i < l; i++) {\r\n\t\t\t\t\tthis._children[i]._setProject(project);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tgetLayer: function() {\r\n\t\tvar parent = this;\r\n\t\twhile (parent = parent._parent) {\r\n\t\t\tif (parent instanceof Layer)\r\n\t\t\t\treturn parent;\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\r\n\tgetParent: function() {\r\n\t\treturn this._parent;\r\n\t},\r\n\r\n\tsetParent: function(item) {\r\n\t\treturn item.addChild(this);\r\n\t},\r\n\r\n\tgetChildren: function() {\r\n\t\treturn this._children;\r\n\t},\r\n\r\n\tsetChildren: function(items) {\r\n\t\tthis.removeChildren();\r\n\t\tthis.addChildren(items);\r\n\t},\r\n\r\n\tgetFirstChild: function() {\r\n\t\treturn this._children && this._children[0] || null;\r\n\t},\r\n\r\n\tgetLastChild: function() {\r\n\t\treturn this._children && this._children[this._children.length - 1]\r\n\t\t\t\t|| null;\r\n\t},\r\n\r\n\tgetNextSibling: function() {\r\n\t\treturn this._parent && this._parent._children[this._index + 1] || null;\r\n\t},\r\n\r\n\tgetPreviousSibling: function() {\r\n\t\treturn this._parent && this._parent._children[this._index - 1] || null;\r\n\t},\r\n\r\n\tgetIndex: function() {\r\n\t\treturn this._index;\r\n\t},\r\n\r\n\tisInserted: function() {\r\n\t\treturn this._parent ? this._parent.isInserted() : false;\r\n\t},\r\n\r\n\tclone: function() {\r\n\t\treturn this._clone(new this.constructor());\r\n\t},\r\n\r\n\t_clone: function(copy) {\r\n\t\tcopy.setStyle(this._style);\r\n\t\tif (this._children) {\r\n\t\t\tfor (var i = 0, l = this._children.length; i < l; i++)\r\n\t\t\t\tcopy.addChild(this._children[i].clone(), true);\r\n\t\t}\r\n\t\tvar keys = ['_locked', '_visible', '_blendMode', '_opacity',\r\n\t\t\t\t'_clipMask', '_guide', 'applyMatrix'];\r\n\t\tfor (var i = 0, l = keys.length; i < l; i++) {\r\n\t\t\tvar key = keys[i];\r\n\t\t\tif (this.hasOwnProperty(key))\r\n\t\t\t\tcopy[key] = this[key];\r\n\t\t}\r\n\t\tcopy._matrix.initialize(this._matrix);\r\n\t\tcopy.setSelected(this._selected);\r\n\t\tif (this._name)\r\n\t\t\tcopy.setName(this._name, true);\r\n\t\treturn copy;\r\n\t},\r\n\r\n\tcopyTo: function(itemOrProject) {\r\n\t\tvar copy = this.clone();\r\n\t\tif (itemOrProject.layers) {\r\n\t\t\titemOrProject.activeLayer.addChild(copy);\r\n\t\t} else {\r\n\t\t\titemOrProject.addChild(copy);\r\n\t\t}\r\n\t\treturn copy;\r\n\t},\r\n\r\n\trasterize: function(resolution) {\r\n\t\tvar bounds = this.getStrokeBounds(),\r\n\t\t\tscale = (resolution || 72) / 72,\r\n\t\t\tcanvas = CanvasProvider.getCanvas(bounds.getSize().multiply(scale)),\r\n\t\t\tctx = canvas.getContext('2d');\r\n\t\tctx.save();\r\n\t\tnew Matrix().scale(scale).translate(-bounds.x, -bounds.y)\r\n\t\t\t.applyToContext(ctx);\r\n\t\tItem.draw(this, ctx, {});\r\n\t\tvar raster = new Raster(canvas);\r\n\t\traster.setBounds(bounds);\r\n\t\tctx.restore();\r\n\t\treturn raster;\r\n\t},\r\n\r\n\thitTest: function(point, options) {\r\n\t\tfunction checkBounds(type, part) {\r\n\t\t\tvar pt = bounds['get' + part]();\r\n\t\t\tif (point.getDistance(pt) < options.tolerance)\r\n\t\t\t\treturn new HitResult(type, that,\r\n\t\t\t\t\t\t{ name: Base.hyphenate(part), point: pt });\r\n\t\t}\r\n\r\n\t\tif (this._locked)\r\n\t\t\treturn null;\r\n\r\n\t\tpoint = Point.read(arguments);\r\n\t\toptions = HitResult.getOptions(Base.read(arguments));\r\n\t\tif (!this._children && !this.getRoughBounds()\r\n\t\t\t\t.expand(options.tolerance)._containsPoint(point))\r\n\t\t\treturn null;\r\n\t\tpoint = this._matrix._inverseTransform(point);\r\n\t\tif ((options.center || options.bounds) &&\r\n\t\t\t\t!(this instanceof Layer && !this._parent)) {\r\n\t\t\tvar bounds = this.getBounds(),\r\n\t\t\t\tthat = this,\r\n\t\t\t\tpoints = ['TopLeft', 'TopRight', 'BottomLeft', 'BottomRight',\r\n\t\t\t\t'LeftCenter', 'TopCenter', 'RightCenter', 'BottomCenter'],\r\n\t\t\t\tres;\r\n\t\t\tif (options.center && (res = checkBounds('center', 'Center')))\r\n\t\t\t\treturn res;\r\n\t\t\tif (options.bounds) {\r\n\t\t\t\tfor (var i = 0; i < 8; i++)\r\n\t\t\t\t\tif (res = checkBounds('bounds', points[i]))\r\n\t\t\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this._children || !(options.guides && !this._guide\r\n\t\t\t\t|| options.selected && !this._selected)\r\n\t\t\t\t\t? this._hitTest(point, options) : null;\r\n\t},\r\n\r\n\t_hitTest: function(point, options) {\r\n\t\tif (this._children) {\r\n\t\t\tfor (var i = this._children.length - 1; i >= 0; i--) {\r\n\t\t\t\tvar res = this._children[i].hitTest(point, options);\r\n\r\n\t\t\t\t//brightgreen - added support for ignore_events attributes on item,\r\n\t\t\t\t//allows all hittests to be ignore if true\r\n\t\t\t\tif (res && !res.item.ignore_events) return res;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\taddChild: function(item, _cloning) {\r\n\t\treturn this.insertChild(undefined, item, _cloning);\r\n\t},\r\n\r\n\tinsertChild: function(index, item, _cloning) {\r\n\t\tif (this._children) {\r\n\t\t\titem._remove(true);\r\n\t\t\tBase.splice(this._children, [item], index, 0);\r\n\t\t\titem._parent = this;\r\n\t\t\titem._setProject(this._project);\r\n\t\t\tif (item._name)\r\n\t\t\t\titem.setName(item._name);\r\n\t\t\tthis._changed(3);\r\n\t\t\treturn item;\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\r\n\taddChildren: function(items, _cloning) {\r\n\t\treturn this.insertChildren(this._children.length, items, _cloning);\r\n\t},\r\n\r\n\tinsertChildren: function(index, items, _cloning) {\r\n\t\titems = items && Array.prototype.slice.apply(items);\r\n\t\tvar children = this._children,\r\n\t\t\tlength = children.length,\r\n\t\t\ti = index;\r\n\t\tfor (var j = 0, l = items && items.length; j < l; j++) {\r\n\t\t\tif (this.insertChild(i, items[j], _cloning)) {\r\n\t\t\t\tvar newLength = children.length;\r\n\t\t\t\ti += newLength - length;\r\n\t\t\t\tlength = newLength;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn i != index;\r\n\t},\r\n\r\n\tinsertAbove: function(item, _cloning) {\r\n\t\tvar index = item._index;\r\n\t\tif (item._parent == this._parent && index < this._index)\r\n\t\t\t index++;\r\n\t\treturn item._parent.insertChild(index, this, _cloning);\r\n\t},\r\n\r\n\tinsertBelow: function(item, _cloning) {\r\n\t\tvar index = item._index;\r\n\t\tif (item._parent == this._parent && index > this._index)\r\n\t\t\t index--;\r\n\t\treturn item._parent.insertChild(index, this, _cloning);\r\n\t},\r\n\r\n\tsendToBack: function() {\r\n\t\treturn this._parent.insertChild(0, this);\r\n\t},\r\n\r\n\tbringToFront: function() {\r\n\t\treturn this._parent.addChild(this);\r\n\t},\r\n\r\n\tappendTop: function(item) {\r\n\t\treturn this.addChild(item);\r\n\t},\r\n\r\n\tappendBottom: function(item) {\r\n\t\treturn this.insertChild(0, item);\r\n\t},\r\n\r\n\tmoveAbove: function(item) {\r\n\t\treturn this.insertAbove(item);\r\n\t},\r\n\r\n\tmoveBelow: function(item) {\r\n\t\treturn this.insertBelow(item);\r\n\t},\r\n\r\n\t_removeFromNamed: function() {\r\n\t\tvar children = this._parent._children,\r\n\t\t\tnamedChildren = this._parent._namedChildren,\r\n\t\t\tname = this._name,\r\n\t\t\tnamedArray = namedChildren[name],\r\n\t\t\tindex = namedArray ? namedArray.indexOf(this) : -1;\r\n\t\tif (index == -1)\r\n\t\t\treturn;\r\n\t\tif (children[name] == this)\r\n\t\t\tdelete children[name];\r\n\t\tnamedArray.splice(index, 1);\r\n\t\tif (namedArray.length) {\r\n\t\t\tchildren[name] = namedArray[namedArray.length - 1];\r\n\t\t} else {\r\n\t\t\tdelete namedChildren[name];\r\n\t\t}\r\n\t},\r\n\r\n\t_remove: function(notify) {\r\n\t\tif (this._parent) {\r\n\t\t\tif (this._name)\r\n\t\t\t\tthis._removeFromNamed();\r\n\t\t\tif (this._index != null)\r\n\t\t\t\tBase.splice(this._parent._children, null, this._index, 1);\r\n\t\t\tif (notify)\r\n\t\t\t\tthis._parent._changed(3);\r\n\t\t\tthis._parent = null;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\tremove: function() {\r\n\t\treturn this._remove(true);\r\n\t},\r\n\r\n\tremoveChildren: function(from, to) {\r\n\t\tif (!this._children)\r\n\t\t\treturn null;\r\n\t\tfrom = from || 0;\r\n\t\tto = Base.pick(to, this._children.length);\r\n\t\tvar removed = Base.splice(this._children, null, from, to - from);\r\n\t\tfor (var i = removed.length - 1; i >= 0; i--)\r\n\t\t\tremoved[i]._remove(false);\r\n\t\tif (removed.length > 0)\r\n\t\t\tthis._changed(3);\r\n\t\treturn removed;\r\n\t},\r\n\r\n\treverseChildren: function() {\r\n\t\tif (this._children) {\r\n\t\t\tthis._children.reverse();\r\n\t\t\tfor (var i = 0, l = this._children.length; i < l; i++)\r\n\t\t\t\tthis._children[i]._index = i;\r\n\t\t\tthis._changed(3);\r\n\t\t}\r\n\t},\r\n\r\n\tisEditable: function() {\r\n\t\tvar item = this;\r\n\t\twhile (item) {\r\n\t\t\tif (!item._visible || item._locked)\r\n\t\t\t\treturn false;\r\n\t\t\titem = item._parent;\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\r\n\t_getOrder: function(item) {\r\n\t\tfunction getList(item) {\r\n\t\t\tvar list = [];\r\n\t\t\tdo {\r\n\t\t\t\tlist.unshift(item);\r\n\t\t\t} while (item = item._parent);\r\n\t\t\treturn list;\r\n\t\t}\r\n\t\tvar list1 = getList(this),\r\n\t\t\tlist2 = getList(item);\r\n\t\tfor (var i = 0, l = Math.min(list1.length, list2.length); i < l; i++) {\r\n\t\t\tif (list1[i] != list2[i]) {\r\n\t\t\t\treturn list1[i]._index < list2[i]._index ? 1 : -1;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn 0;\r\n\t},\r\n\r\n\thasChildren: function() {\r\n\t\treturn this._children && this._children.length > 0;\r\n\t},\r\n\r\n\tisAbove: function(item) {\r\n\t\treturn this._getOrder(item) == -1;\r\n\t},\r\n\r\n\tisBelow: function(item) {\r\n\t\treturn this._getOrder(item) == 1;\r\n\t},\r\n\r\n\tisParent: function(item) {\r\n\t\treturn this._parent == item;\r\n\t},\r\n\r\n\tisChild: function(item) {\r\n\t\treturn item && item._parent == this;\r\n\t},\r\n\r\n\tisDescendant: function(item) {\r\n\t\tvar parent = this;\r\n\t\twhile (parent = parent._parent) {\r\n\t\t\tif (parent == item)\r\n\t\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\tisAncestor: function(item) {\r\n\t\treturn item ? item.isDescendant(this) : false;\r\n\t},\r\n\r\n\tisGroupedWith: function(item) {\r\n\t\tvar parent = this._parent;\r\n\t\twhile (parent) {\r\n\t\t\tif (parent._parent\r\n\t\t\t\t&& (parent instanceof Group || parent instanceof CompoundPath)\r\n\t\t\t\t&& item.isDescendant(parent))\r\n\t\t\t\t\treturn true;\r\n\t\t\tparent = parent._parent;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\tscale: function(hor, ver , center) {\r\n\t\tif (arguments.length < 2 || typeof ver === 'object') {\r\n\t\t\tcenter = ver;\r\n\t\t\tver = hor;\r\n\t\t}\r\n\t\treturn this.transform(new Matrix().scale(hor, ver,\r\n\t\t\t\tcenter || this.getPosition(true)));\r\n\t},\r\n\r\n\ttranslate: function(delta) {\r\n\t\tvar mx = new Matrix();\r\n\t\treturn this.transform(mx.translate.apply(mx, arguments));\r\n\t},\r\n\r\n\trotate: function(angle, center) {\r\n\t\treturn this.transform(new Matrix().rotate(angle,\r\n\t\t\t\tcenter || this.getPosition(true)));\r\n\t},\r\n\r\n\tshear: function(hor, ver, center) {\r\n\t\tif (arguments.length < 2 || typeof ver === 'object') {\r\n\t\t\tcenter = ver;\r\n\t\t\tver = hor;\r\n\t\t}\r\n\t\treturn this.transform(new Matrix().shear(hor, ver,\r\n\t\t\t\tcenter || this.getPosition(true)));\r\n\t},\r\n\r\n\ttransform: function(matrix ) {\r\n\t\tvar bounds = this._bounds,\r\n\t\t\tposition = this._position;\r\n\t\tthis._matrix.preConcatenate(matrix);\r\n\t\tif (this._transform)\r\n\t\t\tthis._transform(matrix);\r\n\t\tif ((this.applyMatrix || arguments[1])\r\n\t\t\t\t&& this._applyMatrix(this._matrix))\r\n\t\t\tthis._matrix.reset();\r\n\t\tthis._changed(5);\r\n\t\tif (bounds && matrix.getRotation() % 90 === 0) {\r\n\t\t\tfor (var key in bounds) {\r\n\t\t\t\tvar rect = bounds[key];\r\n\t\t\t\tmatrix._transformBounds(rect, rect);\r\n\t\t\t}\r\n\t\t\tvar getter = this._boundsGetter,\r\n\t\t\t\trect = bounds[getter && getter.getBounds || getter || 'getBounds'];\r\n\t\t\tif (rect)\r\n\t\t\t\tthis._position = rect.getCenter(true);\r\n\t\t\tthis._bounds = bounds;\r\n\t\t} else if (position) {\r\n\t\t\tthis._position = matrix._transformPoint(position, position);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_applyMatrix: function(matrix) {\r\n\t\tif (this._children) {\r\n\t\t\tfor (var i = 0, l = this._children.length; i < l; i++)\r\n\t\t\t\tthis._children[i].transform(matrix, true);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t},\r\n\r\n\tfitBounds: function(rectangle, fill) {\r\n\t\trectangle = Rectangle.read(arguments);\r\n\t\tvar bounds = this.getBounds(),\r\n\t\t\titemRatio = bounds.height / bounds.width,\r\n\t\t\trectRatio = rectangle.height / rectangle.width,\r\n\t\t\tscale = (fill ? itemRatio > rectRatio : itemRatio < rectRatio)\r\n\t\t\t\t\t? rectangle.width / bounds.width\r\n\t\t\t\t\t: rectangle.height / bounds.height,\r\n\t\t\tnewBounds = new Rectangle(new Point(),\r\n\t\t\t\t\tSize.create(bounds.width * scale, bounds.height * scale));\r\n\t\tnewBounds.setCenter(rectangle.getCenter());\r\n\t\tthis.setBounds(newBounds);\r\n\t},\r\n\r\n\timportJson: function(json) {\r\n\t\treturn this.addChild(Base.importJson(json));\r\n\t},\r\n\r\n\t_setStyles: function(ctx) {\r\n\t\tvar style = this._style,\r\n\t\t\twidth = style._strokeWidth,\r\n\t\t\tjoin = style._strokeJoin,\r\n\t\t\tcap = style._strokeCap,\r\n\t\t\tlimit = style._miterLimit,\r\n\t\t\tfillColor = style._fillColor,\r\n\t\t\tstrokeColor = style._strokeColor,\r\n\t\t\tdashArray = style._dashArray,\r\n\t\t\tdashOffset = style._dashOffset;\r\n\t\tif (width != null)\r\n\t\t\tctx.lineWidth = width;\r\n\t\tif (join)\r\n\t\t\tctx.lineJoin = join;\r\n\t\tif (cap)\r\n\t\t\tctx.lineCap = cap;\r\n\t\tif (limit)\r\n\t\t\tctx.miterLimit = limit;\r\n\t\tif (fillColor)\r\n\t\t\tctx.fillStyle = fillColor.toCanvasStyle(ctx);\r\n\t\tif (strokeColor) {\r\n\t\t\tctx.strokeStyle = strokeColor.toCanvasStyle(ctx);\r\n\t\t\tif (paper.support.nativeDash && dashArray && dashArray.length) {\r\n\t\t\t\tif ('setLineDash' in ctx) {\r\n\t\t\t\t\tctx.setLineDash(dashArray);\r\n\t\t\t\t\tctx.lineDashOffset = dashOffset;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tctx.mozDash = dashArray;\r\n\t\t\t\t\tctx.mozDashOffset = dashOffset;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!fillColor || !strokeColor)\r\n\t\t\tctx.globalAlpha = this._opacity;\r\n\t},\r\n\r\n\tstatics: {\r\n\t\tdrawSelectedBounds: function(bounds, ctx, matrix) {\r\n\t\t\tvar coords = matrix._transformCorners(bounds);\r\n\t\t\tctx.beginPath();\r\n\t\t\tfor (var i = 0; i < 8; i++)\r\n\t\t\t\tctx[i == 0 ? 'moveTo' : 'lineTo'](coords[i], coords[++i]);\r\n\t\t\tctx.closePath();\r\n\t\t\tctx.stroke();\r\n\t\t\tfor (var i = 0; i < 8; i++) {\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.rect(coords[i] - 2, coords[++i] - 2, 4, 4);\r\n\t\t\t\tctx.fill();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tdraw: function(item, ctx, param) {\r\n\t\t\tif (!item._visible || item._opacity == 0)\r\n\t\t\t\treturn;\r\n\t\t\titem._drawCount = item._project._drawCount;\r\n\t\t\tvar transforms = param.transforms,\r\n\t\t\t\tparentMatrix = transforms[transforms.length - 1],\r\n\t\t\t\tglobalMatrix = parentMatrix.clone().concatenate(item._matrix);\r\n\t\t\ttransforms.push(item._globalMatrix = globalMatrix);\r\n\t\t\tvar parentCtx, itemOffset, prevOffset;\r\n\t\t\tif (item._blendMode !== 'normal' || item._opacity < 1\r\n\t\t\t\t\t&& item._type !== 'raster' && (item._type !== 'path'\r\n\t\t\t\t\t\t|| item.getFillColor() && item.getStrokeColor())) {\r\n\t\t\t\tvar bounds = item.getStrokeBounds(parentMatrix);\r\n\t\t\t\tif (!bounds.width || !bounds.height)\r\n\t\t\t\t\treturn;\r\n\t\t\t\tprevOffset = param.offset;\r\n\t\t\t\titemOffset = param.offset = bounds.getTopLeft().floor();\r\n\t\t\t\tparentCtx = ctx;\r\n\t\t\t\tctx = CanvasProvider.getContext(\r\n\t\t\t\t\t\tbounds.getSize().ceil().add(Size.create(1, 1)));\r\n\t\t\t}\r\n\t\t\tctx.save();\r\n\t\t\tif (parentCtx)\r\n\t\t\t\tctx.translate(-itemOffset.x, -itemOffset.y);\r\n\t\t\t(parentCtx ? globalMatrix : item._matrix).applyToContext(ctx);\r\n\t\t\titem.draw(ctx, param);\r\n\t\t\tctx.restore();\r\n\t\t\ttransforms.pop();\r\n\t\t\tif (param.clip)\r\n\t\t\t\tctx.clip();\r\n\t\t\tif (parentCtx) {\r\n\t\t\t\tparam.offset = prevOffset;\r\n\t\t\t\tif (item._blendMode !== 'normal') {\r\n\t\t\t\t\tBlendMode.process(item._blendMode, ctx, parentCtx,\r\n\t\t\t\t\t\titem._opacity, itemOffset.subtract(prevOffset));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tparentCtx.save();\r\n\t\t\t\t\tparentCtx.globalAlpha = item._opacity;\r\n\t\t\t\t\tparentCtx.drawImage(ctx.canvas, itemOffset.x, itemOffset.y);\r\n\t\t\t\t\tparentCtx.restore();\r\n\t\t\t\t}\r\n\t\t\t\tCanvasProvider.release(ctx);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}, Base.each(['down', 'drag', 'up', 'move'], function(name) {\r\n\tthis['removeOn' + Base.capitalize(name)] = function() {\r\n\t\tvar hash = {};\r\n\t\thash[name] = true;\r\n\t\treturn this.removeOn(hash);\r\n\t};\r\n}, {\r\n\r\n\tremoveOn: function(obj) {\r\n\t\tfor (var name in obj) {\r\n\t\t\tif (obj[name]) {\r\n\t\t\t\tvar key = 'mouse' + name,\r\n\t\t\t\t\tsets = Tool._removeSets = Tool._removeSets || {};\r\n\t\t\t\tsets[key] = sets[key] || {};\r\n\t\t\t\tsets[key][this._id] = this;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n}));\r\n\r\nvar Group = this.Group = Item.extend({\r\n\t_class: 'Group',\r\n\t_serializeFields: {\r\n\t\tchildren: []\r\n\t},\r\n\r\n\tinitialize: function(arg) {\r\n\t\tthis.base();\r\n\t\tthis._children = [];\r\n\t\tthis._namedChildren = {};\r\n\t\tif (arg && !this._set(arg))\r\n\t\t\tthis.addChildren(Array.isArray(arg) ? arg : arguments);\r\n\t},\r\n\r\n\t_changed: function(flags) {\r\n\t\tItem.prototype._changed.call(this, flags);\r\n\t\tif (flags & (2 | 256)) {\r\n\t\t\tdelete this._clipItem;\r\n\t\t}\r\n\t},\r\n\r\n\t_getClipItem: function() {\r\n\t\tif (this._clipItem !== undefined)\r\n\t\t\treturn this._clipItem;\r\n\t\tfor (var i = 0, l = this._children.length; i < l; i++) {\r\n\t\t\tvar child = this._children[i];\r\n\t\t\tif (child._clipMask)\r\n\t\t\t\treturn this._clipItem = child;\r\n\t\t}\r\n\t\treturn this._clipItem = null;\r\n\t},\r\n\r\n\tisClipped: function() {\r\n\t\treturn !!this._getClipItem();\r\n\t},\r\n\r\n\tsetClipped: function(clipped) {\r\n\t\tvar child = this.getFirstChild();\r\n\t\tif (child)\r\n\t\t\tchild.setClipMask(clipped);\r\n\t},\r\n\r\n\tdraw: function(ctx, param) {\r\n\t\tvar clipItem = this._getClipItem();\r\n\t\tif (clipItem) {\r\n\t\t\tparam.clip = true;\r\n\t\t\tItem.draw(clipItem, ctx, param);\r\n\t\t\tparam.clip = false;\r\n\t\t}\r\n\t\tfor (var i = 0, l = this._children.length; i < l; i++) {\r\n\t\t\tvar item = this._children[i];\r\n\t\t\tif (item != clipItem)\r\n\t\t\t\tItem.draw(item, ctx, param);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nvar Layer = this.Layer = Group.extend({\r\n\t_class: 'Layer',\r\n\tinitialize: function(items) {\r\n\t\tthis._project = paper.project;\r\n\t\tthis._index = this._project.layers.push(this) - 1;\r\n\t\tthis.base.apply(this, arguments);\r\n\t\tthis.activate();\r\n\t},\r\n\r\n\t_remove: function(notify) {\r\n\t\tif (this._parent)\r\n\t\t\treturn this.base(notify);\r\n\t\tif (this._index != null) {\r\n\t\t\tBase.splice(this._project.layers, null, this._index, 1);\r\n\t\t\tthis._project._needsRedraw();\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\tgetNextSibling: function() {\r\n\t\treturn this._parent ? this.base()\r\n\t\t\t\t: this._project.layers[this._index + 1] || null;\r\n\t},\r\n\r\n\tgetPreviousSibling: function() {\r\n\t\treturn this._parent ? this.base()\r\n\t\t\t\t: this._project.layers[this._index - 1] || null;\r\n\t},\r\n\r\n\tisInserted: function() {\r\n\t\treturn this._index != null;\r\n\t},\r\n\r\n\tactivate: function() {\r\n\t\tthis._project.activeLayer = this;\r\n\t}\r\n}, new function () {\r\n\tfunction insert(above) {\r\n\t\treturn function(item) {\r\n\t\t\tif (item instanceof Layer && !item._parent\r\n\t\t\t\t\t\t&& this._remove(true)) {\r\n\t\t\t\tBase.splice(item._project.layers, [this],\r\n\t\t\t\t\t\titem._index + (above ? 1 : 0), 0);\r\n\t\t\t\tthis._setProject(item._project);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn this.base(item);\r\n\t\t};\r\n\t}\r\n\r\n\treturn {\r\n\t\tinsertAbove: insert(true),\r\n\r\n\t\tinsertBelow: insert(false)\r\n\t};\r\n});\r\n\r\nvar PlacedItem = this.PlacedItem = Item.extend({\r\n\t_boundsGetter: { getBounds: 'getStrokeBounds' },\r\n\r\n\t_hitTest: function(point, options, matrix) {\r\n\t\tvar result = this._symbol._definition._hitTest(point, options, matrix);\r\n\t\tif (result)\r\n\t\t\tresult.item = this;\r\n\t\treturn result;\r\n\t}\r\n});\r\n\r\nvar Raster = this.Raster = PlacedItem.extend({\r\n\t_class: 'Raster',\r\n\t_boundsSelected: true,\r\n\t_serializeFields: {\r\n\t\tsource: null\r\n\t},\r\n\t_boundsGetter: 'getBounds',\r\n\r\n\tinitialize: function(object, position) {\r\n\t\tthis.base(position !== undefined && Point.read(arguments, 1));\r\n\t\tif (object && !this._set(object)) {\r\n\t\t\tif (object.getContext) {\r\n\t\t\t\tthis.setCanvas(object);\r\n\t\t\t} else if (typeof object === 'string') {\r\n\t\t\t\tthis.setSource(object);\r\n\t\t\t} else {\r\n\t\t\t\tthis.setImage(object);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!this._size)\r\n\t\t\tthis._size = new Size();\r\n\t},\r\n\r\n\tclone: function() {\r\n\t\tvar element = this._image;\r\n\t\tif (!element) {\r\n\t\t\telement = CanvasProvider.getCanvas(this._size);\r\n\t\t\telement.getContext('2d').drawImage(this._canvas, 0, 0);\r\n\t\t}\r\n\t\tvar copy = new Raster(element);\r\n\t\treturn this._clone(copy);\r\n\t},\r\n\r\n\tgetSize: function() {\r\n\t\treturn this._size;\r\n\t},\r\n\r\n\tsetSize: function() {\r\n\t\tvar size = Size.read(arguments);\r\n\t\tif (!this._size.equals(size)) {\r\n\t\t\tvar element = this.getElement();\r\n\t\t\tthis.setCanvas(CanvasProvider.getCanvas(size));\r\n\t\t\tif (element)\r\n\t\t\t\tthis.getContext(true).drawImage(element, 0, 0,\r\n\t\t\t\t\t\tsize.width, size.height);\r\n\t\t}\r\n\t},\r\n\r\n\tgetWidth: function() {\r\n\t\treturn this._size.width;\r\n\t},\r\n\r\n\tgetHeight: function() {\r\n\t\treturn this._size.height;\r\n\t},\r\n\r\n\tisEmpty: function() {\r\n\t\treturn this._size.width == 0 && this._size.height == 0;\r\n\t},\r\n\r\n\tgetPpi: function() {\r\n\t\tvar matrix = this._matrix,\r\n\t\t\torig = new Point(0, 0).transform(matrix),\r\n\t\t\tu = new Point(1, 0).transform(matrix).subtract(orig),\r\n\t\t\tv = new Point(0, 1).transform(matrix).subtract(orig);\r\n\t\treturn Size.create(\r\n\t\t\t72 / u.getLength(),\r\n\t\t\t72 / v.getLength()\r\n\t\t);\r\n\t},\r\n\r\n\tgetContext: function() {\r\n\t\tif (!this._context)\r\n\t\t\tthis._context = this.getCanvas().getContext('2d');\r\n\t\tif (arguments[0]) {\r\n\t\t\tthis._image = null;\r\n\t\t\tthis._changed(129);\r\n\t\t}\r\n\t\treturn this._context;\r\n\t},\r\n\r\n\tsetContext: function(context) {\r\n\t\tthis._context = context;\r\n\t},\r\n\r\n\tgetCanvas: function() {\r\n\t\tif (!this._canvas) {\r\n\t\t\tvar ctx = CanvasProvider.getContext(this._size);\r\n\t\t\ttry {\r\n\t\t\t\tif (this._image)\r\n\t\t\t\t\tctx.drawImage(this._image, 0, 0);\r\n\t\t\t\tthis._canvas = ctx.canvas;\r\n\t\t\t} catch (e) {\r\n\t\t\t\tCanvasProvider.release(ctx);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._canvas;\r\n\t},\r\n\r\n\tsetCanvas: function(canvas) {\r\n\t\tif (this._canvas)\r\n\t\t\tCanvasProvider.release(this._canvas);\r\n\t\tthis._canvas = canvas;\r\n\t\tthis._size = Size.create(canvas.width, canvas.height);\r\n\t\tthis._image = null;\r\n\t\tthis._context = null;\r\n\t\tthis._changed(5 | 129);\r\n\t},\r\n\r\n\tgetImage: function() {\r\n\t\treturn this._image;\r\n\t},\r\n\r\n\tsetImage: function(image) {\r\n\t\tif (this._canvas)\r\n\t\t\tCanvasProvider.release(this._canvas);\r\n\t\tthis._image = image;\r\n\t\tthis._size = Size.create(image.naturalWidth, image.naturalHeight);\r\n\t\tthis._canvas = null;\r\n\t\tthis._context = null;\r\n\t\tthis._changed(5);\r\n\t},\r\n\r\n\tgetSource: function() {\r\n\t\treturn this._image && this._image.src || this.toDataURL();\r\n\t},\r\n\r\n\tsetSource: function(src) {\r\n\t\tvar that = this,\r\n\t\t\timage = document.getElementById(src) || new Image();\r\n\t\tfunction loaded() {\r\n\t\t\tthat.fire('load');\r\n\t\t\tif (that._project.view)\r\n\t\t\t\tthat._project.view.draw(true);\r\n\t\t}\r\n\t\tDomEvent.add(image, {\r\n\t\t\tload: function() {\r\n\t\t\t\tthat.setImage(image);\r\n\t\t\t\tloaded();\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (image.width && image.height) {\r\n\t\t\tsetTimeout(loaded, 0);\r\n\t\t} else if (!image.src) {\r\n\t\t\timage.src = src;\r\n\t\t}\r\n\t\tthis.setImage(image);\r\n\t},\r\n\r\n\tgetElement: function() {\r\n\t\treturn this._canvas || this._image;\r\n\t},\r\n\r\n\tgetSubImage: function(rect) {\r\n\t\trect = Rectangle.read(arguments);\r\n\t\tvar ctx = CanvasProvider.getContext(rect.getSize());\r\n\t\tctx.drawImage(this.getCanvas(), rect.x, rect.y,\r\n\t\t\t\trect.width, rect.height, 0, 0, rect.width, rect.height);\r\n\t\treturn ctx.canvas;\r\n\t},\r\n\r\n\ttoDataURL: function() {\r\n\t\tvar src = this._image && this._image.src;\r\n\t\tif (/^data:/.test(src))\r\n\t\t\treturn src;\r\n\t\tvar canvas = this.getCanvas();\r\n\t\treturn canvas ? canvas.toDataURL() : null;\r\n\t},\r\n\r\n\tdrawImage: function(image, point) {\r\n\t\tpoint = Point.read(arguments, 1);\r\n\t\tthis.getContext(true).drawImage(image, point.x, point.y);\r\n\t},\r\n\r\n\tgetAverageColor: function(object) {\r\n\t\tvar bounds, path;\r\n\t\tif (!object) {\r\n\t\t\tbounds = this.getBounds();\r\n\t\t} else if (object instanceof PathItem) {\r\n\t\t\tpath = object;\r\n\t\t\tbounds = object.getBounds();\r\n\t\t} else if (object.width) {\r\n\t\t\tbounds = new Rectangle(object);\r\n\t\t} else if (object.x) {\r\n\t\t\tbounds = Rectangle.create(object.x - 0.5, object.y - 0.5, 1, 1);\r\n\t\t}\r\n\t\tvar sampleSize = 32,\r\n\t\t\twidth = Math.min(bounds.width, sampleSize),\r\n\t\t\theight = Math.min(bounds.height, sampleSize);\r\n\t\tvar ctx = Raster._sampleContext;\r\n\t\tif (!ctx) {\r\n\t\t\tctx = Raster._sampleContext = CanvasProvider.getContext(\r\n\t\t\t\t\tnew Size(sampleSize));\r\n\t\t} else {\r\n\t\t\tctx.clearRect(0, 0, sampleSize + 1, sampleSize + 1);\r\n\t\t}\r\n\t\tctx.save();\r\n\t\tctx.scale(width / bounds.width, height / bounds.height);\r\n\t\tctx.translate(-bounds.x, -bounds.y);\r\n\t\tif (path)\r\n\t\t\tpath.draw(ctx, { clip: true });\r\n\t\tthis._matrix.applyToContext(ctx);\r\n\t\tctx.drawImage(this.getElement(),\r\n\t\t\t\t-this._size.width / 2, -this._size.height / 2);\r\n\t\tctx.restore();\r\n\t\tvar pixels = ctx.getImageData(0.5, 0.5, Math.ceil(width),\r\n\t\t\t\tMath.ceil(height)).data,\r\n\t\t\tchannels = [0, 0, 0],\r\n\t\t\ttotal = 0;\r\n\t\tfor (var i = 0, l = pixels.length; i < l; i += 4) {\r\n\t\t\tvar alpha = pixels[i + 3];\r\n\t\t\ttotal += alpha;\r\n\t\t\talpha /= 255;\r\n\t\t\tchannels[0] += pixels[i] * alpha;\r\n\t\t\tchannels[1] += pixels[i + 1] * alpha;\r\n\t\t\tchannels[2] += pixels[i + 2] * alpha;\r\n\t\t}\r\n\t\tfor (var i = 0; i < 3; i++)\r\n\t\t\tchannels[i] /= total;\r\n\t\treturn total ? Color.read(channels) : null;\r\n\t},\r\n\r\n\tgetPixel: function(point) {\r\n\t\tpoint = Point.read(arguments);\r\n\t\tvar pixels = this.getContext().getImageData(point.x, point.y, 1, 1).data,\r\n\t\t\tcomponents = [0, 0, 0, 0];\r\n\t\tfor (var i = 0; i < 4; i++)\r\n\t\t\tcomponents[i] = pixels[i] / 255;\r\n\t\treturn Color.create('rgb', components);\r\n\t},\r\n\r\n\tsetPixel: function(point, color) {\r\n\t\tvar _point = Point.read(arguments),\r\n\t\t\t_color = Color.read(arguments);\r\n\t\tvar ctx = this.getContext(true),\r\n\t\t\timageData = ctx.createImageData(1, 1),\r\n\t\t\talpha = _color.getAlpha();\r\n\t\timageData.data[0] = _color.getRed() * 255;\r\n\t\timageData.data[1] = _color.getGreen() * 255;\r\n\t\timageData.data[2] = _color.getBlue() * 255;\r\n\t\timageData.data[3] = alpha != null ? alpha * 255 : 255;\r\n\t\tctx.putImageData(imageData, _point.x, _point.y);\r\n\t},\r\n\r\n\tcreateImageData: function(size) {\r\n\t\tsize = Size.read(arguments);\r\n\t\treturn this.getContext().createImageData(size.width, size.height);\r\n\t},\r\n\r\n\tgetImageData: function(rect) {\r\n\t\trect = Rectangle.read(arguments);\r\n\t\tif (rect.isEmpty())\r\n\t\t\trect = new Rectangle(this.getSize());\r\n\t\treturn this.getContext().getImageData(rect.x, rect.y,\r\n\t\t\t\trect.width, rect.height);\r\n\t},\r\n\r\n\tsetImageData: function(data, point) {\r\n\t\tpoint = Point.read(arguments, 1);\r\n\t\tthis.getContext(true).putImageData(data, point.x, point.y);\r\n\t},\r\n\r\n\t_getBounds: function(getter, matrix) {\r\n\t\tvar rect = new Rectangle(this._size).setCenter(0, 0);\r\n\t\treturn matrix ? matrix._transformBounds(rect) : rect;\r\n\t},\r\n\r\n\t_hitTest: function(point, options) {\r\n\t\tif (point.isInside(this._getBounds())) {\r\n\t\t\tvar that = this;\r\n\t\t\treturn new HitResult('pixel', that, {\r\n\t\t\t\toffset: point.add(that._size.divide(2)).round(),\r\n\t\t\t\tcolor: {\r\n\t\t\t\t\tget: function() {\r\n\t\t\t\t\t\treturn that.getPixel(this.offset);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\tdraw: function(ctx, param) {\r\n\t\tvar element = this.getElement();\r\n\t\tif (element) {\r\n\t\t\tctx.globalAlpha = this._opacity;\r\n\t\t\tctx.drawImage(element,\r\n\t\t\t\t\t-this._size.width / 2, -this._size.height / 2);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nvar PlacedSymbol = this.PlacedSymbol = PlacedItem.extend({\r\n\t_class: 'PlacedSymbol',\r\n\t_boundsSelected: true,\r\n\t_serializeFields: {\r\n\t\tsymbol: null\r\n\t},\r\n\r\n\tinitialize: function(arg0, arg1) {\r\n\t\tthis.base(arg1 !== undefined && Point.read(arguments, 1));\r\n\t\tif (arg0 && !this._set(arg0))\r\n\t\t\tthis.setSymbol(arg0 instanceof Symbol ? arg0 : new Symbol(arg0));\r\n\t},\r\n\r\n\tgetSymbol: function() {\r\n\t\treturn this._symbol;\r\n\t},\r\n\r\n\tsetSymbol: function(symbol) {\r\n\t\tif (this._symbol)\r\n\t\t\tdelete this._symbol._instances[this._id];\r\n\t\tthis._symbol = symbol;\r\n\t\tsymbol._instances[this._id] = this;\r\n\t},\r\n\r\n\tclone: function() {\r\n\t\treturn this._clone(new PlacedSymbol(this.symbol));\r\n\t},\r\n\r\n\tisEmpty: function() {\r\n\t\treturn this._symbol._definition.isEmpty();\r\n\t},\r\n\r\n\t_getBounds: function(getter, matrix) {\r\n\t\treturn this.symbol._definition._getCachedBounds(getter, matrix);\r\n\t},\r\n\r\n\tdraw: function(ctx, param) {\r\n\t\tItem.draw(this.symbol._definition, ctx, param);\r\n\t}\r\n\r\n});\r\n\r\nvar HitResult = this.HitResult = Base.extend({\r\n\tinitialize: function(type, item, values) {\r\n\t\tthis.type = type;\r\n\t\tthis.item = item;\r\n\t\tif (values) {\r\n\t\t\tvalues.enumerable = true;\r\n\t\t\tthis.inject(values);\r\n\t\t}\r\n\t},\r\n\r\n\tstatics: {\r\n\t\tgetOptions: function(options) {\r\n\t\t\treturn options && options._merged ? options : Base.merge({\r\n\t\t\t\ttype: null,\r\n\t\t\t\ttolerance: paper.project.options.hitTolerance || 2,\r\n\t\t\t\tfill: !options,\r\n\t\t\t\tstroke: !options,\r\n\t\t\t\tsegments: !options,\r\n\t\t\t\thandles: false,\r\n\t\t\t\tends: false,\r\n\t\t\t\tcenter: false,\r\n\t\t\t\tbounds: false,\r\n\t\t\t\tguides: false,\r\n\t\t\t\tselected: false,\r\n\t\t\t\t_merged: true\r\n\t\t\t}, options);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nvar Segment = this.Segment = Base.extend({\r\n\t_class: 'Segment',\r\n\r\n\tinitialize: function(arg0, arg1, arg2, arg3, arg4, arg5) {\r\n\t\tvar count = arguments.length,\r\n\t\t\tcreatePoint = SegmentPoint.create,\r\n\t\t\tpoint, handleIn, handleOut;\r\n\t\tif (count == 0) {\r\n\t\t} else if (count == 1) {\r\n\t\t\tif (arg0.point) {\r\n\t\t\t\tpoint = arg0.point;\r\n\t\t\t\thandleIn = arg0.handleIn;\r\n\t\t\t\thandleOut = arg0.handleOut;\r\n\t\t\t} else {\r\n\t\t\t\tpoint = arg0;\r\n\t\t\t}\r\n\t\t} else if (count < 6) {\r\n\t\t\tif (count == 2 && arg1.x === undefined) {\r\n\t\t\t\tpoint = [ arg0, arg1 ];\r\n\t\t\t} else {\r\n\t\t\t\tpoint = arg0;\r\n\t\t\t\thandleIn = arg1;\r\n\t\t\t\thandleOut = arg2;\r\n\t\t\t}\r\n\t\t} else if (count == 6) {\r\n\t\t\tpoint = [ arg0, arg1 ];\r\n\t\t\thandleIn = [ arg2, arg3 ];\r\n\t\t\thandleOut = [ arg4, arg5 ];\r\n\t\t}\r\n\t\tcreatePoint(this, '_point', point);\r\n\t\tcreatePoint(this, '_handleIn', handleIn);\r\n\t\tcreatePoint(this, '_handleOut', handleOut);\r\n\t},\r\n\r\n\t_serialize: function(options) {\r\n\t\treturn Base.serialize(this._handleIn.isZero() && this._handleOut.isZero()\r\n\t\t\t\t? this._point\r\n\t\t\t\t: [this._point, this._handleIn, this._handleOut], options, true);\r\n\t},\r\n\r\n\t_changed: function(point) {\r\n\t\tif (!this._path)\r\n\t\t\treturn;\r\n\t\tvar curve = this._path._curves && this.getCurve(),\r\n\t\t\tother;\r\n\t\tif (curve) {\r\n\t\t\tcurve._changed();\r\n\t\t\tif (other = (curve[point == this._point\r\n\t\t\t\t\t|| point == this._handleIn && curve._segment1 == this\r\n\t\t\t\t\t? 'getPrevious' : 'getNext']())) {\r\n\t\t\t\tother._changed();\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._path._changed(5);\r\n\t},\r\n\r\n\tgetPoint: function() {\r\n\t\treturn this._point;\r\n\t},\r\n\r\n\tsetPoint: function(point) {\r\n\t\tpoint = Point.read(arguments);\r\n\t\tthis._point.set(point.x, point.y);\r\n\t},\r\n\r\n\tgetHandleIn: function() {\r\n\t\treturn this._handleIn;\r\n\t},\r\n\r\n\tsetHandleIn: function(point) {\r\n\t\tpoint = Point.read(arguments);\r\n\t\tthis._handleIn.set(point.x, point.y);\r\n\t},\r\n\r\n\tgetHandleOut: function() {\r\n\t\treturn this._handleOut;\r\n\t},\r\n\r\n\tsetHandleOut: function(point) {\r\n\t\tpoint = Point.read(arguments);\r\n\t\tthis._handleOut.set(point.x, point.y);\r\n\t},\r\n\r\n\tisLinear: function() {\r\n\t\treturn this._handleIn.isZero() && this._handleOut.isZero();\r\n\t},\r\n\r\n\tsetLinear: function() {\r\n\t\tthis._handleIn.set(0, 0);\r\n\t\tthis._handleOut.set(0, 0);\r\n\t},\r\n\r\n\t_isSelected: function(point) {\r\n\t\tvar state = this._selectionState;\r\n\t\treturn point == this._point ? !!(state & 4)\r\n\t\t\t: point == this._handleIn ? !!(state & 1)\r\n\t\t\t: point == this._handleOut ? !!(state & 2)\r\n\t\t\t: false;\r\n\t},\r\n\r\n\t_setSelected: function(point, selected) {\r\n\t\tvar path = this._path,\r\n\t\t\tselected = !!selected,\r\n\t\t\tstate = this._selectionState || 0,\r\n\t\t\tselection = [\r\n\t\t\t\t!!(state & 4),\r\n\t\t\t\t!!(state & 1),\r\n\t\t\t\t!!(state & 2)\r\n\t\t\t];\r\n\t\tif (point == this._point) {\r\n\t\t\tif (selected) {\r\n\t\t\t\tselection[1] = selection[2] = false;\r\n\t\t\t} else {\r\n\t\t\t\tvar previous = this.getPrevious(),\r\n\t\t\t\t\tnext = this.getNext();\r\n\t\t\t\tselection[1] = previous && (previous._point.isSelected()\r\n\t\t\t\t\t\t|| previous._handleOut.isSelected());\r\n\t\t\t\tselection[2] = next && (next._point.isSelected()\r\n\t\t\t\t\t\t|| next._handleIn.isSelected());\r\n\t\t\t}\r\n\t\t\tselection[0] = selected;\r\n\t\t} else {\r\n\t\t\tvar index = point == this._handleIn ? 1 : 2;\r\n\t\t\tif (selection[index] != selected) {\r\n\t\t\t\tif (selected)\r\n\t\t\t\t\tselection[0] = false;\r\n\t\t\t\tselection[index] = selected;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._selectionState = (selection[0] ? 4 : 0)\r\n\t\t\t\t| (selection[1] ? 1 : 0)\r\n\t\t\t\t| (selection[2] ? 2 : 0);\r\n\t\tif (path && state != this._selectionState) {\r\n\t\t\tpath._updateSelection(this, state, this._selectionState);\r\n\t\t\tpath._changed(33);\r\n\t\t}\r\n\t},\r\n\r\n\tisSelected: function() {\r\n\t\treturn this._isSelected(this._point);\r\n\t},\r\n\r\n\tsetSelected: function(selected) {\r\n\t\tthis._setSelected(this._point, selected);\r\n\t},\r\n\r\n\tgetIndex: function() {\r\n\t\treturn this._index !== undefined ? this._index : null;\r\n\t},\r\n\r\n\tgetPath: function() {\r\n\t\treturn this._path || null;\r\n\t},\r\n\r\n\tgetCurve: function() {\r\n\t\tif (this._path) {\r\n\t\t\tvar index = this._index;\r\n\t\t\tif (!this._path._closed && index == this._path._segments.length - 1)\r\n\t\t\t\tindex--;\r\n\t\t\treturn this._path.getCurves()[index] || null;\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\r\n\tgetNext: function() {\r\n\t\tvar segments = this._path && this._path._segments;\r\n\t\treturn segments && (segments[this._index + 1]\r\n\t\t\t\t|| this._path._closed && segments[0]) || null;\r\n\t},\r\n\r\n\tgetPrevious: function() {\r\n\t\tvar segments = this._path && this._path._segments;\r\n\t\treturn segments && (segments[this._index - 1]\r\n\t\t\t\t|| this._path._closed && segments[segments.length - 1]) || null;\r\n\t},\r\n\r\n\treverse: function() {\r\n\t\treturn new Segment(this._point, this._handleOut, this._handleIn);\r\n\t},\r\n\r\n\tremove: function() {\r\n\t\treturn this._path ? !!this._path.removeSegment(this._index) : false;\r\n\t},\r\n\r\n\tclone: function() {\r\n\t\treturn new Segment(this._point, this._handleIn, this._handleOut);\r\n\t},\r\n\r\n\tequals: function(segment) {\r\n\t\treturn segment == this || segment\r\n\t\t\t\t&& this._point.equals(segment._point)\r\n\t\t\t\t&& this._handleIn.equals(segment._handleIn)\r\n\t\t\t\t&& this._handleOut.equals(segment._handleOut);\r\n\t},\r\n\r\n\ttoString: function() {\r\n\t\tvar parts = [ 'point: ' + this._point ];\r\n\t\tif (!this._handleIn.isZero())\r\n\t\t\tparts.push('handleIn: ' + this._handleIn);\r\n\t\tif (!this._handleOut.isZero())\r\n\t\t\tparts.push('handleOut: ' + this._handleOut);\r\n\t\treturn '{ ' + parts.join(', ') + ' }';\r\n\t},\r\n\r\n\t_transformCoordinates: function(matrix, coords, change) {\r\n\t\tvar point = this._point,\r\n\t\t\thandleIn =  !change || !this._handleIn.isZero()\r\n\t\t\t\t\t? this._handleIn : null,\r\n\t\t\thandleOut = !change || !this._handleOut.isZero()\r\n\t\t\t\t\t? this._handleOut : null,\r\n\t\t\tx = point._x,\r\n\t\t\ty = point._y,\r\n\t\t\ti = 2;\r\n\t\tcoords[0] = x;\r\n\t\tcoords[1] = y;\r\n\t\tif (handleIn) {\r\n\t\t\tcoords[i++] = handleIn._x + x;\r\n\t\t\tcoords[i++] = handleIn._y + y;\r\n\t\t}\r\n\t\tif (handleOut) {\r\n\t\t\tcoords[i++] = handleOut._x + x;\r\n\t\t\tcoords[i++] = handleOut._y + y;\r\n\t\t}\r\n\t\tif (matrix) {\r\n\t\t\tmatrix._transformCoordinates(coords, 0, coords, 0, i / 2);\r\n\t\t\tx = coords[0];\r\n\t\t\ty = coords[1];\r\n\t\t\tif (change) {\r\n\t\t\t\tpoint._x = x;\r\n\t\t\t\tpoint._y = y;\r\n\t\t\t\ti  = 2;\r\n\t\t\t\tif (handleIn) {\r\n\t\t\t\t\thandleIn._x = coords[i++] - x;\r\n\t\t\t\t\thandleIn._y = coords[i++] - y;\r\n\t\t\t\t}\r\n\t\t\t\tif (handleOut) {\r\n\t\t\t\t\thandleOut._x = coords[i++] - x;\r\n\t\t\t\t\thandleOut._y = coords[i++] - y;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (!handleIn) {\r\n\t\t\t\t\tcoords[i++] = x;\r\n\t\t\t\t\tcoords[i++] = y;\r\n\t\t\t\t}\r\n\t\t\t\tif (!handleOut) {\r\n\t\t\t\t\tcoords[i++] = x;\r\n\t\t\t\t\tcoords[i++] = y;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn coords;\r\n\t\tnop().nop();\r\n\t}\r\n});\r\n\r\nvar SegmentPoint = Point.extend({\r\n\tset: function(x, y) {\r\n\t\tthis._x = x;\r\n\t\tthis._y = y;\r\n\t\tthis._owner._changed(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetX: function() {\r\n\t\treturn this._x;\r\n\t},\r\n\r\n\tsetX: function(x) {\r\n\t\tthis._x = x;\r\n\t\tthis._owner._changed(this);\r\n\t},\r\n\r\n\tgetY: function() {\r\n\t\treturn this._y;\r\n\t},\r\n\r\n\tsetY: function(y) {\r\n\t\tthis._y = y;\r\n\t\tthis._owner._changed(this);\r\n\t},\r\n\r\n\tisZero: function() {\r\n\t\treturn Numerical.isZero(this._x) && Numerical.isZero(this._y);\r\n\t},\r\n\r\n\tsetSelected: function(selected) {\r\n\t\tthis._owner._setSelected(this, selected);\r\n\t},\r\n\r\n\tisSelected: function() {\r\n\t\treturn this._owner._isSelected(this);\r\n\t},\r\n\r\n\tstatics: {\r\n\t\tcreate: function(segment, key, pt) {\r\n\t\t\tvar point = Base.create(SegmentPoint),\r\n\t\t\t\tx, y, selected;\r\n\t\t\tif (!pt) {\r\n\t\t\t\tx = y = 0;\r\n\t\t\t} else if ((x = pt[0]) !== undefined) {\r\n\t\t\t\ty = pt[1];\r\n\t\t\t} else {\r\n\t\t\t\tif ((x = pt.x) === undefined) {\r\n\t\t\t\t\tpt = Point.read(arguments, 2);\r\n\t\t\t\t\tx = pt.x;\r\n\t\t\t\t}\r\n\t\t\t\ty = pt.y;\r\n\t\t\t\tselected = pt.selected;\r\n\t\t\t}\r\n\t\t\tpoint._x = x;\r\n\t\t\tpoint._y = y;\r\n\t\t\tpoint._owner = segment;\r\n\t\t\tsegment[key] = point;\r\n\t\t\tif (selected)\r\n\t\t\t\tpoint.setSelected(true);\r\n\t\t\treturn point;\r\n\t\t}\r\n\t}\r\n});\r\n\r\nvar Curve = this.Curve = Base.extend({\r\n\tinitialize: function(arg0, arg1, arg2, arg3, arg4, arg5, arg6, arg7) {\r\n\t\tvar count = arguments.length;\r\n\t\tif (count == 0) {\r\n\t\t\tthis._segment1 = new Segment();\r\n\t\t\tthis._segment2 = new Segment();\r\n\t\t} else if (count == 1) {\r\n\t\t\tthis._segment1 = new Segment(arg0.segment1);\r\n\t\t\tthis._segment2 = new Segment(arg0.segment2);\r\n\t\t} else if (count == 2) {\r\n\t\t\tthis._segment1 = new Segment(arg0);\r\n\t\t\tthis._segment2 = new Segment(arg1);\r\n\t\t} else {\r\n\t\t\tvar point1, handle1, handle2, point2;\r\n\t\t\tif (count == 4) {\r\n\t\t\t\tpoint1 = arg0;\r\n\t\t\t\thandle1 = arg1;\r\n\t\t\t\thandle2 = arg2;\r\n\t\t\t\tpoint2 = arg3;\r\n\t\t\t} else if (count == 8) {\r\n\t\t\t\tpoint1 = [arg0, arg1];\r\n\t\t\t\tpoint2 = [arg6, arg7];\r\n\t\t\t\thandle1 = [arg2 - arg0, arg7 - arg1];\r\n\t\t\t\thandle2 = [arg4 - arg6, arg5 - arg7];\r\n\t\t\t}\r\n\t\t\tthis._segment1 = new Segment(point1, null, handle1);\r\n\t\t\tthis._segment2 = new Segment(point2, handle2, null);\r\n\t\t}\r\n\t},\r\n\r\n\t_changed: function() {\r\n\t\tdelete this._length;\r\n\t\tdelete this._bounds;\r\n\t},\r\n\r\n\tgetPoint1: function() {\r\n\t\treturn this._segment1._point;\r\n\t},\r\n\r\n\tsetPoint1: function(point) {\r\n\t\tpoint = Point.read(arguments);\r\n\t\tthis._segment1._point.set(point.x, point.y);\r\n\t},\r\n\r\n\tgetPoint2: function() {\r\n\t\treturn this._segment2._point;\r\n\t},\r\n\r\n\tsetPoint2: function(point) {\r\n\t\tpoint = Point.read(arguments);\r\n\t\tthis._segment2._point.set(point.x, point.y);\r\n\t},\r\n\r\n\tgetHandle1: function() {\r\n\t\treturn this._segment1._handleOut;\r\n\t},\r\n\r\n\tsetHandle1: function(point) {\r\n\t\tpoint = Point.read(arguments);\r\n\t\tthis._segment1._handleOut.set(point.x, point.y);\r\n\t},\r\n\r\n\tgetHandle2: function() {\r\n\t\treturn this._segment2._handleIn;\r\n\t},\r\n\r\n\tsetHandle2: function(point) {\r\n\t\tpoint = Point.read(arguments);\r\n\t\tthis._segment2._handleIn.set(point.x, point.y);\r\n\t},\r\n\r\n\tgetSegment1: function() {\r\n\t\treturn this._segment1;\r\n\t},\r\n\r\n\tgetSegment2: function() {\r\n\t\treturn this._segment2;\r\n\t},\r\n\r\n\tgetPath: function() {\r\n\t\treturn this._path;\r\n\t},\r\n\r\n\tgetIndex: function() {\r\n\t\treturn this._segment1._index;\r\n\t},\r\n\r\n\tgetNext: function() {\r\n\t\tvar curves = this._path && this._path._curves;\r\n\t\treturn curves && (curves[this._segment1._index + 1]\r\n\t\t\t\t|| this._path._closed && curves[0]) || null;\r\n\t},\r\n\r\n\tgetPrevious: function() {\r\n\t\tvar curves = this._path && this._path._curves;\r\n\t\treturn curves && (curves[this._segment1._index - 1]\r\n\t\t\t\t|| this._path._closed && curves[curves.length - 1]) || null;\r\n\t},\r\n\r\n\tisSelected: function() {\r\n\t\treturn this.getHandle1().isSelected() && this.getHandle2().isSelected();\r\n\t},\r\n\r\n\tsetSelected: function(selected) {\r\n\t\tthis.getHandle1().setSelected(selected);\r\n\t\tthis.getHandle2().setSelected(selected);\r\n\t},\r\n\r\n\tgetValues: function() {\r\n\t\treturn Curve.getValues(this._segment1, this._segment2);\r\n\t},\r\n\r\n\tgetPoints: function() {\r\n\t\tvar coords = this.getValues(),\r\n\t\t\tpoints = [];\r\n\t\tfor (var i = 0; i < 8; i += 2)\r\n\t\t\tpoints.push(Point.create(coords[i], coords[i + 1]));\r\n\t\treturn points;\r\n\t},\r\n\r\n\tgetLength: function() {\r\n\t\tvar from = arguments[0],\r\n\t\t\tto = arguments[1],\r\n\t\t\tfullLength = arguments.length == 0 || from == 0 && to == 1;\r\n\t\tif (fullLength && this._length != null)\r\n\t\t\treturn this._length;\r\n\t\tvar length = Curve.getLength(this.getValues(), from, to);\r\n\t\tif (fullLength)\r\n\t\t\tthis._length = length;\r\n\t\treturn length;\r\n\t},\r\n\r\n\tgetPart: function(from, to) {\r\n\t\treturn new Curve(Curve.getPart(this.getValues(), from, to));\r\n\t},\r\n\r\n\tisLinear: function() {\r\n\t\treturn this._segment1._handleOut.isZero()\r\n\t\t\t\t&& this._segment2._handleIn.isZero();\r\n\t},\r\n\r\n\tgetIntersections: function(curve) {\r\n\t\treturn Curve._addIntersections(this.getValues(), curve.getValues(),\r\n\t\t\t\tthis, []);\r\n\t},\r\n\r\n\tgetCrossings: function(point, roots) {\r\n\t\tvar vals = this.getValues(),\r\n\t\t\tcount = Curve.solveCubic(vals, 1, point.y, roots),\r\n\t\t\tcrossings = 0;\r\n\t\tfor (var i = 0; i < count; i++) {\r\n\t\t\tvar t = roots[i];\r\n\t\t\tif (t >= 0 && t < 1 && Curve.evaluate(vals, t, true, 0).x > point.x) {\r\n\t\t\t\tif (t < 0.00001\r\n\t\t\t\t\t&& Curve.evaluate(this.getPrevious().getValues(), 1, true, 1).y\r\n\t\t\t\t\t\t* Curve.evaluate(vals, t, true, 1).y\r\n\t\t\t\t\t\t\t>= 0.00001)\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\tcrossings++;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn crossings;\r\n\t},\r\n\r\n\treverse: function() {\r\n\t\treturn new Curve(this._segment2.reverse(), this._segment1.reverse());\r\n\t},\r\n\r\n\tdivide: function(parameter) {\r\n\t\tvar res = null;\r\n\t\tif (parameter && parameter.curve === this)\r\n\t\t\tparameter = parameter.parameter;\r\n\t\tif (parameter > 0 && parameter < 1) {\r\n\t\t\tvar parts = Curve.subdivide(this.getValues(), parameter),\r\n\t\t\t\tisLinear = this.isLinear(),\r\n\t\t\t\tleft = parts[0],\r\n\t\t\t\tright = parts[1],\r\n\t\t\t\tpoint1 = this._segment1._point,\r\n\t\t\t\tpoint2 = this._segment2._point;\r\n\t\t\tif (!isLinear) {\r\n\t\t\t\tthis._segment1._handleOut.set(left[2] - point1._x,\r\n\t\t\t\t\t\tleft[3] - point1._y);\r\n\t\t\t\tthis._segment2._handleIn.set(right[4] - point2._x,\r\n\t\t\t\t\t\tright[5] - point2._y);\r\n\t\t\t}\r\n\r\n\t\t\tvar x = left[6], y = left[7],\r\n\t\t\t\tsegment = new Segment(Point.create(x, y),\r\n\t\t\t\t\t\tisLinear ? null : Point.create(left[4] - x, left[5] - y),\r\n\t\t\t\t\t\tisLinear ? null : Point.create(right[2] - x, right[3] - y));\r\n\t\t\tif (this._path) {\r\n\t\t\t\tif (this._segment1._index > 0 && this._segment2._index === 0) {\r\n\t\t\t\t\tthis._path.add(segment);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._path.insert(this._segment2._index, segment);\r\n\t\t\t\t}\r\n\t\t\t\tres = this;\r\n\t\t\t} else {\r\n\t\t\t\tvar end = this._segment2;\r\n\t\t\t\tthis._segment2 = segment;\r\n\t\t\t\tres = new Curve(segment, end);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn res;\r\n\t},\r\n\r\n\tsplit: function(parameter) {\r\n\t\treturn this._path\r\n\t\t\t? this._path.split(this._segment1._index, parameter)\r\n\t\t\t: null;\r\n\t},\r\n\r\n\tclone: function() {\r\n\t\treturn new Curve(this._segment1, this._segment2);\r\n\t},\r\n\r\n\ttoString: function() {\r\n\t\tvar parts = [ 'point1: ' + this._segment1._point ];\r\n\t\tif (!this._segment1._handleOut.isZero())\r\n\t\t\tparts.push('handle1: ' + this._segment1._handleOut);\r\n\t\tif (!this._segment2._handleIn.isZero())\r\n\t\t\tparts.push('handle2: ' + this._segment2._handleIn);\r\n\t\tparts.push('point2: ' + this._segment2._point);\r\n\t\treturn '{ ' + parts.join(', ') + ' }';\r\n\t},\r\n\r\nstatics: {\r\n\tcreate: function(path, segment1, segment2) {\r\n\t\tvar curve = Base.create(Curve);\r\n\t\tcurve._path = path;\r\n\t\tcurve._segment1 = segment1;\r\n\t\tcurve._segment2 = segment2;\r\n\t\treturn curve;\r\n\t},\r\n\r\n\tgetValues: function(segment1, segment2) {\r\n\t\tvar p1 = segment1._point,\r\n\t\t\th1 = segment1._handleOut,\r\n\t\t\th2 = segment2._handleIn,\r\n\t\t\tp2 = segment2._point;\r\n\t\treturn [\r\n\t\t\tp1._x, p1._y,\r\n\t\t\tp1._x + h1._x, p1._y + h1._y,\r\n\t\t\tp2._x + h2._x, p2._y + h2._y,\r\n\t\t\tp2._x, p2._y\r\n\t\t];\r\n\t},\r\n\r\n\tevaluate: function(v, offset, isParameter, type) {\r\n\t\tvar t = isParameter ? offset : Curve.getParameterAt(v, offset, 0),\r\n\t\t\tp1x = v[0], p1y = v[1],\r\n\t\t\tc1x = v[2], c1y = v[3],\r\n\t\t\tc2x = v[4], c2y = v[5],\r\n\t\t\tp2x = v[6], p2y = v[7],\r\n\t\t\tx, y;\r\n\r\n\t\tif (type == 0 && (t == 0 || t == 1)) {\r\n\t\t\tx = t == 0 ? p1x : p2x;\r\n\t\t\ty = t == 0 ? p1y : p2y;\r\n\t\t} else {\r\n\t\t\tvar tMin = 0.00001;\r\n\t\t\tif (t < tMin && c1x == p1x && c1y == p1y)\r\n\t\t\t\tt = tMin;\r\n\t\t\telse if (t > 1 - tMin && c2x == p2x && c2y == p2y)\r\n\t\t\t\tt = 1 - tMin;\r\n\t\t\tvar cx = 3 * (c1x - p1x),\r\n\t\t\t\tbx = 3 * (c2x - c1x) - cx,\r\n\t\t\t\tax = p2x - p1x - cx - bx,\r\n\r\n\t\t\t\tcy = 3 * (c1y - p1y),\r\n\t\t\t\tby = 3 * (c2y - c1y) - cy,\r\n\t\t\t\tay = p2y - p1y - cy - by;\r\n\r\n\t\t\tswitch (type) {\r\n\t\t\tcase 0:\r\n\t\t\t\tx = ((ax * t + bx) * t + cx) * t + p1x;\r\n\t\t\t\ty = ((ay * t + by) * t + cy) * t + p1y;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1:\r\n\t\t\tcase 2:\r\n\t\t\t\tx = (3 * ax * t + 2 * bx) * t + cx;\r\n\t\t\t\ty = (3 * ay * t + 2 * by) * t + cy;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn type == 2 ? new Point(y, -x) : new Point(x, y);\r\n\t},\r\n\r\n\tsubdivide: function(v, t) {\r\n\t\tvar p1x = v[0], p1y = v[1],\r\n\t\t\tc1x = v[2], c1y = v[3],\r\n\t\t\tc2x = v[4], c2y = v[5],\r\n\t\t\tp2x = v[6], p2y = v[7];\r\n\t\tif (t === undefined)\r\n\t\t\tt = 0.5;\r\n\t\tvar u = 1 - t,\r\n\t\t\tp3x = u * p1x + t * c1x, p3y = u * p1y + t * c1y,\r\n\t\t\tp4x = u * c1x + t * c2x, p4y = u * c1y + t * c2y,\r\n\t\t\tp5x = u * c2x + t * p2x, p5y = u * c2y + t * p2y,\r\n\t\t\tp6x = u * p3x + t * p4x, p6y = u * p3y + t * p4y,\r\n\t\t\tp7x = u * p4x + t * p5x, p7y = u * p4y + t * p5y,\r\n\t\t\tp8x = u * p6x + t * p7x, p8y = u * p6y + t * p7y;\r\n\t\treturn [\r\n\t\t\t[p1x, p1y, p3x, p3y, p6x, p6y, p8x, p8y],\r\n\t\t\t[p8x, p8y, p7x, p7y, p5x, p5y, p2x, p2y]\r\n\t\t];\r\n\t},\r\n\r\n\tsolveCubic: function (v, coord, val, roots) {\r\n\t\tvar p1 = v[coord],\r\n\t\t\tc1 = v[coord + 2],\r\n\t\t\tc2 = v[coord + 4],\r\n\t\t\tp2 = v[coord + 6],\r\n\t\t\tc = 3 * (c1 - p1),\r\n\t\t\tb = 3 * (c2 - c1) - c,\r\n\t\t\ta = p2 - p1 - c - b;\r\n\t\treturn Numerical.solveCubic(a, b, c, p1 - val, roots,\r\n\t\t\t\t0.00001);\r\n\t},\r\n\r\n\tgetParameterOf: function(v, x, y) {\r\n\t\tif (Math.abs(v[0] - x) < 0.00001\r\n\t\t\t\t&& Math.abs(v[1] - y) < 0.00001)\r\n\t\t\treturn 0;\r\n\t\tif (Math.abs(v[6] - x) < 0.00001\r\n\t\t\t\t&& Math.abs(v[7] - y) < 0.00001)\r\n\t\t\treturn 1;\r\n\t\tvar txs = [],\r\n\t\t\ttys = [],\r\n\t\t\tsx = Curve.solveCubic(v, 0, x, txs),\r\n\t\t\tsy = Curve.solveCubic(v, 1, y, tys),\r\n\t\t\ttx, ty;\r\n\t\tfor (var cx = 0;  sx == -1 || cx < sx;) {\r\n\t\t\tif (sx == -1 || (tx = txs[cx++]) >= 0 && tx <= 1) {\r\n\t\t\t\tfor (var cy = 0; sy == -1 || cy < sy;) {\r\n\t\t\t\t\tif (sy == -1 || (ty = tys[cy++]) >= 0 && ty <= 1) {\r\n\t\t\t\t\t\tif (sx == -1) tx = ty;\r\n\t\t\t\t\t\telse if (sy == -1) ty = tx;\r\n\t\t\t\t\t\tif (Math.abs(tx - ty) < 0.00001)\r\n\t\t\t\t\t\t\treturn (tx + ty) * 0.5;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (sx == -1)\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\r\n\tgetPart: function(v, from, to) {\r\n\t\tif (from > 0)\r\n\t\t\tv = Curve.subdivide(v, from)[1];\r\n\t\tif (to < 1)\r\n\t\t\tv = Curve.subdivide(v, (to - from) / (1 - from))[0];\r\n\t\treturn v;\r\n\t},\r\n\r\n\tisFlatEnough: function(v, tolerance) {\r\n\t\tvar p1x = v[0], p1y = v[1],\r\n\t\t\tc1x = v[2], c1y = v[3],\r\n\t\t\tc2x = v[4], c2y = v[5],\r\n\t\t\tp2x = v[6], p2y = v[7],\r\n\t\t\tux = 3 * c1x - 2 * p1x - p2x,\r\n\t\t\tuy = 3 * c1y - 2 * p1y - p2y,\r\n\t\t\tvx = 3 * c2x - 2 * p2x - p1x,\r\n\t\t\tvy = 3 * c2y - 2 * p2y - p1y;\r\n\t\treturn Math.max(ux * ux, vx * vx) + Math.max(uy * uy, vy * vy)\r\n\t\t\t\t< 16 * tolerance * tolerance;\r\n\t},\r\n\r\n\tgetBounds: function(v) {\r\n\t\tvar min = v.slice(0, 2),\r\n\t\t\tmax = min.slice(),\r\n\t\t\troots = [0, 0];\r\n\t\tfor (var i = 0; i < 2; i++)\r\n\t\t\tCurve._addBounds(v[i], v[i + 2], v[i + 4], v[i + 6],\r\n\t\t\t\t\ti, 0, min, max, roots);\r\n\t\treturn Rectangle.create(min[0], min[1], max[0] - min[0], max[1] - min[1]);\r\n\t},\r\n\r\n\t_addBounds: function(v0, v1, v2, v3, coord, padding, min, max, roots) {\r\n\t\tfunction add(value, padding) {\r\n\t\t\tvar left = value - padding,\r\n\t\t\t\tright = value + padding;\r\n\t\t\tif (left < min[coord])\r\n\t\t\t\tmin[coord] = left;\r\n\t\t\tif (right > max[coord])\r\n\t\t\t\tmax[coord] = right;\r\n\t\t}\r\n\t\tvar a = 3 * (v1 - v2) - v0 + v3,\r\n\t\t\tb = 2 * (v0 + v2) - 4 * v1,\r\n\t\t\tc = v1 - v0,\r\n\t\t\tcount = Numerical.solveQuadratic(a, b, c, roots,\r\n\t\t\t\t\t0.00001),\r\n\t\t\ttMin = 0.00001,\r\n\t\t\ttMax = 1 - tMin;\r\n\t\tadd(v3, 0);\r\n\t\tfor (var j = 0; j < count; j++) {\r\n\t\t\tvar t = roots[j],\r\n\t\t\t\tu = 1 - t;\r\n\t\t\tif (tMin < t && t < tMax)\r\n\t\t\t\tadd(u * u * u * v0\r\n\t\t\t\t\t+ 3 * u * u * t * v1\r\n\t\t\t\t\t+ 3 * u * t * t * v2\r\n\t\t\t\t\t+ t * t * t * v3,\r\n\t\t\t\t\tpadding);\r\n\t\t}\r\n\t},\r\n\r\n\t_addIntersections: function(v1, v2, curve, locations) {\r\n\t\tvar bounds1 = Curve.getBounds(v1),\r\n\t\t\tbounds2 = Curve.getBounds(v2);\r\n\t\tif (bounds1.touches(bounds2)) {\r\n\t\t\tif (Curve.isFlatEnough(v1, 0.00001)\r\n\t\t\t\t\t&& Curve.isFlatEnough(v2, 0.00001)) {\r\n\t\t\t\tvar point = new Line(v1[0], v1[1], v1[6], v1[7], false)\r\n\t\t\t\t\t\t.intersect(new Line(v2[0], v2[1], v2[6], v2[7], false),\r\n\t\t\t\t\t\t\ttrue, false);\r\n\t\t\t\tif (point)\r\n\t\t\t\t\tlocations.push(new CurveLocation(curve, null, point));\r\n\t\t\t} else {\r\n\t\t\t\tvar v1s = Curve.subdivide(v1),\r\n\t\t\t\t\tv2s = Curve.subdivide(v2);\r\n\t\t\t\tfor (var i = 0; i < 2; i++)\r\n\t\t\t\t\tfor (var j = 0; j < 2; j++)\r\n\t\t\t\t\t\tthis._addIntersections(v1s[i], v2s[j], curve, locations);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn locations;\r\n\t}\r\n}}, Base.each(['getBounds', 'getStrokeBounds', 'getHandleBounds', 'getRoughBounds'],\r\n\tfunction(name) {\r\n\t\tthis[name] = function() {\r\n\t\t\tif (!this._bounds)\r\n\t\t\t\tthis._bounds = {};\r\n\t\t\tvar bounds = this._bounds[name];\r\n\t\t\tif (!bounds) {\r\n\t\t\t\tbounds = this._bounds[name] = Path[name](\r\n\t\t\t\t\t[this._segment1, this._segment2], false, this._path._style);\r\n\t\t\t}\r\n\t\t\treturn bounds.clone();\r\n\t\t};\r\n\t},\r\n{\r\n\r\n}), Base.each(['getPoint', 'getTangent', 'getNormal'],\r\n\tfunction(name, index) {\r\n\t\tthis[name + 'At'] = function(offset, isParameter) {\r\n\t\t\treturn Curve.evaluate(this.getValues(), offset, isParameter, index);\r\n\t\t};\r\n\t\tthis[name] = function(parameter) {\r\n\t\t\treturn Curve.evaluate(this.getValues(), parameter, true, index);\r\n\t\t};\r\n\t},\r\n{\r\n\tgetParameterAt: function(offset, start) {\r\n\t\treturn Curve.getParameterAt(this.getValues(), offset,\r\n\t\t\t\tstart !== undefined ? start : offset < 0 ? 1 : 0);\r\n\t},\r\n\r\n\tgetParameterOf: function(point) {\r\n\t\tpoint = Point.read(arguments);\r\n\t\treturn Curve.getParameterOf(this.getValues(), point.x, point.y);\r\n\t},\r\n\r\n\tgetLocationAt: function(offset, isParameter) {\r\n\t\tif (!isParameter)\r\n\t\t\toffset = this.getParameterAt(offset);\r\n\t\treturn new CurveLocation(this, offset);\r\n\t},\r\n\r\n\tgetLocationOf: function(point) {\r\n\t\tvar t = this.getParameterOf.apply(this, arguments);\r\n\t\treturn t != null ? new CurveLocation(this, t) : null;\r\n\t}\r\n\r\n}),\r\nnew function() {\r\n\r\n\tfunction getLengthIntegrand(v) {\r\n\t\tvar p1x = v[0], p1y = v[1],\r\n\t\t\tc1x = v[2], c1y = v[3],\r\n\t\t\tc2x = v[4], c2y = v[5],\r\n\t\t\tp2x = v[6], p2y = v[7],\r\n\r\n\t\t\tax = 9 * (c1x - c2x) + 3 * (p2x - p1x),\r\n\t\t\tbx = 6 * (p1x + c2x) - 12 * c1x,\r\n\t\t\tcx = 3 * (c1x - p1x),\r\n\r\n\t\t\tay = 9 * (c1y - c2y) + 3 * (p2y - p1y),\r\n\t\t\tby = 6 * (p1y + c2y) - 12 * c1y,\r\n\t\t\tcy = 3 * (c1y - p1y);\r\n\r\n\t\treturn function(t) {\r\n\t\t\tvar dx = (ax * t + bx) * t + cx,\r\n\t\t\t\tdy = (ay * t + by) * t + cy;\r\n\t\t\treturn Math.sqrt(dx * dx + dy * dy);\r\n\t\t};\r\n\t}\r\n\r\n\tfunction getIterations(a, b) {\r\n\t\treturn Math.max(2, Math.min(16, Math.ceil(Math.abs(b - a) * 32)));\r\n\t}\r\n\r\n\treturn {\r\n\t\tstatics: true,\r\n\r\n\t\tgetLength: function(v, a, b) {\r\n\t\t\tif (a === undefined)\r\n\t\t\t\ta = 0;\r\n\t\t\tif (b === undefined)\r\n\t\t\t\tb = 1;\r\n\t\t\tif (v[0] == v[2] && v[1] == v[3] && v[6] == v[4] && v[7] == v[5]) {\r\n\t\t\t\tvar dx = v[6] - v[0],\r\n\t\t\t\t\tdy = v[7] - v[1];\r\n\t\t\t\treturn (b - a) * Math.sqrt(dx * dx + dy * dy);\r\n\t\t\t}\r\n\t\t\tvar ds = getLengthIntegrand(v);\r\n\t\t\treturn Numerical.integrate(ds, a, b, getIterations(a, b));\r\n\t\t},\r\n\r\n\t\tgetParameterAt: function(v, offset, start) {\r\n\t\t\tif (offset == 0)\r\n\t\t\t\treturn start;\r\n\t\t\tvar forward = offset > 0,\r\n\t\t\t\ta = forward ? start : 0,\r\n\t\t\t\tb = forward ? 1 : start,\r\n\t\t\t\toffset = Math.abs(offset),\r\n\t\t\t\tds = getLengthIntegrand(v),\r\n\t\t\t\trangeLength = Numerical.integrate(ds, a, b,\r\n\t\t\t\t\t\tgetIterations(a, b));\r\n\t\t\tif (offset >= rangeLength)\r\n\t\t\t\treturn forward ? b : a;\r\n\t\t\tvar guess = offset / rangeLength,\r\n\t\t\t\tlength = 0;\r\n\t\t\tfunction f(t) {\r\n\t\t\t\tvar count = getIterations(start, t);\r\n\t\t\t\tlength += start < t\r\n\t\t\t\t\t\t? Numerical.integrate(ds, start, t, count)\r\n\t\t\t\t\t\t: -Numerical.integrate(ds, t, start, count);\r\n\t\t\t\tstart = t;\r\n\t\t\t\treturn length - offset;\r\n\t\t\t}\r\n\t\t\treturn Numerical.findRoot(f, ds,\r\n\t\t\t\t\tforward ? a + guess : b - guess,\r\n\t\t\t\t\ta, b, 16, 0.00001);\r\n\t\t}\r\n\t};\r\n}, new function() {\r\n\r\n\tvar maxDepth = 32,\r\n\t\tepsilon = Math.pow(2, -maxDepth - 1);\r\n\r\n\tvar zCubic = [\r\n\t\t[1.0, 0.6, 0.3, 0.1],\r\n\t\t[0.4, 0.6, 0.6, 0.4],\r\n\t\t[0.1, 0.3, 0.6, 1.0]\r\n\t];\r\n\r\n\tvar xAxis = new Line(new Point(0, 0), new Point(1, 0));\r\n\r\n\tfunction toBezierForm(v, point) {\r\n\t\tvar n = 3,\r\n\t\t\tdegree = 5,\r\n\t\t\tc = [],\r\n\t\t\td = [],\r\n\t\t\tcd = [],\r\n\t\t\tw = [];\r\n\t\tfor(var i = 0; i <= n; i++) {\r\n\t\t\tc[i] = v[i].subtract(point);\r\n\t\t\tif (i < n)\r\n\t\t\t\td[i] = v[i + 1].subtract(v[i]).multiply(n);\r\n\t\t}\r\n\r\n\t\tfor (var row = 0; row < n; row++) {\r\n\t\t\tcd[row] = [];\r\n\t\t\tfor (var column = 0; column <= n; column++)\r\n\t\t\t\tcd[row][column] = d[row].dot(c[column]);\r\n\t\t}\r\n\r\n\t\tfor (var i = 0; i <= degree; i++)\r\n\t\t\tw[i] = new Point(i / degree, 0);\r\n\r\n\t\tfor (var k = 0; k <= degree; k++) {\r\n\t\t\tvar lb = Math.max(0, k - n + 1),\r\n\t\t\t\tub = Math.min(k, n);\r\n\t\t\tfor (var i = lb; i <= ub; i++) {\r\n\t\t\t\tvar j = k - i;\r\n\t\t\t\tw[k].y += cd[j][i] * zCubic[j][i];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn w;\r\n\t}\r\n\r\n\tfunction findRoots(w, depth) {\r\n\t\tswitch (countCrossings(w)) {\r\n\t\tcase 0:\r\n\t\t\treturn [];\r\n\t\tcase 1:\r\n\t\t\tif (depth >= maxDepth)\r\n\t\t\t\treturn [0.5 * (w[0].x + w[5].x)];\r\n\t\t\tif (isFlatEnough(w)) {\r\n\t\t\t\tvar line = new Line(w[0], w[5], true);\r\n\t\t\t\treturn [ Numerical.isZero(line.vector.getLength(true))\r\n\t\t\t\t\t\t? line.point.x\r\n\t\t\t\t\t\t: xAxis.intersect(line).x ];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar p = [[]],\r\n\t\t\tleft = [],\r\n\t\t\tright = [];\r\n\t\tfor (var j = 0; j <= 5; j++)\r\n\t\t \tp[0][j] = new Point(w[j]);\r\n\r\n\t\tfor (var i = 1; i <= 5; i++) {\r\n\t\t\tp[i] = [];\r\n\t\t\tfor (var j = 0 ; j <= 5 - i; j++)\r\n\t\t\t\tp[i][j] = p[i - 1][j].add(p[i - 1][j + 1]).multiply(0.5);\r\n\t\t}\r\n\t\tfor (var j = 0; j <= 5; j++) {\r\n\t\t\tleft[j]  = p[j][0];\r\n\t\t\tright[j] = p[5 - j][j];\r\n\t\t}\r\n\r\n\t\treturn findRoots(left, depth + 1).concat(findRoots(right, depth + 1));\r\n\t}\r\n\r\n\tfunction countCrossings(v) {\r\n\t\tvar crossings = 0,\r\n\t\t\tprevSign = null;\r\n\t\tfor (var i = 0, l = v.length; i < l; i++)  {\r\n\t\t\tvar sign = v[i].y < 0 ? -1 : 1;\r\n\t\t\tif (prevSign != null && sign != prevSign)\r\n\t\t\t\tcrossings++;\r\n\t\t\tprevSign = sign;\r\n\t\t}\r\n\t\treturn crossings;\r\n\t}\r\n\r\n\tfunction isFlatEnough(v) {\r\n\r\n\t\tvar n = v.length - 1,\r\n\t\t\ta = v[0].y - v[n].y,\r\n\t\t\tb = v[n].x - v[0].x,\r\n\t\t\tc = v[0].x * v[n].y - v[n].x * v[0].y,\r\n\t\t\tmaxAbove = 0,\r\n\t\t\tmaxBelow = 0;\r\n\t\tfor (var i = 1; i < n; i++) {\r\n\t\t\tvar val = a * v[i].x + b * v[i].y + c,\r\n\t\t\t\tdist = val * val;\r\n\t\t\tif (val < 0 && dist > maxBelow) {\r\n\t\t\t\tmaxBelow = dist;\r\n\t\t\t} else if (dist > maxAbove) {\r\n\t\t\t\tmaxAbove = dist;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn Math.abs((maxAbove + maxBelow) / (2 * a * (a * a + b * b)))\r\n\t\t\t\t< epsilon;\r\n\t}\r\n\r\n\treturn {\r\n\t\tgetNearestLocation: function(point) {\r\n\t\t\tvar w = toBezierForm(this.getPoints(), point);\r\n\t\t\tvar roots = findRoots(w, 0).concat([0, 1]);\r\n\t\t\tvar minDist = Infinity,\r\n\t\t\t\tminT,\r\n\t\t\t\tminPoint;\r\n\t\t\tfor (var i = 0; i < roots.length; i++) {\r\n\t\t\t\tvar pt = this.getPointAt(roots[i], true),\r\n\t\t\t\t\tdist = point.getDistance(pt, true);\r\n\t\t\t\tif (dist < minDist) {\r\n\t\t\t\t\tminDist = dist;\r\n\t\t\t\t\tminT = roots[i];\r\n\t\t\t\t\tminPoint = pt;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn new CurveLocation(this, minT, minPoint, Math.sqrt(minDist));\r\n\t\t},\r\n\r\n\t\tgetNearestPoint: function(point) {\r\n\t\t\treturn this.getNearestLocation(point).getPoint();\r\n\t\t}\r\n\t};\r\n});\r\n\r\nvar CurveLocation = this.CurveLocation = Base.extend({\r\n\tinitialize: function(curve, parameter, point, distance) {\r\n\t\tthis._curve = curve;\r\n\t\tthis._segment1 = curve._segment1;\r\n\t\tthis._segment2 = curve._segment2;\r\n\t\tthis._parameter = parameter;\r\n\t\tthis._point = point;\r\n\t\tthis._distance = distance;\r\n\t},\r\n\r\n\tgetSegment: function() {\r\n\t\tif (!this._segment) {\r\n\t\t\tvar curve = this.getCurve(),\r\n\t\t\t\tparameter = this.getParameter();\r\n\t\t\tif (parameter == 0) {\r\n\t\t\t\tthis._segment = curve._segment1;\r\n\t\t\t} else if (parameter == 1) {\r\n\t\t\t\tthis._segment = curve._segment2;\r\n\t\t\t} else if (parameter == null) {\r\n\t\t\t\treturn null;\r\n\t\t\t} else {\r\n\t\t\t\tthis._segment = curve.getLength(0, parameter)\r\n\t\t\t\t\t< curve.getLength(parameter, 1)\r\n\t\t\t\t\t\t? curve._segment1\r\n\t\t\t\t\t\t: curve._segment2;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._segment;\r\n\t},\r\n\r\n\tgetCurve: function() {\r\n\t\tif (!this._curve || arguments[0]) {\r\n\t\t\tthis._curve = this._segment1.getCurve();\r\n\t\t\tif (this._curve.getParameterOf(this._point) == null)\r\n\t\t\t\tthis._curve = this._segment2.getPrevious().getCurve();\r\n\t\t}\r\n\t\treturn this._curve;\r\n\t},\r\n\r\n\tgetPath: function() {\r\n\t\tvar curve = this.getCurve();\r\n\t\treturn curve && curve._path;\r\n\t},\r\n\r\n\tgetIndex: function() {\r\n\t\tvar curve = this.getCurve();\r\n\t\treturn curve && curve.getIndex();\r\n\t},\r\n\r\n\tgetOffset: function() {\r\n\t\tvar path = this.getPath();\r\n\t\treturn path && path._getOffset(this);\r\n\t},\r\n\r\n\tgetCurveOffset: function() {\r\n\t\tvar curve = this.getCurve(),\r\n\t\t\tparameter = this.getParameter();\r\n\t\treturn parameter != null && curve && curve.getLength(0, parameter);\r\n\t},\r\n\r\n\tgetParameter: function() {\r\n\t\tif ((this._parameter == null || arguments[0]) && this._point) {\r\n\t\t\tvar curve = this.getCurve(arguments[0] && this._point);\r\n\t\t\tthis._parameter = curve && curve.getParameterOf(this._point);\r\n\t\t}\r\n\t\treturn this._parameter;\r\n\t},\r\n\r\n\tgetPoint: function() {\r\n\t\tif (!this._point && this._parameter != null) {\r\n\t\t\tvar curve = this.getCurve();\r\n\t\t\tthis._point = curve && curve.getPointAt(this._parameter, true);\r\n\t\t}\r\n\t\treturn this._point;\r\n\t},\r\n\r\n\tgetTangent: function() {\r\n\t\tvar parameter = this.getParameter(),\r\n\t\t\tcurve = this.getCurve();\r\n\t\treturn parameter != null && curve && curve.getTangentAt(parameter, true);\r\n\t},\r\n\r\n\tgetNormal: function() {\r\n\t\tvar parameter = this.getParameter(),\r\n\t\t\tcurve = this.getCurve();\r\n\t\treturn parameter != null && curve && curve.getNormalAt(parameter, true);\r\n\t},\r\n\r\n\tgetDistance: function() {\r\n\t\treturn this._distance;\r\n\t},\r\n\r\n\tdivide: function() {\r\n\t\tvar curve = this.getCurve(true);\r\n\t\treturn curve && curve.divide(this.getParameter(true));\r\n\t},\r\n\r\n\tsplit: function() {\r\n\t\tvar curve = this.getCurve(true);\r\n\t\treturn curve && curve.split(this.getParameter(true));\r\n\t},\r\n\r\n\ttoString: function() {\r\n\t\tvar parts = [],\r\n\t\t\tpoint = this.getPoint(),\r\n\t\t\tf = Formatter.instance;\r\n\t\tif (point)\r\n\t\t\tparts.push('point: ' + point);\r\n\t\tvar index = this.getIndex();\r\n\t\tif (index != null)\r\n\t\t\tparts.push('index: ' + index);\r\n\t\tvar parameter = this.getParameter();\r\n\t\tif (parameter != null)\r\n\t\t\tparts.push('parameter: ' + f.number(parameter));\r\n\t\tif (this._distance != null)\r\n\t\t\tparts.push('distance: ' + f.number(this._distance));\r\n\t\treturn '{ ' + parts.join(', ') + ' }';\r\n\t}\r\n});\r\n\r\nvar PathItem = this.PathItem = Item.extend({\r\n\r\n\tgetIntersections: function(path) {\r\n\t\tif (!this.getBounds().touches(path.getBounds()))\r\n\t\t\treturn [];\r\n\t\tvar locations = [],\r\n\t\t\tcurves1 = this.getCurves(),\r\n\t\t\tcurves2 = path.getCurves(),\r\n\t\t\tlength2 = curves2.length,\r\n\t\t\tvalues2 = [];\r\n\t\tfor (var i = 0; i < length2; i++)\r\n\t\t\tvalues2[i] = curves2[i].getValues();\r\n\t\tfor (var i = 0, l = curves1.length; i < l; i++) {\r\n\t\t\tvar curve = curves1[i],\r\n\t\t\t\tvalues1 = curve.getValues();\r\n\t\t\tfor (var j = 0; j < length2; j++)\r\n\t\t\t\tCurve._addIntersections(values1, values2[j], curve, locations);\r\n\t\t}\r\n\t\treturn locations;\r\n\t},\r\n\r\n\tsetPathData: function(data) {\r\n\r\n\t\tvar parts = data.match(/[a-z][^a-z]*/ig),\r\n\t\t\tcoords,\r\n\t\t\trelative = false,\r\n\t\t\tcontrol,\r\n\t\t\tcurrent = new Point();\r\n\r\n\t\tfunction getCoord(index, coord, update) {\r\n\t\t\tvar val = parseFloat(coords[index]);\r\n\t\t\tif (relative)\r\n\t\t\t\tval += current[coord];\r\n\t\t\tif (update)\r\n\t\t\t\tcurrent[coord] = val;\r\n\t\t\treturn val;\r\n\t\t}\r\n\r\n\t\tfunction getPoint(index, update) {\r\n\t\t\treturn new Point(\r\n\t\t\t\tgetCoord(index, 'x', update),\r\n\t\t\t\tgetCoord(index + 1, 'y', update)\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif (this._type === 'path')\r\n\t\t\tthis.removeSegments();\r\n\t\telse\r\n\t\t\tthis.removeChildren();\r\n\r\n\t\tfor (var i = 0, l = parts.length; i < l; i++) {\r\n\t\t\tvar part = parts[i];\r\n\t\t\t\tcmd = part[0],\r\n\t\t\t\tlower = cmd.toLowerCase();\r\n\t\t\tcoords = part.slice(1).trim().split(/[\\s,]+|(?=[+-])/);\r\n\t\t\trelative = cmd === lower;\r\n\t\t\tswitch (lower) {\r\n\t\t\tcase 'm':\r\n\t\t\tcase 'l':\r\n\t\t\t\tfor (var j = 0; j < coords.length; j += 2)\r\n\t\t\t\t\tthis[j === 0 && lower === 'm' ? 'moveTo' : 'lineTo'](\r\n\t\t\t\t\t\t\tgetPoint(j, true));\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'h':\r\n\t\t\tcase 'v':\r\n\t\t\t\tvar coord = lower == 'h' ? 'x' : 'y';\r\n\t\t\t\tfor (var j = 0; j < coords.length; j++) {\r\n\t\t\t\t\tgetCoord(j, coord, true);\r\n\t\t\t\t\tthis.lineTo(current);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'c':\r\n\t\t\t\tthis.cubicCurveTo(\r\n\t\t\t\t\t\tgetPoint(0),\r\n\t\t\t\t\t\tcontrol = getPoint(2),\r\n\t\t\t\t\t\tgetPoint(4, true));\r\n\t\t\t\tbreak;\r\n\t\t\tcase 's':\r\n\t\t\t\tthis.cubicCurveTo(\r\n\t\t\t\t\t\tcurrent.multiply(2).subtract(control),\r\n\t\t\t\t\t\tcontrol = getPoint(0),\r\n\t\t\t\t\t\tgetPoint(2, true));\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'q':\r\n\t\t\t\tthis.quadraticCurveTo(\r\n\t\t\t\t\t\tcontrol = getPoint(0),\r\n\t\t\t\t\t\tgetPoint(2, true));\r\n\t\t\t\tbreak;\r\n\t\t\tcase 't':\r\n\t\t\t\tfor (var j = 0; j < coords.length; j += 2) {\r\n\t\t\t\t\tthis.quadraticCurveTo(\r\n\t\t\t\t\t\t\tcontrol = current.multiply(2).subtract(control),\r\n\t\t\t\t\t\t\tgetPoint(j, true));\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'a':\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'z':\r\n\t\t\t\tthis.closePath();\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n});\r\n\r\nvar Path = this.Path = PathItem.extend({\r\n\t_class: 'Path',\r\n\t_serializeFields: {\r\n\t\tsegments: [],\r\n\t\tclosed: false\r\n\t},\r\n\r\n\tinitialize: function(arg) {\r\n\t\tthis._closed = false;\r\n\t\tthis._segments = [];\r\n\t\tthis.base();\r\n\t\tvar segments = Array.isArray(arg)\r\n\t\t\t? typeof arg[0] === 'object'\r\n\t\t\t\t? arg\r\n\t\t\t\t: arguments\r\n\t\t\t: arg && (arg.point !== undefined || arg.x !== undefined)\r\n\t\t\t\t? arguments\r\n\t\t\t\t: null;\r\n\t\tthis.setSegments(segments || []);\r\n\t\tif (arg && !segments)\r\n\t\t\tthis._set(arg);\r\n\t},\r\n\r\n\tclone: function() {\r\n\t\tvar copy = this._clone(new Path(this._segments));\r\n\t\tcopy._closed = this._closed;\r\n\t\tif (this._clockwise !== undefined)\r\n\t\t\tcopy._clockwise = this._clockwise;\r\n\t\treturn copy;\r\n\t},\r\n\r\n\t_changed: function(flags) {\r\n\t\tItem.prototype._changed.call(this, flags);\r\n\t\tif (flags & 4) {\r\n\t\t\tdelete this._length;\r\n\t\t\tdelete this._clockwise;\r\n\t\t\tif (this._curves) {\r\n\t\t\t\tfor (var i = 0, l = this._curves.length; i < l; i++) {\r\n\t\t\t\t\tthis._curves[i]._changed(5);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if (flags & 8) {\r\n\t\t\tdelete this._bounds;\r\n\t\t}\r\n\t},\r\n\r\n\tgetSegments: function() {\r\n\t\treturn this._segments;\r\n\t},\r\n\r\n\tsetSegments: function(segments) {\r\n\t\tthis._selectedSegmentState = 0;\r\n\t\tthis._segments.length = 0;\r\n\t\tdelete this._curves;\r\n\t\tthis._add(Segment.readAll(segments));\r\n\t},\r\n\r\n\tgetFirstSegment: function() {\r\n\t\treturn this._segments[0];\r\n\t},\r\n\r\n\tgetLastSegment: function() {\r\n\t\treturn this._segments[this._segments.length - 1];\r\n\t},\r\n\r\n\tgetCurves: function() {\r\n\t\tvar curves = this._curves,\r\n\t\t\tsegments = this._segments;\r\n\t\tif (!curves) {\r\n\t\t\tvar length = this._countCurves();\r\n\t\t\tcurves = this._curves = new Array(length);\r\n\t\t\tfor (var i = 0; i < length; i++)\r\n\t\t\t\tcurves[i] = Curve.create(this, segments[i],\r\n\t\t\t\t\tsegments[i + 1] || segments[0]);\r\n\t\t}\r\n\t\treturn curves;\r\n\t},\r\n\r\n\tgetFirstCurve: function() {\r\n\t\treturn this.getCurves()[0];\r\n\t},\r\n\r\n\tgetLastCurve: function() {\r\n\t\tvar curves = this.getCurves();\r\n\t\treturn curves[curves.length - 1];\r\n\t},\r\n\r\n\tgetPathData: function() {\r\n\t\tvar segments = this._segments,\r\n\t\t\tstyle = this._style,\r\n\t\t\tprecision = arguments[0],\r\n\t\t\tf = Formatter.instance,\r\n\t\t\tparts = [];\r\n\r\n\t\tfunction addCurve(seg1, seg2, skipLine) {\r\n\t\t\tvar point1 = seg1._point,\r\n\t\t\t\tpoint2 = seg2._point,\r\n\t\t\t\thandle1 = seg1._handleOut,\r\n\t\t\t\thandle2 = seg2._handleIn;\r\n\t\t\tif (handle1.isZero() && handle2.isZero()) {\r\n\t\t\t\tif (!skipLine) {\r\n\t\t\t\t\tparts.push('L' + f.point(point2, precision));\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvar end = point2.subtract(point1);\r\n\t\t\t\tparts.push('c' + f.point(handle1, precision)\r\n\t\t\t\t\t\t+ ' ' + f.point(end.add(handle2), precision)\r\n\t\t\t\t\t\t+ ' ' + f.point(end, precision));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (segments.length === 0)\r\n\t\t\treturn '';\r\n\t\tparts.push('M' + f.point(segments[0]._point));\r\n\t\tfor (i = 0, l = segments.length  - 1; i < l; i++)\r\n\t\t\taddCurve(segments[i], segments[i + 1], false);\r\n\t\tif (this._closed && style._strokeColor || style._fillColor)\r\n\t\t\taddCurve(segments[segments.length - 1], segments[0], true);\r\n\t\tif (this._closed)\r\n\t\t\tparts.push('z');\r\n\t\treturn parts.join('');\r\n\t},\r\n\r\n\tisClosed: function() {\r\n\t\treturn this._closed;\r\n\t},\r\n\r\n\tsetClosed: function(closed) {\r\n\t\tif (this._closed != (closed = !!closed)) {\r\n\t\t\tthis._closed = closed;\r\n\t\t\tif (this._curves) {\r\n\t\t\t\tvar length = this._curves.length = this._countCurves();\r\n\t\t\t\tif (closed)\r\n\t\t\t\t\tthis._curves[length - 1] = Curve.create(this,\r\n\t\t\t\t\t\tthis._segments[length - 1], this._segments[0]);\r\n\t\t\t}\r\n\t\t\tthis._changed(5);\r\n\t\t}\r\n\t},\r\n\r\n\tisEmpty: function() {\r\n\t\treturn this._segments.length === 0;\r\n\t},\r\n\r\n\tisPolygon: function() {\r\n\t\tfor (var i = 0, l = this._segments.length; i < l; i++) {\r\n\t\t\tif (!this._segments[i].isLinear())\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\r\n\tapplyMatrix: true,\r\n\r\n\t_applyMatrix: function(matrix) {\r\n\t\tvar coords = new Array(6);\r\n\t\tfor (var i = 0, l = this._segments.length; i < l; i++) {\r\n\t\t\tthis._segments[i]._transformCoordinates(matrix, coords, true);\r\n\t\t}\r\n\t\tvar style = this._style,\r\n\t\t\tfillColor = style._fillColor,\r\n\t\t\tstrokeColor = style._strokeColor;\r\n\t\tif (fillColor && fillColor._type === 'gradient')\r\n\t\t\tfillColor.transform(matrix);\r\n\t\tif (strokeColor && strokeColor._type === 'gradient')\r\n\t\t\tstrokeColor.transform(matrix);\r\n\t\treturn true;\r\n\t},\r\n\r\n\t_add: function(segs, index) {\r\n\t\tvar segments = this._segments,\r\n\t\t\tcurves = this._curves,\r\n\t\t\tamount = segs.length,\r\n\t\t\tappend = index == null,\r\n\t\t\tindex = append ? segments.length : index,\r\n\t\t\tfullySelected = this.isFullySelected();\r\n\t\tfor (var i = 0; i < amount; i++) {\r\n\t\t\tvar segment = segs[i];\r\n\t\t\tif (segment._path)\r\n\t\t\t\tsegment = segs[i] = segment.clone();\r\n\t\t\tsegment._path = this;\r\n\t\t\tsegment._index = index + i;\r\n\t\t\tif (fullySelected)\r\n\t\t\t\tsegment._selectionState = 4;\r\n\t\t\tif (segment._selectionState)\r\n\t\t\t\tthis._updateSelection(segment, 0, segment._selectionState);\r\n\t\t}\r\n\t\tif (append) {\r\n\t\t\tsegments.push.apply(segments, segs);\r\n\t\t} else {\r\n\t\t\tsegments.splice.apply(segments, [index, 0].concat(segs));\r\n\t\t\tfor (var i = index + amount, l = segments.length; i < l; i++)\r\n\t\t\t\tsegments[i]._index = i;\r\n\t\t}\r\n\t\tif (curves || segs._curves) {\r\n\t\t\tif (!curves)\r\n\t\t\t\tcurves = this._curves = [];\r\n\t\t\tvar from = index > 0 ? index - 1 : index,\r\n\t\t\t\tstart = from,\r\n\t\t\t\tto = Math.min(from + amount, this._countCurves());\r\n\t\t\tif (segs._curves) {\r\n\t\t\t\tcurves.splice.apply(curves, [from, 0].concat(segs._curves));\r\n\t\t\t\tstart += segs._curves.length;\r\n\t\t\t}\r\n\t\t\tfor (var i = start; i < to; i++)\r\n\t\t\t\tcurves.splice(i, 0, Base.create(Curve));\r\n\t\t\tthis._adjustCurves(from, to);\r\n\t\t}\r\n\t\tthis._changed(5);\r\n\t\treturn segs;\r\n\t},\r\n\r\n\t_adjustCurves: function(from, to) {\r\n\t\tvar segments = this._segments,\r\n\t\t\tcurves = this._curves,\r\n\t\t\tcurve;\r\n\t\tfor (var i = from; i < to; i++) {\r\n\t\t\tcurve = curves[i];\r\n\t\t\tcurve._path = this;\r\n\t\t\tcurve._segment1 = segments[i];\r\n\t\t\tcurve._segment2 = segments[i + 1] || segments[0];\r\n\t\t}\r\n\t\tif (curve = curves[this._closed && from === 0 ? segments.length - 1\r\n\t\t\t\t: from - 1])\r\n\t\t\tcurve._segment2 = segments[from] || segments[0];\r\n\t\tif (curve = curves[to])\r\n\t\t\tcurve._segment1 = segments[to];\r\n\t},\r\n\r\n\t_countCurves: function() {\r\n\t\tvar length = this._segments.length;\r\n\t\treturn !this._closed && length > 0 ? length - 1 : length;\r\n\t},\r\n\r\n\tadd: function(segment1 ) {\r\n\t\treturn arguments.length > 1 && typeof segment1 !== 'number'\r\n\t\t\t? this._add(Segment.readAll(arguments))\r\n\t\t\t: this._add([ Segment.read(arguments) ])[0];\r\n\t},\r\n\r\n\tinsert: function(index, segment1 ) {\r\n\t\treturn arguments.length > 2 && typeof segment1 !== 'number'\r\n\t\t\t? this._add(Segment.readAll(arguments, 1), index)\r\n\t\t\t: this._add([ Segment.read(arguments, 1) ], index)[0];\r\n\t},\r\n\r\n\taddSegment: function(segment) {\r\n\t\treturn this._add([ Segment.read(arguments) ])[0];\r\n\t},\r\n\r\n\tinsertSegment: function(index, segment) {\r\n\t\treturn this._add([ Segment.read(arguments, 1) ], index)[0];\r\n\t},\r\n\r\n\taddSegments: function(segments) {\r\n\t\treturn this._add(Segment.readAll(segments));\r\n\t},\r\n\r\n\tinsertSegments: function(index, segments) {\r\n\t\treturn this._add(Segment.readAll(segments), index);\r\n\t},\r\n\r\n\tremoveSegment: function(index) {\r\n\t\treturn this.removeSegments(index, index + 1)[0] || null;\r\n\t},\r\n\r\n\tremoveSegments: function(from, to) {\r\n\t\tfrom = from || 0;\r\n\t\tto = Base.pick(to, this._segments.length);\r\n\t\tvar segments = this._segments,\r\n\t\t\tcurves = this._curves,\r\n\t\t\tcount = segments.length,\r\n\t\t\tremoved = segments.splice(from, to - from),\r\n\t\t\tamount = removed.length;\r\n\t\tif (!amount)\r\n\t\t\treturn removed;\r\n\t\tfor (var i = 0; i < amount; i++) {\r\n\t\t\tvar segment = removed[i];\r\n\t\t\tif (segment._selectionState)\r\n\t\t\t\tthis._updateSelection(segment, segment._selectionState, 0);\r\n\t\t\tdelete segment._index;\r\n\t\t\tdelete segment._path;\r\n\t\t}\r\n\t\tfor (var i = from, l = segments.length; i < l; i++)\r\n\t\t\tsegments[i]._index = i;\r\n\t\tif (curves) {\r\n\t\t\tvar index = to == count + (this._closed ? 1 : 0) ? from - 1 : from,\r\n\t\t\t\tcurves = curves.splice(index, amount);\r\n\t\t\tif (arguments[2])\r\n\t\t\t\tremoved._curves = curves.slice(1);\r\n\t\t\tthis._adjustCurves(index, index);\r\n\t\t}\r\n\t\tthis._changed(5);\r\n\t\treturn removed;\r\n\t},\r\n\r\n\tisFullySelected: function() {\r\n\t\treturn this._selected && this._selectedSegmentState\r\n\t\t\t\t== this._segments.length * 4;\r\n\t},\r\n\r\n\tsetFullySelected: function(selected) {\r\n\t\tif (selected)\r\n\t\t\tthis._selectSegments(true);\r\n\t\tthis.setSelected(selected);\r\n\t},\r\n\r\n\tsetSelected: function(selected) {\r\n\t\tif (!selected)\r\n\t\t\tthis._selectSegments(false);\r\n\t\tthis.base(selected);\r\n\t},\r\n\r\n\t_selectSegments: function(selected) {\r\n\t\tvar length = this._segments.length;\r\n\t\tthis._selectedSegmentState = selected\r\n\t\t\t\t? length * 4 : 0;\r\n\t\tfor (var i = 0; i < length; i++)\r\n\t\t\tthis._segments[i]._selectionState = selected\r\n\t\t\t\t\t? 4 : 0;\r\n\t},\r\n\r\n\t_updateSelection: function(segment, oldState, newState) {\r\n\t\tsegment._selectionState = newState;\r\n\t\tvar total = this._selectedSegmentState += newState - oldState;\r\n\t\tif (total > 0)\r\n\t\t\tthis.setSelected(true);\r\n\t},\r\n\r\n\tflatten: function(maxDistance) {\r\n\t\tvar flattener = new PathFlattener(this),\r\n\t\t\tpos = 0,\r\n\t\t\tstep = flattener.length / Math.ceil(flattener.length / maxDistance),\r\n\t\t\tend = flattener.length + (this._closed ? -step : step) / 2;\r\n\t\tvar segments = [];\r\n\t\twhile (pos <= end) {\r\n\t\t\tsegments.push(new Segment(flattener.evaluate(pos, 0)));\r\n\t\t\tpos += step;\r\n\t\t}\r\n\t\tthis.setSegments(segments);\r\n\t},\r\n\r\n\tsimplify: function(tolerance) {\r\n\t\tif (this._segments.length > 2) {\r\n\t\t\tvar fitter = new PathFitter(this, tolerance || 2.5);\r\n\t\t\tthis.setSegments(fitter.fit());\r\n\t\t}\r\n\t},\r\n\r\n\tsplit: function(index, parameter) {\r\n\t\tif (parameter === null)\r\n\t\t\treturn;\r\n\t\tif (arguments.length == 1) {\r\n\t\t\tvar arg = index;\r\n\t\t\tif (typeof arg === 'number')\r\n\t\t\t\targ = this.getLocationAt(arg);\r\n\t\t\tindex = arg.index;\r\n\t\t\tparameter = arg.parameter;\r\n\t\t}\r\n\t\tif (parameter >= 1) {\r\n\t\t\tindex++;\r\n\t\t\tparameter--;\r\n\t\t}\r\n\t\tvar curves = this.getCurves();\r\n\t\tif (index >= 0 && index < curves.length) {\r\n\t\t\tif (parameter > 0) {\r\n\t\t\t\tcurves[index++].divide(parameter);\r\n\t\t\t}\r\n\t\t\tvar segs = this.removeSegments(index, this._segments.length, true),\r\n\t\t\t\tpath;\r\n\t\t\tif (this._closed) {\r\n\t\t\t\tthis.setClosed(false);\r\n\t\t\t\tpath = this;\r\n\t\t\t} else if (index > 0) {\r\n\t\t\t\tpath = this._clone(new Path().insertAbove(this, true));\r\n\t\t\t}\r\n\t\t\tpath._add(segs, 0);\r\n\t\t\tthis.addSegment(segs[0]);\r\n\t\t\treturn path;\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\r\n\tisClockwise: function() {\r\n\t\tif (this._clockwise !== undefined)\r\n\t\t\treturn this._clockwise;\r\n\t\tvar sum = 0,\r\n\t\t\txPre, yPre;\r\n\t\tfunction edge(x, y) {\r\n\t\t\tif (xPre !== undefined)\r\n\t\t\t\tsum += (xPre - x) * (y + yPre);\r\n\t\t\txPre = x;\r\n\t\t\tyPre = y;\r\n\t\t}\r\n\t\tfor (var i = 0, l = this._segments.length; i < l; i++) {\r\n\t\t\tvar seg1 = this._segments[i],\r\n\t\t\t\tseg2 = this._segments[i + 1 < l ? i + 1 : 0],\r\n\t\t\t\tpoint1 = seg1._point,\r\n\t\t\t\thandle1 = seg1._handleOut,\r\n\t\t\t\thandle2 = seg2._handleIn,\r\n\t\t\t\tpoint2 = seg2._point;\r\n\t\t\tedge(point1._x, point1._y);\r\n\t\t\tedge(point1._x + handle1._x, point1._y + handle1._y);\r\n\t\t\tedge(point2._x + handle2._x, point2._y + handle2._y);\r\n\t\t\tedge(point2._x, point2._y);\r\n\t\t}\r\n\t\treturn sum > 0;\r\n\t},\r\n\r\n\tsetClockwise: function(clockwise) {\r\n\t\tif (this.isClockwise() != (clockwise = !!clockwise)) {\r\n\t\t\tthis.reverse();\r\n\t\t}\r\n\t\tthis._clockwise = clockwise;\r\n\t},\r\n\r\n\treverse: function() {\r\n\t\tthis._segments.reverse();\r\n\t\tfor (var i = 0, l = this._segments.length; i < l; i++) {\r\n\t\t\tvar segment = this._segments[i];\r\n\t\t\tvar handleIn = segment._handleIn;\r\n\t\t\tsegment._handleIn = segment._handleOut;\r\n\t\t\tsegment._handleOut = handleIn;\r\n\t\t\tsegment._index = i;\r\n\t\t}\r\n\t\tif (this._clockwise !== undefined)\r\n\t\t\tthis._clockwise = !this._clockwise;\r\n\t},\r\n\r\n\tjoin: function(path) {\r\n\t\tif (path) {\r\n\t\t\tvar segments = path._segments,\r\n\t\t\t\tlast1 = this.getLastSegment(),\r\n\t\t\t\tlast2 = path.getLastSegment();\r\n\t\t\tif (last1._point.equals(last2._point))\r\n\t\t\t\tpath.reverse();\r\n\t\t\tvar first2 = path.getFirstSegment();\r\n\t\t\tif (last1._point.equals(first2._point)) {\r\n\t\t\t\tlast1.setHandleOut(first2._handleOut);\r\n\t\t\t\tthis._add(segments.slice(1));\r\n\t\t\t} else {\r\n\t\t\t\tvar first1 = this.getFirstSegment();\r\n\t\t\t\tif (first1._point.equals(first2._point))\r\n\t\t\t\t\tpath.reverse();\r\n\t\t\t\tlast2 = path.getLastSegment();\r\n\t\t\t\tif (first1._point.equals(last2._point)) {\r\n\t\t\t\t\tfirst1.setHandleIn(last2._handleIn);\r\n\t\t\t\t\tthis._add(segments.slice(0, segments.length - 1), 0);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._add(segments.slice());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tpath.remove();\r\n\t\t\tvar first1 = this.getFirstSegment();\r\n\t\t\tlast1 = this.getLastSegment();\r\n\t\t\tif (last1._point.equals(first1._point)) {\r\n\t\t\t\tfirst1.setHandleIn(last1._handleIn);\r\n\t\t\t\tlast1.remove();\r\n\t\t\t\tthis.setClosed(true);\r\n\t\t\t}\r\n\t\t\tthis._changed(5);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\treduce: function() {\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetLength: function() {\r\n\t\tif (this._length == null) {\r\n\t\t\tvar curves = this.getCurves();\r\n\t\t\tthis._length = 0;\r\n\t\t\tfor (var i = 0, l = curves.length; i < l; i++)\r\n\t\t\t\tthis._length += curves[i].getLength();\r\n\t\t}\r\n\t\treturn this._length;\r\n\t},\r\n\r\n\t_getOffset: function(location) {\r\n\t\tvar index = location && location.getIndex();\r\n\t\tif (index != null) {\r\n\t\t\tvar curves = this.getCurves(),\r\n\t\t\t\toffset = 0;\r\n\t\t\tfor (var i = 0; i < index; i++)\r\n\t\t\t\toffset += curves[i].getLength();\r\n\t\t\tvar curve = curves[index];\r\n\t\t\treturn offset + curve.getLength(0, location.getParameter());\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\r\n\tgetLocationOf: function(point) {\r\n\t\tpoint = Point.read(arguments);\r\n\t\tvar curves = this.getCurves();\r\n\t\tfor (var i = 0, l = curves.length; i < l; i++) {\r\n\t\t\tvar loc = curves[i].getLocationOf(point);\r\n\t\t\tif (loc)\r\n\t\t\t\treturn loc;\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\r\n\tgetLocationAt: function(offset, isParameter) {\r\n\t\tvar curves = this.getCurves(),\r\n\t\t\tlength = 0;\r\n\t\tif (isParameter) {\r\n\t\t\tvar index = ~~offset;\r\n\t\t\treturn curves[index].getLocationAt(offset - index, true);\r\n\t\t}\r\n\t\tfor (var i = 0, l = curves.length; i < l; i++) {\r\n\t\t\tvar start = length,\r\n\t\t\t\tcurve = curves[i];\r\n\t\t\tlength += curve.getLength();\r\n\t\t\tif (length >= offset) {\r\n\t\t\t\treturn curve.getLocationAt(offset - start);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (offset <= this.getLength())\r\n\t\t\treturn new CurveLocation(curves[curves.length - 1], 1);\r\n\t\treturn null;\r\n\t},\r\n\r\n\tgetPointAt: function(offset, isParameter) {\r\n\t\tvar loc = this.getLocationAt(offset, isParameter);\r\n\t\treturn loc && loc.getPoint();\r\n\t},\r\n\r\n\tgetTangentAt: function(offset, isParameter) {\r\n\t\tvar loc = this.getLocationAt(offset, isParameter);\r\n\t\treturn loc && loc.getTangent();\r\n\t},\r\n\r\n\tgetNormalAt: function(offset, isParameter) {\r\n\t\tvar loc = this.getLocationAt(offset, isParameter);\r\n\t\treturn loc && loc.getNormal();\r\n\t},\r\n\r\n\tgetNearestLocation: function(point) {\r\n\t\tvar curves = this.getCurves(),\r\n\t\t\tminDist = Infinity,\r\n\t\t\tminLoc = null;\r\n\t\tfor (var i = 0, l = curves.length; i < l; i++) {\r\n\t\t\tvar loc = curves[i].getNearestLocation(point);\r\n\t\t\tif (loc._distance < minDist) {\r\n\t\t\t\tminDist = loc._distance;\r\n\t\t\t\tminLoc = loc;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn minLoc;\r\n\t},\r\n\r\n\tgetNearestPoint: function(point) {\r\n\t\treturn this.getNearestLocation(point).getPoint();\r\n\t},\r\n\r\n\thasFill: function() {\r\n\t\treturn this._style._fillColor || this._parent instanceof CompoundPath\r\n\t\t\t\t&& this._parent._style._fillColor;\r\n\t},\r\n\r\n\tcontains: function(point) {\r\n\t\tpoint = Point.read(arguments);\r\n\t\tvar hasFill = this.hasFill();\r\n\t\tif (!this._closed && !hasFill\r\n\t\t\t\t|| !this.getRoughBounds()._containsPoint(point))\r\n\t\t\treturn false;\r\n\t\tvar curves = this.getCurves(),\r\n\t\t\tsegments = this._segments,\r\n\t\t\tcrossings = 0,\r\n\t\t\troots = new Array(3);\r\n\t\tfor (var i = 0, l = curves.length; i < l; i++)\r\n\t\t\tcrossings += curves[i].getCrossings(point, roots);\r\n\t\tif (!this._closed && hasFill)\r\n\t\t\tcrossings += Curve.create(this, segments[segments.length - 1],\r\n\t\t\t\t\tsegments[0]).getCrossings(point, roots);\r\n\t\treturn (crossings & 1) == 1;\r\n\t},\r\n\r\n\t_hitTest: function(point, options) {\r\n\t\tvar style = this._style,\r\n\t\t\ttolerance = options.tolerance || 0,\r\n\t\t\tradius = (options.stroke && style._strokeColor\r\n\t\t\t\t\t? style._strokeWidth / 2 : 0) + tolerance,\r\n\t\t\tloc,\r\n\t\t\tres;\r\n\t\tvar coords = [],\r\n\t\t\tthat = this;\r\n\t\tfunction checkPoint(seg, pt, name) {\r\n\t\t\tif (point.getDistance(pt) < tolerance)\r\n\t\t\t\treturn new HitResult(name, that, { segment: seg, point: pt });\r\n\t\t}\r\n\t\tfunction checkSegment(seg, ends) {\r\n\t\t\tvar point = seg._point;\r\n\t\t\treturn (ends || options.segments)\r\n\t\t\t\t\t&& checkPoint(seg, point, 'segment')\r\n\t\t\t\t|| (!ends && options.handles) && (\r\n\t\t\t\t\tcheckPoint(seg, point.add(seg._handleIn), 'handle-in') ||\r\n\t\t\t\t\tcheckPoint(seg, point.add(seg._handleOut), 'handle-out'));\r\n\t\t}\r\n\t\tif (options.ends && !options.segments && !this._closed) {\r\n\t\t\tif (res = checkSegment(this.getFirstSegment(), true)\r\n\t\t\t\t\t|| checkSegment(this.getLastSegment(), true))\r\n\t\t\t\treturn res;\r\n\t\t} else if (options.segments || options.handles) {\r\n\t\t\tfor (var i = 0, l = this._segments.length; i < l; i++) {\r\n\t\t\t\tif (res = checkSegment(this._segments[i]))\r\n\t\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (options.stroke && radius > 0)\r\n\t\t\tloc = this.getNearestLocation(point);\r\n\t\tif (!(loc && loc._distance <= radius) && options.fill\r\n\t\t\t\t&& this.hasFill() && this.contains(point))\r\n\t\t\treturn new HitResult('fill', this);\r\n\t\tif (!loc && options.stroke && radius > 0)\r\n\t\t\tloc = this.getNearestLocation(point);\r\n\t\tif (loc && loc._distance <= radius)\r\n\t\t\treturn options.stroke\r\n\t\t\t\t\t? new HitResult('stroke', this, { location: loc })\r\n\t\t\t\t\t: new HitResult('fill', this);\r\n\t}\r\n\r\n}, new function() {\r\n\r\n\tfunction drawHandles(ctx, segments, matrix, size) {\r\n\t\tvar half = size / 2;\r\n\r\n\t\tfunction drawHandle(index) {\r\n\t\t\tvar hX = coords[index],\r\n\t\t\t\thY = coords[index + 1];\r\n\t\t\tif (pX != hX || pY != hY) {\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.moveTo(pX, pY);\r\n\t\t\t\tctx.lineTo(hX, hY);\r\n\t\t\t\tctx.stroke();\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.arc(hX, hY, half, 0, Math.PI * 2, true);\r\n\t\t\t\tctx.fill();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar coords = new Array(6);\r\n\t\tfor (var i = 0, l = segments.length; i < l; i++) {\r\n\t\t\tvar segment = segments[i];\r\n\t\t\tsegment._transformCoordinates(matrix, coords, false);\r\n\t\t\tvar state = segment._selectionState,\r\n\t\t\t\tselected = state & 4,\r\n\t\t\t\tpX = coords[0],\r\n\t\t\t\tpY = coords[1];\r\n\t\t\tif (selected || (state & 1))\r\n\t\t\t\tdrawHandle(2);\r\n\t\t\tif (selected || (state & 2))\r\n\t\t\t\tdrawHandle(4);\r\n\t\t\tctx.save();\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.rect(pX - half, pY - half, size, size);\r\n\t\t\tctx.fill();\r\n\t\t\tif (!selected) {\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.rect(pX - half + 1, pY - half + 1, size - 2, size - 2);\r\n\t\t\t\tctx.fillStyle = '#ffffff';\r\n\t\t\t\tctx.fill();\r\n\t\t\t}\r\n\t\t\tctx.restore();\r\n\t\t}\r\n\t}\r\n\r\n\tfunction drawSegments(ctx, path, matrix) {\r\n\t\tvar segments = path._segments,\r\n\t\t\tlength = segments.length,\r\n\t\t\tcoords = new Array(6),\r\n\t\t\tfirst = true,\r\n\t\t\tcurX, curY,\r\n\t\t\tprevX, prevY,\r\n\t\t\tinX, inY,\r\n\t\t\toutX, outY;\r\n\r\n\t\tfunction drawSegment(i) {\r\n\t\t\tvar segment = segments[i];\r\n\t\t\tif (matrix) {\r\n\t\t\t\tsegment._transformCoordinates(matrix, coords, false);\r\n\t\t\t\tcurX = coords[0];\r\n\t\t\t\tcurY = coords[1];\r\n\t\t\t} else {\r\n\t\t\t\tvar point = segment._point;\r\n\t\t\t\tcurX = point._x;\r\n\t\t\t\tcurY = point._y;\r\n\t\t\t}\r\n\t\t\tif (first) {\r\n\t\t\t\tctx.moveTo(curX, curY);\r\n\t\t\t\tfirst = false;\r\n\t\t\t} else {\r\n\t\t\t\tif (matrix) {\r\n\t\t\t\t\tinX = coords[2];\r\n\t\t\t\t\tinY = coords[3];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar handle = segment._handleIn;\r\n\t\t\t\t\tinX = curX + handle._x;\r\n\t\t\t\t\tinY = curY + handle._y;\r\n\t\t\t\t}\r\n\t\t\t\tif (inX == curX && inY == curY && outX == prevX && outY == prevY) {\r\n\t\t\t\t\tctx.lineTo(curX, curY);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tctx.bezierCurveTo(outX, outY, inX, inY, curX, curY);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tprevX = curX;\r\n\t\t\tprevY = curY;\r\n\t\t\tif (matrix) {\r\n\t\t\t\toutX = coords[4];\r\n\t\t\t\toutY = coords[5];\r\n\t\t\t} else {\r\n\t\t\t\tvar handle = segment._handleOut;\r\n\t\t\t\toutX = prevX + handle._x;\r\n\t\t\t\toutY = prevY + handle._y;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (var i = 0; i < length; i++)\r\n\t\t\tdrawSegment(i);\r\n\t\tif (path._closed && length > 1)\r\n\t\t\tdrawSegment(0);\r\n\t}\r\n\r\n\treturn {\r\n\t\tdraw: function(ctx, param) {\r\n\t\t\tif (!param.compound)\r\n\t\t\t\tctx.beginPath();\r\n\r\n\t\t\tvar style = this._style,\r\n\t\t\t\tfillColor = style._fillColor,\r\n\t\t\t\tstrokeColor = style._strokeColor,\r\n\t\t\t\tdashArray = style._dashArray,\r\n\t\t\t\tdrawDash = !paper.support.nativeDash && strokeColor\r\n\t\t\t\t\t\t&& dashArray && dashArray.length;\r\n\r\n\t\t\tif (param.compound || param.clip || fillColor || strokeColor\r\n\t\t\t\t\t&& !drawDash)\r\n\t\t\t\tdrawSegments(ctx, this);\r\n\r\n\t\t\tif (this._closed)\r\n\t\t\t\tctx.closePath();\r\n\r\n\t\t\tif (!param.clip && !param.compound && (fillColor || strokeColor)) {\r\n\t\t\t\tthis._setStyles(ctx);\r\n\t\t\t\tif (fillColor)\r\n\t\t\t\t\tctx.fill();\r\n\t\t\t\tif (strokeColor) {\r\n\t\t\t\t\tif (drawDash) {\r\n\t\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\t\tvar flattener = new PathFlattener(this),\r\n\t\t\t\t\t\t\tfrom = style._dashOffset, to,\r\n\t\t\t\t\t\t\ti = 0;\r\n\t\t\t\t\t\twhile (from < flattener.length) {\r\n\t\t\t\t\t\t\tto = from + dashArray[(i++) % dashArray.length];\r\n\t\t\t\t\t\t\tflattener.drawPart(ctx, from, to);\r\n\t\t\t\t\t\t\tfrom = to + dashArray[(i++) % dashArray.length];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tctx.stroke();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tdrawSelected: function(ctx, matrix) {\r\n\t\t\tctx.beginPath();\r\n\t\t\tdrawSegments(ctx, this, matrix);\r\n\t\t\tctx.stroke();\r\n\t\t\tdrawHandles(ctx, this._segments, matrix,\r\n\t\t\t\t\tthis._project.options.handleSize || 4);\r\n\t\t}\r\n\t};\r\n}, new function() {\r\n\r\n\tfunction getFirstControlPoints(rhs) {\r\n\t\tvar n = rhs.length,\r\n\t\t\tx = [],\r\n\t\t\ttmp = [],\r\n\t\t\tb = 2;\r\n\t\tx[0] = rhs[0] / b;\r\n\t\tfor (var i = 1; i < n; i++) {\r\n\t\t\ttmp[i] = 1 / b;\r\n\t\t\tb = (i < n - 1 ? 4 : 2) - tmp[i];\r\n\t\t\tx[i] = (rhs[i] - x[i - 1]) / b;\r\n\t\t}\r\n\t\tfor (var i = 1; i < n; i++) {\r\n\t\t\tx[n - i - 1] -= tmp[n - i] * x[n - i];\r\n\t\t}\r\n\t\treturn x;\r\n\t}\r\n\r\n\treturn {\r\n\t\tsmooth: function() {\r\n\t\t\tvar segments = this._segments,\r\n\t\t\t\tsize = segments.length,\r\n\t\t\t\tn = size,\r\n\t\t\t\toverlap;\r\n\r\n\t\t\tif (size <= 2)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (this._closed) {\r\n\t\t\t\toverlap = Math.min(size, 4);\r\n\t\t\t\tn += Math.min(size, overlap) * 2;\r\n\t\t\t} else {\r\n\t\t\t\toverlap = 0;\r\n\t\t\t}\r\n\t\t\tvar knots = [];\r\n\t\t\tfor (var i = 0; i < size; i++)\r\n\t\t\t\tknots[i + overlap] = segments[i]._point;\r\n\t\t\tif (this._closed) {\r\n\t\t\t\tfor (var i = 0; i < overlap; i++) {\r\n\t\t\t\t\tknots[i] = segments[i + size - overlap]._point;\r\n\t\t\t\t\tknots[i + size + overlap] = segments[i]._point;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tn--;\r\n\t\t\t}\r\n\t\t\tvar rhs = [];\r\n\r\n\t\t\tfor (var i = 1; i < n - 1; i++)\r\n\t\t\t\trhs[i] = 4 * knots[i]._x + 2 * knots[i + 1]._x;\r\n\t\t\trhs[0] = knots[0]._x + 2 * knots[1]._x;\r\n\t\t\trhs[n - 1] = 3 * knots[n - 1]._x;\r\n\t\t\tvar x = getFirstControlPoints(rhs);\r\n\r\n\t\t\tfor (var i = 1; i < n - 1; i++)\r\n\t\t\t\trhs[i] = 4 * knots[i]._y + 2 * knots[i + 1]._y;\r\n\t\t\trhs[0] = knots[0]._y + 2 * knots[1]._y;\r\n\t\t\trhs[n - 1] = 3 * knots[n - 1]._y;\r\n\t\t\tvar y = getFirstControlPoints(rhs);\r\n\r\n\t\t\tif (this._closed) {\r\n\t\t\t\tfor (var i = 0, j = size; i < overlap; i++, j++) {\r\n\t\t\t\t\tvar f1 = i / overlap,\r\n\t\t\t\t\t\tf2 = 1 - f1,\r\n\t\t\t\t\t\tie = i + overlap,\r\n\t\t\t\t\t\tje = j + overlap;\r\n\t\t\t\t\tx[j] = x[i] * f1 + x[j] * f2;\r\n\t\t\t\t\ty[j] = y[i] * f1 + y[j] * f2;\r\n\t\t\t\t\tx[je] = x[ie] * f2 + x[je] * f1;\r\n\t\t\t\t\ty[je] = y[ie] * f2 + y[je] * f1;\r\n\t\t\t\t}\r\n\t\t\t\tn--;\r\n\t\t\t}\r\n\t\t\tvar handleIn = null;\r\n\t\t\tfor (var i = overlap; i <= n - overlap; i++) {\r\n\t\t\t\tvar segment = segments[i - overlap];\r\n\t\t\t\tif (handleIn)\r\n\t\t\t\t\tsegment.setHandleIn(handleIn.subtract(segment._point));\r\n\t\t\t\tif (i < n) {\r\n\t\t\t\t\tsegment.setHandleOut(\r\n\t\t\t\t\t\t\tPoint.create(x[i], y[i]).subtract(segment._point));\r\n\t\t\t\t\tif (i < n - 1)\r\n\t\t\t\t\t\thandleIn = Point.create(\r\n\t\t\t\t\t\t\t\t2 * knots[i + 1]._x - x[i + 1],\r\n\t\t\t\t\t\t\t\t2 * knots[i + 1]._y - y[i + 1]);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\thandleIn = Point.create(\r\n\t\t\t\t\t\t\t\t(knots[n]._x + x[n - 1]) / 2,\r\n\t\t\t\t\t\t\t\t(knots[n]._y + y[n - 1]) / 2);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this._closed && handleIn) {\r\n\t\t\t\tvar segment = this._segments[0];\r\n\t\t\t\tsegment.setHandleIn(handleIn.subtract(segment._point));\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}, new function() {\r\n\tfunction getCurrentSegment(that) {\r\n\t\tvar segments = that._segments;\r\n\t\tif (segments.length == 0)\r\n\t\t\tthrow new Error('Use a moveTo() command first');\r\n\t\treturn segments[segments.length - 1];\r\n\t}\r\n\r\n\treturn {\r\n\t\tmoveTo: function(point) {\r\n\t\t\tif (this._segments.length === 1)\r\n\t\t\t\tthis.removeSegment(0);\r\n\t\t\tif (!this._segments.length)\r\n\t\t\t\tthis._add([ new Segment(Point.read(arguments)) ]);\r\n\t\t},\r\n\r\n\t\tmoveBy: function(point) {\r\n\t\t\tthrow new Error('moveBy() is unsupported on Path items.');\r\n\t\t},\r\n\r\n\t\tlineTo: function(point) {\r\n\t\t\tthis._add([ new Segment(Point.read(arguments)) ]);\r\n\t\t},\r\n\r\n\t\tcubicCurveTo: function(handle1, handle2, to) {\r\n\t\t\tvar _handle1 = Point.read(arguments),\r\n\t\t\t\t_handle2 = Point.read(arguments),\r\n\t\t\t\t_to = Point.read(arguments);\r\n\t\t\tvar current = getCurrentSegment(this);\r\n\t\t\tcurrent.setHandleOut(_handle1.subtract(current._point));\r\n\t\t\tthis._add([ new Segment(_to, _handle2.subtract(to)) ]);\r\n\t\t},\r\n\r\n\t\tquadraticCurveTo: function(handle, to) {\r\n\t\t\tvar _handle = Point.read(arguments),\r\n\t\t\t\tto = Point.read(arguments);\r\n\t\t\tvar current = getCurrentSegment(this)._point;\r\n\t\t\tthis.cubicCurveTo(\r\n\t\t\t\t_handle.add(current.subtract(_handle).multiply(1 / 3)),\r\n\t\t\t\t_handle.add(to.subtract(_handle).multiply(1 / 3)),\r\n\t\t\t\tto\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\tcurveTo: function(through, to, parameter) {\r\n\t\t\tvar _through = Point.read(arguments),\r\n\t\t\t\t_to = Point.read(arguments),\r\n\t\t\t\tt = Base.pick(Base.read(arguments), 0.5),\r\n\t\t\t\tt1 = 1 - t,\r\n\t\t\t\tcurrent = getCurrentSegment(this)._point,\r\n\t\t\t\thandle = _through.subtract(current.multiply(t1 * t1))\r\n\t\t\t\t\t.subtract(_to.multiply(t * t)).divide(2 * t * t1);\r\n\t\t\tif (handle.isNaN())\r\n\t\t\t\tthrow new Error(\r\n\t\t\t\t\t'Cannot put a curve through points with parameter = ' + t);\r\n\t\t\tthis.quadraticCurveTo(handle, _to);\r\n\t\t},\r\n\r\n\t\tarcTo: function(to, clockwise ) {\r\n\t\t\tvar current = getCurrentSegment(this),\r\n\t\t\t\tfrom = current._point,\r\n\t\t\t\tthrough,\r\n\t\t\t\tpoint = Point.read(arguments),\r\n\t\t\t\tnext = Base.pick(Base.peek(arguments), true);\r\n\t\t\tif (typeof next === 'boolean') {\r\n\t\t\t\tto = point;\r\n\t\t\t\tclockwise = next;\r\n\t\t\t\tvar middle = from.add(to).divide(2),\r\n\t\t\t\tthrough = middle.add(middle.subtract(from).rotate(\r\n\t\t\t\t\t\tclockwise ? -90 : 90));\r\n\t\t\t} else {\r\n\t\t\t\tthrough = point;\r\n\t\t\t\tto = Point.read(arguments);\r\n\t\t\t}\r\n\t\t\tvar l1 = new Line(from.add(through).divide(2),\r\n\t\t\t\t\tthrough.subtract(from).rotate(90)),\r\n\t\t\t \tl2 = new Line(through.add(to).divide(2),\r\n\t\t\t\t\tto.subtract(through).rotate(90)),\r\n\t\t\t\tcenter = l1.intersect(l2),\r\n\t\t\t\tline = new Line(from, to, true),\r\n\t\t\t\tthroughSide = line.getSide(through);\r\n\t\t\tif (!center) {\r\n\t\t\t\tif (!throughSide)\r\n\t\t\t\t\treturn this.lineTo(to);\r\n\t\t\t\tthrow new Error(\"Cannot put an arc through the given points: \"\r\n\t\t\t\t\t+ [from, through, to]);\r\n\t\t\t}\r\n\t\t\tvar vector = from.subtract(center),\r\n\t\t\t\tradius = vector.getLength(),\r\n\t\t\t\textent = vector.getDirectedAngle(to.subtract(center)),\r\n\t\t\t\tcenterSide = line.getSide(center);\r\n\t\t\tif (centerSide == 0) {\r\n\t\t\t\textent = throughSide * Math.abs(extent);\r\n\t\t\t} else if (throughSide == centerSide) {\r\n\t\t\t\textent -= 360 * (extent < 0 ? -1 : 1);\r\n\t\t\t}\r\n\t\t\tvar ext = Math.abs(extent),\r\n\t\t\t\tcount =  ext >= 360 ? 4 : Math.ceil(ext / 90),\r\n\t\t\t\tinc = extent / count,\r\n\t\t\t\thalf = inc * Math.PI / 360,\r\n\t\t\t\tz = 4 / 3 * Math.sin(half) / (1 + Math.cos(half)),\r\n\t\t\t\tsegments = [];\r\n\t\t\tfor (var i = 0; i <= count; i++) {\r\n\t\t\t\tvar pt = i < count ? center.add(vector) : to;\r\n\t\t\t\tvar out = i < count ? vector.rotate(90).multiply(z) : null;\r\n\t\t\t\tif (i == 0) {\r\n\t\t\t\t\tcurrent.setHandleOut(out);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsegments.push(\r\n\t\t\t\t\t\tnew Segment(pt, vector.rotate(-90).multiply(z), out));\r\n\t\t\t\t}\r\n\t\t\t\tvector = vector.rotate(inc);\r\n\t\t\t}\r\n\t\t\tthis._add(segments);\r\n\t\t},\r\n\r\n\t\tlineBy: function(vector) {\r\n\t\t\tvector = Point.read(arguments);\r\n\t\t\tvar current = getCurrentSegment(this);\r\n\t\t\tthis.lineTo(current._point.add(vector));\r\n\t\t},\r\n\r\n\t\tcurveBy: function(throughVector, toVector, parameter) {\r\n\t\t\tthroughVector = Point.read(throughVector);\r\n\t\t\ttoVector = Point.read(toVector);\r\n\t\t\tvar current = getCurrentSegment(this)._point;\r\n\t\t\tthis.curveTo(current.add(throughVector), current.add(toVector),\r\n\t\t\t\t\tparameter);\r\n\t\t},\r\n\r\n\t\tarcBy: function(throughVector, toVector) {\r\n\t\t\tthroughVector = Point.read(throughVector);\r\n\t\t\ttoVector = Point.read(toVector);\r\n\t\t\tvar current = getCurrentSegment(this)._point;\r\n\t\t\tthis.arcBy(current.add(throughVector), current.add(toVector));\r\n\t\t},\r\n\r\n\t\tclosePath: function() {\r\n\t\t\tvar first = this.getFirstSegment(),\r\n\t\t\t\tlast = this.getLastSegment();\r\n\t\t\tif (first._point.equals(last._point)) {\r\n\t\t\t\tfirst.setHandleIn(last._handleIn);\r\n\t\t\t\tlast.remove();\r\n\t\t\t}\r\n\t\t\tthis.setClosed(true);\r\n\t\t}\r\n\t};\r\n}, {\r\n\r\n\t_getBounds: function(getter, matrix) {\r\n\t\treturn Path[getter](this._segments, this._closed, this._style, matrix);\r\n\t},\r\n\r\nstatics: {\r\n\tgetBounds: function(segments, closed, style, matrix, strokePadding) {\r\n\t\tvar first = segments[0];\r\n\t\tif (!first)\r\n\t\t\treturn new Rectangle();\r\n\t\tvar coords = new Array(6),\r\n\t\t\tprevCoords = first._transformCoordinates(matrix, new Array(6), false),\r\n\t\t\tmin = prevCoords.slice(0, 2),\r\n\t\t\tmax = min.slice(),\r\n\t\t\troots = new Array(2);\r\n\r\n\t\tfunction processSegment(segment) {\r\n\t\t\tsegment._transformCoordinates(matrix, coords, false);\r\n\t\t\tfor (var i = 0; i < 2; i++) {\r\n\t\t\t\tCurve._addBounds(\r\n\t\t\t\t\tprevCoords[i],\r\n\t\t\t\t\tprevCoords[i + 4],\r\n\t\t\t\t\tcoords[i + 2],\r\n\t\t\t\t\tcoords[i],\r\n\t\t\t\t\ti, strokePadding ? strokePadding[i] : 0, min, max, roots);\r\n\t\t\t}\r\n\t\t\tvar tmp = prevCoords;\r\n\t\t\tprevCoords = coords;\r\n\t\t\tcoords = tmp;\r\n\t\t}\r\n\r\n\t\tfor (var i = 1, l = segments.length; i < l; i++)\r\n\t\t\tprocessSegment(segments[i]);\r\n\t\tif (closed)\r\n\t\t\tprocessSegment(first);\r\n\t\treturn Rectangle.create(min[0], min[1], max[0] - min[0], max[1] - min[1]);\r\n\t},\r\n\r\n\tgetStrokeBounds: function(segments, closed, style, matrix) {\r\n\t\tfunction getPenPadding(radius, matrix) {\r\n\t\t\tif (!matrix)\r\n\t\t\t\treturn [radius, radius];\r\n\t\t\tvar mx = matrix.shiftless(),\r\n\t\t\t\thor = mx.transform(Point.create(radius, 0)),\r\n\t\t\t\tver = mx.transform(Point.create(0, radius)),\r\n\t\t\t\tphi = hor.getAngleInRadians(),\r\n\t\t\t\ta = hor.getLength(),\r\n\t\t\t\tb = ver.getLength();\r\n\t\t\tvar sin = Math.sin(phi),\r\n\t\t\t\tcos = Math.cos(phi),\r\n\t\t\t\ttan = Math.tan(phi),\r\n\t\t\t\ttx = -Math.atan(b * tan / a),\r\n\t\t\t\tty = Math.atan(b / (tan * a));\r\n\t\t\treturn [Math.abs(a * Math.cos(tx) * cos - b * Math.sin(tx) * sin),\r\n\t\t\t\t\tMath.abs(b * Math.sin(ty) * cos + a * Math.cos(ty) * sin)];\r\n\t\t}\r\n\r\n\t\tif (!style._strokeColor || !style._strokeWidth)\r\n\t\t\treturn Path.getBounds(segments, closed, style, matrix);\r\n\t\tvar radius = style._strokeWidth / 2,\r\n\t\t\tpadding = getPenPadding(radius, matrix),\r\n\t\t\tbounds = Path.getBounds(segments, closed, style, matrix, padding),\r\n\t\t\tjoin = style._strokeJoin,\r\n\t\t\tcap = style._strokeCap,\r\n\t\t\tmiter = style._miterLimit * style._strokeWidth / 2;\r\n\t\tvar joinBounds = new Rectangle(new Size(padding).multiply(2));\r\n\r\n\t\tfunction add(point) {\r\n\t\t\tbounds = bounds.include(matrix\r\n\t\t\t\t? matrix._transformPoint(point, point) : point);\r\n\t\t}\r\n\r\n\t\tfunction addBevelJoin(curve, t) {\r\n\t\t\tvar point = curve.getPointAt(t, true),\r\n\t\t\t\tnormal = curve.getNormalAt(t, true).normalize(radius);\r\n\t\t\tadd(point.add(normal));\r\n\t\t\tadd(point.subtract(normal));\r\n\t\t}\r\n\r\n\t\tfunction addJoin(segment, join) {\r\n\t\t\tif (join === 'round' || !segment._handleIn.isZero()\r\n\t\t\t\t\t&& !segment._handleOut.isZero()) {\r\n\t\t\t\tbounds = bounds.unite(joinBounds.setCenter(matrix\r\n\t\t\t\t\t? matrix._transformPoint(segment._point) : segment._point));\r\n\t\t\t} else if (join == 'bevel') {\r\n\t\t\t\tvar curve = segment.getCurve();\r\n\t\t\t\taddBevelJoin(curve, 0);\r\n\t\t\t\taddBevelJoin(curve.getPrevious(), 1);\r\n\t\t\t} else if (join == 'miter') {\r\n\t\t\t\tvar curve2 = segment.getCurve(),\r\n\t\t\t\t\tcurve1 = curve2.getPrevious(),\r\n\t\t\t\t\tpoint = curve2.getPointAt(0, true),\r\n\t\t\t\t\tnormal1 = curve1.getNormalAt(1, true).normalize(radius),\r\n\t\t\t\t\tnormal2 = curve2.getNormalAt(0, true).normalize(radius),\r\n\t\t\t\t\tline1 = new Line(point.subtract(normal1),\r\n\t\t\t\t\t\t\tPoint.create(-normal1.y, normal1.x)),\r\n\t\t\t\t\tline2 = new Line(point.subtract(normal2),\r\n\t\t\t\t\t\t\tPoint.create(-normal2.y, normal2.x)),\r\n\t\t\t\t\tcorner = line1.intersect(line2);\r\n\t\t\t\tif (!corner || point.getDistance(corner) > miter) {\r\n\t\t\t\t\taddJoin(segment, 'bevel');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tadd(corner);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction addCap(segment, cap, t) {\r\n\t\t\tswitch (cap) {\r\n\t\t\tcase 'round':\r\n\t\t\t\treturn addJoin(segment, cap);\r\n\t\t\tcase 'butt':\r\n\t\t\tcase 'square':\r\n\t\t\t\tvar curve = segment.getCurve(),\r\n\t\t\t\t\tpoint = curve.getPointAt(t, true),\r\n\t\t\t\t\tnormal = curve.getNormalAt(t, true).normalize(radius);\r\n\t\t\t\tif (cap === 'square')\r\n\t\t\t\t\tpoint = point.add(normal.rotate(t == 0 ? -90 : 90));\r\n\t\t\t\tadd(point.add(normal));\r\n\t\t\t\tadd(point.subtract(normal));\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (var i = 1, l = segments.length - (closed ? 0 : 1); i < l; i++)\r\n\t\t\taddJoin(segments[i], join);\r\n\t\tif (closed) {\r\n\t\t\taddJoin(segments[0], join);\r\n\t\t} else {\r\n\t\t\taddCap(segments[0], cap, 0);\r\n\t\t\taddCap(segments[segments.length - 1], cap, 1);\r\n\t\t}\r\n\t\treturn bounds;\r\n\t},\r\n\r\n\tgetHandleBounds: function(segments, closed, style, matrix, strokePadding,\r\n\t\t\tjoinPadding) {\r\n\t\tvar coords = new Array(6),\r\n\t\t\tx1 = Infinity,\r\n\t\t\tx2 = -x1,\r\n\t\t\ty1 = x1,\r\n\t\t\ty2 = x2;\r\n\t\tstrokePadding = strokePadding / 2 || 0;\r\n\t\tjoinPadding = joinPadding / 2 || 0;\r\n\t\tfor (var i = 0, l = segments.length; i < l; i++) {\r\n\t\t\tvar segment = segments[i];\r\n\t\t\tsegment._transformCoordinates(matrix, coords, false);\r\n\t\t\tfor (var j = 0; j < 6; j += 2) {\r\n\t\t\t\tvar padding = j == 0 ? joinPadding : strokePadding,\r\n\t\t\t\t\tx = coords[j],\r\n\t\t\t\t\ty = coords[j + 1],\r\n\t\t\t\t\txn = x - padding,\r\n\t\t\t\t\txx = x + padding,\r\n\t\t\t\t\tyn = y - padding,\r\n\t\t\t\t\tyx = y + padding;\r\n\t\t\t\tif (xn < x1) x1 = xn;\r\n\t\t\t\tif (xx > x2) x2 = xx;\r\n\t\t\t\tif (yn < y1) y1 = yn;\r\n\t\t\t\tif (yx > y2) y2 = yx;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn Rectangle.create(x1, y1, x2 - x1, y2 - y1);\r\n\t},\r\n\r\n\tgetRoughBounds: function(segments, closed, style, matrix) {\r\n\t\tvar strokeWidth = style._strokeColor ? style._strokeWidth : 0;\r\n\t\treturn Path.getHandleBounds(segments, closed, style, matrix,\r\n\t\t\t\tstrokeWidth,\r\n\t\t\t\tstyle._strokeJoin == 'miter'\r\n\t\t\t\t\t? strokeWidth * style._miterLimit\r\n\t\t\t\t\t: strokeWidth);\r\n\t}\r\n}});\r\n\r\nPath.inject({ statics: new function() {\r\n\r\n\tfunction createPath(args) {\r\n\t\tvar path = new Path(),\r\n\t\t\tnamed = Base.getNamed(args);\r\n\t\tif (named)\r\n\t\t\tpath._set(named);\r\n\t\treturn path;\r\n\t}\r\n\r\n\tfunction createRectangle() {\r\n\t\tvar rect = Rectangle.readNamed(arguments, 'rectangle'),\r\n\t\t\tleft = rect.getLeft(),\r\n\t\t\ttop = rect.getTop(),\r\n\t\t\tright = rect.getRight(),\r\n\t\t\tbottom = rect.getBottom(),\r\n\t\t\tpath = createPath(arguments);\r\n\t\tpath._add([\r\n\t\t\tnew Segment(Point.create(left, bottom)),\r\n\t\t\tnew Segment(Point.create(left, top)),\r\n\t\t\tnew Segment(Point.create(right, top)),\r\n\t\t\tnew Segment(Point.create(right, bottom))\r\n\t\t]);\r\n\t\tpath._closed = true;\r\n\t\treturn path;\r\n\t}\r\n\r\n\tvar kappa = 2 * (Math.sqrt(2) - 1) / 3;\r\n\r\n\tvar ellipseSegments = [\r\n\t\tnew Segment([0, 0.5], [0, kappa ], [0, -kappa]),\r\n\t\tnew Segment([0.5, 0], [-kappa, 0], [kappa, 0 ]),\r\n\t\tnew Segment([1, 0.5], [0, -kappa], [0, kappa ]),\r\n\t\tnew Segment([0.5, 1], [kappa, 0 ], [-kappa, 0])\r\n\t];\r\n\r\n\tfunction createEllipse() {\r\n\t\tvar rect = Rectangle.readNamed(arguments, 'rectangle'),\r\n\t\t\tpath = createPath(arguments),\r\n\t\t\tpoint = rect.getPoint(true),\r\n\t\t\tsize = rect.getSize(true),\r\n\t\t\tsegments = new Array(4);\r\n\t\tfor (var i = 0; i < 4; i++) {\r\n\t\t\tvar segment = ellipseSegments[i];\r\n\t\t\tsegments[i] = new Segment(\r\n\t\t\t\tsegment._point.multiply(size).add(point),\r\n\t\t\t\tsegment._handleIn.multiply(size),\r\n\t\t\t\tsegment._handleOut.multiply(size)\r\n\t\t\t);\r\n\t\t}\r\n\t\tpath._add(segments);\r\n\t\tpath._closed = true;\r\n\t\treturn path;\r\n\t}\r\n\r\n\treturn {\r\n\t\tLine: function() {\r\n\t\t\treturn new Path(\r\n\t\t\t\tPoint.readNamed(arguments, 'from'),\r\n\t\t\t\tPoint.readNamed(arguments, 'to')\r\n\t\t\t).set(Base.getNamed(arguments));\r\n\t\t},\r\n\r\n\t\tRectangle: createRectangle,\r\n\r\n\t\tRoundRectangle: function() {\r\n\t\t\tvar rect = Rectangle.readNamed(arguments, 'rectangle'),\r\n\t\t\t\tradius = Size.readNamed(arguments, 'radius');\r\n\t\t\tif (radius.isZero())\r\n\t\t\t\treturn createRectangle(rect);\r\n\t\t\tradius = Size.min(radius, rect.getSize(true).divide(2));\r\n\t\t\tvar bl = rect.getBottomLeft(true),\r\n\t\t\t\ttl = rect.getTopLeft(true),\r\n\t\t\t\ttr = rect.getTopRight(true),\r\n\t\t\t\tbr = rect.getBottomRight(true),\r\n\t\t\t\th = radius.multiply(kappa * 2),\r\n\t\t\t\tpath = createPath(arguments);\r\n\t\t\tpath._add([\r\n\t\t\t\tnew Segment(bl.add(radius.width, 0), null, [-h.width, 0]),\r\n\t\t\t\tnew Segment(bl.subtract(0, radius.height), [0, h.height], null),\r\n\r\n\t\t\t\tnew Segment(tl.add(0, radius.height), null, [0, -h.height]),\r\n\t\t\t\tnew Segment(tl.add(radius.width, 0), [-h.width, 0], null),\r\n\r\n\t\t\t\tnew Segment(tr.subtract(radius.width, 0), null, [h.width, 0]),\r\n\t\t\t\tnew Segment(tr.add(0, radius.height), [0, -h.height], null),\r\n\r\n\t\t\t\tnew Segment(br.subtract(0, radius.height), null, [0, h.height]),\r\n\t\t\t\tnew Segment(br.subtract(radius.width, 0), [h.width, 0], null)\r\n\t\t\t]);\r\n\t\t\tpath._closed = true;\r\n\t\t\treturn path;\r\n\t\t},\r\n\r\n\t\tEllipse: createEllipse,\r\n\r\n\t\tOval: createEllipse,\r\n\r\n\t\tCircle: function() {\r\n\t\t\tvar center = Point.readNamed(arguments, 'center'),\r\n\t\t\t\tradius = Base.readNamed(arguments, 'radius');\r\n\t\t\treturn createEllipse(new Rectangle(center.subtract(radius),\r\n\t\t\t\t\tSize.create(radius * 2, radius * 2)))\r\n\t\t\t\t\t.set(Base.getNamed(arguments));\r\n\t\t},\r\n\r\n\t\tArc: function() {\r\n\t\t\tvar from = Point.readNamed(arguments, 'from'),\r\n\t\t\t\tthrough = Point.readNamed(arguments, 'through'),\r\n\t\t\t\tto = Point.readNamed(arguments, 'to'),\r\n\t\t\t\tpath = createPath(arguments);\r\n\t\t\tpath.moveTo(from);\r\n\t\t\tpath.arcTo(through, to);\r\n\t\t\treturn path;\r\n\t\t},\r\n\r\n\t\tRegularPolygon: function() {\r\n\t\t\tvar center = Point.readNamed(arguments, 'center'),\r\n\t\t\t\tsides = Base.readNamed(arguments, 'sides'),\r\n\t\t\t\tradius = Base.readNamed(arguments, 'radius'),\r\n\t\t\t\tpath = createPath(arguments),\r\n\t\t\t\tstep = 360 / sides,\r\n\t\t\t\tthree = !(sides % 3),\r\n\t\t\t\tvector = new Point(0, three ? -radius : radius),\r\n\t\t\t\toffset = three ? -1 : 0.5,\r\n\t\t\t\tsegments = new Array(sides);\r\n\t\t\tfor (var i = 0; i < sides; i++) {\r\n\t\t\t\tsegments[i] = new Segment(center.add(\r\n\t\t\t\t\tvector.rotate((i + offset) * step)));\r\n\t\t\t}\r\n\t\t\tpath._add(segments);\r\n\t\t\tpath._closed = true;\r\n\t\t\treturn path;\r\n\t\t},\r\n\r\n\t\tStar: function() {\r\n\t\t\tvar center = Point.readNamed(arguments, 'center'),\r\n\t\t\t\tpoints = Base.readNamed(arguments, 'points') * 2,\r\n\t\t\t\tradius1 = Base.readNamed(arguments, 'radius1'),\r\n\t\t\t\tradius2 = Base.readNamed(arguments, 'radius2'),\r\n\t\t\t\tpath = createPath(arguments),\r\n\t\t\t\tstep = 360 / points,\r\n\t\t\t\tvector = new Point(0, -1),\r\n\t\t\t\tsegments = new Array(points);\r\n\t\t\tfor (var i = 0; i < points; i++) {\r\n\t\t\t\tsegments[i] = new Segment(center.add(\r\n\t\t\t\t\tvector.rotate(step * i).multiply(i % 2 ? radius2 : radius1)));\r\n\t\t\t}\r\n\t\t\tpath._add(segments);\r\n\t\t\tpath._closed = true;\r\n\t\t\treturn path;\r\n\t\t}\r\n\t};\r\n}});\r\n\r\nvar CompoundPath = this.CompoundPath = PathItem.extend({\r\n\t_class: 'CompoundPath',\r\n\t_serializeFields: {\r\n\t\tpathData: ''\r\n\t},\r\n\r\n\tinitialize: function(arg) {\r\n\t\tthis.base();\r\n\t\tthis._children = [];\r\n\t\tthis._namedChildren = {};\r\n\t\tif (arg && !this._set(arg))\r\n\t\t\tthis.addChildren(Array.isArray(arg) ? arg : arguments);\r\n\t},\r\n\r\n\tinsertChild: function(index, item, _cloning) {\r\n\t\tif (item._type !== 'path')\r\n\t\t\treturn null;\r\n\t\titem = this.base(index, item);\r\n\t\tif (!_cloning && item && item._clockwise === undefined)\r\n\t\t\titem.setClockwise(item._index == 0);\r\n\t\treturn item;\r\n\t},\r\n\r\n\treduce: function() {\r\n\t\tif (this._children.length == 1) {\r\n\t\t\tvar child = this._children[0];\r\n\t\t\tchild.insertAbove(this);\r\n\t\t\tthis.remove();\r\n\t\t\treturn child;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsmooth: function() {\r\n\t\tfor (var i = 0, l = this._children.length; i < l; i++)\r\n\t\t\tthis._children[i].smooth();\r\n\t},\r\n\r\n\tgetFirstSegment: function() {\r\n\t\tvar first = this.getFirstChild();\r\n\t\treturn first && first.getFirstSegment();\r\n\t},\r\n\r\n\tgetLastSegment: function() {\r\n\t\tvar last = this.getLastChild();\r\n\t\treturn last && last.getLastSegment();\r\n\t},\r\n\r\n\tgetCurves: function() {\r\n\t\tvar children = this._children,\r\n\t\t\tcurves = [];\r\n\t\tfor (var i = 0, l = children.length; i < l; i++)\r\n\t\t\tcurves = curves.concat(children[i].getCurves());\r\n\t\treturn curves;\r\n\t},\r\n\r\n\tgetFirstCurve: function() {\r\n\t\tvar first = this.getFirstChild();\r\n\t\treturn first && first.getFirstCurve();\r\n\t},\r\n\r\n\tgetLastCurve: function() {\r\n\t\tvar last = this.getLastChild();\r\n\t\treturn last && last.getFirstCurve();\r\n\t},\r\n\r\n\tgetPathData: function() {\r\n\t\tvar children = this._children,\r\n\t\t\tpaths = [];\r\n\t\tfor (var i = 0, l = children.length; i < l; i++)\r\n\t\t\tpaths.push(children[i].getPathData(arguments[0]));\r\n\t\treturn paths.join(' ');\r\n\t},\r\n\r\n\t_contains: function(point) {\r\n\t\tvar children = [];\r\n\t\tfor (var i = 0, l = this._children.length; i < l; i++) {\r\n\t\t\tvar child = this._children[i];\r\n\t\t\tif (child.contains(point))\r\n\t\t\t\tchildren.push(child);\r\n\t\t}\r\n\t\treturn (children.length & 1) == 1 && children;\r\n\t},\r\n\r\n\tcontains: function(point) {\r\n\t\treturn !!this._contains(Point.read(arguments));\r\n\t},\r\n\r\n\t_hitTest: function(point, options) {\r\n\t\tvar res = this.base(point, Base.merge(options, { fill: false }));\r\n\t\tif (!res && options.fill && this._style._fillColor) {\r\n\t\t\tres = this._contains(point);\r\n\t\t\tres = res ? new HitResult('fill', res[0]) : null;\r\n\t\t}\r\n\t\treturn res;\r\n\t},\r\n\r\n\tdraw: function(ctx, param) {\r\n\t\tvar children = this._children,\r\n\t\t\tstyle = this._style;\r\n\t\tif (children.length === 0)\r\n\t\t\treturn;\r\n\t\tctx.beginPath();\r\n\t\tparam.compound = true;\r\n\t\tfor (var i = 0, l = children.length; i < l; i++)\r\n\t\t\tItem.draw(children[i], ctx, param);\r\n\t\tparam.compound = false;\r\n\t\tif (!param.clip) {\r\n\t\t\tthis._setStyles(ctx);\r\n\t\t\tif (style._fillColor)\r\n\t\t\t\tctx.fill();\r\n\t\t\tif (style._strokeColor)\r\n\t\t\t\tctx.stroke();\r\n\t\t}\r\n\t}\r\n}, new function() {\r\n\tfunction getCurrentPath(that) {\r\n\t\tif (!that._children.length)\r\n\t\t\tthrow new Error('Use a moveTo() command first');\r\n\t\treturn that._children[that._children.length - 1];\r\n\t}\r\n\r\n\tvar fields = {\r\n\t\tmoveTo: function(point) {\r\n\t\t\tvar path = new Path();\r\n\t\t\tthis.addChild(path);\r\n\t\t\tpath.moveTo.apply(path, arguments);\r\n\t\t},\r\n\r\n\t\tmoveBy: function(point) {\r\n\t\t\tthis.moveTo(getCurrentPath(this).getLastSegment()._point.add(\r\n\t\t\t\t\tPoint.read(arguments)));\r\n\t\t},\r\n\r\n\t\tclosePath: function() {\r\n\t\t\tgetCurrentPath(this).closePath();\r\n\t\t}\r\n\t};\r\n\r\n\tBase.each(['lineTo', 'cubicCurveTo', 'quadraticCurveTo', 'curveTo',\r\n\t\t\t'arcTo', 'lineBy', 'curveBy', 'arcBy'], function(key) {\r\n\t\tfields[key] = function() {\r\n\t\t\tvar path = getCurrentPath(this);\r\n\t\t\tpath[key].apply(path, arguments);\r\n\t\t};\r\n\t});\r\n\r\n\treturn fields;\r\n});\r\n\r\nvar PathFlattener = Base.extend({\r\n\tinitialize: function(path) {\r\n\t\tthis.curves = [];\r\n\t\tthis.parts = [];\r\n\t\tthis.length = 0;\r\n\t\tthis.index = 0;\r\n\r\n\t\tvar segments = path._segments,\r\n\t\t\tsegment1 = segments[0],\r\n\t\t\tsegment2,\r\n\t\t\tthat = this;\r\n\r\n\t\tfunction addCurve(segment1, segment2) {\r\n\t\t\tvar curve = Curve.getValues(segment1, segment2);\r\n\t\t\tthat.curves.push(curve);\r\n\t\t\tthat._computeParts(curve, segment1._index, 0, 1);\r\n\t\t}\r\n\r\n\t\tfor (var i = 1, l = segments.length; i < l; i++) {\r\n\t\t\tsegment2 = segments[i];\r\n\t\t\taddCurve(segment1, segment2);\r\n\t\t\tsegment1 = segment2;\r\n\t\t}\r\n\t\tif (path._closed)\r\n\t\t\taddCurve(segment2, segments[0]);\r\n\t},\r\n\r\n\t_computeParts: function(curve, index, minT, maxT) {\r\n\t\tif ((maxT - minT) > 1 / 32 && !Curve.isFlatEnough(curve, 0.25)) {\r\n\t\t\tvar curves = Curve.subdivide(curve);\r\n\t\t\tvar halfT = (minT + maxT) / 2;\r\n\t\t\tthis._computeParts(curves[0], index, minT, halfT);\r\n\t\t\tthis._computeParts(curves[1], index, halfT, maxT);\r\n\t\t} else {\r\n\t\t\tvar x = curve[6] - curve[0],\r\n\t\t\t\ty = curve[7] - curve[1],\r\n\t\t\t\tdist = Math.sqrt(x * x + y * y);\r\n\t\t\tif (dist > 0.00001) {\r\n\t\t\t\tthis.length += dist;\r\n\t\t\t\tthis.parts.push({\r\n\t\t\t\t\toffset: this.length,\r\n\t\t\t\t\tvalue: maxT,\r\n\t\t\t\t\tindex: index\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tgetParameterAt: function(offset) {\r\n\t\tvar i, j = this.index;\r\n\t\tfor (;;) {\r\n\t\t\ti = j;\r\n\t\t\tif (j == 0 || this.parts[--j].offset < offset)\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tfor (var l = this.parts.length; i < l; i++) {\r\n\t\t\tvar part = this.parts[i];\r\n\t\t\tif (part.offset >= offset) {\r\n\t\t\t\tthis.index = i;\r\n\t\t\t\tvar prev = this.parts[i - 1];\r\n\t\t\t\tvar prevVal = prev && prev.index == part.index ? prev.value : 0,\r\n\t\t\t\t\tprevLen = prev ? prev.offset : 0;\r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue: prevVal + (part.value - prevVal)\r\n\t\t\t\t\t\t* (offset - prevLen) /  (part.offset - prevLen),\r\n\t\t\t\t\tindex: part.index\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar part = this.parts[this.parts.length - 1];\r\n\t\treturn {\r\n\t\t\tvalue: 1,\r\n\t\t\tindex: part.index\r\n\t\t};\r\n\t},\r\n\r\n\tevaluate: function(offset, type) {\r\n\t\tvar param = this.getParameterAt(offset);\r\n\t\treturn Curve.evaluate(this.curves[param.index], param.value, true, type);\r\n\t},\r\n\r\n\tdrawPart: function(ctx, from, to) {\r\n\t\tfrom = this.getParameterAt(from);\r\n\t\tto = this.getParameterAt(to);\r\n\t\tfor (var i = from.index; i <= to.index; i++) {\r\n\t\t\tvar curve = Curve.getPart(this.curves[i],\r\n\t\t\t\t\ti == from.index ? from.value : 0,\r\n\t\t\t\t\ti == to.index ? to.value : 1);\r\n\t\t\tif (i == from.index)\r\n\t\t\t\tctx.moveTo(curve[0], curve[1]);\r\n\t\t\tctx.bezierCurveTo.apply(ctx, curve.slice(2));\r\n\t\t}\r\n\t}\r\n});\r\n\r\nvar PathFitter = Base.extend({\r\n\tinitialize: function(path, error) {\r\n\t\tthis.points = [];\r\n\t\tvar segments = path._segments,\r\n\t\t\tprev;\r\n\t\tfor (var i = 0, l = segments.length; i < l; i++) {\r\n\t\t\tvar point = segments[i].point.clone();\r\n\t\t\tif (!prev || !prev.equals(point)) {\r\n\t\t\t\tthis.points.push(point);\r\n\t\t\t\tprev = point;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.error = error;\r\n\t},\r\n\r\n\tfit: function() {\r\n\t\tvar points = this.points,\r\n\t\t\tlength = points.length;\r\n\t\tthis.segments = length > 0 ? [new Segment(points[0])] : [];\r\n\t\tif (length > 1)\r\n\t\t\tthis.fitCubic(0, length - 1,\r\n\t\t\t\tpoints[1].subtract(points[0]).normalize(),\r\n\t\t\t\tpoints[length - 2].subtract(points[length - 1]).normalize());\r\n\t\treturn this.segments;\r\n\t},\r\n\r\n\tfitCubic: function(first, last, tan1, tan2) {\r\n\t\tif (last - first == 1) {\r\n\t\t\tvar pt1 = this.points[first],\r\n\t\t\t\tpt2 = this.points[last],\r\n\t\t\t\tdist = pt1.getDistance(pt2) / 3;\r\n\t\t\tthis.addCurve([pt1, pt1.add(tan1.normalize(dist)),\r\n\t\t\t\t\tpt2.add(tan2.normalize(dist)), pt2]);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar uPrime = this.chordLengthParameterize(first, last),\r\n\t\t\tmaxError = Math.max(this.error, this.error * this.error),\r\n\t\t\terror,\r\n\t\t\tsplit;\r\n\t\tfor (var i = 0; i <= 4; i++) {\r\n\t\t\tvar curve = this.generateBezier(first, last, uPrime, tan1, tan2);\r\n\t\t\tvar max = this.findMaxError(first, last, curve, uPrime);\r\n\t\t\tif (max.error < this.error) {\r\n\t\t\t\tthis.addCurve(curve);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tsplit = max.index;\r\n\t\t\tif (max.error >= maxError)\r\n\t\t\t\tbreak;\r\n\t\t\tthis.reparameterize(first, last, uPrime, curve);\r\n\t\t\tmaxError = max.error;\r\n\t\t}\r\n\t\tvar V1 = this.points[split - 1].subtract(this.points[split]),\r\n\t\t\tV2 = this.points[split].subtract(this.points[split + 1]),\r\n\t\t\ttanCenter = V1.add(V2).divide(2).normalize();\r\n\t\tthis.fitCubic(first, split, tan1, tanCenter);\r\n\t\tthis.fitCubic(split, last, tanCenter.negate(), tan2);\r\n\t},\r\n\r\n\taddCurve: function(curve) {\r\n\t\tvar prev = this.segments[this.segments.length - 1];\r\n\t\tprev.setHandleOut(curve[1].subtract(curve[0]));\r\n\t\tthis.segments.push(\r\n\t\t\t\tnew Segment(curve[3], curve[2].subtract(curve[3])));\r\n\t},\r\n\r\n\tgenerateBezier: function(first, last, uPrime, tan1, tan2) {\r\n\t\tvar epsilon = 1e-11,\r\n\t\t\tpt1 = this.points[first],\r\n\t\t\tpt2 = this.points[last],\r\n\t\t\tC = [[0, 0], [0, 0]],\r\n\t\t\tX = [0, 0];\r\n\r\n\t\tfor (var i = 0, l = last - first + 1; i < l; i++) {\r\n\t\t\tvar u = uPrime[i],\r\n\t\t\t\tt = 1 - u,\r\n\t\t\t\tb = 3 * u * t,\r\n\t\t\t\tb0 = t * t * t,\r\n\t\t\t\tb1 = b * t,\r\n\t\t\t\tb2 = b * u,\r\n\t\t\t\tb3 = u * u * u,\r\n\t\t\t\ta1 = tan1.normalize(b1),\r\n\t\t\t\ta2 = tan2.normalize(b2),\r\n\t\t\t\ttmp = this.points[first + i]\r\n\t\t\t\t\t.subtract(pt1.multiply(b0 + b1))\r\n\t\t\t\t\t.subtract(pt2.multiply(b2 + b3));\r\n\t\t\tC[0][0] += a1.dot(a1);\r\n\t\t\tC[0][1] += a1.dot(a2);\r\n\t\t\tC[1][0] = C[0][1];\r\n\t\t\tC[1][1] += a2.dot(a2);\r\n\t\t\tX[0] += a1.dot(tmp);\r\n\t\t\tX[1] += a2.dot(tmp);\r\n\t\t}\r\n\r\n\t\tvar detC0C1 = C[0][0] * C[1][1] - C[1][0] * C[0][1],\r\n\t\t\talpha1, alpha2;\r\n\t\tif (Math.abs(detC0C1) > epsilon) {\r\n\t\t\tvar detC0X  = C[0][0] * X[1]    - C[1][0] * X[0],\r\n\t\t\t\tdetXC1  = X[0]    * C[1][1] - X[1]    * C[0][1];\r\n\t\t\talpha1 = detXC1 / detC0C1;\r\n\t\t\talpha2 = detC0X / detC0C1;\r\n\t\t} else {\r\n\t\t\tvar c0 = C[0][0] + C[0][1],\r\n\t\t\t\tc1 = C[1][0] + C[1][1];\r\n\t\t\tif (Math.abs(c0) > epsilon) {\r\n\t\t\t\talpha1 = alpha2 = X[0] / c0;\r\n\t\t\t} else if (Math.abs(c1) > epsilon) {\r\n\t\t\t\talpha1 = alpha2 = X[1] / c1;\r\n\t\t\t} else {\r\n\t\t\t\talpha1 = alpha2 = 0;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar segLength = pt2.getDistance(pt1);\r\n\t\tepsilon *= segLength;\r\n\t\tif (alpha1 < epsilon || alpha2 < epsilon) {\r\n\t\t\talpha1 = alpha2 = segLength / 3;\r\n\t\t}\r\n\r\n\t\treturn [pt1, pt1.add(tan1.normalize(alpha1)),\r\n\t\t\t\tpt2.add(tan2.normalize(alpha2)), pt2];\r\n\t},\r\n\r\n\treparameterize: function(first, last, u, curve) {\r\n\t\tfor (var i = first; i <= last; i++) {\r\n\t\t\tu[i - first] = this.findRoot(curve, this.points[i], u[i - first]);\r\n\t\t}\r\n\t},\r\n\r\n\tfindRoot: function(curve, point, u) {\r\n\t\tvar curve1 = [],\r\n\t\t\tcurve2 = [];\r\n\t\tfor (var i = 0; i <= 2; i++) {\r\n\t\t\tcurve1[i] = curve[i + 1].subtract(curve[i]).multiply(3);\r\n\t\t}\r\n\t\tfor (var i = 0; i <= 1; i++) {\r\n\t\t\tcurve2[i] = curve1[i + 1].subtract(curve1[i]).multiply(2);\r\n\t\t}\r\n\t\tvar pt = this.evaluate(3, curve, u),\r\n\t\t\tpt1 = this.evaluate(2, curve1, u),\r\n\t\t\tpt2 = this.evaluate(1, curve2, u),\r\n\t\t\tdiff = pt.subtract(point),\r\n\t\t\tdf = pt1.dot(pt1) + diff.dot(pt2);\r\n\t\tif (Math.abs(df) < 0.00001)\r\n\t\t\treturn u;\r\n\t\treturn u - diff.dot(pt1) / df;\r\n\t},\r\n\r\n\tevaluate: function(degree, curve, t) {\r\n\t\tvar tmp = curve.slice();\r\n\t\tfor (var i = 1; i <= degree; i++) {\r\n\t\t\tfor (var j = 0; j <= degree - i; j++) {\r\n\t\t\t\ttmp[j] = tmp[j].multiply(1 - t).add(tmp[j + 1].multiply(t));\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn tmp[0];\r\n\t},\r\n\r\n\tchordLengthParameterize: function(first, last) {\r\n\t\tvar u = [0];\r\n\t\tfor (var i = first + 1; i <= last; i++) {\r\n\t\t\tu[i - first] = u[i - first - 1]\r\n\t\t\t\t\t+ this.points[i].getDistance(this.points[i - 1]);\r\n\t\t}\r\n\t\tfor (var i = 1, m = last - first; i <= m; i++) {\r\n\t\t\tu[i] /= u[m];\r\n\t\t}\r\n\t\treturn u;\r\n\t},\r\n\r\n\tfindMaxError: function(first, last, curve, u) {\r\n\t\tvar index = Math.floor((last - first + 1) / 2),\r\n\t\t\tmaxDist = 0;\r\n\t\tfor (var i = first + 1; i < last; i++) {\r\n\t\t\tvar P = this.evaluate(3, curve, u[i - first]);\r\n\t\t\tvar v = P.subtract(this.points[i]);\r\n\t\t\tvar dist = v.x * v.x + v.y * v.y;\r\n\t\t\tif (dist >= maxDist) {\r\n\t\t\t\tmaxDist = dist;\r\n\t\t\t\tindex = i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {\r\n\t\t\terror: maxDist,\r\n\t\t\tindex: index\r\n\t\t};\r\n\t}\r\n});\r\n\r\nvar TextItem = this.TextItem = Item.extend({\r\n\t_boundsSelected: true,\r\n\t_serializeFields: {\r\n\t\tcontent: null\r\n\t},\r\n\t_boundsGetter: 'getBounds',\r\n\r\n\tinitialize: function(arg) {\r\n\t\tvar hasProperties = arg && Base.isPlainObject(arg)\r\n\t\t\t\t&& arg.x === undefined && arg.y === undefined;\r\n\t\tthis.base(hasProperties ? null : Point.read(arguments));\r\n\t\tthis._content = '';\r\n\t\tthis._lines = [];\r\n\t\tif (hasProperties)\r\n\t\t\tthis._set(arg);\r\n\t},\r\n\r\n\t_clone: function(copy) {\r\n\t\tcopy.setContent(this._content);\r\n\t\treturn this.base(copy);\r\n\t},\r\n\r\n\tgetContent: function() {\r\n\t\treturn this._content;\r\n\t},\r\n\r\n\tsetContent: function(content) {\r\n\t\tthis._content = '' + content;\r\n\t\tthis._lines = this._content.split(/\\r\\n|\\n|\\r/mg);\r\n\t\tthis._changed(69);\r\n\t},\r\n\r\n\tisEmpty: function() {\r\n\t\treturn !this._content;\r\n\t},\r\n\r\n\tgetCharacterStyle: function() {\r\n\t\treturn this.getStyle();\r\n\t},\r\n\r\n\tsetCharacterStyle: function(style) {\r\n\t\tthis.setStyle(style);\r\n\t},\r\n\r\n\tgetParagraphStyle: function() {\r\n\t\treturn this.getStyle();\r\n\t},\r\n\r\n\tsetParagraphStyle: function(style) {\r\n\t\tthis.setStyle(style);\r\n\t}\r\n});\r\n\r\nvar PointText = this.PointText = TextItem.extend({\r\n\t_class: 'PointText',\r\n\r\n\tclone: function() {\r\n\t\treturn this._clone(new PointText());\r\n\t},\r\n\r\n\tgetPoint: function() {\r\n\t\tvar point = this._matrix.getTranslation();\r\n\t\treturn LinkedPoint.create(this, 'setPoint', point.x, point.y);\r\n\t},\r\n\r\n\tsetPoint: function(point) {\r\n\t\tthis.translate(Point.read(arguments).subtract(\r\n\t\t\t\tthis._matrix.getTranslation()));\r\n\t},\r\n\r\n\tdraw: function(ctx) {\r\n\t\tif (!this._content)\r\n\t\t\treturn;\r\n\t\tthis._setStyles(ctx);\r\n\t\tvar style = this._style,\r\n\t\t\tlines = this._lines,\r\n\t\t\tleading = style.getLeading();\r\n\t\tctx.font = style.getFontStyle();\r\n\t\tctx.textAlign = style.getJustification();\r\n\t\tfor (var i = 0, l = lines.length; i < l; i++) {\r\n\t\t\tvar line = lines[i];\r\n\t\t\tif (style._fillColor)\r\n\t\t\t\tctx.fillText(line, 0, 0);\r\n\t\t\tif (style._strokeColor)\r\n\t\t\t\tctx.strokeText(line, 0, 0);\r\n\t\t\tctx.translate(0, leading);\r\n\t\t}\r\n\t}\r\n}, new function() {\r\n\tvar measureCtx = null;\r\n\r\n\treturn {\r\n\t\t_getBounds: function(getter, matrix) {\r\n\t\t\tif (!measureCtx)\r\n\t\t\t\tmeasureCtx = CanvasProvider.getContext(1, 1);\r\n\t\t\tvar style = this._style,\r\n\t\t\t\tlines = this._lines,\r\n\t\t\t\tcount = lines.length,\r\n\t\t\t\tjustification = style.getJustification(),\r\n\t\t\t\tleading = style.getLeading(),\r\n\t\t\t\tx = 0;\r\n\t\t\tmeasureCtx.font = style.getFontStyle();\r\n\t\t\tvar width = 0;\r\n\t\t\tfor (var i = 0; i < count; i++)\r\n\t\t\t\twidth = Math.max(width, measureCtx.measureText(lines[i]).width);\r\n\t\t\tif (justification !== 'left')\r\n\t\t\t\tx -= width / (justification === 'center' ? 2: 1);\r\n\t\t\tvar bounds = Rectangle.create(x,\r\n\t\t\t\t\t\tcount ? leading / 4 + (count - 1) * leading : 0,\r\n\t\t\t\t\t\twidth, -count * leading);\r\n\t\t\treturn matrix ? matrix._transformBounds(bounds, bounds) : bounds;\r\n\t\t}\r\n\t};\r\n});\r\n\r\nvar Style = this.Style = Base.extend(new function() {\r\n\tvar defaults = {\r\n\t\tfillColor: undefined,\r\n\t\tstrokeColor: undefined,\r\n\t\tstrokeWidth: 1,\r\n\t\tstrokeCap: 'butt',\r\n\t\tstrokeJoin: 'miter',\r\n\t\tmiterLimit: 10,\r\n\t\tdashOffset: 0,\r\n\t\tdashArray: [],\r\n\t\tfont: 'sans-serif',\r\n\t\tfontSize: 12,\r\n\t\tleading: null,\r\n\t\tjustification: 'left'\r\n\t};\r\n\r\n\tvar textDefaults = Base.merge(defaults, {\r\n\t\tfillColor: 'black'\r\n\t});\r\n\r\n\tvar flags = {\r\n\t\tstrokeWidth: 25,\r\n\t\tstrokeCap: 25,\r\n\t\tstrokeJoin: 25,\r\n\t\tmiterLimit: 25,\r\n\t\tfont: 5,\r\n\t\tfontSize: 5,\r\n\t\tleading: 5,\r\n\t\tjustification: 5\r\n\t};\r\n\r\n\tvar item = {},\r\n\t\tfields = {\r\n\t\t\tgetDefaults: function() {\r\n\t\t\t\treturn this._item instanceof TextItem ? textDefaults : defaults;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\tBase.each(defaults, function(value, key) {\r\n\t\tvar isColor = /Color$/.test(key),\r\n\t\t\tpart = Base.capitalize(key),\r\n\t\t\tset = 'set' + part,\r\n\t\t\tget = 'get' + part;\r\n\r\n\t\tfields[set] = function(value) {\r\n\t\t\tvar children = this._item && this._item._children;\r\n\t\t\tvalue = isColor ? Color.read(arguments, 0, 0, true) : value;\r\n\t\t\tif (children && children.length > 0\r\n\t\t\t\t\t&& this._item._type !== 'compound-path') {\r\n\t\t\t\tfor (var i = 0, l = children.length; i < l; i++)\r\n\t\t\t\t\tchildren[i]._style[set](value);\r\n\t\t\t} else {\r\n\t\t\t\tvar old = this['_' + key];\r\n\t\t\t\tif (!Base.equals(old, value)) {\r\n\t\t\t\t\tif (isColor) {\r\n\t\t\t\t\t\tif (old)\r\n\t\t\t\t\t\t\tdelete old._owner;\r\n\t\t\t\t\t\tif (value) {\r\n\t\t\t\t\t\t\tvalue._owner = this._item;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis['_' + key] = value;\r\n\t\t\t\t\tif (this._item)\r\n\t\t\t\t\t\tthis._item._changed(flags[key] || 17);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfields[get] = function() {\r\n\t\t\tvar style,\r\n\t\t\t\tchildren = this._item && this._item._children;\r\n\t\t\tif (!children || children.length === 0\r\n\t\t\t\t\t|| this._item._type === 'compound-path')\r\n\t\t\t\treturn this['_' + key];\r\n\t\t\tfor (var i = 0, l = children.length; i < l; i++) {\r\n\t\t\t\tvar childStyle = children[i]._style[get]();\r\n\t\t\t\tif (!style) {\r\n\t\t\t\t\tstyle = childStyle;\r\n\t\t\t\t} else if (!Base.equals(style, childStyle)) {\r\n\t\t\t\t\treturn undefined;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn style;\r\n\t\t};\r\n\r\n\t\titem[get] = function() {\r\n\t\t\treturn this._style[get]();\r\n\t\t};\r\n\r\n\t\titem[set] = function(value) {\r\n\t\t\tthis._style[set](value);\r\n\t\t};\r\n\t});\r\n\r\n\tItem.inject(item);\r\n\treturn fields;\r\n}, {\r\n\tinitialize: function(style) {\r\n\t\tvar clone = style instanceof Style;\r\n\t\treturn Base.each(this.getDefaults(), function(value, key) {\r\n\t\t\tvalue = style && style[key] || value;\r\n\t\t\tthis[key] = value && clone && value.clone\r\n\t\t\t\t\t? value.clone() : value;\r\n\t\t}, this);\r\n\t},\r\n\r\n\tgetLeading: function() {\r\n\t\tvar leading = this.base();\r\n\t\treturn leading != null ? leading : this._fontSize * 1.2;\r\n\t},\r\n\r\n\tgetFontStyle: function() {\r\n\t\tvar size = this._fontSize;\r\n\t\treturn (/[a-z]/i.test(size) ? size + ' ' : size + 'px ') + this._font;\r\n\t},\r\n\r\n\tstatics: {\r\n\t\tcreate: function(item) {\r\n\t\t\tvar style = Base.create(this);\r\n\t\t\tstyle._item = item;\r\n\t\t\treturn style;\r\n\t\t}\r\n\t}\r\n\r\n});\r\n\r\nvar Color = this.Color = Base.extend(new function() {\r\n\r\n\tvar types = {\r\n\t\tgray: ['gray'],\r\n\t\trgb: ['red', 'green', 'blue'],\r\n\t\thsb: ['hue', 'saturation', 'brightness'],\r\n\t\thsl: ['hue', 'saturation', 'lightness'],\r\n\t\tgradient: ['gradient', 'origin', 'destination', 'highlight']\r\n\t};\r\n\r\n\tvar parsers = {},\r\n\t\tcolorCache = {},\r\n\t\tcolorCtx;\r\n\r\n\tfunction nameToRgb(name) {\r\n\t\tvar cached = colorCache[name];\r\n\t\tif (!cached) {\r\n\t\t\tif (!colorCtx) {\r\n\t\t\t\tcolorCtx = CanvasProvider.getContext(1, 1);\r\n\t\t\t\tcolorCtx.globalCompositeOperation = 'copy';\r\n\t\t\t}\r\n\t\t\tcolorCtx.fillStyle = 'rgba(0,0,0,0)';\r\n\t\t\tcolorCtx.fillStyle = name;\r\n\t\t\tcolorCtx.fillRect(0, 0, 1, 1);\r\n\t\t\tvar data = colorCtx.getImageData(0, 0, 1, 1).data;\r\n\t\t\tcached = colorCache[name] = [\r\n\t\t\t\tdata[0] / 255,\r\n\t\t\t\tdata[1] / 255,\r\n\t\t\t\tdata[2] / 255\r\n\t\t\t];\r\n\t\t}\r\n\t\treturn cached.slice();\r\n\t}\r\n\r\n\tfunction hexToRgb(string) {\r\n\t\tvar hex = string.match(/^#?(\\w{1,2})(\\w{1,2})(\\w{1,2})$/);\r\n\t\tif (hex.length >= 4) {\r\n\t\t\tvar components = [0, 0, 0];\r\n\t\t\tfor (var i = 0; i < 3; i++) {\r\n\t\t\t\tvar value = hex[i + 1];\r\n\t\t\t\tcomponents[i] = parseInt(value.length == 1\r\n\t\t\t\t\t\t? value + value : value, 16) / 255;\r\n\t\t\t}\r\n\t\t\treturn components;\r\n\t\t}\r\n\t}\r\n\r\n\tvar hsbIndices = [\r\n\t\t[0, 3, 1],\r\n\t\t[2, 0, 1],\r\n\t\t[1, 0, 3],\r\n\t\t[1, 2, 0],\r\n\t\t[3, 1, 0],\r\n\t\t[0, 1, 2]\r\n\t];\r\n\r\n\tvar converters = {\r\n\t\t'rgb-hsb': function(r, g, b) {\r\n\t\t\tvar max = Math.max(r, g, b),\r\n\t\t\t\tmin = Math.min(r, g, b),\r\n\t\t\t\tdelta = max - min,\r\n\t\t\t\th = delta === 0 ? 0\r\n\t\t\t\t\t:   ( max == r ? (g - b) / delta + (g < b ? 6 : 0)\r\n\t\t\t\t\t\t: max == g ? (b - r) / delta + 2\r\n\t\t\t\t\t\t:            (r - g) / delta + 4) * 60;\r\n\t\t\treturn [h, max === 0 ? 0 : delta / max, max];\r\n\t\t},\r\n\r\n\t\t'hsb-rgb': function(h, s, b) {\r\n\t\t\tvar h = (h / 60) % 6,\r\n\t\t\t\ti = Math.floor(h),\r\n\t\t\t\tf = h - i,\r\n\t\t\t\ti = hsbIndices[i],\r\n\t\t\t\tv = [\r\n\t\t\t\t\tb,\r\n\t\t\t\t\tb * (1 - s),\r\n\t\t\t\t\tb * (1 - s * f),\r\n\t\t\t\t\tb * (1 - s * (1 - f))\r\n\t\t\t\t];\r\n\t\t\treturn [v[i[0]], v[i[1]], v[i[2]]];\r\n\t\t},\r\n\r\n\t\t'rgb-hsl': function(r, g, b) {\r\n\t\t\tvar max = Math.max(r, g, b),\r\n\t\t\t\tmin = Math.min(r, g, b),\r\n\t\t\t\tdelta = max - min,\r\n\t\t\t\tachromatic = delta === 0,\r\n\t\t\t\th = achromatic ? 0\r\n\t\t\t\t\t:   ( max == r ? (g - b) / delta + (g < b ? 6 : 0)\r\n\t\t\t\t\t\t: max == g ? (b - r) / delta + 2\r\n\t\t\t\t\t\t:            (r - g) / delta + 4) * 60,\r\n\t\t\t\tl = (max + min) / 2,\r\n\t\t\t\ts = achromatic ? 0 : l < 0.5\r\n\t\t\t\t\t\t? delta / (max + min)\r\n\t\t\t\t\t\t: delta / (2 - max - min);\r\n\t\t\treturn [h, s, l];\r\n\t\t},\r\n\r\n\t\t'hsl-rgb': function(h, s, l) {\r\n\t\t\th /= 360;\r\n\t\t\tif (s === 0)\r\n\t\t\t\treturn [l, l, l];\r\n\t\t\tvar t3s = [ h + 1 / 3, h, h - 1 / 3 ],\r\n\t\t\t\tt2 = l < 0.5 ? l * (1 + s) : l + s - l * s,\r\n\t\t\t\tt1 = 2 * l - t2,\r\n\t\t\t\tc = [];\r\n\t\t\tfor (var i = 0; i < 3; i++) {\r\n\t\t\t\tvar t3 = t3s[i];\r\n\t\t\t\tif (t3 < 0) t3 += 1;\r\n\t\t\t\tif (t3 > 1) t3 -= 1;\r\n\t\t\t\tc[i] = 6 * t3 < 1\r\n\t\t\t\t\t? t1 + (t2 - t1) * 6 * t3\r\n\t\t\t\t\t: 2 * t3 < 1\r\n\t\t\t\t\t\t? t2\r\n\t\t\t\t\t\t: 3 * t3 < 2\r\n\t\t\t\t\t\t\t? t1 + (t2 - t1) * ((2 / 3) - t3) * 6\r\n\t\t\t\t\t\t\t: t1;\r\n\t\t\t}\r\n\t\t\treturn c;\r\n\t\t},\r\n\r\n\t\t'rgb-gray': function(r, g, b) {\r\n\t\t\treturn [r * 0.2989 + g * 0.587 + b * 0.114];\r\n\t\t},\r\n\r\n\t\t'gray-rgb': function(g) {\r\n\t\t\treturn [g, g, g];\r\n\t\t},\r\n\r\n\t\t'gray-hsb': function(g) {\r\n\t\t\treturn [0, 0, g];\r\n\t\t},\r\n\r\n\t\t'gray-hsl': function(g) {\r\n\t\t\treturn [0, 0, g];\r\n\t\t},\r\n\r\n\t\t'gradient-rgb': function(gradient) {\r\n\t\t\treturn [];\r\n\t\t},\r\n\r\n\t\t'rgb-gradient': function(r, g, b) {\r\n\t\t\treturn [];\r\n\t\t}\r\n\r\n\t};\r\n\r\n\treturn Base.each(types, function(properties, type) {\r\n\t\tparsers[type] = [];\r\n\t\tBase.each(properties, function(name, index) {\r\n\t\t\tvar part = Base.capitalize(name),\r\n\t\t\t\thasOverlap = /^(hue|saturation)$/.test(name),\r\n\t\t\t\tparser = parsers[type][index] = name === 'gradient'\r\n\t\t\t\t\t? function(value) {\r\n\t\t\t\t\t\tvar current = this._components[0];\r\n\t\t\t\t\t\tvalue = Gradient.read(\r\n\t\t\t\t\t\t\t\tArray.isArray(value) ? value : arguments,\r\n\t\t\t\t\t\t\t\t0, 0, false, true);\r\n\t\t\t\t\t\tif (current !== value) {\r\n\t\t\t\t\t\t\tif (current)\r\n\t\t\t\t\t\t\t\tcurrent._removeOwner(this);\r\n\t\t\t\t\t\t\tif (value)\r\n\t\t\t\t\t\t\t\tvalue._addOwner(this);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn value;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t: name === 'hue'\r\n\t\t\t\t\t\t? function(value) {\r\n\t\t\t\t\t\t\treturn isNaN(value) ? 0\r\n\t\t\t\t\t\t\t\t\t: ((value % 360) + 360) % 360;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t: type === 'gradient'\r\n\t\t\t\t\t\t\t? function(value) {\r\n\t\t\t\t\t\t\t\treturn Point.read(arguments, 0, 0, true,\r\n\t\t\t\t\t\t\t\t\t\tname === 'highlight');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t: function(value) {\r\n\t\t\t\t\t\t\t\treturn isNaN(value) ? 0\r\n\t\t\t\t\t\t\t\t\t\t: Math.min(Math.max(value, 0), 1);\r\n\t\t\t\t\t\t\t};\r\n\r\n\t\t\tthis['get' + part] = function() {\r\n\t\t\t\treturn this._type === type\r\n\t\t\t\t\t|| hasOverlap && /^hs[bl]$/.test(this._type)\r\n\t\t\t\t\t\t? this._components[index]\r\n\t\t\t\t\t\t: this._convert(type)[index];\r\n\t\t\t};\r\n\r\n\t\t\tthis['set' + part] = function(value) {\r\n\t\t\t\tif (this._type !== type\r\n\t\t\t\t\t\t&& !(hasOverlap && /^hs[bl]$/.test(this._type))) {\r\n\t\t\t\t\tthis._components = this._convert(type);\r\n\t\t\t\t\tthis._type = type;\r\n\t\t\t\t}\r\n\t\t\t\tvalue = parser.call(this, value);\r\n\t\t\t\tif (value != null) {\r\n\t\t\t\t\tthis._components[index] = value;\r\n\t\t\t\t\tthis._changed();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}, this);\r\n\t}, {\r\n\t\t_class: 'Color',\r\n\t\t_readNull: true,\r\n\t\t_readIndex: true,\r\n\r\n\t\tinitialize: function(arg) {\r\n\t\t\tvar slice = Array.prototype.slice,\r\n\t\t\t\targs = arguments,\r\n\t\t\t\tread = 0,\r\n\t\t\t\ttype,\r\n\t\t\t\tcomponents,\r\n\t\t\t\talpha;\r\n\t\t\tif (Array.isArray(arg)) {\r\n\t\t\t\targs = arg;\r\n\t\t\t\targ = args[0];\r\n\t\t\t}\r\n\t\t\tif (typeof arg === 'string' && arg in types) {\r\n\t\t\t\ttype = arg;\r\n\t\t\t\tif (this._read)\r\n\t\t\t\t\tread = 1;\r\n\t\t\t\targs = slice.call(args, 1);\r\n\t\t\t\targ = args[0];\r\n\t\t\t}\r\n\t\t\tvar argType = arg != null && typeof arg,\r\n\t\t\t\tvalues = argType === 'number'\r\n\t\t\t\t\t? args\r\n\t\t\t\t\t: argType === 'object' && arg.length != null\r\n\t\t\t\t\t\t? arg\r\n\t\t\t\t\t\t: null;\r\n\t\t\tif (values) {\r\n\t\t\t\tif (!type)\r\n\t\t\t\t\ttype = values.length >= 3\r\n\t\t\t\t\t\t\t? 'rgb'\r\n\t\t\t\t\t\t\t: 'gray';\r\n\t\t\t\tvar length = types[type].length;\r\n\t\t\t\talpha = values[length];\r\n\t\t\t\tif (this._read)\r\n\t\t\t\t\tread += values === arguments\r\n\t\t\t\t\t\t? length + (alpha != null ? 1 : 0)\r\n\t\t\t\t\t\t: 1;\r\n\t\t\t\tif (values.length > length)\r\n\t\t\t\t\tvalues = slice.call(values, 0, length);\r\n\t\t\t} else {\r\n\t\t\t\tif (argType === 'string') {\r\n\t\t\t\t\tcomponents = arg.match(/^#[0-9a-f]{3,6}$/i)\r\n\t\t\t\t\t\t\t? hexToRgb(arg)\r\n\t\t\t\t\t\t\t: nameToRgb(arg);\r\n\t\t\t\t\ttype = 'rgb';\r\n\t\t\t\t} else if (argType === 'object') {\r\n\t\t\t\t\tif (arg._class === 'Color') {\r\n\t\t\t\t\t\ttype = arg._type;\r\n\t\t\t\t\t\tcomponents = arg._components.slice();\r\n\t\t\t\t\t\talpha = arg._alpha;\r\n\t\t\t\t\t} else if (arg._class === 'Gradient') {\r\n\t\t\t\t\t\ttype = 'gradient';\r\n\t\t\t\t\t\tvalues = args;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttype = 'hue' in arg\r\n\t\t\t\t\t\t\t? 'lightness' in arg\r\n\t\t\t\t\t\t\t\t? 'hsl'\r\n\t\t\t\t\t\t\t\t: 'hsb'\r\n\t\t\t\t\t\t\t: 'gradient' in arg || 'stops' in arg\r\n\t\t\t\t\t\t\t\t? 'gradient'\r\n\t\t\t\t\t\t\t\t: 'gray' in arg\r\n\t\t\t\t\t\t\t\t\t? 'gray'\r\n\t\t\t\t\t\t\t\t\t: 'rgb';\r\n\t\t\t\t\t\tvar properties = types[type];\r\n\t\t\t\t\t\t\tparse = parsers[type];\r\n\t\t\t\t\t\tthis._components = components = [];\r\n\t\t\t\t\t\tfor (var i = 0, l = properties.length; i < l; i++) {\r\n\t\t\t\t\t\t\tvar value = arg[properties[i]];\r\n\t\t\t\t\t\t\tif (value == null && i === 0 && type === 'gradient'\r\n\t\t\t\t\t\t\t\t\t&& 'stops' in arg) {\r\n\t\t\t\t\t\t\t\tvalue = {\r\n\t\t\t\t\t\t\t\t\tstops: arg.stops,\r\n\t\t\t\t\t\t\t\t\tradial: arg.radial\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tvalue = parse[i].call(this, value);\r\n\t\t\t\t\t\t\tif (value != null)\r\n\t\t\t\t\t\t\t\tcomponents[i] = value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\talpha = arg.alpha;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (this._read && type)\r\n\t\t\t\t\tread = 1;\r\n\t\t\t}\r\n\t\t\tthis._type = type || 'rgb';\r\n\t\t\tif (type === 'gradient')\r\n\t\t\t\tthis._id = ++Base._uid;\r\n\t\t\tif (!components) {\r\n\t\t\t\tthis._components = components = [];\r\n\t\t\t\tvar parse = parsers[this._type];\r\n\t\t\t\tfor (var i = 0, l = parse.length; i < l; i++) {\r\n\t\t\t\t\tvar value = parse[i].call(this, values && values[i]);\r\n\t\t\t\t\tif (value != null)\r\n\t\t\t\t\t\tcomponents[i] = value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._components = components;\r\n\t\t\tthis._alpha = alpha;\r\n\t\t\tif (this._read)\r\n\t\t\t\tthis._read = read;\r\n\t\t},\r\n\r\n\t\t_serialize: function(options, dictionary) {\r\n\t\t\treturn Base.serialize(\r\n\t\t\t\t\t/^(gray|rgb)$/.test(this._type)\r\n\t\t\t\t\t\t? this._components\r\n\t\t\t\t\t\t: [this._type].concat(this._components),\r\n\t\t\t\t\toptions, true, dictionary);\r\n\t\t},\r\n\r\n\t\t_changed: function() {\r\n\t\t\tthis._css = null;\r\n\t\t\tthis._canvasGradient = null;\r\n\t\t\tif (this._owner)\r\n\t\t\t\tthis._owner._changed(17);\r\n\t\t},\r\n\r\n\t\tclone: function() {\r\n\t\t\treturn Color.create(this._type, this._components.slice(),\r\n\t\t\t\t\tthis._alpha);\r\n\t\t},\r\n\r\n\t\t_convert: function(type) {\r\n\t\t\tvar converter;\r\n\t\t\treturn this._type == type\r\n\t\t\t\t\t? this._components.slice()\r\n\t\t\t\t\t: (converter = converters[this._type + '-' + type])\r\n\t\t\t\t\t\t? converter.apply(this, this._components)\r\n\t\t\t\t\t\t: converters['rgb-' + type].apply(this,\r\n\t\t\t\t\t\t\tconverters[this._type + '-rgb'].apply(this,\r\n\t\t\t\t\t\t\t\t\tthis._components));\r\n\t\t},\r\n\r\n\t\tconvert: function(type) {\r\n\t\t\treturn Color.create(type, this._convert(type), this._alpha);\r\n\t\t},\r\n\r\n\t\tgetType: function() {\r\n\t\t\treturn this._type;\r\n\t\t},\r\n\r\n\t\tsetType: function(type) {\r\n\t\t\tthis._components = this._convert(type);\r\n\t\t\tthis._type = type;\r\n\t\t},\r\n\r\n\t\tgetComponents: function() {\r\n\t\t\tvar components = this._components.slice();\r\n\t\t\tif (this._alpha != null)\r\n\t\t\t\tcomponents.push(this._alpha);\r\n\t\t\treturn components;\r\n\t\t},\r\n\r\n\t\tgetAlpha: function() {\r\n\t\t\treturn this._alpha != null ? this._alpha : 1;\r\n\t\t},\r\n\r\n\t\tsetAlpha: function(alpha) {\r\n\t\t\tthis._alpha = alpha == null ? null : Math.min(Math.max(alpha, 0), 1);\r\n\t\t\tthis._changed();\r\n\t\t},\r\n\r\n\t\thasAlpha: function() {\r\n\t\t\treturn this._alpha != null;\r\n\t\t},\r\n\r\n\t\tequals: function(color) {\r\n\t\t\treturn color && this._type === color._type\r\n\t\t\t\t\t&& this._alpha === color._alpha\r\n\t\t\t\t\t&& Base.equals(this._components, color._components);\r\n\t\t},\r\n\r\n\t\ttoString: function() {\r\n\t\t\tvar properties = types[this._type],\r\n\t\t\t\tparts = [],\r\n\t\t\t\tisGradient = this._type === 'gradient',\r\n\t\t\t\tf = Formatter.instance;\r\n\t\t\tfor (var i = 0, l = properties.length; i < l; i++) {\r\n\t\t\t\tvar value = this._components[i];\r\n\t\t\t\tif (value != null)\r\n\t\t\t\t\tparts.push(properties[i] + ': '\r\n\t\t\t\t\t\t\t+ (isGradient ? value : f.number(value)));\r\n\t\t\t}\r\n\t\t\tif (this._alpha != null)\r\n\t\t\t\tparts.push('alpha: ' + f.number(this._alpha));\r\n\t\t\treturn '{ ' + parts.join(', ') + ' }';\r\n\t\t},\r\n\r\n\t\ttoCss: function(noAlpha) {\r\n\t\t\tvar css = this._css;\r\n\t\t\tif (!css || noAlpha) {\r\n\t\t\t\tvar components = this._convert('rgb'),\r\n\t\t\t\t\talpha = noAlpha || this._alpha == null ? 1 : this._alpha;\r\n\t\t\t\tcomponents = [\r\n\t\t\t\t\tMath.round(components[0] * 255),\r\n\t\t\t\t\tMath.round(components[1] * 255),\r\n\t\t\t\t\tMath.round(components[2] * 255)\r\n\t\t\t\t];\r\n\t\t\t\tif (alpha < 1)\r\n\t\t\t\t\tcomponents.push(alpha);\r\n\t\t\t\tvar css = (components.length == 4 ? 'rgba(' : 'rgb(')\r\n\t\t\t\t\t\t+ components.join(', ') + ')';\r\n\t\t\t\tif (!noAlpha)\r\n\t\t\t\t\tthis._css = css;\r\n\t\t\t}\r\n\t\t\treturn css;\r\n\t\t},\r\n\r\n\t\ttoCanvasStyle: function(ctx) {\r\n\t\t\tif (this._type !== 'gradient')\r\n\t\t\t\treturn this.toCss();\r\n\t\t\tif (this._canvasGradient)\r\n\t\t\t\treturn this._canvasGradient;\r\n\t\t\tvar components = this._components,\r\n\t\t\t\tgradient = components[0],\r\n\t\t\t\tstops = gradient._stops,\r\n\t\t\t\torigin = components[1],\r\n\t\t\t\tdestination = components[2],\r\n\t\t\t\tcanvasGradient;\r\n\t\t\tif (gradient._radial) {\r\n\t\t\t\tvar radius = destination.getDistance(origin),\r\n\t\t\t\t\thighlight = components[3];\r\n\t\t\t\tif (highlight) {\r\n\t\t\t\t\tvar vector = highlight.subtract(origin);\r\n\t\t\t\t\tif (vector.getLength() > radius)\r\n\t\t\t\t\t\thighlight = origin.add(vector.normalize(radius - 0.1));\r\n\t\t\t\t}\r\n\t\t\t\tvar start = highlight || origin;\r\n\t\t\t\tcanvasGradient = ctx.createRadialGradient(start.x, start.y,\r\n\t\t\t\t\t\t0, origin.x, origin.y, radius);\r\n\t\t\t} else {\r\n\t\t\t\tcanvasGradient = ctx.createLinearGradient(origin.x, origin.y,\r\n\t\t\t\t\t\tdestination.x, destination.y);\r\n\t\t\t}\r\n\t\t\tfor (var i = 0, l = stops.length; i < l; i++) {\r\n\t\t\t\tvar stop = stops[i];\r\n\t\t\t\tcanvasGradient.addColorStop(stop._rampPoint, stop._color.toCss());\r\n\t\t\t}\r\n\t\t\treturn this._canvasGradient = canvasGradient;\r\n\t\t},\r\n\r\n\t\ttransform: function(matrix) {\r\n\t\t\tif (this._type === 'gradient') {\r\n\t\t\t\tvar components = this._components;\r\n\t\t\t\tfor (var i = 1, l = components.length; i < l; i++) {\r\n\t\t\t\t\tvar point = components[i];\r\n\t\t\t\t\tmatrix._transformPoint(point, point, true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tstatics: {\r\n\t\t\t_types: types,\r\n\r\n\t\t\tcreate: function(type, components, alpha) {\r\n\t\t\t\tvar color = Base.create(Color);\r\n\t\t\t\tcolor._type = type;\r\n\t\t\t\tcolor._components = components;\r\n\t\t\t\tcolor._alpha = alpha;\r\n\t\t\t\tif (type === 'gradient') {\r\n\t\t\t\t\tcolor._id = ++Base._uid;\r\n\t\t\t\t\tfor (var i = 1, l = components.length; i < l; i++) {\r\n\t\t\t\t\t\tvar point = components[i];\r\n\t\t\t\t\t\tif (point)\r\n\t\t\t\t\t\t\tcomponents[i] = point.clone();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn color;\r\n\t\t\t},\r\n\r\n\t\t\trandom: function() {\r\n\t\t\t\tvar random = Math.random;\r\n\t\t\t\treturn new Color(random(), random(), random());\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n});\r\n\r\nBase.each(Color._types, function(properties, type) {\r\n\tvar ctor = this[Base.capitalize(type) + 'Color'] =\r\n\t\tfunction(arg) {\r\n\t\t\tvar argType = arg != null && typeof arg,\r\n\t\t\t\tcomponents = argType === 'object' && arg.length != null\r\n\t\t\t\t\t? arg\r\n\t\t\t\t\t: argType === 'string'\r\n\t\t\t\t\t\t? null\r\n\t\t\t\t\t\t: arguments;\r\n\t\t\treturn components\r\n\t\t\t\t\t? new Color(type, components)\r\n\t\t\t\t\t: new Color(arg);\r\n\t\t};\r\n\tif (type.length == 3)\r\n\t\tthis[type.toUpperCase() + 'Color'] = ctor;\r\n}, this);\r\n\r\nvar Gradient = this.Gradient = Base.extend({\r\n\t_class: 'Gradient',\r\n\r\n\tinitialize: function(stops, radial) {\r\n\t\tthis._id = ++Base._uid;\r\n\t\tif (stops && this._set(stops))\r\n\t\t\tstops = radial = null;\r\n\t\tif (!this._stops)\r\n\t\t\tthis.setStops(stops || ['white', 'black']);\r\n\t\tif (this._radial == null)\r\n\t\t\tthis.setRadial(typeof radial === 'string' && radial === 'radial'\r\n\t\t\t\t\t|| radial || false);\r\n\t},\r\n\r\n\t_serialize: function(options, dictionary) {\r\n\t\treturn dictionary.add(this, function() {\r\n\t\t\treturn Base.serialize([this._stops, this._radial],\r\n\t\t\t\t\toptions, true, dictionary);\r\n\t\t});\r\n\t},\r\n\r\n\t_changed: function() {\r\n\t\tfor (var i = 0, l = this._owners && this._owners.length; i < l; i++)\r\n\t\t\tthis._owners[i]._changed();\r\n\t},\r\n\r\n\t_addOwner: function(color) {\r\n\t\tif (!this._owners)\r\n\t\t\tthis._owners = [];\r\n\t\tthis._owners.push(color);\r\n\t},\r\n\r\n\t_removeOwner: function(color) {\r\n\t\tvar index = this._owners ? this._owners.indexOf(color) : -1;\r\n\t\tif (index != -1) {\r\n\t\t\tthis._owners.splice(index, 1);\r\n\t\t\tif (this._owners.length === 0)\r\n\t\t\t\tdelete this._owners;\r\n\t\t}\r\n\t},\r\n\r\n\tclone: function() {\r\n\t\tvar stops = [];\r\n\t\tfor (var i = 0, l = this._stops.length; i < l; i++)\r\n\t\t\tstops[i] = this._stops[i].clone();\r\n\t\treturn new this.constructor(stops);\r\n\t},\r\n\r\n\tgetStops: function() {\r\n\t\treturn this._stops;\r\n\t},\r\n\r\n\tsetStops: function(stops) {\r\n\t\tif (this.stops) {\r\n\t\t\tfor (var i = 0, l = this._stops.length; i < l; i++)\r\n\t\t\t\tdelete this._stops[i]._owner;\r\n\t\t}\r\n\t\tif (stops.length < 2)\r\n\t\t\tthrow new Error(\r\n\t\t\t\t\t'Gradient stop list needs to contain at least two stops.');\r\n\t\tthis._stops = GradientStop.readAll(stops, 0, true);\r\n\t\tfor (var i = 0, l = this._stops.length; i < l; i++) {\r\n\t\t\tvar stop = this._stops[i];\r\n\t\t\tstop._owner = this;\r\n\t\t\tif (stop._defaultRamp)\r\n\t\t\t\tstop.setRampPoint(i / (l - 1));\r\n\t\t}\r\n\t\tthis._changed();\r\n\t},\r\n\r\n\tgetRadial: function() {\r\n\t\treturn this._radial;\r\n\t},\r\n\r\n\tsetRadial: function(radial) {\r\n\t\tthis._radial = radial;\r\n\t\tthis._changed();\r\n\t},\r\n\r\n\tequals: function(gradient) {\r\n\t\tif (gradient && gradient.constructor == this.constructor\r\n\t\t\t\t&& this._stops.length == gradient._stops.length) {\r\n\t\t\tfor (var i = 0, l = this._stops.length; i < l; i++) {\r\n\t\t\t\tif (!this._stops[i].equals(gradient._stops[i]))\r\n\t\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n});\r\n\r\nvar GradientStop = this.GradientStop = Base.extend({\r\n\tinitialize: function(arg0, arg1) {\r\n\t\tif (arg0) {\r\n\t\t\tvar color, rampPoint;\r\n\t\t\tif (arg1 === undefined && Array.isArray(arg0)) {\r\n\t\t\t\tcolor = arg0[0];\r\n\t\t\t\trampPoint = arg0[1];\r\n\t\t\t} else if (arg0.color) {\r\n\t\t\t\tcolor = arg0.color;\r\n\t\t\t\trampPoint = arg0.rampPoint;\r\n\t\t\t} else {\r\n\t\t\t\tcolor = arg0;\r\n\t\t\t\trampPoint = arg1;\r\n\t\t\t}\r\n\t\t\tthis.setColor(color);\r\n\t\t\tthis.setRampPoint(rampPoint);\r\n\t\t}\r\n\t},\r\n\r\n\tclone: function() {\r\n\t\treturn new GradientStop(this._color.clone(), this._rampPoint);\r\n\t},\r\n\r\n\t_serialize: function(options, dictionary) {\r\n\t\treturn Base.serialize([this._color, this._rampPoint], options, true,\r\n\t\t\t\tdictionary);\r\n\t},\r\n\r\n\t_changed: function() {\r\n\t\tif (this._owner)\r\n\t\t\tthis._owner._changed(17);\r\n\t},\r\n\r\n\tgetRampPoint: function() {\r\n\t\treturn this._rampPoint;\r\n\t},\r\n\r\n\tsetRampPoint: function(rampPoint) {\r\n\t\tthis._defaultRamp = rampPoint == null;\r\n\t\tthis._rampPoint = rampPoint || 0;\r\n\t\tthis._changed();\r\n\t},\r\n\r\n\tgetColor: function() {\r\n\t\treturn this._color;\r\n\t},\r\n\r\n\tsetColor: function(color) {\r\n\t\tthis._color = Color.read(arguments);\r\n\t\tif (this._color === color)\r\n\t\t\tthis._color = color.clone();\r\n\t\tthis._color._owner = this;\r\n\t\tthis._changed();\r\n\t},\r\n\r\n\tequals: function(stop) {\r\n\t\treturn stop == this || stop instanceof GradientStop\r\n\t\t\t\t&& this._color.equals(stop._color)\r\n\t\t\t\t&& this._rampPoint == stop._rampPoint;\r\n\t}\r\n});\r\n\r\nvar DomElement = new function() {\r\n\r\n\tvar special = /^(checked|value|selected|disabled)$/i,\r\n\t\ttranslated = { text: 'textContent', html: 'innerHTML' },\r\n\t\tunitless = { lineHeight: 1, zoom: 1, zIndex: 1, opacity: 1 };\r\n\r\n\tfunction create(nodes, parent) {\r\n\t\tvar res = [];\r\n\t\tfor (var i =  0, l = nodes && nodes.length; i < l;) {\r\n\t\t\tvar el = nodes[i++];\r\n\t\t\tif (typeof el === 'string') {\r\n\t\t\t\tel = document.createElement(el);\r\n\t\t\t} else if (!el || !el.nodeType) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (Base.isPlainObject(nodes[i]))\r\n\t\t\t\tDomElement.set(el, nodes[i++]);\r\n\t\t\tif (Array.isArray(nodes[i]))\r\n\t\t\t\tcreate(nodes[i++], el);\r\n\t\t\tif (parent)\r\n\t\t\t\tparent.appendChild(el);\r\n\t\t\tres.push(el);\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\r\n\treturn {\r\n\t\tcreate: function(nodes, parent) {\r\n\t\t\tvar isArray = Array.isArray(nodes),\r\n\t\t\t\tres = create(isArray ? nodes : arguments, isArray ? parent : null);\r\n\t\t\treturn res.length == 1 ? res[0] : res;\r\n\t\t},\r\n\r\n\t\tfind: function(selector, root) {\r\n\t\t\treturn (root || document).querySelector(selector);\r\n\t\t},\r\n\r\n\t\tfindAll: function(selector, root) {\r\n\t\t\treturn (root || document).querySelectorAll(selector);\r\n\t\t},\r\n\r\n\t\tget: function(el, key) {\r\n\t\t\treturn el\r\n\t\t\t\t? special.test(key)\r\n\t\t\t\t\t? key === 'value' || typeof el[key] !== 'string'\r\n\t\t\t\t\t\t? el[key]\r\n\t\t\t\t\t\t: true\r\n\t\t\t\t\t: key in translated\r\n\t\t\t\t\t\t? el[translated[key]]\r\n\t\t\t\t\t\t: el.getAttribute(key)\r\n\t\t\t\t: null;\r\n\t\t},\r\n\r\n\t\tset: function(el, key, value) {\r\n\t\t\tif (typeof key !== 'string') {\r\n\t\t\t\tfor (var name in key)\r\n\t\t\t\t\tif (key.hasOwnProperty(name))\r\n\t\t\t\t\t\tthis.set(el, name, key[name]);\r\n\t\t\t} else if (!el || value === undefined) {\r\n\t\t\t\treturn el;\r\n\t\t\t} else if (special.test(key)) {\r\n\t\t\t\tel[key] = value;\r\n\t\t\t} else if (key in translated) {\r\n\t\t\t\tel[translated[key]] = value;\r\n\t\t\t} else if (key === 'style') {\r\n\t\t\t\tthis.setStyle(el, value);\r\n\t\t\t} else if (key === 'events') {\r\n\t\t\t\tDomEvent.add(el, value);\r\n\t\t\t} else {\r\n\t\t\t\tel.setAttribute(key, value);\r\n\t\t\t}\r\n\t\t\treturn el;\r\n\t\t},\r\n\r\n\t\tgetStyles: function(el) {\r\n\t\t\tvar view = el && el.ownerDocument.defaultView;\r\n\t\t\treturn view && view.getComputedStyle(el, '');\r\n\t\t},\r\n\r\n\t\tgetStyle: function(el, key) {\r\n\t\t\treturn el && el.style[key] || this.getStyles(el)[key] || null;\r\n\t\t},\r\n\r\n\t\tsetStyle: function(el, key, value) {\r\n\t\t\tif (typeof key !== 'string') {\r\n\t\t\t\tfor (var name in key)\r\n\t\t\t\t\tif (key.hasOwnProperty(name))\r\n\t\t\t\t\t\tthis.setStyle(el, name, key[name]);\r\n\t\t\t} else {\r\n\t\t\t\tif (/^-?[\\d\\.]+$/.test(value) && !(key in unitless))\r\n\t\t\t\t\tvalue += 'px';\r\n\t\t\t\tel.style[key] = value;\r\n\t\t\t}\r\n\t\t\treturn el;\r\n\t\t},\r\n\r\n\t\thasClass: function(el, cls) {\r\n\t\t\treturn new RegExp('\\\\s*' + cls + '\\\\s*').test(el.className);\r\n\t\t},\r\n\r\n\t\taddClass: function(el, cls) {\r\n\t\t\tel.className = (el.className + ' ' + cls).trim();\r\n\t\t},\r\n\r\n\t\tremoveClass: function(el, cls) {\r\n\t\t\tel.className = el.className.replace(\r\n\t\t\t\tnew RegExp('\\\\s*' + cls + '\\\\s*'), ' ').trim();\r\n\t\t},\r\n\r\n\t\tremove: function(el) {\r\n\t\t\tif (el.parentNode)\r\n\t\t\t\tel.parentNode.removeChild(el);\r\n\t\t},\r\n\r\n\t\tremoveChildren: function(el) {\r\n\t\t\twhile (el.firstChild)\r\n\t\t\t\tel.removeChild(el.firstChild);\r\n\t\t},\r\n\r\n\t\tgetBounds: function(el, viewport) {\r\n\t\t\tvar rect = el.getBoundingClientRect(),\r\n\t\t\t\tdoc = el.ownerDocument,\r\n\t\t\t\tbody = doc.body,\r\n\t\t\t\thtml = doc.documentElement,\r\n\t\t\t\tx = rect.left - (html.clientLeft || body.clientLeft || 0),\r\n\t\t\t\ty = rect.top - (html.clientTop  || body.clientTop  || 0);\r\n\t\t\tif (!viewport) {\r\n\t\t\t\tvar view = doc.defaultView;\r\n\t\t\t\tx += view.pageXOffset || html.scrollLeft || body.scrollLeft;\r\n\t\t\t\ty += view.pageYOffset || html.scrollTop || body.scrollTop;\r\n\t\t\t}\r\n\t\t\treturn new Rectangle(x, y, rect.width, rect.height);\r\n\t\t},\r\n\r\n\t\tgetViewportBounds: function(el) {\r\n\t\t\tvar doc = el.ownerDocument,\r\n\t\t\t\tview = doc.defaultView,\r\n\t\t\t\thtml = doc.documentElement;\r\n\t\t\treturn Rectangle.create(0, 0,\r\n\t\t\t\tview.innerWidth || html.clientWidth,\r\n\t\t\t\tview.innerHeight || html.clientHeight\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\tgetOffset: function(el, viewport) {\r\n\t\t\treturn this.getBounds(el, viewport).getPoint();\r\n\t\t},\r\n\r\n\t\tgetSize: function(el) {\r\n\t\t\treturn this.getBounds(el, true).getSize();\r\n\t\t},\r\n\r\n\t\tisInvisible: function(el) {\r\n\t\t\treturn this.getSize(el).equals([0, 0]);\r\n\t\t},\r\n\r\n\t\tisInView: function(el) {\r\n\t\t\treturn !this.isInvisible(el) && this.getViewportBounds(el).intersects(\r\n\t\t\t\t\tthis.getBounds(el, true));\r\n\t\t}\r\n\t};\r\n};\r\n\r\nvar DomEvent = {\r\n\tadd: function(el, events) {\r\n\t\tfor (var type in events) {\r\n\t\t\tvar func = events[type];\r\n\t\t\tif (el.addEventListener) {\r\n\t\t\t\tel.addEventListener(type, func, false);\r\n\t\t\t} else if (el.attachEvent) {\r\n\t\t\t\tel.attachEvent('on' + type, func.bound = function() {\r\n\t\t\t\t\tfunc.call(el, window.event);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tremove: function(el, events) {\r\n\t\tfor (var type in events) {\r\n\t\t\tvar func = events[type];\r\n\t\t\tif (el.removeEventListener) {\r\n\t\t\t\tel.removeEventListener(type, func, false);\r\n\t\t\t} else if (el.detachEvent) {\r\n\t\t\t\tel.detachEvent('on' + type, func.bound);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tgetPoint: function(event) {\r\n\t\tvar pos = event.targetTouches\r\n\t\t\t\t? event.targetTouches.length\r\n\t\t\t\t\t? event.targetTouches[0]\r\n\t\t\t\t\t: event.changedTouches[0]\r\n\t\t\t\t: event;\r\n\t\treturn Point.create(\r\n\t\t\tpos.pageX || pos.clientX + document.documentElement.scrollLeft,\r\n\t\t\tpos.pageY || pos.clientY + document.documentElement.scrollTop\r\n\t\t);\r\n\t},\r\n\r\n\tgetTarget: function(event) {\r\n\t\treturn event.target || event.srcElement;\r\n\t},\r\n\r\n\tgetOffset: function(event, target) {\r\n\t\treturn DomEvent.getPoint(event).subtract(DomElement.getOffset(\r\n\t\t\t\ttarget || DomEvent.getTarget(event)));\r\n\t},\r\n\r\n\tpreventDefault: function(event) {\r\n\t\tif (event.preventDefault) {\r\n\t\t\tevent.preventDefault();\r\n\t\t} else {\r\n\t\t\tevent.returnValue = false;\r\n\t\t}\r\n\t},\r\n\r\n\tstopPropagation: function(event) {\r\n\t\tif (event.stopPropagation) {\r\n\t\t\tevent.stopPropagation();\r\n\t\t} else {\r\n\t\t\tevent.cancelBubble = true;\r\n\t\t}\r\n\t},\r\n\r\n\tstop: function(event) {\r\n\t\tDomEvent.stopPropagation(event);\r\n\t\tDomEvent.preventDefault(event);\r\n\t}\r\n};\r\n\r\nDomEvent.requestAnimationFrame = new function() {\r\n\tvar part = 'equestAnimationFrame',\r\n\t\trequest = window['r' + part] || window['webkitR' + part]\r\n\t\t\t|| window['mozR' + part] || window['oR' + part]\r\n\t\t\t|| window['msR' + part];\r\n\tif (request) {\r\n\t\trequest(function(time) {\r\n\t\t\tif (time == null)\r\n\t\t\t\trequest = null;\r\n\t\t});\r\n\t}\r\n\r\n\tvar callbacks = [],\r\n\t\tfocused = true,\r\n\t\ttimer;\r\n\r\n\tDomEvent.add(window, {\r\n\t\tfocus: function() {\r\n\t\t\tfocused = true;\r\n\t\t},\r\n\t\tblur: function() {\r\n\t\t\tfocused = false;\r\n\t\t}\r\n\t});\r\n\r\n\treturn function(callback, element) {\r\n\t\tif (request)\r\n\t\t\treturn request(callback, element);\r\n\t\tcallbacks.push([callback, element]);\r\n\t\tif (timer)\r\n\t\t\treturn;\r\n\t\ttimer = setInterval(function() {\r\n\t\t\tfor (var i = callbacks.length - 1; i >= 0; i--) {\r\n\t\t\t\tvar entry = callbacks[i],\r\n\t\t\t\t\tfunc = entry[0],\r\n\t\t\t\t\tel = entry[1];\r\n\t\t\t\tif (!el || (PaperScript.getAttribute(el, 'keepalive') == 'true'\r\n\t\t\t\t\t\t|| focused) && DomElement.isInView(el)) {\r\n\t\t\t\t\tcallbacks.splice(i, 1);\r\n\t\t\t\t\tfunc(Date.now());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, 1000 / 60);\r\n\t};\r\n};\r\n\r\nvar View = this.View = Base.extend(Callback, {\r\n\tinitialize: function(element) {\r\n\t\tthis._scope = paper;\r\n\t\tthis._project = paper.project;\r\n\t\tthis._element = element;\r\n\t\tvar size;\r\n\t\tthis._id = element.getAttribute('id');\r\n\t\tif (this._id == null)\r\n\t\t\telement.setAttribute('id', this._id = 'view-' + View._id++);\r\n\t\tDomEvent.add(element, this._viewHandlers);\r\n\t\tif (PaperScript.hasAttribute(element, 'resize')) {\r\n\t\t\tvar offset = DomElement.getOffset(element, true),\r\n\t\t\t\tthat = this;\r\n\t\t\tsize = DomElement.getViewportBounds(element)\r\n\t\t\t\t\t.getSize().subtract(offset);\r\n\t\t\tthis._windowHandlers = {\r\n\t\t\t\tresize: function(event) {\r\n\t\t\t\t\tif (!DomElement.isInvisible(element))\r\n\t\t\t\t\t\toffset = DomElement.getOffset(element, true);\r\n\t\t\t\t\tthat.setViewSize(DomElement.getViewportBounds(element)\r\n\t\t\t\t\t\t\t.getSize().subtract(offset));\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tDomEvent.add(window, this._windowHandlers);\r\n\t\t} else {\r\n\t\t\tsize = Size.create(parseInt(element.getAttribute('width'), 10),\r\n\t\t\t\t\t\tparseInt(element.getAttribute('height'), 10));\r\n\t\t\tif (size.isNaN())\r\n\t\t\t\tsize = DomElement.getSize(element);\r\n\t\t}\r\n\t\telement.width = size.width;\r\n\t\telement.height = size.height;\r\n\t\tif (PaperScript.hasAttribute(element, 'stats')) {\r\n\t\t\tthis._stats = new Stats();\r\n\t\t\tvar stats = this._stats.domElement,\r\n\t\t\t\tstyle = stats.style,\r\n\t\t\t\toffset = DomElement.getOffset(element);\r\n\t\t\tstyle.position = 'absolute';\r\n\t\t\tstyle.left = offset.x + 'px';\r\n\t\t\tstyle.top = offset.y + 'px';\r\n\t\t\tdocument.body.appendChild(stats);\r\n\t\t}\r\n\t\tView._views.push(this);\r\n\t\tView._viewsById[this._id] = this;\r\n\t\tthis._viewSize = LinkedSize.create(this, 'setViewSize',\r\n\t\t\t\tsize.width, size.height);\r\n\t\tthis._matrix = new Matrix();\r\n\t\tthis._zoom = 1;\r\n\t\tif (!View._focused)\r\n\t\t\tView._focused = this;\r\n\t\tthis._frameItems = {};\r\n\t\tthis._frameItemCount = 0;\r\n\t},\r\n\r\n\tremove: function() {\r\n\t\tif (!this._project)\r\n\t\t\treturn false;\r\n\t\tif (View._focused == this)\r\n\t\t\tView._focused = null;\r\n\t\tView._views.splice(View._views.indexOf(this), 1);\r\n\t\tdelete View._viewsById[this._id];\r\n\t\tif (this._project.view == this)\r\n\t\t\tthis._project.view = null;\r\n\t\tDomEvent.remove(this._element, this._viewHandlers);\r\n\t\tDomEvent.remove(window, this._windowHandlers);\r\n\t\tthis._element = this._project = null;\r\n\t\tthis.detach('frame');\r\n\t\tthis._frameItems = {};\r\n\t\treturn true;\r\n\t},\r\n\r\n\t_events: {\r\n\t\tonFrame: {\r\n\t\t\tinstall: function() {\r\n\t\t\t\tif (!this._requested) {\r\n\t\t\t\t\tthis._animate = true;\r\n\t\t\t\t\tthis._handleFrame(true);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tuninstall: function() {\r\n\t\t\t\tthis._animate = false;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tonResize: {}\r\n\t},\r\n\r\n\t_animate: false,\r\n\t_time: 0,\r\n\t_count: 0,\r\n\r\n\t_handleFrame: function(request) {\r\n\t\tthis._requested = false;\r\n\t\tif (!this._animate)\r\n\t\t\treturn;\r\n\t\tpaper = this._scope;\r\n\t\tif (request) {\r\n\t\t\tthis._requested = true;\r\n\t\t\tvar that = this;\r\n\t\t\tDomEvent.requestAnimationFrame(function() {\r\n\t\t\t\tthat._handleFrame(true);\r\n\t\t\t}, this._element);\r\n\t\t}\r\n\t\tvar now = Date.now() / 1000,\r\n\t\t\tdelta = this._before ? now - this._before : 0;\r\n\t\tthis._before = now;\r\n\t\tthis._handlingFrame = true;\r\n\t\tthis.fire('frame', Base.merge({\r\n\t\t\tdelta: delta,\r\n\t\t\ttime: this._time += delta,\r\n\t\t\tcount: this._count++\r\n\t\t}));\r\n\t\tif (this._stats)\r\n\t\t\tthis._stats.update();\r\n\t\tthis._handlingFrame = false;\r\n\t\tthis.draw(true);\r\n\t},\r\n\r\n\t_animateItem: function(item, animate) {\r\n\t\tvar items = this._frameItems;\r\n\t\tif (animate) {\r\n\t\t\titems[item._id] = {\r\n\t\t\t\titem: item,\r\n\t\t\t\ttime: 0,\r\n\t\t\t\tcount: 0\r\n\t\t\t};\r\n\t\t\tif (++this._frameItemCount == 1)\r\n\t\t\t\tthis.attach('frame', this._handleFrameItems);\r\n\t\t} else {\r\n\t\t\tdelete items[item._id];\r\n\t\t\tif (--this._frameItemCount == 0) {\r\n\t\t\t\tthis.detach('frame', this._handleFrameItems);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_handleFrameItems: function(event) {\r\n\t\tfor (var i in this._frameItems) {\r\n\t\t\tvar entry = this._frameItems[i];\r\n\t\t\tentry.item.fire('frame', Base.merge(event, {\r\n\t\t\t\ttime: entry.time += event.delta,\r\n\t\t\t\tcount: entry.count++\r\n\t\t\t}));\r\n\t\t}\r\n\t},\r\n\r\n\t_redraw: function() {\r\n\t\tthis._redrawNeeded = true;\r\n\t\tif (this._handlingFrame)\r\n\t\t\treturn;\r\n\t\tif (this._animate) {\r\n\t\t\tthis._handleFrame();\r\n\t\t} else {\r\n\t\t\tthis.draw();\r\n\t\t}\r\n\t},\r\n\r\n\t_transform: function(matrix) {\r\n\t\tthis._matrix.concatenate(matrix);\r\n\t\tthis._bounds = null;\r\n\t\tthis._inverse = null;\r\n\t\tthis._redraw();\r\n\t},\r\n\r\n\tgetElement: function() {\r\n\t\treturn this._element;\r\n\t},\r\n\r\n\tgetViewSize: function() {\r\n\t\treturn this._viewSize;\r\n\t},\r\n\r\n\tsetViewSize: function(size) {\r\n\t\tsize = Size.read(arguments);\r\n\t\tvar delta = size.subtract(this._viewSize);\r\n\t\tif (delta.isZero())\r\n\t\t\treturn;\r\n\t\tthis._element.width = size.width;\r\n\t\tthis._element.height = size.height;\r\n\t\tthis._viewSize.set(size.width, size.height, true);\r\n\t\tthis._bounds = null;\r\n\t\tthis.fire('resize', {\r\n\t\t\tsize: size,\r\n\t\t\tdelta: delta\r\n\t\t});\r\n\t\tthis._redraw();\r\n\t},\r\n\r\n\tgetBounds: function() {\r\n\t\tif (!this._bounds)\r\n\t\t\tthis._bounds = this._getInverse()._transformBounds(\r\n\t\t\t\t\tnew Rectangle(new Point(), this._viewSize));\r\n\t\treturn this._bounds;\r\n\t},\r\n\r\n\tgetSize: function() {\r\n\t\treturn this.getBounds().getSize();\r\n\t},\r\n\r\n\tgetCenter: function() {\r\n\t\treturn this.getBounds().getCenter();\r\n\t},\r\n\r\n\tsetCenter: function(center) {\r\n\t\tthis.scrollBy(Point.read(arguments).subtract(this.getCenter()));\r\n\t},\r\n\r\n\tgetZoom: function() {\r\n\t\treturn this._zoom;\r\n\t},\r\n\r\n\tsetZoom: function(zoom) {\r\n\t\tthis._transform(new Matrix().scale(zoom / this._zoom,\r\n\t\t\tthis.getCenter()));\r\n\t\tthis._zoom = zoom;\r\n\t},\r\n\r\n\tisVisible: function() {\r\n\t\treturn DomElement.isInView(this._element);\r\n\t},\r\n\r\n\tscrollBy: function(point) {\r\n\t\tthis._transform(new Matrix().translate(Point.read(arguments).negate()));\r\n\t},\r\n\r\n\tprojectToView: function(point) {\r\n\t\treturn this._matrix._transformPoint(Point.read(arguments));\r\n\t},\r\n\r\n\tviewToProject: function(point) {\r\n\t\treturn this._getInverse()._transformPoint(Point.read(arguments));\r\n\t},\r\n\r\n\t_getInverse: function() {\r\n\t\tif (!this._inverse)\r\n\t\t\tthis._inverse = this._matrix.inverted();\r\n\t\treturn this._inverse;\r\n\t}\r\n\r\n}, {\r\n\tstatics: {\r\n\t\t_views: [],\r\n\t\t_viewsById: {},\r\n\t\t_id: 0,\r\n\r\n\t\tcreate: function(element) {\r\n\t\t\tif (typeof element === 'string')\r\n\t\t\t\telement = document.getElementById(element);\r\n\t\t\treturn new CanvasView(element);\r\n\t\t}\r\n\t}\r\n}, new function() {\r\n\tvar tool,\r\n\t\tprevFocus,\r\n\t\ttempFocus,\r\n\t\tdragging = false;\r\n\r\n\tfunction getView(event) {\r\n\t\tvar target = DomEvent.getTarget(event);\r\n\t\treturn target.getAttribute && View._viewsById[target.getAttribute('id')];\r\n\t}\r\n\r\n\tfunction viewToProject(view, event) {\r\n\t\treturn view.viewToProject(DomEvent.getOffset(event, view._element));\r\n\t}\r\n\r\n\tfunction updateFocus() {\r\n\t\tif (!View._focused || !View._focused.isVisible()) {\r\n\t\t\tfor (var i = 0, l = View._views.length; i < l; i++) {\r\n\t\t\t\tvar view = View._views[i];\r\n\t\t\t\tif (view && view.isVisible()) {\r\n\t\t\t\t\tView._focused = tempFocus = view;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction mousedown(event) {\r\n\t\tvar view = View._focused = getView(event),\r\n\t\t\tpoint = viewToProject(view, event);\r\n\t\tdragging = true;\r\n\t\tif (view._onMouseDown)\r\n\t\t\tview._onMouseDown(event, point);\r\n\t\tif (tool = view._scope._tool)\r\n\t\t\ttool._onHandleEvent('mousedown', point, event);\r\n\t\tview.draw(true);\r\n\t}\r\n\r\n\tfunction mousemove(event) {\r\n\t\tvar view;\r\n\t\tif (!dragging) {\r\n\t\t\tview = getView(event);\r\n\t\t\tif (view) {\r\n\t\t\t\tprevFocus = View._focused;\r\n\t\t\t\tView._focused = tempFocus = view;\r\n\t\t\t} else if (tempFocus && tempFocus == View._focused) {\r\n\t\t\t\tView._focused = prevFocus;\r\n\t\t\t\tupdateFocus();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!(view = view || View._focused))\r\n\t\t\treturn;\r\n\t\tvar point = event && viewToProject(view, event);\r\n\t\tif (view._onMouseMove)\r\n\t\t\tview._onMouseMove(event, point);\r\n\t\tif (tool = view._scope._tool) {\r\n\t\t\tif (tool._onHandleEvent(dragging && tool.responds('mousedrag')\r\n\t\t\t\t\t? 'mousedrag' : 'mousemove', point, event))\r\n\t\t\t\tDomEvent.stop(event);\r\n\t\t}\r\n\t\tview.draw(true);\r\n\t}\r\n\r\n\tfunction mouseup(event) {\r\n\t\tvar view = View._focused;\r\n\t\tif (!view || !dragging)\r\n\t\t\treturn;\r\n\t\tvar point = viewToProject(view, event);\r\n\t\tcurPoint = null;\r\n\t\tdragging = false;\r\n\t\tif (view._onMouseUp)\r\n\t\t\tview._onMouseUp(event, point);\r\n\t\tif (tool && tool._onHandleEvent('mouseup', point, event))\r\n\t\t\tDomEvent.stop(event);\r\n\t\tview.draw(true);\r\n\t}\r\n\r\n\tfunction selectstart(event) {\r\n\t\tif (dragging)\r\n\t\t\tDomEvent.stop(event);\r\n\t}\r\n\r\n\tDomEvent.add(document, {\r\n\t\tmousemove: mousemove,\r\n\t\tmouseup: mouseup,\r\n\t\ttouchmove: mousemove,\r\n\t\ttouchend: mouseup,\r\n\t\tselectstart: selectstart,\r\n\t\tscroll: updateFocus\r\n\t});\r\n\r\n\tDomEvent.add(window, {\r\n\t\tload: updateFocus\r\n\t});\r\n\r\n\treturn {\r\n\t\t_viewHandlers: {\r\n\t\t\tmousedown: mousedown,\r\n\t\t\ttouchstart: mousedown,\r\n\t\t\tselectstart: selectstart\r\n\t\t},\r\n\r\n\t\tstatics: {\r\n\t\t\tupdateFocus: updateFocus\r\n\t\t}\r\n\t};\r\n});\r\n\r\nvar CanvasView = View.extend({\r\n\tinitialize: function(canvas) {\r\n\t\tif (!(canvas instanceof HTMLCanvasElement)) {\r\n\t\t\tvar size = Size.read(arguments, 1);\r\n\t\t\tif (size.isZero())\r\n\t\t\t\tsize = Size.create(1024, 768);\r\n\t\t\tcanvas = CanvasProvider.getCanvas(size);\r\n\t\t}\r\n\t\tthis._context = canvas.getContext('2d');\r\n\t\tthis._eventCounters = {};\r\n\t\tthis.base(canvas);\r\n\t},\r\n\r\n\tdraw: function(checkRedraw) {\r\n\t\tif (checkRedraw && !this._redrawNeeded)\r\n\t\t\treturn false;\r\n\t\tvar ctx = this._context,\r\n\t\t\tsize = this._viewSize;\r\n\t\tctx.clearRect(0, 0, size._width + 1, size._height + 1);\r\n\t\tthis._project.draw(ctx, this._matrix);\r\n\t\tthis._redrawNeeded = false;\r\n\t\treturn true;\r\n\t}\r\n}, new function() {\r\n\r\n\tvar downPoint,\r\n\t\tlastPoint,\r\n\t\toverPoint,\r\n\t\tdownItem,\r\n\t\tlastItem,\r\n\t\toverItem,\r\n\t\thasDrag,\r\n\t\tdoubleClick,\r\n\t\tclickTime;\r\n\r\n\tfunction callEvent(type, event, point, target, lastPoint, bubble) {\r\n\t\tvar item = target,\r\n\t\t\tmouseEvent;\r\n\t\twhile (item) {\r\n\t\t\tif (item.responds(type)) {\r\n\t\t\t\tif (!mouseEvent)\r\n\t\t\t\t\tmouseEvent = new MouseEvent(type, event, point, target,\r\n\t\t\t\t\t\t\tlastPoint ? point.subtract(lastPoint) : null);\r\n\t\t\t\tif (item.fire(type, mouseEvent)\r\n\t\t\t\t\t\t&& (!bubble || mouseEvent._stopped))\r\n\t\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\titem = item.getParent();\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tfunction handleEvent(view, type, event, point, lastPoint) {\r\n\t\tif (view._eventCounters[type]) {\r\n\t\t\tvar project = view._project,\r\n\t\t\t\thit = project.hitTest(point, {\r\n\t\t\t\t\ttolerance: project.options.hitTolerance || 0,\r\n\t\t\t\t\tfill: true,\r\n\t\t\t\t\tstroke: true\r\n\t\t\t\t}),\r\n\t\t\t\titem = hit && hit.item;\r\n\t\t\tif (item) {\r\n\t\t\t\tif (type === 'mousemove' && item != overItem)\r\n\t\t\t\t\tlastPoint = point;\r\n\t\t\t\tif (type !== 'mousemove' || !hasDrag)\r\n\t\t\t\t\tcallEvent(type, event, point, item, lastPoint);\r\n\t\t\t\treturn item;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn {\r\n\t\t_onMouseDown: function(event, point) {\r\n\t\t\tvar item = handleEvent(this, 'mousedown', event, point);\r\n\t\t\tdoubleClick = lastItem == item && (Date.now() - clickTime < 300);\r\n\t\t\tdownItem = lastItem = item;\r\n\t\t\tdownPoint = lastPoint = overPoint = point;\r\n\t\t\thasDrag = downItem && downItem.responds('mousedrag');\r\n\t\t},\r\n\r\n\t\t_onMouseUp: function(event, point) {\r\n\t\t\tvar item = handleEvent(this, 'mouseup', event, point);\r\n\t\t\tif (hasDrag) {\r\n\t\t\t\tif (lastPoint && !lastPoint.equals(point))\r\n\t\t\t\t\tcallEvent('mousedrag', event, point, downItem, lastPoint);\r\n\t\t\t\tif (item != downItem) {\r\n\t\t\t\t\toverPoint = point;\r\n\t\t\t\t\tcallEvent('mousemove', event, point, item, overPoint);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (item === downItem) {\r\n\t\t\t\tclickTime = Date.now();\r\n\t\t\t\tif (!doubleClick\r\n\t\t\t\t\t\t|| callEvent('doubleclick', event, downPoint, item))\r\n\t\t\t\t\tcallEvent('click', event, downPoint, item);\r\n\t\t\t\tdoubleClick = false;\r\n\t\t\t}\r\n\t\t\tdownItem = null;\r\n\t\t\thasDrag = false;\r\n\t\t},\r\n\r\n\t\t_onMouseMove: function(event, point) {\r\n\t\t\tif (downItem)\r\n\t\t\t\tcallEvent('mousedrag', event, point, downItem, lastPoint);\r\n\t\t\tvar item = handleEvent(this, 'mousemove', event, point, overPoint);\r\n\t\t\tlastPoint = overPoint = point;\r\n\t\t\tif (item !== overItem) {\r\n\t\t\t\tcallEvent('mouseleave', event, point, overItem);\r\n\t\t\t\toverItem = item;\r\n\t\t\t\tcallEvent('mouseenter', event, point, item);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n});\r\n\r\nvar Event = this.Event = Base.extend({\r\n\tinitialize: function(event) {\r\n\t\tthis.event = event;\r\n\t},\r\n\r\n\tpreventDefault: function() {\r\n\t\tthis._prevented = true;\r\n\t\tDomEvent.preventDefault(this.event);\r\n\t},\r\n\r\n\tstopPropagation: function() {\r\n\t\tthis._stopped = true;\r\n\t\tDomEvent.stopPropagation(this.event);\r\n\t},\r\n\r\n\tstop: function() {\r\n\t\tthis.stopPropagation();\r\n\t\tthis.preventDefault();\r\n\t},\r\n\r\n\tgetModifiers: function() {\r\n\t\treturn Key.modifiers;\r\n\t}\r\n});\r\n\r\nvar KeyEvent = this.KeyEvent = Event.extend({\r\n\tinitialize: function(down, key, character, event) {\r\n\t\tthis.base(event);\r\n\t\tthis.type = down ? 'keydown' : 'keyup';\r\n\t\tthis.key = key;\r\n\t\tthis.character = character;\r\n\t},\r\n\r\n\ttoString: function() {\r\n\t\treturn \"{ type: '\" + this.type\r\n\t\t\t\t+ \"', key: '\" + this.key\r\n\t\t\t\t+ \"', character: '\" + this.character\r\n\t\t\t\t+ \"', modifiers: \" + this.getModifiers()\r\n\t\t\t\t+ \" }\";\r\n\t}\r\n});\r\n\r\nvar Key = this.Key = new function() {\r\n\r\n\tvar keys = {\r\n\t\t8: 'backspace',\r\n\t\t9: 'tab',\r\n\t\t13: 'enter',\r\n\t\t16: 'shift',\r\n\t\t17: 'control',\r\n\t\t18: 'option',\r\n\t\t19: 'pause',\r\n\t\t20: 'caps-lock',\r\n\t\t27: 'escape',\r\n\t\t32: 'space',\r\n\t\t35: 'end',\r\n\t\t36: 'home',\r\n\t\t37: 'left',\r\n\t\t38: 'up',\r\n\t\t39: 'right',\r\n\t\t40: 'down',\r\n\t\t46: 'delete',\r\n\t\t91: 'command',\r\n\t\t93: 'command',\r\n\t\t224: 'command'\r\n\t},\r\n\r\n\tmodifiers = Base.merge({\r\n\t\tshift: false,\r\n\t\tcontrol: false,\r\n\t\toption: false,\r\n\t\tcommand: false,\r\n\t\tcapsLock: false,\r\n\t\tspace: false\r\n\t}),\r\n\r\n\tcharCodeMap = {},\r\n\tkeyMap = {},\r\n\tdownCode;\r\n\r\n\tfunction handleKey(down, keyCode, charCode, event) {\r\n\t\tvar character = String.fromCharCode(charCode),\r\n\t\t\tkey = keys[keyCode] || character.toLowerCase(),\r\n\t\t\ttype = down ? 'keydown' : 'keyup',\r\n\t\t\tview = View._focused,\r\n\t\t\tscope = view && view.isVisible() && view._scope,\r\n\t\t\ttool = scope && scope._tool;\r\n\t\tkeyMap[key] = down;\r\n\t\tif (tool && tool.responds(type)) {\r\n\t\t\ttool.fire(type, new KeyEvent(down, key, character, event));\r\n\t\t\tif (view)\r\n\t\t\t\tview.draw(true);\r\n\t\t}\r\n\t}\r\n\r\n\tDomEvent.add(document, {\r\n\t\tkeydown: function(event) {\r\n\t\t\tvar code = event.which || event.keyCode;\r\n\t\t\tvar key = keys[code], name;\r\n\t\t\tif (key) {\r\n\t\t\t\tif ((name = Base.camelize(key)) in modifiers)\r\n\t\t\t\t\tmodifiers[name] = true;\r\n\t\t\t\tcharCodeMap[code] = 0;\r\n\t\t\t\thandleKey(true, code, null, event);\r\n\t\t\t} else {\r\n\t\t\t\tdownCode = code;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tkeypress: function(event) {\r\n\t\t\tif (downCode != null) {\r\n\t\t\t\tvar code = event.which || event.keyCode;\r\n\t\t\t\tcharCodeMap[downCode] = code;\r\n\t\t\t\thandleKey(true, downCode, code, event);\r\n\t\t\t\tdownCode = null;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tkeyup: function(event) {\r\n\t\t\tvar code = event.which || event.keyCode,\r\n\t\t\t\tkey = keys[code], name;\r\n\t\t\tif (key && (name = Base.camelize(key)) in modifiers)\r\n\t\t\t\tmodifiers[name] = false;\r\n\t\t\tif (charCodeMap[code] != null) {\r\n\t\t\t\thandleKey(false, code, charCodeMap[code], event);\r\n\t\t\t\tdelete charCodeMap[code];\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\treturn {\r\n\t\tmodifiers: modifiers,\r\n\r\n\t\tisDown: function(key) {\r\n\t\t\treturn !!keyMap[key];\r\n\t\t}\r\n\t};\r\n};\r\n\r\nvar MouseEvent = this.MouseEvent = Event.extend({\r\n\tinitialize: function(type, event, point, target, delta) {\r\n\t\tthis.base(event);\r\n\t\tthis.type = type;\r\n\t\tthis.point = point;\r\n\t\tthis.target = target;\r\n\t\tthis.delta = delta;\r\n\t},\r\n\r\n\ttoString: function() {\r\n\t\treturn \"{ type: '\" + this.type\r\n\t\t\t\t+ \"', point: \" + this.point\r\n\t\t\t\t+ ', target: ' + this.target\r\n\t\t\t\t+ (this.delta ? ', delta: ' + this.delta : '')\r\n\t\t\t\t+ ', modifiers: ' + this.getModifiers()\r\n\t\t\t\t+ ' }';\r\n\t}\r\n});\r\n\r\nvar Palette = this.Palette = Base.extend(Callback, {\r\n\t_events: [ 'onChange' ],\r\n\r\n\tinitialize: function(title, components, values) {\r\n\t\tvar parent = DomElement.find('.palettejs-panel')\r\n\t\t\t|| DomElement.find('body').appendChild(\r\n\t\t\t\tDomElement.create('div', { 'class': 'palettejs-panel' }));\r\n\t\tthis._element = parent.appendChild(\r\n\t\t\tDomElement.create('table', { 'class': 'palettejs-pane' })),\r\n\t\tthis._title = title;\r\n\t\tif (!values)\r\n\t\t\tvalues = {};\r\n\t\tfor (var name in (this._components = components)) {\r\n\t\t\tvar component = components[name];\r\n\t\t\tif (!(component instanceof Component)) {\r\n\t\t\t\tif (component.value == null)\r\n\t\t\t\t\tcomponent.value = values[name];\r\n\t\t\t\tcomponent.name = name;\r\n\t\t\t\tcomponent = components[name] = new Component(component);\r\n\t\t\t}\r\n\t\t\tthis._element.appendChild(component._element);\r\n\t\t\tcomponent._palette = this;\r\n\t\t\tif (values[name] === undefined)\r\n\t\t\t\tvalues[name] = component.value;\r\n\t\t}\r\n\t\tthis._values = Base.each(values, function(value, name) {\r\n\t\t\tvar component = components[name];\r\n\t\t\tif (component) {\r\n\t\t\t\tBase.define(values, name, {\r\n\t\t\t\t\tenumerable: true,\r\n\t\t\t\t\tconfigurable: true,\r\n\t\t\t\t\twritable: true,\r\n\t\t\t\t\tget: function() {\r\n\t\t\t\t\t\treturn component._value;\r\n\t\t\t\t\t},\r\n\t\t\t\t\tset: function(val) {\r\n\t\t\t\t\t\tcomponent.setValue(val);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (window.paper)\r\n\t\t\tpaper.palettes.push(this);\r\n\t},\r\n\r\n\treset: function() {\r\n\t\tfor (var i in this._components)\r\n\t\t\tthis._components[i].reset();\r\n\t},\r\n\r\n\tremove: function() {\r\n\t\tDomElement.remove(this._element);\r\n\t}\r\n});\r\n\r\nvar Component = this.Component = Base.extend(Callback, {\r\n\t_events: [ 'onChange', 'onClick' ],\r\n\r\n\t_types: {\r\n\t\t'boolean': {\r\n\t\t\ttype: 'checkbox',\r\n\t\t\tvalue: 'checked'\r\n\t\t},\r\n\r\n\t\tstring: {\r\n\t\t\ttype: 'text'\r\n\t\t},\r\n\r\n\t\tnumber: {\r\n\t\t\ttype: 'number',\r\n\t\t\tnumber: true\r\n\t\t},\r\n\r\n\t\tbutton: {\r\n\t\t\ttype: 'button'\r\n\t\t},\r\n\r\n\t\ttext: {\r\n\t\t\ttag: 'div',\r\n\t\t\tvalue: 'text'\r\n\t\t},\r\n\r\n\t\tslider: {\r\n\t\t\ttype: 'range',\r\n\t\t\tnumber: true\r\n\t\t},\r\n\r\n\t\tlist: {\r\n\t\t\ttag: 'select',\r\n\r\n\t\t\toptions: function() {\r\n\t\t\t\tDomElement.removeChildren(this._inputItem);\r\n\t\t\t\tDomElement.create(Base.each(this._options, function(option) {\r\n\t\t\t\t\tthis.push('option', { value: option, text: option });\r\n\t\t\t\t}, []), this._inputItem);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tinitialize: function(obj) {\r\n\t\tthis._type = obj.type in this._types\r\n\t\t\t? obj.type\r\n\t\t\t: 'options' in obj\r\n\t\t\t\t? 'list'\r\n\t\t\t\t: 'onClick' in obj\r\n\t\t\t\t\t? 'button'\r\n\t\t\t\t\t: typeof obj.value;\r\n\t\tthis._info = this._types[this._type] || { type: this._type };\r\n\t\tvar that = this,\r\n\t\t\tfireChange = false;\r\n\t\tthis._inputItem = DomElement.create(this._info.tag || 'input', {\r\n\t\t\ttype: this._info.type,\r\n\t\t\tevents: {\r\n\t\t\t\tchange: function() {\r\n\t\t\t\t\tthat.setValue(\r\n\t\t\t\t\t\tDomElement.get(this, that._info.value || 'value'));\r\n\t\t\t\t\tif (fireChange) {\r\n\t\t\t\t\t\tthat._palette.fire('change', that, that.name, that._value);\r\n\t\t\t\t\t\tthat.fire('change', that._value);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tclick: function() {\r\n\t\t\t\t\tthat.fire('click');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis._element = DomElement.create('tr', [\r\n\t\t\tthis._labelItem = DomElement.create('td'),\r\n\t\t\t'td', [this._inputItem]\r\n\t\t]);\r\n\t\tBase.each(obj, function(value, key) {\r\n\t\t\tthis[key] = value;\r\n\t\t}, this);\r\n\t\tthis._defaultValue = this._value;\r\n\t\tfireChange = true;\r\n\t},\r\n\r\n\tgetType: function() {\r\n\t\treturn this._type;\r\n\t},\r\n\r\n\tgetLabel: function() {\r\n\t\treturn this._label;\r\n\t},\r\n\r\n\tsetLabel: function(label) {\r\n\t\tthis._label = label;\r\n\t\tDomElement.set(this._labelItem, 'text', label + ':');\r\n\t},\r\n\r\n\tgetOptions: function() {\r\n\t\treturn this._options;\r\n\t},\r\n\r\n\tsetOptions: function(options) {\r\n\t\tthis._options = options;\r\n\t\tif (this._info.options)\r\n\t\t\tthis._info.options.call(this);\r\n\t},\r\n\r\n\tgetValue: function() {\r\n\t\treturn this._value;\r\n\t},\r\n\r\n\tsetValue: function(value) {\r\n\t\tvar key = this._info.value || 'value';\r\n\t\tDomElement.set(this._inputItem, key, value);\r\n\t\tvalue = DomElement.get(this._inputItem, key);\r\n\t\tthis._value = this._info.number ? parseFloat(value, 10) : value;\r\n\t},\r\n\r\n\tgetRange: function() {\r\n\t\treturn [parseFloat(DomElement.get(this._inputItem, 'min')),\r\n\t\t\t\tparseFloat(DomElement.get(this._inputItem, 'max'))];\r\n\t},\r\n\r\n\tsetRange: function(min, max) {\r\n\t\tvar range = Array.isArray(min) ? min : [min, max];\r\n\t\tDomElement.set(this._inputItem, { min: range[0], max: range[1] });\r\n\t},\r\n\r\n\tgetMin: function() {\r\n\t\treturn this.getRange()[0];\r\n\t},\r\n\r\n\tsetMin: function(min) {\r\n\t\tthis.setRange(min, this.getMax());\r\n\t},\r\n\r\n\tgetMax: function() {\r\n\t\treturn this.getRange()[1];\r\n\t},\r\n\r\n\tsetMax: function(max) {\r\n\t\tthis.setRange(this.getMin(), max);\r\n\t},\r\n\r\n\tgetStep: function() {\r\n\t\treturn parseFloat(DomElement.get(this._inputItem, 'step'));\r\n\t},\r\n\r\n\tsetStep: function(step) {\r\n\t\tDomElement.set(this._inputItem, 'step', step);\r\n\t},\r\n\r\n\treset: function() {\r\n\t\tthis.setValue(this._defaultValue);\r\n\t}\r\n});\r\n\r\nvar ToolEvent = this.ToolEvent = Event.extend({\r\n\t_item: null,\r\n\r\n\tinitialize: function(tool, type, event) {\r\n\t\tthis.tool = tool;\r\n\t\tthis.type = type;\r\n\t\tthis.event = event;\r\n\t},\r\n\r\n\t_choosePoint: function(point, toolPoint) {\r\n\t\treturn point ? point : toolPoint ? toolPoint.clone() : null;\r\n\t},\r\n\r\n\tgetPoint: function() {\r\n\t\treturn this._choosePoint(this._point, this.tool._point);\r\n\t},\r\n\r\n\tsetPoint: function(point) {\r\n\t\tthis._point = point;\r\n\t},\r\n\r\n\tgetLastPoint: function() {\r\n\t\treturn this._choosePoint(this._lastPoint, this.tool._lastPoint);\r\n\t},\r\n\r\n\tsetLastPoint: function(lastPoint) {\r\n\t\tthis._lastPoint = lastPoint;\r\n\t},\r\n\r\n\tgetDownPoint: function() {\r\n\t\treturn this._choosePoint(this._downPoint, this.tool._downPoint);\r\n\t},\r\n\r\n\tsetDownPoint: function(downPoint) {\r\n\t\tthis._downPoint = downPoint;\r\n\t},\r\n\r\n\tgetMiddlePoint: function() {\r\n\t\tif (!this._middlePoint && this.tool._lastPoint) {\r\n\t\t\treturn this.tool._point.add(this.tool._lastPoint).divide(2);\r\n\t\t}\r\n\t\treturn this.middlePoint;\r\n\t},\r\n\r\n\tsetMiddlePoint: function(middlePoint) {\r\n\t\tthis._middlePoint = middlePoint;\r\n\t},\r\n\r\n\tgetDelta: function() {\r\n\t\treturn !this._delta && this.tool._lastPoint\r\n\t\t \t\t? this.tool._point.subtract(this.tool._lastPoint)\r\n\t\t\t\t: this._delta;\r\n\t},\r\n\r\n\tsetDelta: function(delta) {\r\n\t\tthis._delta = delta;\r\n\t},\r\n\r\n\tgetCount: function() {\r\n\t\treturn /^mouse(down|up)$/.test(this.type)\r\n\t\t\t\t? this.tool._downCount\r\n\t\t\t\t: this.tool._count;\r\n\t},\r\n\r\n\tsetCount: function(count) {\r\n\t\tthis.tool[/^mouse(down|up)$/.test(this.type) ? 'downCount' : 'count']\r\n\t\t\t= count;\r\n\t},\r\n\r\n\tgetItem: function() {\r\n\t\tif (!this._item) {\r\n\t\t\tvar result = this.tool._scope.project.hitTest(this.getPoint());\r\n\t\t\tif (result) {\r\n\t\t\t\tvar item = result.item,\r\n\t\t\t\t\tparent = item._parent;\r\n\t\t\t\twhile ((parent instanceof Group && !(parent instanceof Layer))\r\n\t\t\t\t\t\t|| parent instanceof CompoundPath) {\r\n\t\t\t\t\titem = parent;\r\n\t\t\t\t\tparent = parent._parent;\r\n\t\t\t\t}\r\n\t\t\t\tthis._item = item;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._item;\r\n\t},\r\n\tsetItem: function(item) {\r\n\t\tthis._item = item;\r\n\t},\r\n\r\n\ttoString: function() {\r\n\t\treturn '{ type: ' + this.type\r\n\t\t\t\t+ ', point: ' + this.getPoint()\r\n\t\t\t\t+ ', count: ' + this.getCount()\r\n\t\t\t\t+ ', modifiers: ' + this.getModifiers()\r\n\t\t\t\t+ ' }';\r\n\t}\r\n});\r\n\r\nvar Tool = this.Tool = PaperScopeItem.extend({\r\n\t_list: 'tools',\r\n\t_reference: '_tool',\r\n\t_events: [ 'onActivate', 'onDeactivate', 'onEditOptions',\r\n\t\t\t'onMouseDown', 'onMouseUp', 'onMouseDrag', 'onMouseMove',\r\n\t\t\t'onKeyDown', 'onKeyUp' ],\r\n\r\n\tinitialize: function(props) {\r\n\t\tthis.base();\r\n\t\tthis._firstMove = true;\r\n\t\tthis._count = 0;\r\n\t\tthis._downCount = 0;\r\n\t\tthis._set(props);\r\n\t},\r\n\r\n\tgetMinDistance: function() {\r\n\t\treturn this._minDistance;\r\n\t},\r\n\r\n\tsetMinDistance: function(minDistance) {\r\n\t\tthis._minDistance = minDistance;\r\n\t\tif (this._minDistance != null && this._maxDistance != null\r\n\t\t\t\t&& this._minDistance > this._maxDistance) {\r\n\t\t\tthis._maxDistance = this._minDistance;\r\n\t\t}\r\n\t},\r\n\r\n\tgetMaxDistance: function() {\r\n\t\treturn this._maxDistance;\r\n\t},\r\n\r\n\tsetMaxDistance: function(maxDistance) {\r\n\t\tthis._maxDistance = maxDistance;\r\n\t\tif (this._minDistance != null && this._maxDistance != null\r\n\t\t\t\t&& this._maxDistance < this._minDistance) {\r\n\t\t\tthis._minDistance = maxDistance;\r\n\t\t}\r\n\t},\r\n\r\n\tgetFixedDistance: function() {\r\n\t\treturn this._minDistance == this._maxDistance\r\n\t\t\t? this._minDistance : null;\r\n\t},\r\n\r\n\tsetFixedDistance: function(distance) {\r\n\t\tthis._minDistance = distance;\r\n\t\tthis._maxDistance = distance;\r\n\t},\r\n\r\n\t_updateEvent: function(type, point, minDistance, maxDistance, start,\r\n\t\t\tneedsChange, matchMaxDistance) {\r\n\t\tif (!start) {\r\n\t\t\tif (minDistance != null || maxDistance != null) {\r\n\t\t\t\tvar minDist = minDistance != null ? minDistance : 0,\r\n\t\t\t\t\tvector = point.subtract(this._point),\r\n\t\t\t\t\tdistance = vector.getLength();\r\n\t\t\t\tif (distance < minDist)\r\n\t\t\t\t\treturn false;\r\n\t\t\t\tvar maxDist = maxDistance != null ? maxDistance : 0;\r\n\t\t\t\tif (maxDist != 0) {\r\n\t\t\t\t\tif (distance > maxDist) {\r\n\t\t\t\t\t\tpoint = this._point.add(vector.normalize(maxDist));\r\n\t\t\t\t\t} else if (matchMaxDistance) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (needsChange && point.equals(this._point))\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\t\tthis._lastPoint = start && type == 'mousemove' ? point : this._point;\r\n\t\tthis._point = point;\r\n\t\tswitch (type) {\r\n\t\tcase 'mousedown':\r\n\t\t\tthis._lastPoint = this._downPoint;\r\n\t\t\tthis._downPoint = this._point;\r\n\t\t\tthis._downCount++;\r\n\t\t\tbreak;\r\n\t\tcase 'mouseup':\r\n\t\t\tthis._lastPoint = this._downPoint;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tthis._count = start ? 0 : this._count + 1;\r\n\t\treturn true;\r\n\t},\r\n\r\n\tfire: function(type, event) {\r\n\t\tvar sets = Tool._removeSets;\r\n\t\tif (sets) {\r\n\t\t\tif (type === 'mouseup')\r\n\t\t\t\tsets.mousedrag = null;\r\n\t\t\tvar set = sets[type];\r\n\t\t\tif (set) {\r\n\t\t\t\tfor (var id in set) {\r\n\t\t\t\t\tvar item = set[id];\r\n\t\t\t\t\tfor (var key in sets) {\r\n\t\t\t\t\t\tvar other = sets[key];\r\n\t\t\t\t\t\tif (other && other != set)\r\n\t\t\t\t\t\t\tdelete other[item._id];\r\n\t\t\t\t\t}\r\n\t\t\t\t\titem.remove();\r\n\t\t\t\t}\r\n\t\t\t\tsets[type] = null;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this.base(type, event);\r\n\t},\r\n\r\n\t_onHandleEvent: function(type, point, event) {\r\n\t\tpaper = this._scope;\r\n\t\tvar called = false;\r\n\t\tswitch (type) {\r\n\t\tcase 'mousedown':\r\n\t\t\tthis._updateEvent(type, point, null, null, true, false, false);\r\n\t\t\tif (this.responds(type))\r\n\t\t\t\tcalled = this.fire(type, new ToolEvent(this, type, event));\r\n\t\t\tbreak;\r\n\t\tcase 'mousedrag':\r\n\t\t\tvar needsChange = false,\r\n\t\t\t\tmatchMaxDistance = false;\r\n\t\t\twhile (this._updateEvent(type, point, this.minDistance,\r\n\t\t\t\t\tthis.maxDistance, false, needsChange, matchMaxDistance)) {\r\n\t\t\t\tif (this.responds(type))\r\n\t\t\t\t\tcalled = this.fire(type, new ToolEvent(this, type, event));\r\n\t\t\t\tneedsChange = true;\r\n\t\t\t\tmatchMaxDistance = true;\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase 'mouseup':\r\n\t\t\tif (!point.equals(this._point)\r\n\t\t\t\t\t&& this._updateEvent('mousedrag', point, this.minDistance,\r\n\t\t\t\t\t\t\tthis.maxDistance, false, false, false)) {\r\n\t\t\t\tif (this.responds('mousedrag'))\r\n\t\t\t\t\tcalled = this.fire('mousedrag',\r\n\t\t\t\t\t\t\tnew ToolEvent(this, type, event));\r\n\t\t\t}\r\n\t\t\tthis._updateEvent(type, point, null, this.maxDistance, false,\r\n\t\t\t\t\tfalse, false);\r\n\t\t\tif (this.responds(type))\r\n\t\t\t\tcalled = this.fire(type, new ToolEvent(this, type, event));\r\n\t\t\tthis._updateEvent(type, point, null, null, true, false, false);\r\n\t\t\tthis._firstMove = true;\r\n\t\t\tbreak;\r\n\t\tcase 'mousemove':\r\n\t\t\twhile (this._updateEvent(type, point, this.minDistance,\r\n\t\t\t\t\tthis.maxDistance, this._firstMove, true, false)) {\r\n\t\t\t\tif (this.responds(type))\r\n\t\t\t\t\tcalled = this.fire(type, new ToolEvent(this, type, event));\r\n\t\t\t\tthis._firstMove = false;\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\treturn called;\r\n\t}\r\n\r\n});\r\n\r\nvar Formatter = Base.extend({\r\n\tinitialize: function(precision) {\r\n\t\tthis.precision = precision || 5;\r\n\t\tthis.multiplier = Math.pow(10, this.precision);\r\n\t},\r\n\r\n\tnumber: function(val) {\r\n\t\treturn Math.round(val * this.multiplier) / this.multiplier;\r\n\t},\r\n\r\n\tpoint: function(val, separator) {\r\n\t\treturn this.number(val.x) + (separator || ',') + this.number(val.y);\r\n\t},\r\n\r\n\tsize: function(val, separator) {\r\n\t\treturn this.number(val.width) + (separator || ',')\r\n\t\t\t\t+ this.number(val.height);\r\n\t},\r\n\r\n\trectangle: function(val, separator) {\r\n\t\treturn this.point(val, separator) + (separator || ',')\r\n\t\t\t\t+ this.size(val, separator);\r\n\t}\r\n});\r\n\r\nFormatter.instance = new Formatter(5);\r\n\r\nvar CanvasProvider = {\r\n\tcanvases: [],\r\n\r\n\tgetCanvas: function(width, height) {\r\n\t\tvar size = height === undefined ? width : Size.create(width, height);\r\n\t\tif (this.canvases.length) {\r\n\t\t\tvar canvas = this.canvases.pop();\r\n\t\t\tif ((canvas.width != size.width)\r\n\t\t\t\t\t|| (canvas.height != size.height)) {\r\n\t\t\t\tcanvas.width = size.width;\r\n\t\t\t\tcanvas.height = size.height;\r\n\t\t\t} else {\r\n\t\t\t\tcanvas.getContext('2d').clearRect(0, 0,\r\n\t\t\t\t\t\tsize.width + 1, size.height + 1);\r\n\t\t\t}\r\n\t\t\treturn canvas;\r\n\t\t} else {\r\n\t\t\tvar canvas = document.createElement('canvas');\r\n\t\t\tcanvas.width = size.width;\r\n\t\t\tcanvas.height = size.height;\r\n\t\t\treturn canvas;\r\n\t\t}\r\n\t},\r\n\r\n\tgetContext: function(width, height) {\r\n\t\treturn this.getCanvas(width, height).getContext('2d');\r\n\t},\r\n\r\n\trelease: function(obj) {\r\n\t\tthis.canvases.push(obj.canvas ? obj.canvas : obj);\r\n\t},\r\n};\r\n\r\nvar Numerical = new function() {\r\n\r\n\tvar abscissas = [\r\n\t\t[  0.5773502691896257645091488],\r\n\t\t[0,0.7745966692414833770358531],\r\n\t\t[  0.3399810435848562648026658,0.8611363115940525752239465],\r\n\t\t[0,0.5384693101056830910363144,0.9061798459386639927976269],\r\n\t\t[  0.2386191860831969086305017,0.6612093864662645136613996,0.9324695142031520278123016],\r\n\t\t[0,0.4058451513773971669066064,0.7415311855993944398638648,0.9491079123427585245261897],\r\n\t\t[  0.1834346424956498049394761,0.5255324099163289858177390,0.7966664774136267395915539,0.9602898564975362316835609],\r\n\t\t[0,0.3242534234038089290385380,0.6133714327005903973087020,0.8360311073266357942994298,0.9681602395076260898355762],\r\n\t\t[  0.1488743389816312108848260,0.4333953941292471907992659,0.6794095682990244062343274,0.8650633666889845107320967,0.9739065285171717200779640],\r\n\t\t[0,0.2695431559523449723315320,0.5190961292068118159257257,0.7301520055740493240934163,0.8870625997680952990751578,0.9782286581460569928039380],\r\n\t\t[  0.1252334085114689154724414,0.3678314989981801937526915,0.5873179542866174472967024,0.7699026741943046870368938,0.9041172563704748566784659,0.9815606342467192506905491],\r\n\t\t[0,0.2304583159551347940655281,0.4484927510364468528779129,0.6423493394403402206439846,0.8015780907333099127942065,0.9175983992229779652065478,0.9841830547185881494728294],\r\n\t\t[  0.1080549487073436620662447,0.3191123689278897604356718,0.5152486363581540919652907,0.6872929048116854701480198,0.8272013150697649931897947,0.9284348836635735173363911,0.9862838086968123388415973],\r\n\t\t[0,0.2011940939974345223006283,0.3941513470775633698972074,0.5709721726085388475372267,0.7244177313601700474161861,0.8482065834104272162006483,0.9372733924007059043077589,0.9879925180204854284895657],\r\n\t\t[  0.0950125098376374401853193,0.2816035507792589132304605,0.4580167776572273863424194,0.6178762444026437484466718,0.7554044083550030338951012,0.8656312023878317438804679,0.9445750230732325760779884,0.9894009349916499325961542]\r\n\t];\r\n\r\n\tvar weights = [\r\n\t\t[1],\r\n\t\t[0.8888888888888888888888889,0.5555555555555555555555556],\r\n\t\t[0.6521451548625461426269361,0.3478548451374538573730639],\r\n\t\t[0.5688888888888888888888889,0.4786286704993664680412915,0.2369268850561890875142640],\r\n\t\t[0.4679139345726910473898703,0.3607615730481386075698335,0.1713244923791703450402961],\r\n\t\t[0.4179591836734693877551020,0.3818300505051189449503698,0.2797053914892766679014678,0.1294849661688696932706114],\r\n\t\t[0.3626837833783619829651504,0.3137066458778872873379622,0.2223810344533744705443560,0.1012285362903762591525314],\r\n\t\t[0.3302393550012597631645251,0.3123470770400028400686304,0.2606106964029354623187429,0.1806481606948574040584720,0.0812743883615744119718922],\r\n\t\t[0.2955242247147528701738930,0.2692667193099963550912269,0.2190863625159820439955349,0.1494513491505805931457763,0.0666713443086881375935688],\r\n\t\t[0.2729250867779006307144835,0.2628045445102466621806889,0.2331937645919904799185237,0.1862902109277342514260976,0.1255803694649046246346943,0.0556685671161736664827537],\r\n\t\t[0.2491470458134027850005624,0.2334925365383548087608499,0.2031674267230659217490645,0.1600783285433462263346525,0.1069393259953184309602547,0.0471753363865118271946160],\r\n\t\t[0.2325515532308739101945895,0.2262831802628972384120902,0.2078160475368885023125232,0.1781459807619457382800467,0.1388735102197872384636018,0.0921214998377284479144218,0.0404840047653158795200216],\r\n\t\t[0.2152638534631577901958764,0.2051984637212956039659241,0.1855383974779378137417166,0.1572031671581935345696019,0.1215185706879031846894148,0.0801580871597602098056333,0.0351194603317518630318329],\r\n\t\t[0.2025782419255612728806202,0.1984314853271115764561183,0.1861610000155622110268006,0.1662692058169939335532009,0.1395706779261543144478048,0.1071592204671719350118695,0.0703660474881081247092674,0.0307532419961172683546284],\r\n\t\t[0.1894506104550684962853967,0.1826034150449235888667637,0.1691565193950025381893121,0.1495959888165767320815017,0.1246289712555338720524763,0.0951585116824927848099251,0.0622535239386478928628438,0.0271524594117540948517806]\r\n\t];\r\n\r\n\tvar abs = Math.abs,\r\n\t\tsqrt = Math.sqrt,\r\n\t\tpow = Math.pow,\r\n\t\tcos = Math.cos,\r\n\t\tPI = Math.PI;\r\n\r\n\tfunction cbrt(x) {\r\n\t\treturn x > 0 ? pow(x, 1 / 3) : x < 0 ? -pow(-x, 1 / 3) : 0;\r\n\t}\r\n\r\n\treturn {\r\n\t\tTOLERANCE: 10e-6,\r\n\t\tEPSILON: 10e-12,\r\n\r\n\t\tisZero: function(val) {\r\n\t\t\treturn abs(val) <= this.EPSILON;\r\n\t\t},\r\n\r\n\t\tintegrate: function(f, a, b, n) {\r\n\t\t\tvar x = abscissas[n - 2],\r\n\t\t\t\tw = weights[n - 2],\r\n\t\t\t\tA = 0.5 * (b - a),\r\n\t\t\t\tB = A + a,\r\n\t\t\t\ti = 0,\r\n\t\t\t\tm = (n + 1) >> 1,\r\n\t\t\t\tsum = n & 1 ? w[i++] * f(B) : 0;\r\n\t\t\twhile (i < m) {\r\n\t\t\t\tvar Ax = A * x[i];\r\n\t\t\t\tsum += w[i++] * (f(B + Ax) + f(B - Ax));\r\n\t\t\t}\r\n\t\t\treturn A * sum;\r\n\t\t},\r\n\r\n\t\tfindRoot: function(f, df, x, a, b, n, tolerance) {\r\n\t\t\tfor (var i = 0; i < n; i++) {\r\n\t\t\t\tvar fx = f(x),\r\n\t\t\t\t\tdx = fx / df(x);\r\n\t\t\t\tif (abs(dx) < tolerance)\r\n\t\t\t\t\treturn x;\r\n\t\t\t\tvar nx = x - dx;\r\n\t\t\t\tif (fx > 0) {\r\n\t\t\t\t\tb = x;\r\n\t\t\t\t\tx = nx <= a ? 0.5 * (a + b) : nx;\r\n\t\t\t\t} else {\r\n\t\t\t\t\ta = x;\r\n\t\t\t\t\tx = nx >= b ? 0.5 * (a + b) : nx;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tsolveQuadratic: function(a, b, c, roots, tolerance) {\r\n\t\t\tif (abs(a) < tolerance) {\r\n\t\t\t\tif (abs(b) >= tolerance) {\r\n\t\t\t\t\troots[0] = -c / b;\r\n\t\t\t\t\treturn 1;\r\n\t\t\t\t}\r\n\t\t\t\treturn abs(c) < tolerance ? -1 : 0;\r\n\t\t\t}\r\n\t\t\tvar q = b * b - 4 * a * c;\r\n\t\t\tif (q < 0)\r\n\t\t\t\treturn 0;\r\n\t\t\tq = sqrt(q);\r\n\t\t\ta *= 2;\r\n\t\t\tvar n = 0;\r\n\t\t\troots[n++] = (-b - q) / a;\r\n\t\t\tif (q > 0)\r\n\t\t\t\troots[n++] = (-b + q) / a;\r\n\t\t\treturn n;\r\n\t\t},\r\n\r\n\t\tsolveCubic: function(a, b, c, d, roots, tolerance) {\r\n\t\t\tif (abs(a) < tolerance)\r\n\t\t\t\treturn Numerical.solveQuadratic(b, c, d, roots, tolerance);\r\n\t\t\tb /= a;\r\n\t\t\tc /= a;\r\n\t\t\td /= a;\r\n\t\t\tvar bb = b * b,\r\n\t\t\t\tp = 1 / 3 * (-1 / 3 * bb + c),\r\n\t\t\t\tq = 1 / 2 * (2 / 27 * b * bb - 1 / 3 * b * c + d),\r\n\t\t\t\tppp = p * p * p,\r\n\t\t\t\tD = q * q + ppp;\r\n\t\t\tb /= 3;\r\n\t\t\tif (abs(D) < tolerance) {\r\n\t\t\t    if (abs(q) < tolerance) {\r\n\t\t\t        roots[0] = - b;\r\n\t\t\t        return 1;\r\n\t\t\t    } else {\r\n\t\t\t        var u = cbrt(-q);\r\n\t\t\t        roots[0] = 2 * u - b;\r\n\t\t\t        roots[1] = - u - b;\r\n\t\t\t        return 2;\r\n\t\t\t    }\r\n\t\t\t} else if (D < 0) {\r\n\t\t\t    var phi = 1 / 3 * Math.acos(-q / sqrt(-ppp));\r\n\t\t\t    var t = 2 * sqrt(-p);\r\n\t\t\t    roots[0] =   t * cos(phi) - b;\r\n\t\t\t    roots[1] = - t * cos(phi + PI / 3) - b;\r\n\t\t\t    roots[2] = - t * cos(phi - PI / 3) - b;\r\n\t\t\t    return 3;\r\n\t\t\t} else {\r\n\t\t\t    D = sqrt(D);\r\n\t\t\t    roots[0] = cbrt(D - q) - cbrt(D + q) - b;\r\n\t\t\t    return 1;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n};\r\n\r\nvar BlendMode = {\r\n\tprocess: function(blendMode, srcContext, dstContext, alpha, offset) {\r\n\t\tvar srcCanvas = srcContext.canvas,\r\n\t\t\tdstData = dstContext.getImageData(offset.x, offset.y,\r\n\t\t\t\t\tsrcCanvas.width, srcCanvas.height),\r\n\t\t\tdst  = dstData.data,\r\n\t\t\tsrc  = srcContext.getImageData(0, 0,\r\n\t\t\t\t\tsrcCanvas.width, srcCanvas.height).data,\r\n\t\t\tmin = Math.min,\r\n\t\t\tmax = Math.max,\r\n\t\t\tabs = Math.abs,\r\n\t\t\tsr, sg, sb, sa,\r\n\t\t\tbr, bg, bb, ba,\r\n\t\t\tdr, dg, db;\r\n\r\n\t\tfunction getLum(r, g, b) {\r\n\t\t\treturn 0.2989 * r + 0.587 * g + 0.114 * b;\r\n\t\t}\r\n\r\n\t\tfunction setLum(r, g, b, l) {\r\n\t\t\tvar d = l - getLum(r, g, b);\r\n\t\t\tdr = r + d;\r\n\t\t\tdg = g + d;\r\n\t\t\tdb = b + d;\r\n\t\t\tvar l = getLum(dr, dg, db),\r\n\t\t\t\tmn = min(dr, dg, db),\r\n\t\t\t\tmx = max(dr, dg, db);\r\n\t\t\tif (mn < 0) {\r\n\t\t\t\tvar lmn = l - mn;\r\n\t\t\t\tdr = l + (dr - l) * l / lmn;\r\n\t\t\t\tdg = l + (dg - l) * l / lmn;\r\n\t\t\t\tdb = l + (db - l) * l / lmn;\r\n\t\t\t}\r\n\t\t\tif (mx > 255) {\r\n\t\t\t\tvar ln = 255 - l, mxl = mx - l;\r\n\t\t\t\tdr = l + (dr - l) * ln / mxl;\r\n\t\t\t\tdg = l + (dg - l) * ln / mxl;\r\n\t\t\t\tdb = l + (db - l) * ln / mxl;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction getSat(r, g, b) {\r\n\t\t\treturn max(r, g, b) - min(r, g, b);\r\n\t\t}\r\n\r\n\t\tfunction setSat(r, g, b, s) {\r\n\t\t\tvar col = [r, g, b],\r\n\t\t\t\tmx = max(r, g, b),\r\n\t\t\t\tmn = min(r, g, b),\r\n\t\t\t\tmd;\r\n\t\t\tmn = mn == r ? 0 : mn == g ? 1 : 2;\r\n\t\t\tmx = mx == r ? 0 : mx == g ? 1 : 2;\r\n\t\t\tmd = min(mn, mx) == 0 ? max(mn, mx) == 1 ? 2 : 1 : 0;\r\n\t\t\tif (col[mx] > col[mn]) {\r\n\t\t\t\tcol[md] = (col[md] - col[mn]) * s / (col[mx] - col[mn]);\r\n\t\t\t\tcol[mx] = s;\r\n\t\t\t} else {\r\n\t\t\t\tcol[md] = col[mx] = 0;\r\n\t\t\t}\r\n\t\t\tcol[mn] = 0;\r\n\t\t\tdr = col[0];\r\n\t\t\tdg = col[1];\r\n\t\t\tdb = col[2];\r\n\t\t}\r\n\r\n\t\tvar modes = {\r\n\t\t\tmultiply: function() {\r\n\t\t\t\tdr = br * sr / 255;\r\n\t\t\t\tdg = bg * sg / 255;\r\n\t\t\t\tdb = bb * sb / 255;\r\n\t\t\t},\r\n\r\n\t\t\tscreen: function() {\r\n\t\t\t\tdr = 255 - (255 - br) * (255 - sr) / 255;\r\n\t\t\t\tdg = 255 - (255 - bg) * (255 - sg) / 255;\r\n\t\t\t\tdb = 255 - (255 - bb) * (255 - sb) / 255;\r\n\t\t\t},\r\n\r\n\t\t\toverlay: function() {\r\n\t\t\t\tdr = br < 128 ? 2 * br * sr / 255 : 255 - 2 * (255 - br) * (255 - sr) / 255;\r\n\t\t\t\tdg = bg < 128 ? 2 * bg * sg / 255 : 255 - 2 * (255 - bg) * (255 - sg) / 255;\r\n\t\t\t\tdb = bb < 128 ? 2 * bb * sb / 255 : 255 - 2 * (255 - bb) * (255 - sb) / 255;\r\n\t\t\t},\r\n\r\n\t\t\t'soft-light': function() {\r\n\t\t\t\tvar t = sr * br / 255;\r\n\t\t\t\tdr = t + br * (255 - (255 - br) * (255 - sr) / 255 - t) / 255;\r\n\t\t\t\tt = sg * bg / 255;\r\n\t\t\t\tdg = t + bg * (255 - (255 - bg) * (255 - sg) / 255 - t) / 255;\r\n\t\t\t\tt = sb * bb / 255;\r\n\t\t\t\tdb = t + bb * (255 - (255 - bb) * (255 - sb) / 255 - t) / 255;\r\n\t\t\t},\r\n\r\n\t\t\t'hard-light': function() {\r\n\t\t\t\tdr = sr < 128 ? 2 * sr * br / 255 : 255 - 2 * (255 - sr) * (255 - br) / 255;\r\n\t\t\t\tdg = sg < 128 ? 2 * sg * bg / 255 : 255 - 2 * (255 - sg) * (255 - bg) / 255;\r\n\t\t\t\tdb = sb < 128 ? 2 * sb * bb / 255 : 255 - 2 * (255 - sb) * (255 - bb) / 255;\r\n\t\t\t},\r\n\r\n\t\t\t'color-dodge': function() {\r\n\t\t\t\tdr = sr == 255 ? sr : min(255, br * 255 / (255 - sr));\r\n\t\t\t\tdg = sg == 255 ? sg : min(255, bg * 255 / (255 - sg));\r\n\t\t\t\tdb = sb == 255 ? sb : min(255, bb * 255 / (255 - sb));\r\n\t\t\t},\r\n\r\n\t\t\t'color-burn': function() {\r\n\t\t\t\tdr = sr == 0 ? 0 : max(255 - ((255 - br) * 255) / sr, 0);\r\n\t\t\t\tdg = sg == 0 ? 0 : max(255 - ((255 - bg) * 255) / sg, 0);\r\n\t\t\t\tdb = sb == 0 ? 0 : max(255 - ((255 - bb) * 255) / sb, 0);\r\n\t\t\t},\r\n\r\n\t\t\tdarken: function() {\r\n\t\t\t\tdr = br < sr ? br : sr;\r\n\t\t\t\tdg = bg < sg ? bg : sg;\r\n\t\t\t\tdb = bb < sb ? bb : sb;\r\n\t\t\t},\r\n\r\n\t\t\tlighten: function() {\r\n\t\t\t\tdr = br > sr ? br : sr;\r\n\t\t\t\tdg = bg > sg ? bg : sg;\r\n\t\t\t\tdb = bb > sb ? bb : sb;\r\n\t\t\t},\r\n\r\n\t\t\tdifference: function() {\r\n\t\t\t\tdr = br - sr;\r\n\t\t\t\tif (dr < 0)\r\n\t\t\t\t\tdr = -dr;\r\n\t\t\t\tdg = bg - sg;\r\n\t\t\t\tif (dg < 0)\r\n\t\t\t\t\tdg = -dg;\r\n\t\t\t\tdb = bb - sb;\r\n\t\t\t\tif (db < 0)\r\n\t\t\t\t\tdb = -db;\r\n\t\t\t},\r\n\r\n\t\t\texclusion: function() {\r\n\t\t\t\tdr = br + sr * (255 - br - br) / 255;\r\n\t\t\t\tdg = bg + sg * (255 - bg - bg) / 255;\r\n\t\t\t\tdb = bb + sb * (255 - bb - bb) / 255;\r\n\t\t\t},\r\n\r\n\t\t\thue: function() {\r\n\t\t\t\tsetSat(sr, sg, sb, getSat(br, bg, bb));\r\n\t\t\t\tsetLum(dr, dg, db, getLum(br, bg, bb));\r\n\t\t\t},\r\n\r\n\t\t\tsaturation: function() {\r\n\t\t\t\tsetSat(br, bg, bb, getSat(sr, sg, sb));\r\n\t\t\t\tsetLum(dr, dg, db, getLum(br, bg, bb));\r\n\t\t\t},\r\n\r\n\t\t\tluminosity: function() {\r\n\t\t\t\tsetLum(br, bg, bb, getLum(sr, sg, sb));\r\n\t\t\t},\r\n\r\n\t\t\tcolor: function() {\r\n\t\t\t\tsetLum(sr, sg, sb, getLum(br, bg, bb));\r\n\t\t\t},\r\n\r\n\t\t\tadd: function() {\r\n\t\t\t\tdr = min(br + sr, 255);\r\n\t\t\t\tdg = min(bg + sg, 255);\r\n\t\t\t\tdb = min(bb + sb, 255);\r\n\t\t\t},\r\n\r\n\t\t\tsubtract: function() {\r\n\t\t\t\tdr = max(br - sr, 0);\r\n\t\t\t\tdg = max(bg - sg, 0);\r\n\t\t\t\tdb = max(bb - sb, 0);\r\n\t\t\t},\r\n\r\n\t\t\taverage: function() {\r\n\t\t\t\tdr = (br + sr) / 2;\r\n\t\t\t\tdg = (bg + sg) / 2;\r\n\t\t\t\tdb = (bb + sb) / 2;\r\n\t\t\t},\r\n\r\n\t\t\tnegation: function() {\r\n\t\t\t\tdr = 255 - abs(255 - sr - br);\r\n\t\t\t\tdg = 255 - abs(255 - sg - bg);\r\n\t\t\t\tdb = 255 - abs(255 - sb - bb);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvar process = modes[blendMode];\r\n\t\tif (!process)\r\n\t\t\treturn;\r\n\r\n\t\tfor (var i = 0, l = dst.length; i < l; i += 4) {\r\n\t\t\tsr = src[i];\r\n\t\t\tbr = dst[i];\r\n\t\t\tsg = src[i + 1];\r\n\t\t\tbg = dst[i + 1];\r\n\t\t\tsb = src[i + 2];\r\n\t\t\tbb = dst[i + 2];\r\n\t\t\tsa = src[i + 3];\r\n\t\t\tba = dst[i + 3];\r\n\t\t\tprocess();\r\n\t\t\tvar a1 = sa * alpha / 255,\r\n\t\t\t\ta2 = 1 - a1;\r\n\t\t\tdst[i] = a1 * dr + a2 * br;\r\n\t\t\tdst[i + 1] = a1 * dg + a2 * bg;\r\n\t\t\tdst[i + 2] = a1 * db + a2 * bb;\r\n\t\t\tdst[i + 3] = sa * alpha + a2 * ba;\r\n\t\t}\r\n\t\tdstContext.putImageData(dstData, offset.x, offset.y);\r\n\t}\r\n};\r\n\r\nvar SvgStyles = Base.each({\r\n\tfillColor: ['fill', 'color'],\r\n\tstrokeColor: ['stroke', 'color'],\r\n\tstrokeWidth: ['stroke-width', 'number'],\r\n\tstrokeCap: ['stroke-linecap', 'string'],\r\n\tstrokeJoin: ['stroke-linejoin', 'string'],\r\n\tmiterLimit: ['stroke-miterlimit', 'number'],\r\n\tdashArray: ['stroke-dasharray', 'array'],\r\n\tdashOffset: ['stroke-dashoffset', 'number']\r\n}, function(entry, key) {\r\n\tvar part = Base.capitalize(key);\r\n\tthis[key] = {\r\n\t\ttype: entry[1],\r\n\t\tproperty: key,\r\n\t\tattribute: entry[0],\r\n\t\tget: 'get' + part,\r\n\t\tset: 'set' + part\r\n\t};\r\n}, {});\r\n\r\nnew function() {\r\n\tvar formatter = Formatter.instance,\r\n\t\tnamespaces = {\r\n\t\t\thref: 'http://www.w3.org/1999/xlink'\r\n\t\t};\r\n\r\n\tfunction setAttributes(node, attrs) {\r\n\t\tfor (var key in attrs) {\r\n\t\t\tvar val = attrs[key],\r\n\t\t\t\tnamespace = namespaces[key];\r\n\t\t\tif (typeof val === 'number')\r\n\t\t\t\tval = formatter.number(val);\r\n\t\t\tif (namespace) {\r\n\t\t\t\tnode.setAttributeNS(namespace, key, val);\r\n\t\t\t} else {\r\n\t\t\t\tnode.setAttribute(key, val);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn node;\r\n\t}\r\n\r\n\tfunction createElement(tag, attrs) {\r\n\t\treturn setAttributes(\r\n\t\t\tdocument.createElementNS('http://www.w3.org/2000/svg', tag), attrs);\r\n\t}\r\n\r\n\tfunction getDistance(segments, index1, index2) {\r\n\t\treturn segments[index1]._point.getDistance(segments[index2]._point);\r\n\t}\r\n\r\n\tfunction getTransform(item, coordinates) {\r\n\t\tvar matrix = item._matrix,\r\n\t\t\ttrans = matrix.getTranslation(),\r\n\t\t\tattrs = {};\r\n\t\tif (coordinates) {\r\n\t\t\tmatrix = matrix.shiftless();\r\n\t\t\tvar point = matrix._inverseTransform(trans);\r\n\t\t\tattrs.x = point.x;\r\n\t\t\tattrs.y = point.y;\r\n\t\t\ttrans = null;\r\n\t\t}\r\n\t\tif (matrix.isIdentity())\r\n\t\t\treturn attrs;\r\n\t\tvar decomposed = matrix.decompose();\r\n\t\tif (decomposed && !decomposed.shearing) {\r\n\t\t\tvar parts = [],\r\n\t\t\t\tangle = decomposed.rotation,\r\n\t\t\t\tscale = decomposed.scaling;\r\n\t\t\tif (trans && !trans.isZero())\r\n\t\t\t\tparts.push('translate(' + formatter.point(trans) + ')');\r\n\t\t\tif (!Numerical.isZero(scale.x - 1) || !Numerical.isZero(scale.y - 1))\r\n\t\t\t\tparts.push('scale(' + formatter.point(scale) +')');\r\n\t\t\tif (angle)\r\n\t\t\t\tparts.push('rotate(' + formatter.number(angle) + ')');\r\n\t\t\tattrs.transform = parts.join(' ');\r\n\t\t} else {\r\n\t\t\tattrs.transform = 'matrix(' + matrix.getValues().join(',') + ')';\r\n\t\t}\r\n\t\treturn attrs;\r\n\t}\r\n\r\n\tfunction determineAngle(path, segments, type, center) {\r\n\t\tvar topCenter = type === 'rect'\r\n\t\t\t\t? segments[1]._point.add(segments[2]._point).divide(2)\r\n\t\t\t\t: type === 'roundrect'\r\n\t\t\t\t? segments[3]._point.add(segments[4]._point).divide(2)\r\n\t\t\t\t: type === 'circle' || type === 'ellipse'\r\n\t\t\t\t? segments[1]._point\r\n\t\t\t\t: null;\r\n\t\tvar angle = topCenter && topCenter.subtract(center).getAngle() + 90;\r\n\t\treturn Numerical.isZero(angle || 0) ? 0 : angle;\r\n\t}\r\n\r\n\tfunction determineType(path, segments) {\r\n\t\tfunction isColinear(i, j) {\r\n\t\t\tvar seg1 = segments[i],\r\n\t\t\t\tseg2 = seg1.getNext(),\r\n\t\t\t\tseg3 = segments[j],\r\n\t\t\t\tseg4 = seg3.getNext();\r\n\t\t\treturn seg1._handleOut.isZero() && seg2._handleIn.isZero()\r\n\t\t\t\t\t&& seg3._handleOut.isZero() && seg4._handleIn.isZero()\r\n\t\t\t\t\t&& seg2._point.subtract(seg1._point).isColinear(\r\n\t\t\t\t\t\tseg4._point.subtract(seg3._point));\r\n\t\t}\r\n\r\n\t\tvar kappa = 4 * (Math.sqrt(2) - 1) / 3;\r\n\r\n\t\tfunction isArc(i) {\r\n\t\t\tvar segment = segments[i],\r\n\t\t\t\tnext = segment.getNext(),\r\n\t\t\t\thandle1 = segment._handleOut,\r\n\t\t\t\thandle2 = next._handleIn;\r\n\t\t\tif (handle1.isOrthogonal(handle2)) {\r\n\t\t\t\tvar from = segment._point,\r\n\t\t\t\t\tto = next._point,\r\n\t\t\t\t\tcorner = new Line(from, handle1).intersect(\r\n\t\t\t\t\t\t\tnew Line(to, handle2));\r\n\t\t\t\treturn corner && Numerical.isZero(handle1.getLength() /\r\n\t\t\t\t\t\tcorner.subtract(from).getLength() - kappa)\r\n\t\t\t\t\t&& Numerical.isZero(handle2.getLength() /\r\n\t\t\t\t\t\tcorner.subtract(to).getLength() - kappa);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (path.isPolygon()) {\r\n\t\t\treturn  segments.length === 4 && path._closed\r\n\t\t\t\t\t&& isColinear(0, 2) && isColinear(1, 3)\r\n\t\t\t\t\t? 'rect'\r\n\t\t\t\t\t: segments.length === 0\r\n\t\t\t\t\t\t? 'empty'\r\n\t\t\t\t\t\t: segments.length >= 3\r\n\t\t\t\t\t\t\t? path._closed ? 'polygon' : 'polyline'\r\n\t\t\t\t\t\t\t: 'line';\r\n\t\t} else if (path._closed) {\r\n\t\t\tif (segments.length === 8\r\n\t\t\t\t\t&& isArc(0) && isArc(2) && isArc(4) && isArc(6)\r\n\t\t\t\t\t&& isColinear(1, 5) && isColinear(3, 7)) {\r\n\t\t\t\treturn 'roundrect';\r\n\t\t\t} else if (segments.length === 4\r\n\t\t\t\t\t&& isArc(0) && isArc(1) && isArc(2) && isArc(3)) {\r\n\t\t\t\treturn Numerical.isZero(getDistance(segments, 0, 2)\r\n\t\t\t\t\t\t- getDistance(segments, 1, 3))\r\n\t\t\t\t\t\t? 'circle'\r\n\t\t\t\t\t\t: 'ellipse';\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn 'path';\r\n\t}\r\n\r\n\tfunction exportGroup(item) {\r\n\t\tvar attrs = getTransform(item),\r\n\t\t\tchildren = item._children;\r\n\t\tattrs.fill = 'none';\r\n\t\tvar node = createElement('g', attrs);\r\n\t\tfor (var i = 0, l = children.length; i < l; i++) {\r\n\t\t\tvar child = exportSvg(children[i]);\r\n\t\t\tif (child)\r\n\t\t\t\tnode.appendChild(child);\r\n\t\t}\r\n\t\treturn node;\r\n\t}\r\n\r\n\tfunction exportRaster(item) {\r\n\t\tvar attrs = getTransform(item, true),\r\n\t\t\tsize = item.getSize();\r\n\t\tattrs.x -= size.width / 2;\r\n\t\tattrs.y -= size.height / 2;\r\n\t\tattrs.width = size.width;\r\n\t\tattrs.height = size.height;\r\n\t\tattrs.href = item.toDataURL();\r\n\t\treturn createElement('image', attrs);\r\n\t}\r\n\r\n\tfunction exportText(item) {\r\n\t\tvar attrs = getTransform(item, true),\r\n\t\t\tstyle = item._style;\r\n\t\tif (style._font != null)\r\n\t\t\tattrs['font-family'] = style._font;\r\n\t\tif (style._fontSize != null)\r\n\t\t\tattrs['font-size'] = style._fontSize;\r\n\t\tvar node = createElement('text', attrs);\r\n\t\tnode.textContent = item._content;\r\n\t\treturn node;\r\n\t}\r\n\r\n\tfunction exportPath(item) {\r\n\t\tvar segments = item._segments,\r\n\t\t\tcenter = item.getPosition(true),\r\n\t\t\ttype = determineType(item, segments),\r\n\t\t\tangle = determineAngle(item, segments, type, center),\r\n\t\t\tattrs;\r\n\t\tswitch (type) {\r\n\t\tcase 'empty':\r\n\t\t\treturn null;\r\n\t\tcase 'path':\r\n\t\t\tvar data = item.getPathData();\r\n\t\t\tattrs = data && { d: data };\r\n\t\t\tbreak;\r\n\t\tcase 'polyline':\r\n\t\tcase 'polygon':\r\n\t\t\tvar parts = [];\r\n\t\t\tfor(i = 0, l = segments.length; i < l; i++)\r\n\t\t\t\tparts.push(formatter.point(segments[i]._point));\r\n\t\t\tattrs = {\r\n\t\t\t\tpoints: parts.join(' ')\r\n\t\t\t};\r\n\t\t\tbreak;\r\n\t\tcase 'rect':\r\n\t\t\tvar width = getDistance(segments, 0, 3),\r\n\t\t\t\theight = getDistance(segments, 0, 1),\r\n\t\t\t\tpoint = segments[1]._point.rotate(-angle, center);\r\n\t\t\tattrs = {\r\n\t\t\t\tx: point.x,\r\n\t\t\t\ty: point.y,\r\n\t\t\t\twidth: width,\r\n\t\t\t\theight: height\r\n\t\t\t};\r\n\t\t\tbreak;\r\n\t\tcase 'roundrect':\r\n\t\t\ttype = 'rect';\r\n\t\t\tvar width = getDistance(segments, 1, 6),\r\n\t\t\t\theight = getDistance(segments, 0, 3),\r\n\t\t\t\trx = (width - getDistance(segments, 0, 7)) / 2,\r\n\t\t\t\try = (height - getDistance(segments, 1, 2)) / 2,\r\n\t\t\t\tleft = segments[3]._point,\r\n\t\t\t\tright = segments[4]._point,\r\n\t\t\t\tpoint = left.subtract(right.subtract(left).normalize(rx))\r\n\t\t\t\t\t\t.rotate(-angle, center);\r\n\t\t\tattrs = {\r\n\t\t\t\tx: point.x,\r\n\t\t\t\ty: point.y,\r\n\t\t\t\twidth: width,\r\n\t\t\t\theight: height,\r\n\t\t\t\trx: rx,\r\n\t\t\t\try: ry\r\n\t\t\t};\r\n\t\t\tbreak;\r\n\t\tcase'line':\r\n\t\t\tvar first = segments[0]._point,\r\n\t\t\t\tlast = segments[segments.length - 1]._point;\r\n\t\t\tattrs = {\r\n\t\t\t\tx1: first._x,\r\n\t\t\t\ty1: first._y,\r\n\t\t\t\tx2: last._x,\r\n\t\t\t\ty2: last._y\r\n\t\t\t};\r\n\t\t\tbreak;\r\n\t\tcase 'circle':\r\n\t\t\tvar radius = getDistance(segments, 0, 2) / 2;\r\n\t\t\tattrs = {\r\n\t\t\t\tcx: center.x,\r\n\t\t\t\tcy: center.y,\r\n\t\t\t\tr: radius\r\n\t\t\t};\r\n\t\t\tbreak;\r\n\t\tcase 'ellipse':\r\n\t\t\tvar rx = getDistance(segments, 2, 0) / 2,\r\n\t\t\t\try = getDistance(segments, 3, 1) / 2;\r\n\t\t\tattrs = {\r\n\t\t\t\tcx: center.x,\r\n\t\t\t\tcy: center.y,\r\n\t\t\t\trx: rx,\r\n\t\t\t\try: ry\r\n\t\t\t};\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tif (angle) {\r\n\t\t\tattrs.transform = 'rotate(' + formatter.number(angle) + ','\r\n\t\t\t\t\t+ formatter.point(center) + ')';\r\n\t\t\titem._gradientMatrix = new Matrix().rotate(-angle, center);\r\n\t\t}\r\n\t\treturn createElement(type, attrs);\r\n\t}\r\n\r\n\tfunction exportCompoundPath(item) {\r\n\t\tvar attrs = getTransform(item, true);\r\n\t\tvar data = item.getPathData();\r\n\t\tif (data)\r\n\t\t\tattrs.d = data;\r\n\t\treturn createElement('path', attrs);\r\n\t}\r\n\r\n\tfunction exportPlacedSymbol(item) {\r\n\t\tvar attrs = getTransform(item, true),\r\n\t\t\tsymbol = item.getSymbol(),\r\n\t\t\tsymbolNode = getDefinition(symbol);\r\n\t\t\tdefinition = symbol.getDefinition(),\r\n\t\t\tbounds = definition.getBounds();\r\n\t\tif (!symbolNode) {\r\n\t\t\tsymbolNode = createElement('symbol', {\r\n\t\t\t\tviewBox: formatter.rectangle(bounds)\r\n\t\t\t});\r\n\t\t\tsymbolNode.appendChild(exportSvg(definition));\r\n\t\t\tsetDefinition(symbol, symbolNode);\r\n\t\t}\r\n\t\tattrs.href = '#' + symbolNode.id;\r\n\t\tattrs.x += bounds.x;\r\n\t\tattrs.y += bounds.y;\r\n\t\tattrs.width = formatter.number(bounds.width);\r\n\t\tattrs.height = formatter.number(bounds.height);\r\n\t\treturn createElement('use', attrs);\r\n\t}\r\n\r\n\tfunction exportGradient(color, item) {\r\n\t\tvar gradientNode = getDefinition(color);\r\n\t\tif (!gradientNode) {\r\n\t\t\tvar gradient = color.getGradient(),\r\n\t\t\t\tradial = gradient._radial,\r\n\t\t\t\tmatrix = item._gradientMatrix,\r\n\t\t\t\torigin = color.getOrigin().transform(matrix),\r\n\t\t\t\tdestination = color.getDestination().transform(matrix),\r\n\t\t\t\tattrs;\r\n\t\t\t\tif (radial) {\r\n\t\t\t\t\tattrs = {\r\n\t\t\t\t\t\tcx: origin.x,\r\n\t\t\t\t\t\tcy: origin.y,\r\n\t\t\t\t\t\tr: origin.getDistance(destination)\r\n\t\t\t\t\t};\r\n\t\t\t\t\tvar highlight = color.getHighlight();\r\n\t\t\t\t\tif (highlight) {\r\n\t\t\t\t\t\thighlight = highlight.transform(matrix);\r\n\t\t\t\t\t\tattrs.fx = highlight.x;\r\n\t\t\t\t\t\tattrs.fy = highlight.y;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tattrs = {\r\n\t\t\t\t\t\tx1: origin.x,\r\n\t\t\t\t\t\ty1: origin.y,\r\n\t\t\t\t\t\tx2: destination.x,\r\n\t\t\t\t\t\ty2: destination.y\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\tattrs.gradientUnits = 'userSpaceOnUse';\r\n\t\t\tgradientNode = createElement(\r\n\t\t\t\t\t(radial ? 'radial' : 'linear') + 'Gradient', attrs);\r\n\t\t\tvar stops = gradient._stops;\r\n\t\t\tfor (var i = 0, l = stops.length; i < l; i++) {\r\n\t\t\t\tvar stop = stops[i],\r\n\t\t\t\t\tstopColor = stop._color,\r\n\t\t\t\t\talpha = stopColor.getAlpha();\r\n\t\t\t\tattrs = {\r\n\t\t\t\t\toffset: stop._rampPoint,\r\n\t\t\t\t\t'stop-color': stopColor.toCss(true)\r\n\t\t\t\t};\r\n\t\t\t\tif (alpha < 1)\r\n\t\t\t\t\tattrs['stop-opacity'] = alpha;\r\n\t\t\t\tgradientNode.appendChild(createElement('stop', attrs));\r\n\t\t\t}\r\n\t\t\tsetDefinition(color, gradientNode);\r\n\t\t}\r\n\t\treturn 'url(#' + gradientNode.id + ')';\r\n\t}\r\n\r\n\tvar exporters = {\r\n\t\tgroup: exportGroup,\r\n\t\tlayer: exportGroup,\r\n\t\traster: exportRaster,\r\n\t\tpath: exportPath,\r\n\t\t'point-text': exportText,\r\n\t\t'placed-symbol': exportPlacedSymbol,\r\n\t\t'compound-path': exportCompoundPath\r\n\t};\r\n\r\n\tfunction applyStyle(item, node) {\r\n\t\tvar attrs = {},\r\n\t\t\tstyle = item._style,\r\n\t\t\tparent = item.getParent(),\r\n\t\t\tparentStyle = parent && parent._style;\r\n\r\n\t\tif (item._name != null)\r\n\t\t\tattrs.id = item._name;\r\n\r\n\t\tBase.each(SvgStyles, function(entry) {\r\n\t\t\tvar value = style[entry.get]();\r\n\t\t\tif (!parentStyle || !Base.equals(parentStyle[entry.get](), value)) {\r\n\t\t\t\tif (entry.type === 'color' && value != null) {\r\n\t\t\t\t\tvar alpha = value.getAlpha();\r\n\t\t\t\t\tif (alpha < 1)\r\n\t\t\t\t\t\tattrs[entry.attribute + '-opacity'] = alpha;\r\n\t\t\t\t}\r\n\t\t\t\tattrs[entry.attribute] = value == null\r\n\t\t\t\t\t? 'none'\r\n\t\t\t\t\t: entry.type === 'color'\r\n\t\t\t\t\t\t? value.gradient\r\n\t\t\t\t\t\t\t? exportGradient(value, item)\r\n\t\t\t\t\t\t\t: value.toCss(true)\r\n\t\t\t\t\t\t: entry.type === 'array'\r\n\t\t\t\t\t\t\t? value.join(',')\r\n\t\t\t\t\t\t\t: entry.type === 'number'\r\n\t\t\t\t\t\t\t\t? formatter.number(value)\r\n\t\t\t\t\t\t\t\t: value;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif (item._opacity != null && item._opacity < 1)\r\n\t\t\tattrs.opacity = item._opacity;\r\n\r\n\t\tif (item._visibility != null && !item._visibility)\r\n\t\t\tattrs.visibility = 'hidden';\r\n\r\n\t\tdelete item._gradientMatrix;\r\n\t\treturn setAttributes(node, attrs);\r\n\t}\r\n\r\n\tvar definitions;\r\n\tfunction getDefinition(item) {\r\n\t\tif (!definitions)\r\n\t\t\tdefinitions = { ids: {}, svgs: {} };\r\n\t\treturn definitions.svgs[item._id];\r\n\t}\r\n\r\n\tfunction setDefinition(item, node) {\r\n\t\tvar type = item._type,\r\n\t\t\tid = definitions.ids[type] = (definitions.ids[type] || 0) + 1;\r\n\t\tnode.id = type + '-' + id;\r\n\t\tdefinitions.svgs[item._id] = node;\r\n\t}\r\n\r\n\tfunction exportDefinitions(node) {\r\n\t\tif (!definitions)\r\n\t\t\treturn node;\r\n\t\tvar container = node.nodeName == 'svg' && node,\r\n\t\t\tfirstChild = container ? container.firstChild : node;\r\n\t\tfor (var i in definitions.svgs) {\r\n\t\t\tif (!container) {\r\n\t\t\t\tcontainer = createElement('svg');\r\n\t\t\t\tcontainer.appendChild(node);\r\n\t\t\t}\r\n\t\t\tcontainer.insertBefore(definitions.svgs[i], firstChild);\r\n\t\t}\r\n\t\tdefinitions = null;\r\n\t\treturn container;\r\n\t}\r\n\r\n\tfunction exportSvg(item) {\r\n\t\tvar exporter = exporters[item._type],\r\n\t\t\tnode = exporter && exporter(item, item._type);\r\n\t\tif (node && item._data)\r\n\t\t\tnode.setAttribute('data-paper-data', JSON.stringify(item._data));\r\n\t\treturn node && applyStyle(item, node);\r\n\t}\r\n\r\n\tItem.inject({\r\n\t\texportSvg: function() {\r\n\t\t\tvar node = exportSvg(this);\r\n\t\t\treturn exportDefinitions(node);\r\n\t\t}\r\n\t});\r\n\r\n\tProject.inject({\r\n\t\texportSvg: function() {\r\n\t\t\tvar node = createElement('svg'),\r\n\t\t\t\tlayers = this.layers;\r\n\t\t\tfor (var i = 0, l = layers.length; i < l; i++)\r\n\t\t\t\tnode.appendChild(exportSvg(layers[i]));\r\n\t\t\treturn exportDefinitions(node);\r\n\t\t}\r\n\t});\r\n};\r\n\r\nnew function() {\r\n\r\n\tfunction getValue(node, key, allowNull, index) {\r\n\t\tvar base = (!allowNull || node.getAttribute(key) != null)\r\n\t\t\t\t&& node[key] && node[key].baseVal;\r\n\t\treturn base\r\n\t\t\t\t? index !== undefined\r\n\t\t\t\t\t? index < base.numberOfItems\r\n\t\t\t\t\t\t? Base.pick((base = base.getItem(index)).value, base)\r\n\t\t\t\t\t\t: null\r\n\t\t\t\t\t: Base.pick(base.value, base)\r\n\t\t\t\t: null;\r\n\t}\r\n\r\n\tfunction getPoint(node, x, y, allowNull, index) {\r\n\t\tx = getValue(node, x, allowNull, index);\r\n\t\ty = getValue(node, y, allowNull, index);\r\n\t\treturn allowNull && x == null && y == null ? null\r\n\t\t\t\t: Point.create(x || 0, y || 0);\r\n\t}\r\n\r\n\tfunction getSize(node, w, h, allowNull, index) {\r\n\t\tw = getValue(node, w, allowNull, index);\r\n\t\th = getValue(node, h, allowNull, index);\r\n\t\treturn allowNull && w == null && h == null ? null\r\n\t\t\t\t: Size.create(w || 0, h || 0);\r\n\t}\r\n\r\n\tfunction convertValue(value, type) {\r\n\t\treturn value === 'none'\r\n\t\t\t\t? null\r\n\t\t\t\t: type === 'number'\r\n\t\t\t\t\t? parseFloat(value)\r\n\t\t\t\t\t: type === 'array'\r\n\t\t\t\t\t\t? value ? value.split(/[\\s,]+/g).map(parseFloat) : []\r\n\t\t\t\t\t\t: type === 'color' && getDefinition(value)\r\n\t\t\t\t\t\t\t|| value;\r\n\t}\r\n\r\n\tfunction importGroup(node, type) {\r\n\t\tvar nodes = node.childNodes,\r\n\t\t\tclip = type === 'clipPath',\r\n\t\t\titem = clip ? new CompoundPath() : new Group(),\r\n\t\t\tproject = item._project,\r\n\t\t\tcurrentStyle = project._currentStyle;\r\n\t\titem.setFillColor('black');\r\n\t\tif (!clip) {\r\n\t\t\titem = applyAttributes(item, node);\r\n\t\t\tproject._currentStyle = item._style.clone();\r\n\t\t}\r\n\t\tfor (var i = 0, l = nodes.length; i < l; i++) {\r\n\t\t\tvar childNode = nodes[i],\r\n\t\t\t\tchild;\r\n\t\t\tif (childNode.nodeType == 1 && (child = importSvg(childNode))) {\r\n\t\t\t\tif (clip && child instanceof CompoundPath) {\r\n\t\t\t\t\titem.addChildren(child.removeChildren());\r\n\t\t\t\t\tchild.remove();\r\n\t\t\t\t} else if (!(child instanceof Symbol)) {\r\n\t\t\t\t\titem.addChild(child);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (clip)\r\n\t\t\titem = applyAttributes(item.reduce(), node);\r\n\t\tproject._currentStyle = currentStyle;\r\n\t\tif (clip || type === 'defs') {\r\n\t\t\titem.remove();\r\n\t\t\titem = null;\r\n\t\t}\r\n\t\treturn item;\r\n\t}\r\n\r\n\tfunction importPoly(node, type) {\r\n\t\tvar path = new Path(),\r\n\t\t\tpoints = node.points;\r\n\t\tpath.moveTo(points.getItem(0));\r\n\t\tfor (var i = 1, l = points.numberOfItems; i < l; i++)\r\n\t\t\tpath.lineTo(points.getItem(i));\r\n\t\tif (type === 'polygon')\r\n\t\t\tpath.closePath();\r\n\t\treturn path;\r\n\t}\r\n\r\n\tfunction importPath(node) {\r\n\t\tvar data = node.getAttribute('d'),\r\n\t\t\tpath = data.match(/m/gi).length > 1\r\n\t\t\t\t\t? new CompoundPath()\r\n\t\t\t\t\t: new Path();\r\n\t\tpath.setPathData(data);\r\n\t\treturn path;\r\n\t}\r\n\r\n\tfunction importGradient(node, type) {\r\n\t\tvar nodes = node.childNodes,\r\n\t\t\tstops = [];\r\n\t\tfor (var i = 0, l = nodes.length; i < l; i++) {\r\n\t\t\tvar child = nodes[i];\r\n\t\t\tif (child.nodeType == 1)\r\n\t\t\t\tstops.push(applyAttributes(new GradientStop(), child));\r\n\t\t}\r\n\t\tvar isRadial = type === 'radialGradient',\r\n\t\t\tgradient = new Gradient(stops, isRadial),\r\n\t\t\torigin, destination, highlight;\r\n\t\tif (isRadial) {\r\n\t\t\torigin = getPoint(node, 'cx', 'cy');\r\n\t\t\tdestination = origin.add(getValue(node, 'r'), 0);\r\n\t\t\thighlight = getPoint(node, 'fx', 'fy', true);\r\n\t\t} else {\r\n\t\t\torigin = getPoint(node, 'x1', 'y1');\r\n\t\t\tdestination = getPoint(node, 'x2', 'y2');\r\n\t\t}\r\n\t\tapplyAttributes(\r\n\t\t\tnew Color(gradient, origin, destination, highlight), node);\r\n\t\treturn null;\r\n\t}\r\n\r\n\tvar importers = {\r\n\t\tg: importGroup,\r\n\t\tsvg: importGroup,\r\n\t\tclipPath: importGroup,\r\n\t\tpolygon: importPoly,\r\n\t\tpolyline: importPoly,\r\n\t\tpath: importPath,\r\n\t\tlinearGradient: importGradient,\r\n\t\tradialGradient: importGradient,\r\n\r\n\t\timage: function (node) {\r\n\t\t\tvar raster = new Raster(getValue(node, 'href'));\r\n\t\t\traster.attach('load', function() {\r\n\t\t\t\tvar size = getSize(node, 'width', 'height');\r\n\t\t\t\tthis.setSize(size);\r\n\t\t\t\tthis.translate(getPoint(node, 'x', 'y').add(size.divide(2)));\r\n\t\t\t});\r\n\t\t\treturn raster;\r\n\t\t},\r\n\r\n\t\tsymbol: function(node, type) {\r\n\t\t\treturn new Symbol(importGroup(node, type), true);\r\n\t\t},\r\n\r\n\t\tdefs: importGroup,\r\n\r\n\t\tuse: function(node, type) {\r\n\t\t\tvar id = (getValue(node, 'href') || '').substring(1),\r\n\t\t\t\tdefinition = definitions[id],\r\n\t\t\t\tpoint = getPoint(node, 'x', 'y');\r\n\t\t\treturn definition\r\n\t\t\t\t\t? definition instanceof Symbol\r\n\t\t\t\t\t\t? definition.place(point)\r\n\t\t\t\t\t\t: definition.clone().translate(point)\r\n\t\t\t\t\t: null;\r\n\t\t},\r\n\r\n\t\tcircle: function(node) {\r\n\t\t\treturn new Path.Circle(getPoint(node, 'cx', 'cy'),\r\n\t\t\t\t\tgetValue(node, 'r'));\r\n\t\t},\r\n\r\n\t\tellipse: function(node) {\r\n\t\t\tvar center = getPoint(node, 'cx', 'cy'),\r\n\t\t\t\tradius = getSize(node, 'rx', 'ry');\r\n\t\t\treturn new Path.Ellipse(new Rectangle(center.subtract(radius),\r\n\t\t\t\t\tcenter.add(radius)));\r\n\t\t},\r\n\r\n\t\trect: function(node) {\r\n\t\t\tvar point = getPoint(node, 'x', 'y'),\r\n\t\t\t\tsize = getSize(node, 'width', 'height'),\r\n\t\t\t\tradius = getSize(node, 'rx', 'ry');\r\n\t\t\treturn new Path.RoundRectangle(new Rectangle(point, size), radius);\r\n\t\t},\r\n\r\n\t\tline: function(node) {\r\n\t\t\treturn new Path.Line(getPoint(node, 'x1', 'y1'),\r\n\t\t\t\t\tgetPoint(node, 'x2', 'y2'));\r\n\t\t},\r\n\r\n\t\ttext: function(node) {\r\n\t\t\tvar text = new PointText(getPoint(node, 'x', 'y', false, 0)\r\n\t\t\t\t\t.add(getPoint(node, 'dx', 'dy', false, 0)));\r\n\t\t\ttext.setContent(node.textContent.trim() || '');\r\n\t\t\treturn text;\r\n\t\t}\r\n\t};\r\n\r\n\tfunction applyTransform(item, value, name, node) {\r\n\t\tvar transforms = node[name].baseVal,\r\n\t\t\tmatrix = new Matrix();\r\n\t\tfor (var i = 0, l = transforms.numberOfItems; i < l; i++) {\r\n\t\t\tvar mx = transforms.getItem(i).matrix;\r\n\t\t\tmatrix.concatenate(\r\n\t\t\t\tnew Matrix(mx.a, mx.b, mx.c, mx.d, mx.e, mx.f));\r\n\t\t}\r\n\t\titem.transform(matrix);\r\n\t}\r\n\r\n\tfunction applyOpacity(item, value, name) {\r\n\t\tvar color = item._style[name === 'fill-opacity' ? 'getFillColor'\r\n\t\t\t\t: 'getStrokeColor']();\r\n\t\tif (color)\r\n\t\t\tcolor.setAlpha(parseFloat(value));\r\n\t}\r\n\r\n\tvar attributes = Base.each(SvgStyles, function(entry) {\r\n\t\tthis[entry.attribute] = function(item, value, name, node) {\r\n\t\t\titem._style[entry.set](convertValue(value, entry.type));\r\n\t\t};\r\n\t}, {\r\n\t\tid: function(item, value) {\r\n\t\t\tdefinitions[value] = item;\r\n\t\t\tif (item.setName)\r\n\t\t\t\titem.setName(value);\r\n\t\t},\r\n\r\n\t\t'clip-path': function(item, value) {\r\n\t\t\tvar clip = getDefinition(value);\r\n\t\t\tif (clip) {\r\n\t\t\t\tclip = clip.clone();\r\n\t\t\t\tclip.setClipMask(true);\r\n\t\t\t\treturn new Group(clip, item);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgradientTransform: applyTransform,\r\n\t\ttransform: applyTransform,\r\n\r\n\t\topacity: function(item, value) {\r\n\t\t\titem.setOpacity(parseFloat(value));\r\n\t\t},\r\n\r\n\t\t'fill-opacity': applyOpacity,\r\n\t\t'stroke-opacity': applyOpacity,\r\n\r\n\t\t'font-family': function(item, value) {\r\n\t\t\titem.setFont(value.split(',')[0].replace(/^\\s+|\\s+$/g, ''));\r\n\t\t},\r\n\r\n\t\t'font-size': function(item, value) {\r\n\t\t\titem.setFontSize(parseFloat(value));\r\n\t\t},\r\n\r\n\t\t'text-anchor': function(item, value) {\r\n\t\t\titem.setJustification({\r\n\t\t\t\tstart: 'left',\r\n\t\t\t\tmiddle: 'center',\r\n\t\t\t\tend: 'right'\r\n\t\t\t}[value]);\r\n\t\t},\r\n\r\n\t\tvisibility: function(item, value) {\r\n\t\t\titem.setVisible(value === 'visible');\r\n\t\t},\r\n\r\n\t\t'stop-color': function(item, value) {\r\n\t\t\titem.setColor(value);\r\n\t\t},\r\n\r\n\t\t'stop-opacity': function(item, value) {\r\n\t\t\tif (item._color)\r\n\t\t\t\titem._color.setAlpha(parseFloat(value));\r\n\t\t},\r\n\r\n\t\toffset: function(item, value) {\r\n\t\t\tvar percentage = value.match(/(.*)%$/);\r\n\t\t\titem.setRampPoint(percentage ? percentage[1] / 100 : value);\r\n\t\t},\r\n\r\n\t\tviewBox: function(item, value, name, node, styles) {\r\n\t\t\tvar rect = Rectangle.create.apply(this, convertValue(value, 'array')),\r\n\t\t\t\tsize = getSize(node, 'width', 'height', true);\r\n\t\t\tif (item instanceof Group) {\r\n\t\t\t\tvar scale = size ? rect.getSize().divide(size) : 1,\r\n\t\t\t\t\tmatrix = new Matrix().translate(rect.getPoint()).scale(scale);\r\n\t\t\t\titem.transform(matrix.inverted());\r\n\t\t\t} else if (item instanceof Symbol) {\r\n\t\t\t\tif (size)\r\n\t\t\t\t\trect.setSize(size);\r\n\t\t\t\tvar clip = getAttribute(node, 'overflow', styles) != 'visible',\r\n\t\t\t\t\tgroup = item._definition;\r\n\t\t\t\tif (clip && !rect.contains(group.getBounds())) {\r\n\t\t\t\t\tclip = new Path.Rectangle(rect).transform(group._matrix);\r\n\t\t\t\t\tclip.setClipMask(true);\r\n\t\t\t\t\tgroup.addChild(clip);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tfunction getAttribute(node, name, styles) {\r\n\t\tvar attr = node.attributes[name],\r\n\t\t\tvalue = attr && attr.value;\r\n\t\tif (!value) {\r\n\t\t\tvar style = Base.camelize(name);\r\n\t\t\tvalue = node.style[style];\r\n\t\t\tif (!value && styles.node[style] !== styles.parent[style])\r\n\t\t\t\tvalue = styles.node[style];\r\n\t\t}\r\n\t\treturn !value\r\n\t\t\t\t? undefined\r\n\t\t\t\t: value === 'none'\r\n\t\t\t\t\t? null\r\n\t\t\t\t\t: value;\r\n\t}\r\n\r\n\tfunction applyAttributes(item, node) {\r\n\t\tvar styles = {\r\n\t\t\tnode: DomElement.getStyles(node) || {},\r\n\t\t\tparent: DomElement.getStyles(node.parentNode) || {}\r\n\t\t};\r\n\t\tBase.each(attributes, function(apply, name) {\r\n\t\t\tvar value = getAttribute(node, name, styles);\r\n\t\t\tif (value !== undefined)\r\n\t\t\t\titem = Base.pick(apply(item, value, name, node, styles), item);\r\n\t\t});\r\n\t\treturn item;\r\n\t}\r\n\r\n\tvar definitions = {};\r\n\tfunction getDefinition(value) {\r\n\t\tvar match = value && value.match(/\\((?:#|)([^)']+)/);\r\n        return match && definitions[match[1]];\r\n\t}\r\n\r\n\tfunction importSvg(node, clearDefs) {\r\n\t\tvar type = node.nodeName,\r\n\t\t\timporter = importers[type],\r\n\t\t\titem = importer && importer(node, type),\r\n\t\t\tdata = node.getAttribute('data-paper-data');\r\n\t\t// See importGroup() for an explanation of this filtering:\r\n\t\tif (item && item._type !== 'group')\r\n\t\t\titem = applyAttributes(item, node);\r\n\t\tif (item && data)\r\n\t\t\titem._data = JSON.parse(data);\r\n\t\t// Clear definitions at the end of import?\r\n\t\tif (clearDefs)\r\n\t\t\tdefinitions = {};\r\n\t\treturn item;\r\n\t}\r\n\r\n\tItem.inject(/** @lends Item# */{\r\n\t\t/**\r\n\t\t * Converts the passed node node into a Paper.js item and adds it to the\r\n\t\t * children of this item.\r\n\t\t *\r\n\t\t * @param {SVGSVGElement} node the SVG DOM node to convert\r\n\t\t * @return {Item} the converted Paper.js item\r\n\t\t */\r\n\t\timportSvg: function(node) {\r\n\t\t\treturn this.addChild(importSvg(node, true));\r\n\t\t}\r\n\t});\r\n\r\n\tProject.inject(/** @lends Project# */{\r\n\t\t/**\r\n\t\t * Converts the passed node node into a Paper.js item and adds it to the\r\n\t\t * active layer of this project.\r\n\t\t *\r\n\t\t * @param {SVGSVGElement} node the SVG DOM node to convert\r\n\t\t * @return {Item} the converted Paper.js item\r\n\t\t */\r\n\t\timportSvg: function(node) {\r\n\t\t\tthis.activate();\r\n\t\t\treturn importSvg(node, true);\r\n\t\t}\r\n\t});\r\n};\r\n\r\n/*\r\n * Paper.js - The Swiss Army Knife of Vector Graphics Scripting.\r\n * http://paperjs.org/\r\n *\r\n * Copyright (c) 2011 - 2013, Juerg Lehni & Jonathan Puckey\r\n * http://lehni.org/ & http://jonathanpuckey.com/\r\n *\r\n * Distributed under the MIT license. See LICENSE file for details.\r\n *\r\n * All rights reserved.\r\n */\r\n\r\n/**\r\n * @name PaperScript\r\n * @namespace\r\n */\r\n\r\n(function(e){\"use strict\";function r(e){dr=e||{};for(var r in br)dr.hasOwnProperty(r)||(dr[r]=br[r]);vr=dr.sourceFile||null}function t(e,r){var t=yr(hr,e);r+=\" (\"+t.line+\":\"+t.column+\")\";var n=new SyntaxError(r);throw n.pos=e,n.loc=t,n.raisedAt=gr,n}function n(e){function r(e){if(1==e.length)return t+=\"return str === \"+JSON.stringify(e[0])+\";\";t+=\"switch(str){\";for(var r=0;e.length>r;++r)t+=\"case \"+JSON.stringify(e[r])+\":\";t+=\"return true}return false;\"}e=e.split(\" \");var t=\"\",n=[];e:for(var a=0;e.length>a;++a){for(var o=0;n.length>o;++o)if(n[o][0].length==e[a].length){n[o].push(e[a]);continue e}n.push([e[a]])}if(n.length>3){n.sort(function(e,r){return r.length-e.length}),t+=\"switch(str.length){\";for(var a=0;n.length>a;++a){var i=n[a];t+=\"case \"+i[0].length+\":\",r(i)}t+=\"}\"}else r(e);return Function(\"str\",t)}function a(e){return 65>e?36===e:91>e?!0:97>e?95===e:123>e?!0:e>=170&&Ht.test(String.fromCharCode(e))}function o(e){return 48>e?36===e:58>e?!0:65>e?!1:91>e?!0:97>e?95===e:123>e?!0:e>=170&&Kt.test(String.fromCharCode(e))}function i(){this.line=Ir,this.column=gr-Lr}function s(){Ir=1,gr=Lr=0,Sr=!0,f()}function c(e,r){kr=gr,dr.locations&&(Cr=new i),Er=e,f(),Ar=r,Sr=e.beforeExpr}function u(){var e=dr.onComment&&dr.locations&&new i,r=gr,n=hr.indexOf(\"*/\",gr+=2);if(-1===n&&t(gr-2,\"Unterminated comment\"),gr=n+2,dr.locations){Yt.lastIndex=r;for(var a;(a=Yt.exec(hr))&&gr>a.index;)++Ir,Lr=a.index+a[0].length}dr.onComment&&dr.onComment(!0,hr.slice(r+2,n),r,gr,e,dr.locations&&new i)}function l(){for(var e=gr,r=dr.onComment&&dr.locations&&new i,t=hr.charCodeAt(gr+=2);mr>gr&&10!==t&&13!==t&&8232!==t&&8329!==t;)++gr,t=hr.charCodeAt(gr);dr.onComment&&dr.onComment(!1,hr.slice(e+2,gr),e,gr,r,dr.locations&&new i)}function f(){for(;mr>gr;){var e=hr.charCodeAt(gr);if(32===e)++gr;else if(13===e){++gr;var r=hr.charCodeAt(gr);10===r&&++gr,dr.locations&&(++Ir,Lr=gr)}else if(10===e)++gr,++Ir,Lr=gr;else if(14>e&&e>8)++gr;else if(47===e){var r=hr.charCodeAt(gr+1);if(42===r)u();else{if(47!==r)break;l()}}else if(14>e&&e>8||32===e||160===e)++gr;else{if(!(e>=5760&&Pt.test(String.fromCharCode(e))))break;++gr}}}function p(){var e=hr.charCodeAt(gr+1);return e>=48&&57>=e?S(!0):(++gr,c(kt))}function d(){var e=hr.charCodeAt(gr+1);return Sr?(++gr,C()):61===e?w(At,2):w(Ct,1)}function h(){var e=hr.charCodeAt(gr+1);return 61===e?w(At,2):w(Bt,1)}function m(e){var r=hr.charCodeAt(gr+1);return r===e?w(124===e?Ut:Rt,2):61===r?w(At,2):w(124===e?Tt:qt,1)}function v(){var e=hr.charCodeAt(gr+1);return 61===e?w(At,2):w(Vt,1)}function b(e){var r=hr.charCodeAt(gr+1);return r===e?w(It,2):61===r?w(At,2):w(St,1)}function y(e){var r=hr.charCodeAt(gr+1),t=1;return r===e?(t=62===e&&62===hr.charCodeAt(gr+2)?3:2,61===hr.charCodeAt(gr+t)?w(At,t+1):w(Ot,t)):(61===r&&(t=61===hr.charCodeAt(gr+2)?3:2),w(Dt,t))}function g(e){var r=hr.charCodeAt(gr+1);return 61===r?w(Ft,61===hr.charCodeAt(gr+2)?3:2):w(61===e?Et:Lt,1)}function x(e){switch(e){case 46:return p();case 40:return++gr,c(vt);case 41:return++gr,c(bt);case 59:return++gr,c(gt);case 44:return++gr,c(yt);case 91:return++gr,c(pt);case 93:return++gr,c(dt);case 123:return++gr,c(ht);case 125:return++gr,c(mt);case 58:return++gr,c(xt);case 63:return++gr,c(wt);case 48:var r=hr.charCodeAt(gr+1);if(120===r||88===r)return A();case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return S(!1);case 34:case 39:return I(e);case 47:return d(e);case 37:case 42:return h();case 124:case 38:return m(e);case 94:return v();case 43:case 45:return b(e);case 60:case 62:return y(e);case 61:case 33:return g(e);case 126:return w(Lt,1)}return!1}function k(e){if(xr=gr,dr.locations&&(wr=new i),e)return C();if(gr>=mr)return c(Mr);var r=hr.charCodeAt(gr);if(a(r)||92===r)return R();var n=x(r);if(n===!1){var o=String.fromCharCode(r);if(\"\\\\\"===o||Ht.test(o))return R();t(gr,\"Unexpected character '\"+o+\"'\")}return n}function w(e,r){var t=hr.slice(gr,gr+r);gr+=r,c(e,t)}function C(){for(var e,r,n=\"\",a=gr;;){gr>=mr&&t(a,\"Unterminated regular expression\");var o=hr.charAt(gr);if(Qt.test(o)&&t(a,\"Unterminated regular expression\"),e)e=!1;else{if(\"[\"===o)r=!0;else if(\"]\"===o&&r)r=!1;else if(\"/\"===o&&!r)break;e=\"\\\\\"===o}++gr}var n=hr.slice(a,gr);++gr;var i=U();return i&&!/^[gmsiy]*$/.test(i)&&t(a,\"Invalid regexp flag\"),c(Or,RegExp(n,i))}function E(e,r){for(var t=gr,n=0,a=0,o=null==r?1/0:r;o>a;++a){var i,s=hr.charCodeAt(gr);if(i=s>=97?s-97+10:s>=65?s-65+10:s>=48&&57>=s?s-48:1/0,i>=e)break;++gr,n=n*e+i}return gr===t||null!=r&&gr-t!==r?null:n}function A(){gr+=2;var e=E(16);return null==e&&t(xr+2,\"Expected hexadecimal number\"),a(hr.charCodeAt(gr))&&t(gr,\"Identifier directly after number\"),c(Dr,e)}function S(e){var r=gr,n=!1,o=48===hr.charCodeAt(gr);e||null!==E(10)||t(r,\"Invalid number\"),46===hr.charCodeAt(gr)&&(++gr,E(10),n=!0);var i=hr.charCodeAt(gr);(69===i||101===i)&&(i=hr.charCodeAt(++gr),(43===i||45===i)&&++gr,null===E(10)&&t(r,\"Invalid number\"),n=!0),a(hr.charCodeAt(gr))&&t(gr,\"Identifier directly after number\");var s,u=hr.slice(r,gr);return n?s=parseFloat(u):o&&1!==u.length?/[89]/.test(u)||Fr?t(r,\"Invalid number\"):s=parseInt(u,8):s=parseInt(u,10),c(Dr,s)}function I(e){gr++;for(var r=\"\";;){gr>=mr&&t(xr,\"Unterminated string constant\");var n=hr.charCodeAt(gr);if(n===e)return++gr,c(Br,r);if(92===n){n=hr.charCodeAt(++gr);var a=/^[0-7]+/.exec(hr.slice(gr,gr+3));for(a&&(a=a[0]);a&&parseInt(a,8)>255;)a=a.slice(0,a.length-1);if(\"0\"===a&&(a=null),++gr,a)Fr&&t(gr-2,\"Octal literal in strict mode\"),r+=String.fromCharCode(parseInt(a,8)),gr+=a.length-1;else switch(n){case 110:r+=\"\\n\";break;case 114:r+=\"\\r\";break;case 120:r+=String.fromCharCode(L(2));break;case 117:r+=String.fromCharCode(L(4));break;case 85:r+=String.fromCharCode(L(8));break;case 116:r+=\"\t\";break;case 98:r+=\"\\b\";break;case 118:r+=\"\u000b\";break;case 102:r+=\"\\f\";break;case 48:r+=\"\\0\";break;case 13:10===hr.charCodeAt(gr)&&++gr;case 10:dr.locations&&(Lr=gr,++Ir);break;default:r+=String.fromCharCode(n)}}else(13===n||10===n||8232===n||8329===n)&&t(xr,\"Unterminated string constant\"),r+=String.fromCharCode(n),++gr}}function L(e){var r=E(16,e);return null===r&&t(xr,\"Bad character escape sequence\"),r}function U(){Mt=!1;for(var e,r=!0,n=gr;;){var i=hr.charCodeAt(gr);if(o(i))Mt&&(e+=hr.charAt(gr)),++gr;else{if(92!==i)break;Mt||(e=hr.slice(n,gr)),Mt=!0,117!=hr.charCodeAt(++gr)&&t(gr,\"Expecting Unicode escape sequence \\\\uXXXX\"),++gr;var s=L(4),c=String.fromCharCode(s);c||t(gr-1,\"Invalid Unicode escape\"),(r?a(s):o(s))||t(gr-4,\"Invalid Unicode escape\"),e+=c}r=!1}return Mt?e:hr.slice(n,gr)}function R(){var e=U(),r=jr;return Mt||(Jt(e)?r=ft[e]:(dr.forbidReserved&&(3===dr.ecmaVersion?zt:Xt)(e)||Fr&&Nt(e))&&t(xr,\"The keyword '\"+e+\"' is reserved\")),c(r,e)}function T(){Ur=xr,Rr=kr,Tr=Cr,k()}function V(e){Fr=e,gr=Rr,f(),k()}function q(){this.type=null,this.start=xr,this.end=null}function F(){this.start=wr,this.end=null,null!==vr&&(this.source=vr)}function D(){var e=new q;return dr.locations&&(e.loc=new F),dr.ranges&&(e.range=[xr,0]),e}function O(e){var r=new q;return r.start=e.start,dr.locations&&(r.loc=new F,r.loc.start=e.loc.start),dr.ranges&&(r.range=[e.range[0],0]),r}function B(e,r){return e.type=r,e.end=Rr,dr.locations&&(e.loc.end=Tr),dr.ranges&&(e.range[1]=Rr),e}function j(e){return dr.ecmaVersion>=5&&\"ExpressionStatement\"===e.type&&\"Literal\"===e.expression.type&&\"use strict\"===e.expression.value}function M(e){return Er===e?(T(),!0):void 0}function z(){return!dr.strictSemicolons&&(Er===Mr||Er===mt||Qt.test(hr.slice(Rr,xr)))}function X(){M(gt)||z()||W()}function N(e){Er===e?T():W()}function W(){t(xr,\"Unexpected token\")}function J(e){\"Identifier\"!==e.type&&\"MemberExpression\"!==e.type&&t(e.start,\"Assigning to rvalue\"),Fr&&\"Identifier\"===e.type&&Wt(e.name)&&t(e.start,\"Assigning to \"+e.name+\" in strict mode\")}function P(e){Ur=Rr=gr,dr.locations&&(Tr=new i),Vr=Fr=null,qr=[],k();var r=e||D(),t=!0;for(e||(r.body=[]);Er!==Mr;){var n=$();r.body.push(n),t&&j(n)&&V(!0),t=!1}return B(r,\"Program\")}function $(){Er===Ct&&k(!0);var e=Er,r=D();switch(e){case zr:case Wr:T();var n=e===zr;M(gt)||z()?r.label=null:Er!==jr?W():(r.label=pr(),X());for(var a=0;qr.length>a;++a){var o=qr[a];if(null==r.label||o.name===r.label.name){if(null!=o.kind&&(n||\"loop\"===o.kind))break;if(r.label&&n)break}}return a===qr.length&&t(r.start,\"Unsyntactic \"+e.keyword),B(r,n?\"BreakStatement\":\"ContinueStatement\");case Jr:return T(),X(),B(r,\"DebuggerStatement\");case $r:return T(),qr.push(Zt),r.body=$(),qr.pop(),N(nt),r.test=G(),X(),B(r,\"DoWhileStatement\");case Kr:if(T(),qr.push(Zt),N(vt),Er===gt)return K(r,null);if(Er===tt){var i=D();return T(),Y(i,!0),1===i.declarations.length&&M(lt)?Q(r,i):K(r,i)}var i=Z(!1,!0);return M(lt)?(J(i),Q(r,i)):K(r,i);case Qr:return T(),lr(r,!0);case Yr:return T(),r.test=G(),r.consequent=$(),r.alternate=M(Gr)?$():null,B(r,\"IfStatement\");case Zr:return Vr||t(xr,\"'return' outside of function\"),T(),M(gt)||z()?r.argument=null:(r.argument=Z(),X()),B(r,\"ReturnStatement\");case _r:T(),r.discriminant=G(),r.cases=[],N(ht),qr.push(_t);for(var s,c;Er!=mt;)if(Er===Xr||Er===Pr){var u=Er===Xr;s&&B(s,\"SwitchCase\"),r.cases.push(s=D()),s.consequent=[],T(),u?s.test=Z():(c&&t(Ur,\"Multiple default clauses\"),c=!0,s.test=null),N(xt)}else s||W(),s.consequent.push($());return s&&B(s,\"SwitchCase\"),T(),qr.pop(),B(r,\"SwitchStatement\");case et:return T(),Qt.test(hr.slice(Rr,xr))&&t(Rr,\"Illegal newline after throw\"),r.argument=Z(),X(),B(r,\"ThrowStatement\");case rt:for(T(),r.block=H(),r.handlers=[];Er===Nr;){var l=D();T(),N(vt),l.param=pr(),Fr&&Wt(l.param.name)&&t(l.param.start,\"Binding \"+l.param.name+\" in strict mode\"),N(bt),l.guard=null,l.body=H(),r.handlers.push(B(l,\"CatchClause\"))}return r.finalizer=M(Hr)?H():null,r.handlers.length||r.finalizer||t(r.start,\"Missing catch or finally clause\"),B(r,\"TryStatement\");case tt:return T(),r=Y(r),X(),r;case nt:return T(),r.test=G(),qr.push(Zt),r.body=$(),qr.pop(),B(r,\"WhileStatement\");case at:return Fr&&t(xr,\"'with' in strict mode\"),T(),r.object=G(),r.body=$(),B(r,\"WithStatement\");case ht:return H();case gt:return T(),B(r,\"EmptyStatement\");default:var f=Ar,p=Z();if(e===jr&&\"Identifier\"===p.type&&M(xt)){for(var a=0;qr.length>a;++a)qr[a].name===f&&t(p.start,\"Label '\"+f+\"' is already declared\");var d=Er.isLoop?\"loop\":Er===_r?\"switch\":null;return qr.push({name:f,kind:d}),r.body=$(),qr.pop(),r.label=p,B(r,\"LabeledStatement\")}return r.expression=p,X(),B(r,\"ExpressionStatement\")}}function G(){N(vt);var e=Z();return N(bt),e}function H(){var e,r=D(),t=!0,n=!1;for(r.body=[],N(ht);!M(mt);){var a=$();r.body.push(a),t&&j(a)&&(e=n,V(n=!0)),t=!1}return n&&!e&&V(!1),B(r,\"BlockStatement\")}function K(e,r){return e.init=r,N(gt),e.test=Er===gt?null:Z(),N(gt),e.update=Er===bt?null:Z(),N(bt),e.body=$(),qr.pop(),B(e,\"ForStatement\")}function Q(e,r){return e.left=r,e.right=Z(),N(bt),e.body=$(),qr.pop(),B(e,\"ForInStatement\")}function Y(e,r){for(e.declarations=[],e.kind=\"var\";;){var n=D();if(n.id=pr(),Fr&&Wt(n.id.name)&&t(n.id.start,\"Binding \"+n.id.name+\" in strict mode\"),n.init=M(Et)?Z(!0,r):null,e.declarations.push(B(n,\"VariableDeclarator\")),!M(yt))break}return B(e,\"VariableDeclaration\")}function Z(e,r){var t=_(r);if(!e&&Er===yt){var n=O(t);for(n.expressions=[t];M(yt);)n.expressions.push(_(r));return B(n,\"SequenceExpression\")}return t}function _(e){var r=er(e);if(Er.isAssign){var t=O(r);return t.operator=Ar,t.left=r,T(),t.right=_(e),J(r),B(t,\"AssignmentExpression\")}return r}function er(e){var r=rr(e);if(M(wt)){var t=O(r);return t.test=r,t.consequent=Z(!0),N(xt),t.alternate=Z(!0,e),B(t,\"ConditionalExpression\")}return r}function rr(e){return tr(nr(e),-1,e)}function tr(e,r,t){var n=Er.binop;if(null!=n&&(!t||Er!==lt)&&n>r){var a=O(e);a.left=e,a.operator=Ar,T(),a.right=tr(nr(t),n,t);var a=B(a,/&&|\\|\\|/.test(a.operator)?\"LogicalExpression\":\"BinaryExpression\");return tr(a,r,t)}return e}function nr(e){if(Er.prefix){var r=D(),n=Er.isUpdate;return r.operator=Ar,r.prefix=!0,T(),r.argument=nr(e),n?J(r.argument):Fr&&\"delete\"===r.operator&&\"Identifier\"===r.argument.type&&t(r.start,\"Deleting local variable in strict mode\"),B(r,n?\"UpdateExpression\":\"UnaryExpression\")}for(var a=ar();Er.postfix&&!z();){var r=O(a);r.operator=Ar,r.prefix=!1,r.argument=a,J(a),T(),a=B(r,\"UpdateExpression\")}return a}function ar(){return or(ir())}function or(e,r){if(M(kt)){var t=O(e);return t.object=e,t.property=pr(!0),t.computed=!1,or(B(t,\"MemberExpression\"),r)}if(M(pt)){var t=O(e);return t.object=e,t.property=Z(),t.computed=!0,N(dt),or(B(t,\"MemberExpression\"),r)}if(!r&&M(vt)){var t=O(e);return t.callee=e,t.arguments=fr(bt,!1),or(B(t,\"CallExpression\"),r)}return e}function ir(){switch(Er){case it:var e=D();return T(),B(e,\"ThisExpression\");case jr:return pr();case Dr:case Br:case Or:var e=D();return e.value=Ar,e.raw=hr.slice(xr,kr),T(),B(e,\"Literal\");case st:case ct:case ut:var e=D();return e.value=Er.atomValue,e.raw=Er.keyword,T(),B(e,\"Literal\");case vt:var r=wr,t=xr;T();var n=Z();return n.start=t,n.end=kr,dr.locations&&(n.loc.start=r,n.loc.end=Cr),dr.ranges&&(n.range=[t,kr]),N(bt),n;case pt:var e=D();return T(),e.elements=fr(dt,!0,!0),B(e,\"ArrayExpression\");case ht:return cr();case Qr:var e=D();return T(),lr(e,!1);case ot:return sr();default:W()}}function sr(){var e=D();return T(),e.callee=or(ir(),!0),e.arguments=M(vt)?fr(bt,!1):[],B(e,\"NewExpression\")}function cr(){var e=D(),r=!0,n=!1;for(e.properties=[],T();!M(mt);){if(r)r=!1;else if(N(yt),dr.allowTrailingCommas&&M(mt))break;var a,o={key:ur()},i=!1;if(M(xt)?(o.value=Z(!0),a=o.kind=\"init\"):dr.ecmaVersion>=5&&\"Identifier\"===o.key.type&&(\"get\"===o.key.name||\"set\"===o.key.name)?(i=n=!0,a=o.kind=o.key.name,o.key=ur(),Er!==vt&&W(),o.value=lr(D(),!1)):W(),\"Identifier\"===o.key.type&&(Fr||n))for(var s=0;e.properties.length>s;++s){var c=e.properties[s];if(c.key.name===o.key.name){var u=a==c.kind||i&&\"init\"===c.kind||\"init\"===a&&(\"get\"===c.kind||\"set\"===c.kind);u&&!Fr&&\"init\"===a&&\"init\"===c.kind&&(u=!1),u&&t(o.key.start,\"Redefinition of property\")}}e.properties.push(o)}return B(e,\"ObjectExpression\")}function ur(){return Er===Dr||Er===Br?ir():pr(!0)}function lr(e,r){Er===jr?e.id=pr():r?W():e.id=null,e.params=[];var n=!0;for(N(vt);!M(bt);)n?n=!1:N(yt),e.params.push(pr());var a=Vr,o=qr;if(Vr=!0,qr=[],e.body=H(!0),Vr=a,qr=o,Fr||e.body.body.length&&j(e.body.body[0]))for(var i=e.id?-1:0;e.params.length>i;++i){var s=0>i?e.id:e.params[i];if((Nt(s.name)||Wt(s.name))&&t(s.start,\"Defining '\"+s.name+\"' in strict mode\"),i>=0)for(var c=0;i>c;++c)s.name===e.params[c].name&&t(s.start,\"Argument name clash in strict mode\")}return B(e,r?\"FunctionDeclaration\":\"FunctionExpression\")}function fr(e,r,t){for(var n=[],a=!0;!M(e);){if(a)a=!1;else if(N(yt),r&&dr.allowTrailingCommas&&M(e))break;t&&Er===yt?n.push(null):n.push(Z(!0))}return n}function pr(e){var r=D();return r.name=Er===jr?Ar:e&&!dr.forbidReserved&&Er.keyword||W(),T(),B(r,\"Identifier\")}e.version=\"0.1.01\";var dr,hr,mr,vr;e.parse=function(e,t){return hr=e+\"\",mr=hr.length,r(t),s(),P(dr.program)};var br=e.defaultOptions={ecmaVersion:5,strictSemicolons:!1,allowTrailingCommas:!0,forbidReserved:!1,locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null},yr=e.getLineInfo=function(e,r){for(var t=1,n=0;;){Yt.lastIndex=n;var a=Yt.exec(e);if(!(a&&r>a.index))break;++t,n=a.index+a[0].length}return{line:t,column:r-n}};e.tokenize=function(e,t){function n(e){return k(e),a.start=xr,a.end=kr,a.startLoc=wr,a.endLoc=Cr,a.type=Er,a.value=Ar,a}hr=e+\"\",mr=hr.length,r(t),s();var a={};return n.jumpTo=function(e,r){if(gr=e,dr.locations){Ir=Lr=Yt.lastIndex=0;for(var t;(t=Yt.exec(hr))&&e>t.index;)++Ir,Lr=t.index+t[0].length}hr.charAt(e-1),Sr=r,f()},n};var gr,xr,kr,wr,Cr,Er,Ar,Sr,Ir,Lr,Ur,Rr,Tr,Vr,qr,Fr,Dr={type:\"num\"},Or={type:\"regexp\"},Br={type:\"string\"},jr={type:\"name\"},Mr={type:\"eof\"},zr={keyword:\"break\"},Xr={keyword:\"case\",beforeExpr:!0},Nr={keyword:\"catch\"},Wr={keyword:\"continue\"},Jr={keyword:\"debugger\"},Pr={keyword:\"default\"},$r={keyword:\"do\",isLoop:!0},Gr={keyword:\"else\",beforeExpr:!0},Hr={keyword:\"finally\"},Kr={keyword:\"for\",isLoop:!0},Qr={keyword:\"function\"},Yr={keyword:\"if\"},Zr={keyword:\"return\",beforeExpr:!0},_r={keyword:\"switch\"},et={keyword:\"throw\",beforeExpr:!0},rt={keyword:\"try\"},tt={keyword:\"var\"},nt={keyword:\"while\",isLoop:!0},at={keyword:\"with\"},ot={keyword:\"new\",beforeExpr:!0},it={keyword:\"this\"},st={keyword:\"null\",atomValue:null},ct={keyword:\"true\",atomValue:!0},ut={keyword:\"false\",atomValue:!1},lt={keyword:\"in\",binop:7,beforeExpr:!0},ft={\"break\":zr,\"case\":Xr,\"catch\":Nr,\"continue\":Wr,\"debugger\":Jr,\"default\":Pr,\"do\":$r,\"else\":Gr,\"finally\":Hr,\"for\":Kr,\"function\":Qr,\"if\":Yr,\"return\":Zr,\"switch\":_r,\"throw\":et,\"try\":rt,\"var\":tt,\"while\":nt,\"with\":at,\"null\":st,\"true\":ct,\"false\":ut,\"new\":ot,\"in\":lt,\"instanceof\":{keyword:\"instanceof\",binop:7,beforeExpr:!0},\"this\":it,\"typeof\":{keyword:\"typeof\",prefix:!0,beforeExpr:!0},\"void\":{keyword:\"void\",prefix:!0,beforeExpr:!0},\"delete\":{keyword:\"delete\",prefix:!0,beforeExpr:!0}},pt={type:\"[\",beforeExpr:!0},dt={type:\"]\"},ht={type:\"{\",beforeExpr:!0},mt={type:\"}\"},vt={type:\"(\",beforeExpr:!0},bt={type:\")\"},yt={type:\",\",beforeExpr:!0},gt={type:\";\",beforeExpr:!0},xt={type:\":\",beforeExpr:!0},kt={type:\".\"},wt={type:\"?\",beforeExpr:!0},Ct={binop:10,beforeExpr:!0},Et={isAssign:!0,beforeExpr:!0},At={isAssign:!0,beforeExpr:!0},St={binop:9,prefix:!0,beforeExpr:!0},It={postfix:!0,prefix:!0,isUpdate:!0},Lt={prefix:!0,beforeExpr:!0},Ut={binop:1,beforeExpr:!0},Rt={binop:2,beforeExpr:!0},Tt={binop:3,beforeExpr:!0},Vt={binop:4,beforeExpr:!0},qt={binop:5,beforeExpr:!0},Ft={binop:6,beforeExpr:!0},Dt={binop:7,beforeExpr:!0},Ot={binop:8,beforeExpr:!0},Bt={binop:10,beforeExpr:!0};e.tokTypes={bracketL:pt,bracketR:dt,braceL:ht,braceR:mt,parenL:vt,parenR:bt,comma:yt,semi:gt,colon:xt,dot:kt,question:wt,slash:Ct,eq:Et,name:jr,eof:Mr,num:Dr,regexp:Or,string:Br};for(var jt in ft)e.tokTypes[jt]=ft[jt];var Mt,zt=n(\"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile\"),Xt=n(\"class enum extends super const export import\"),Nt=n(\"implements interface let package private protected public static yield\"),Wt=n(\"eval arguments\"),Jt=n(\"break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this\"),Pt=/[\\u1680\\u180e\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\ufeff]/,$t=\"\\u00aa\\u00b5\\u00ba\\u00c0-\\u00d6\\u00d8-\\u00f6\\u00f8-\\u02c1\\u02c6-\\u02d1\\u02e0-\\u02e4\\u02ec\\u02ee\\u0370-\\u0374\\u0376\\u0377\\u037a-\\u037d\\u0386\\u0388-\\u038a\\u038c\\u038e-\\u03a1\\u03a3-\\u03f5\\u03f7-\\u0481\\u048a-\\u0527\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05d0-\\u05ea\\u05f0-\\u05f2\\u0620-\\u064a\\u066e\\u066f\\u0671-\\u06d3\\u06d5\\u06e5\\u06e6\\u06ee\\u06ef\\u06fa-\\u06fc\\u06ff\\u0710\\u0712-\\u072f\\u074d-\\u07a5\\u07b1\\u07ca-\\u07ea\\u07f4\\u07f5\\u07fa\\u0800-\\u0815\\u081a\\u0824\\u0828\\u0840-\\u0858\\u08a0\\u08a2-\\u08ac\\u0904-\\u0939\\u093d\\u0950\\u0958-\\u0961\\u0971-\\u0977\\u0979-\\u097f\\u0985-\\u098c\\u098f\\u0990\\u0993-\\u09a8\\u09aa-\\u09b0\\u09b2\\u09b6-\\u09b9\\u09bd\\u09ce\\u09dc\\u09dd\\u09df-\\u09e1\\u09f0\\u09f1\\u0a05-\\u0a0a\\u0a0f\\u0a10\\u0a13-\\u0a28\\u0a2a-\\u0a30\\u0a32\\u0a33\\u0a35\\u0a36\\u0a38\\u0a39\\u0a59-\\u0a5c\\u0a5e\\u0a72-\\u0a74\\u0a85-\\u0a8d\\u0a8f-\\u0a91\\u0a93-\\u0aa8\\u0aaa-\\u0ab0\\u0ab2\\u0ab3\\u0ab5-\\u0ab9\\u0abd\\u0ad0\\u0ae0\\u0ae1\\u0b05-\\u0b0c\\u0b0f\\u0b10\\u0b13-\\u0b28\\u0b2a-\\u0b30\\u0b32\\u0b33\\u0b35-\\u0b39\\u0b3d\\u0b5c\\u0b5d\\u0b5f-\\u0b61\\u0b71\\u0b83\\u0b85-\\u0b8a\\u0b8e-\\u0b90\\u0b92-\\u0b95\\u0b99\\u0b9a\\u0b9c\\u0b9e\\u0b9f\\u0ba3\\u0ba4\\u0ba8-\\u0baa\\u0bae-\\u0bb9\\u0bd0\\u0c05-\\u0c0c\\u0c0e-\\u0c10\\u0c12-\\u0c28\\u0c2a-\\u0c33\\u0c35-\\u0c39\\u0c3d\\u0c58\\u0c59\\u0c60\\u0c61\\u0c85-\\u0c8c\\u0c8e-\\u0c90\\u0c92-\\u0ca8\\u0caa-\\u0cb3\\u0cb5-\\u0cb9\\u0cbd\\u0cde\\u0ce0\\u0ce1\\u0cf1\\u0cf2\\u0d05-\\u0d0c\\u0d0e-\\u0d10\\u0d12-\\u0d3a\\u0d3d\\u0d4e\\u0d60\\u0d61\\u0d7a-\\u0d7f\\u0d85-\\u0d96\\u0d9a-\\u0db1\\u0db3-\\u0dbb\\u0dbd\\u0dc0-\\u0dc6\\u0e01-\\u0e30\\u0e32\\u0e33\\u0e40-\\u0e46\\u0e81\\u0e82\\u0e84\\u0e87\\u0e88\\u0e8a\\u0e8d\\u0e94-\\u0e97\\u0e99-\\u0e9f\\u0ea1-\\u0ea3\\u0ea5\\u0ea7\\u0eaa\\u0eab\\u0ead-\\u0eb0\\u0eb2\\u0eb3\\u0ebd\\u0ec0-\\u0ec4\\u0ec6\\u0edc-\\u0edf\\u0f00\\u0f40-\\u0f47\\u0f49-\\u0f6c\\u0f88-\\u0f8c\\u1000-\\u102a\\u103f\\u1050-\\u1055\\u105a-\\u105d\\u1061\\u1065\\u1066\\u106e-\\u1070\\u1075-\\u1081\\u108e\\u10a0-\\u10c5\\u10c7\\u10cd\\u10d0-\\u10fa\\u10fc-\\u1248\\u124a-\\u124d\\u1250-\\u1256\\u1258\\u125a-\\u125d\\u1260-\\u1288\\u128a-\\u128d\\u1290-\\u12b0\\u12b2-\\u12b5\\u12b8-\\u12be\\u12c0\\u12c2-\\u12c5\\u12c8-\\u12d6\\u12d8-\\u1310\\u1312-\\u1315\\u1318-\\u135a\\u1380-\\u138f\\u13a0-\\u13f4\\u1401-\\u166c\\u166f-\\u167f\\u1681-\\u169a\\u16a0-\\u16ea\\u16ee-\\u16f0\\u1700-\\u170c\\u170e-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176c\\u176e-\\u1770\\u1780-\\u17b3\\u17d7\\u17dc\\u1820-\\u1877\\u1880-\\u18a8\\u18aa\\u18b0-\\u18f5\\u1900-\\u191c\\u1950-\\u196d\\u1970-\\u1974\\u1980-\\u19ab\\u19c1-\\u19c7\\u1a00-\\u1a16\\u1a20-\\u1a54\\u1aa7\\u1b05-\\u1b33\\u1b45-\\u1b4b\\u1b83-\\u1ba0\\u1bae\\u1baf\\u1bba-\\u1be5\\u1c00-\\u1c23\\u1c4d-\\u1c4f\\u1c5a-\\u1c7d\\u1ce9-\\u1cec\\u1cee-\\u1cf1\\u1cf5\\u1cf6\\u1d00-\\u1dbf\\u1e00-\\u1f15\\u1f18-\\u1f1d\\u1f20-\\u1f45\\u1f48-\\u1f4d\\u1f50-\\u1f57\\u1f59\\u1f5b\\u1f5d\\u1f5f-\\u1f7d\\u1f80-\\u1fb4\\u1fb6-\\u1fbc\\u1fbe\\u1fc2-\\u1fc4\\u1fc6-\\u1fcc\\u1fd0-\\u1fd3\\u1fd6-\\u1fdb\\u1fe0-\\u1fec\\u1ff2-\\u1ff4\\u1ff6-\\u1ffc\\u2071\\u207f\\u2090-\\u209c\\u2102\\u2107\\u210a-\\u2113\\u2115\\u2119-\\u211d\\u2124\\u2126\\u2128\\u212a-\\u212d\\u212f-\\u2139\\u213c-\\u213f\\u2145-\\u2149\\u214e\\u2160-\\u2188\\u2c00-\\u2c2e\\u2c30-\\u2c5e\\u2c60-\\u2ce4\\u2ceb-\\u2cee\\u2cf2\\u2cf3\\u2d00-\\u2d25\\u2d27\\u2d2d\\u2d30-\\u2d67\\u2d6f\\u2d80-\\u2d96\\u2da0-\\u2da6\\u2da8-\\u2dae\\u2db0-\\u2db6\\u2db8-\\u2dbe\\u2dc0-\\u2dc6\\u2dc8-\\u2dce\\u2dd0-\\u2dd6\\u2dd8-\\u2dde\\u2e2f\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303c\\u3041-\\u3096\\u309d-\\u309f\\u30a1-\\u30fa\\u30fc-\\u30ff\\u3105-\\u312d\\u3131-\\u318e\\u31a0-\\u31ba\\u31f0-\\u31ff\\u3400-\\u4db5\\u4e00-\\u9fcc\\ua000-\\ua48c\\ua4d0-\\ua4fd\\ua500-\\ua60c\\ua610-\\ua61f\\ua62a\\ua62b\\ua640-\\ua66e\\ua67f-\\ua697\\ua6a0-\\ua6ef\\ua717-\\ua71f\\ua722-\\ua788\\ua78b-\\ua78e\\ua790-\\ua793\\ua7a0-\\ua7aa\\ua7f8-\\ua801\\ua803-\\ua805\\ua807-\\ua80a\\ua80c-\\ua822\\ua840-\\ua873\\ua882-\\ua8b3\\ua8f2-\\ua8f7\\ua8fb\\ua90a-\\ua925\\ua930-\\ua946\\ua960-\\ua97c\\ua984-\\ua9b2\\ua9cf\\uaa00-\\uaa28\\uaa40-\\uaa42\\uaa44-\\uaa4b\\uaa60-\\uaa76\\uaa7a\\uaa80-\\uaaaf\\uaab1\\uaab5\\uaab6\\uaab9-\\uaabd\\uaac0\\uaac2\\uaadb-\\uaadd\\uaae0-\\uaaea\\uaaf2-\\uaaf4\\uab01-\\uab06\\uab09-\\uab0e\\uab11-\\uab16\\uab20-\\uab26\\uab28-\\uab2e\\uabc0-\\uabe2\\uac00-\\ud7a3\\ud7b0-\\ud7c6\\ud7cb-\\ud7fb\\uf900-\\ufa6d\\ufa70-\\ufad9\\ufb00-\\ufb06\\ufb13-\\ufb17\\ufb1d\\ufb1f-\\ufb28\\ufb2a-\\ufb36\\ufb38-\\ufb3c\\ufb3e\\ufb40\\ufb41\\ufb43\\ufb44\\ufb46-\\ufbb1\\ufbd3-\\ufd3d\\ufd50-\\ufd8f\\ufd92-\\ufdc7\\ufdf0-\\ufdfb\\ufe70-\\ufe74\\ufe76-\\ufefc\\uff21-\\uff3a\\uff41-\\uff5a\\uff66-\\uffbe\\uffc2-\\uffc7\\uffca-\\uffcf\\uffd2-\\uffd7\\uffda-\\uffdc\",Gt=\"\\u0371-\\u0374\\u0483-\\u0487\\u0591-\\u05bd\\u05bf\\u05c1\\u05c2\\u05c4\\u05c5\\u05c7\\u0610-\\u061a\\u0620-\\u0649\\u0672-\\u06d3\\u06e7-\\u06e8\\u06fb-\\u06fc\\u0730-\\u074a\\u0800-\\u0814\\u081b-\\u0823\\u0825-\\u0827\\u0829-\\u082d\\u0840-\\u0857\\u08e4-\\u08fe\\u0900-\\u0903\\u093a-\\u093c\\u093e-\\u094f\\u0951-\\u0957\\u0962-\\u0963\\u0966-\\u096f\\u0981-\\u0983\\u09bc\\u09be-\\u09c4\\u09c7\\u09c8\\u09d7\\u09df-\\u09e0\\u0a01-\\u0a03\\u0a3c\\u0a3e-\\u0a42\\u0a47\\u0a48\\u0a4b-\\u0a4d\\u0a51\\u0a66-\\u0a71\\u0a75\\u0a81-\\u0a83\\u0abc\\u0abe-\\u0ac5\\u0ac7-\\u0ac9\\u0acb-\\u0acd\\u0ae2-\\u0ae3\\u0ae6-\\u0aef\\u0b01-\\u0b03\\u0b3c\\u0b3e-\\u0b44\\u0b47\\u0b48\\u0b4b-\\u0b4d\\u0b56\\u0b57\\u0b5f-\\u0b60\\u0b66-\\u0b6f\\u0b82\\u0bbe-\\u0bc2\\u0bc6-\\u0bc8\\u0bca-\\u0bcd\\u0bd7\\u0be6-\\u0bef\\u0c01-\\u0c03\\u0c46-\\u0c48\\u0c4a-\\u0c4d\\u0c55\\u0c56\\u0c62-\\u0c63\\u0c66-\\u0c6f\\u0c82\\u0c83\\u0cbc\\u0cbe-\\u0cc4\\u0cc6-\\u0cc8\\u0cca-\\u0ccd\\u0cd5\\u0cd6\\u0ce2-\\u0ce3\\u0ce6-\\u0cef\\u0d02\\u0d03\\u0d46-\\u0d48\\u0d57\\u0d62-\\u0d63\\u0d66-\\u0d6f\\u0d82\\u0d83\\u0dca\\u0dcf-\\u0dd4\\u0dd6\\u0dd8-\\u0ddf\\u0df2\\u0df3\\u0e34-\\u0e3a\\u0e40-\\u0e45\\u0e50-\\u0e59\\u0eb4-\\u0eb9\\u0ec8-\\u0ecd\\u0ed0-\\u0ed9\\u0f18\\u0f19\\u0f20-\\u0f29\\u0f35\\u0f37\\u0f39\\u0f41-\\u0f47\\u0f71-\\u0f84\\u0f86-\\u0f87\\u0f8d-\\u0f97\\u0f99-\\u0fbc\\u0fc6\\u1000-\\u1029\\u1040-\\u1049\\u1067-\\u106d\\u1071-\\u1074\\u1082-\\u108d\\u108f-\\u109d\\u135d-\\u135f\\u170e-\\u1710\\u1720-\\u1730\\u1740-\\u1750\\u1772\\u1773\\u1780-\\u17b2\\u17dd\\u17e0-\\u17e9\\u180b-\\u180d\\u1810-\\u1819\\u1920-\\u192b\\u1930-\\u193b\\u1951-\\u196d\\u19b0-\\u19c0\\u19c8-\\u19c9\\u19d0-\\u19d9\\u1a00-\\u1a15\\u1a20-\\u1a53\\u1a60-\\u1a7c\\u1a7f-\\u1a89\\u1a90-\\u1a99\\u1b46-\\u1b4b\\u1b50-\\u1b59\\u1b6b-\\u1b73\\u1bb0-\\u1bb9\\u1be6-\\u1bf3\\u1c00-\\u1c22\\u1c40-\\u1c49\\u1c5b-\\u1c7d\\u1cd0-\\u1cd2\\u1d00-\\u1dbe\\u1e01-\\u1f15\\u200c\\u200d\\u203f\\u2040\\u2054\\u20d0-\\u20dc\\u20e1\\u20e5-\\u20f0\\u2d81-\\u2d96\\u2de0-\\u2dff\\u3021-\\u3028\\u3099\\u309a\\ua640-\\ua66d\\ua674-\\ua67d\\ua69f\\ua6f0-\\ua6f1\\ua7f8-\\ua800\\ua806\\ua80b\\ua823-\\ua827\\ua880-\\ua881\\ua8b4-\\ua8c4\\ua8d0-\\ua8d9\\ua8f3-\\ua8f7\\ua900-\\ua909\\ua926-\\ua92d\\ua930-\\ua945\\ua980-\\ua983\\ua9b3-\\ua9c0\\uaa00-\\uaa27\\uaa40-\\uaa41\\uaa4c-\\uaa4d\\uaa50-\\uaa59\\uaa7b\\uaae0-\\uaae9\\uaaf2-\\uaaf3\\uabc0-\\uabe1\\uabec\\uabed\\uabf0-\\uabf9\\ufb20-\\ufb28\\ufe00-\\ufe0f\\ufe20-\\ufe26\\ufe33\\ufe34\\ufe4d-\\ufe4f\\uff10-\\uff19\\uff3f\",Ht=RegExp(\"[\"+$t+\"]\"),Kt=RegExp(\"[\"+$t+Gt+\"]\"),Qt=/[\\n\\r\\u2028\\u2029]/,Yt=/\\r\\n|[\\n\\r\\u2028\\u2029]/g,Zt={kind:\"loop\"},_t={kind:\"switch\"}})(\"undefined\"==typeof exports?self.acorn={}:exports);\r\n\r\nvar PaperScript = this.PaperScript = new function() {\r\n\t// Operators to overload\r\n\r\n\tvar binaryOperators = {\r\n\t\t'+': 'add',\r\n\t\t'-': 'subtract',\r\n\t\t'*': 'multiply',\r\n\t\t'/': 'divide',\r\n\t\t'%': 'modulo',\r\n\t\t'==': 'equals',\r\n\t\t'!=': 'equals'\r\n\t};\r\n\r\n\tvar unaryOperators = {\r\n\t\t'-': 'negate',\r\n\t\t'+': null\r\n\t};\r\n\r\n\t// Use very short name for the binary operator (_$_) as well as the\r\n\t// unary operator ($_), as operations will be replaced with then.\r\n\t// The underscores stands for the values, and the $ for the operators.\r\n\r\n\t// Binary Operator Handler\r\n\tfunction _$_(left, operator, right) {\r\n\t\tvar handler = binaryOperators[operator];\r\n\t\tif (left && left[handler]) {\r\n\t\t\tvar res = left[handler](right);\r\n\t\t\treturn operator === '!=' ? !res : res;\r\n\t\t}\r\n\t\tswitch (operator) {\r\n\t\tcase '+': return left + right;\r\n\t\tcase '-': return left - right;\r\n\t\tcase '*': return left * right;\r\n\t\tcase '/': return left / right;\r\n\t\tcase '%': return left % right;\r\n\t\tcase '==': return left == right;\r\n\t\tcase '!=': return left != right;\r\n\t\t}\r\n\t}\r\n\r\n\t// Unary Operator Handler\r\n\tfunction $_(operator, value) {\r\n\t\tvar handler = unaryOperators[operator];\r\n\t\tif (handler && value && value[handler])\r\n\t\t\treturn value[handler]();\r\n\t\tswitch (operator) {\r\n\t\tcase '+': return +value;\r\n\t\tcase '-': return -value;\r\n\t\t}\r\n\t}\r\n\r\n\t// AST Helpers\r\n\r\n\t/**\r\n\t * Compiles PaperScript code into JavaScript code.\r\n\t *\r\n\t * @name PaperScript.compile\r\n\t * @function\r\n\t * @param {String} code The PaperScript code.\r\n\t * @return {String} The compiled PaperScript as JavaScript code.\r\n\t */\r\n\tfunction compile(code) {\r\n\t\t// Use Acorn or Esprima to translate the code into an AST structure\r\n\t\t// which is then walked and parsed for operators to overload.\r\n\t\t// Instead of modifying the AST and converting back to code, we directly\r\n\t\t// change the source code based on the parser's range information, so we\r\n\r\n\t\tvar insertions = [];\r\n\r\n\t\tfunction getOffset(offset) {\r\n\t\t\tvar start = offset;\r\n\t\t\tfor (var i = 0, l = insertions.length; i < l; i++) {\r\n\t\t\t\tvar insertion = insertions[i];\r\n\t\t\t\tif (insertion[0] >= offset)\r\n\t\t\t\t\tbreak;\r\n\t\t\t\toffset += insertion[1];\r\n\t\t\t}\r\n\t\t\treturn offset;\r\n\t\t}\r\n\r\n\t\tfunction getCode(node) {\r\n\t\t\treturn code.substring(getOffset(node.range[0]),\r\n\t\t\t\t\tgetOffset(node.range[1]));\r\n\t\t}\r\n\r\n\t\tfunction replaceCode(node, str) {\r\n\t\t\tvar start = getOffset(node.range[0]),\r\n\t\t\t\tend = getOffset(node.range[1]);\r\n\t\t\tvar insert = 0;\r\n\t\t\tfor (var i = insertions.length - 1; i >= 0; i--) {\r\n\t\t\t\tif (start > insertions[i][0]) {\r\n\t\t\t\t\tinsert = i + 1;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tinsertions.splice(insert, 0, [start, str.length - end + start]);\r\n\t\t\tcode = code.substring(0, start) + str + code.substring(end);\r\n\t\t}\r\n\r\n\t\tfunction walkAst(node) {\r\n\t\t\tfor (var key in node) {\r\n\t\t\t\tif (key === 'range')\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\tvar value = node[key];\r\n\t\t\t\tif (Array.isArray(value)) {\r\n\t\t\t\t\tfor (var i = 0, l = value.length; i < l; i++)\r\n\t\t\t\t\t\twalkAst(value[i]);\r\n\t\t\t\t} else if (value && typeof value === 'object') {\r\n\t\t\t\t\twalkAst(value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tswitch (node && node.type) {\r\n\t\t\tcase 'BinaryExpression':\r\n\t\t\t\tif (node.operator in binaryOperators\r\n\t\t\t\t\t\t&& node.left.type !== 'Literal') {\r\n\t\t\t\t\tvar left = getCode(node.left),\r\n\t\t\t\t\t\tright = getCode(node.right);\r\n\t\t\t\t\treplaceCode(node, '_$_(' + left + ', \"' + node.operator\r\n\t\t\t\t\t\t\t+ '\", ' + right + ')');\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'AssignmentExpression':\r\n\t\t\t\tif (/^.=$/.test(node.operator)\r\n\t\t\t\t\t\t&& node.left.type !== 'Literal') {\r\n\t\t\t\t\tvar left = getCode(node.left),\r\n\t\t\t\t\t\tright = getCode(node.right);\r\n\t\t\t\t\treplaceCode(node, left + ' = _$_(' + left + ', \"'\r\n\t\t\t\t\t\t\t+ node.operator[0] + '\", ' + right + ')');\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'UpdateExpression':\r\n\t\t\t\tif (!node.prefix) {\r\n\t\t\t\t\tvar arg = getCode(node.argument);\r\n\t\t\t\t\treplaceCode(node, arg + ' = _$_(' + arg + ', \"'\r\n\t\t\t\t\t\t\t+ node.operator[0] + '\", 1)');\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'UnaryExpression':\r\n\t\t\t\tif (node.operator in unaryOperators\r\n\t\t\t\t\t\t&& node.argument.type !== 'Literal') {\r\n\t\t\t\t\tvar arg = getCode(node.argument);\r\n\t\t\t\t\treplaceCode(node, '$_(\"' + node.operator + '\", '\r\n\t\t\t\t\t\t\t+ arg + ')');\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\twalkAst(acorn.parse(code, { ranges: true }));\r\n\t\treturn code;\r\n\t}\r\n\r\n\tfunction evaluate(code, scope) {\r\n\t\tpaper = scope;\r\n\t\tvar view = scope.project && scope.project.view,\r\n\t\t\tres;\r\n\t\twith (scope) {\r\n\t\t\t(function() {\r\n\t\t\t\tvar onActivate, onDeactivate, onEditOptions,\r\n\t\t\t\t\tonMouseDown, onMouseUp, onMouseDrag, onMouseMove,\r\n\t\t\t\t\tonKeyDown, onKeyUp, onFrame, onResize;\r\n\t\t\t\tres = eval(compile(code));\r\n\t\t\t\tif (/on(?:Key|Mouse)(?:Up|Down|Move|Drag)/.test(code)) {\r\n\t\t\t\t\tBase.each(Tool.prototype._events, function(key) {\r\n\t\t\t\t\t\tvar value = eval(key);\r\n\t\t\t\t\t\tif (value) {\r\n\t\t\t\t\t\t\tscope.getTool()[key] = value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tif (view) {\r\n\t\t\t\t\tview.setOnResize(onResize);\r\n\t\t\t\t\tview.fire('resize', {\r\n\t\t\t\t\t\tsize: view.size,\r\n\t\t\t\t\t\tdelta: new Point()\r\n\t\t\t\t\t});\r\n\t\t\t\t\tview.setOnFrame(onFrame);\r\n\t\t\t\t\tview.draw();\r\n\t\t\t\t}\r\n\t\t\t}).call(scope);\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\r\n\tfunction request(url, scope) {\r\n\t\tvar xhr = new (window.ActiveXObject || XMLHttpRequest)(\r\n\t\t\t\t'Microsoft.XMLHTTP');\r\n\t\txhr.open('GET', url, true);\r\n\t\tif (xhr.overrideMimeType)\r\n\t\t\txhr.overrideMimeType('text/plain');\r\n\t\txhr.onreadystatechange = function() {\r\n\t\t\tif (xhr.readyState === 4) {\r\n\t\t\t\treturn evaluate(xhr.responseText, scope);\r\n\t\t\t}\r\n\t\t};\r\n\t\treturn xhr.send(null);\r\n\t}\r\n\r\n\tfunction load() {\r\n\t\tvar scripts = document.getElementsByTagName('script');\r\n\t\tfor (var i = 0, l = scripts.length; i < l; i++) {\r\n\t\t\tvar script = scripts[i];\r\n\t\t\tif (/^text\\/(?:x-|)paperscript$/.test(script.type)\r\n\t\t\t\t\t&& !script.getAttribute('data-paper-ignore')) {\r\n\t\t\t\tvar canvas = PaperScript.getAttribute(script, 'canvas'),\r\n\t\t\t\t\tscope = PaperScope.get(canvas)\r\n\t\t\t\t\t\t\t|| new PaperScope(script).setup(canvas);\r\n\t\t\t\tif (script.src) {\r\n\t\t\t\t\trequest(script.src, scope);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tevaluate(script.innerHTML, scope);\r\n\t\t\t\t}\r\n\t\t\t\tscript.setAttribute('data-paper-ignore', true);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif (document.readyState === 'complete') {\r\n\t\tsetTimeout(load);\r\n\t} else {\r\n\t\tDomEvent.add(window, { load: load });\r\n\t}\r\n\r\n\tfunction handleAttribute(name) {\r\n\t\tname += 'Attribute';\r\n\t\treturn function(el, attr) {\r\n\t\t\treturn el[name](attr) || el[name]('data-paper-' + attr);\r\n\t\t};\r\n\t}\r\n\r\n\treturn {\r\n\t\tcompile: compile,\r\n\t\tevaluate: evaluate,\r\n\t\tload: load,\r\n\t\tgetAttribute: handleAttribute('get'),\r\n\t\thasAttribute: handleAttribute('has')\r\n\t};\r\n\r\n};\r\n\r\nthis.enumerable = true;\r\nreturn new (PaperScope.inject(this));\r\n};\r\n","/*!\n * Cropper v2.0.1\n * https://github.com/fengyuanchen/cropper\n *\n * Copyright (c) 2014-2015 Fengyuan Chen and contributors\n * Released under the MIT license\n *\n * Date: 2015-11-18T03:13:47.241Z\n */\n!function(t){\"function\"==typeof define&&define.amd?define([\"jquery\"],t):t(\"object\"==typeof exports?require(\"jquery\"):jQuery)}(function(t){\"use strict\";function i(t){return\"number\"==typeof t&&!isNaN(t)}function e(t){return\"undefined\"==typeof t}function s(t,e){var s=[];return i(e)&&s.push(e),s.slice.apply(t,s)}function h(t,i){var e=s(arguments,2);return function(){return t.apply(i,e.concat(s(arguments)))}}function o(t){var i=t.match(/^(https?:)\\/\\/([^\\:\\/\\?#]+):?(\\d*)/i);return i&&(i[1]!==f.protocol||i[2]!==f.hostname||i[3]!==f.port)}function a(t){var i=\"timestamp=\"+(new Date).getTime();return t+(-1===t.indexOf(\"?\")?\"?\":\"&\")+i}function n(t){return t?' crossOrigin=\"'+t+'\"':\"\"}function r(t,i){var e;return t.naturalWidth?i(t.naturalWidth,t.naturalHeight):(e=document.createElement(\"img\"),e.onload=function(){i(this.width,this.height)},void(e.src=t.src))}function p(t){var e=[],s=t.rotate,h=t.scaleX,o=t.scaleY;return i(s)&&e.push(\"rotate(\"+s+\"deg)\"),i(h)&&i(o)&&e.push(\"scale(\"+h+\",\"+o+\")\"),e.length?e.join(\" \"):\"none\"}function l(t,i){var e,s,h=at(t.degree)%180,o=(h>90?180-h:h)*Math.PI/180,a=nt(o),n=rt(o),r=t.width,p=t.height,l=t.aspectRatio;return i?(e=r/(n+a/l),s=e/l):(e=r*n+p*a,s=r*a+p*n),{width:e,height:s}}function d(e,s){var h,o,a,n=t(\"<canvas>\")[0],r=n.getContext(\"2d\"),p=0,d=0,c=s.naturalWidth,g=s.naturalHeight,u=s.rotate,f=s.scaleX,m=s.scaleY,v=i(f)&&i(m)&&(1!==f||1!==m),w=i(u)&&0!==u,x=w||v,C=c,b=g;return v&&(h=c/2,o=g/2),w&&(a=l({width:c,height:g,degree:u}),C=a.width,b=a.height,h=a.width/2,o=a.height/2),n.width=C,n.height=b,x&&(p=-c/2,d=-g/2,r.save(),r.translate(h,o)),w&&r.rotate(u*Math.PI/180),v&&r.scale(f,m),r.drawImage(e,p,d,c,g),x&&r.restore(),n}function c(i,e){this.$element=t(i),this.options=t.extend({},c.DEFAULTS,t.isPlainObject(e)&&e),this.isLoaded=!1,this.isBuilt=!1,this.isCompleted=!1,this.isRotated=!1,this.isCropped=!1,this.isDisabled=!1,this.isReplaced=!1,this.isLimited=!1,this.isImg=!1,this.originalUrl=\"\",this.crossOrigin=\"\",this.canvas=null,this.cropBox=null,this.init()}var g=t(window),u=t(document),f=window.location,m=\"cropper\",v=\"cropper-modal\",w=\"cropper-hide\",x=\"cropper-hidden\",C=\"cropper-invisible\",b=\"cropper-move\",B=\"cropper-crop\",D=\"cropper-disabled\",y=\"cropper-bg\",$=\"mousedown touchstart pointerdown MSPointerDown\",L=\"mousemove touchmove pointermove MSPointerMove\",T=\"mouseup touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel\",M=\"wheel mousewheel DOMMouseScroll\",W=\"dblclick\",Y=\"load.\"+m,X=\"error.\"+m,R=\"resize.\"+m,k=\"build.\"+m,z=\"built.\"+m,H=\"cropstart.\"+m,O=\"cropmove.\"+m,P=\"cropend.\"+m,E=\"crop.\"+m,I=\"zoom.\"+m,F=/^(e|w|s|n|se|sw|ne|nw|all|crop|move|zoom)$/,S=\"preview\",j=\"action\",A=\"e\",N=\"w\",U=\"s\",_=\"n\",q=\"se\",Z=\"sw\",K=\"ne\",Q=\"nw\",G=\"all\",J=\"crop\",V=\"move\",tt=\"zoom\",it=\"none\",et=t.isFunction(t(\"<canvas>\")[0].getContext),st=Number,ht=Math.min,ot=Math.max,at=Math.abs,nt=Math.sin,rt=Math.cos,pt=Math.sqrt,lt=Math.round,dt={version:\"2.0.1\"};t.extend(dt,{init:function(){var t,i=this.$element;if(i.is(\"img\")){if(this.isImg=!0,this.originalUrl=t=i.attr(\"src\"),!t)return;t=i.prop(\"src\")}else i.is(\"canvas\")&&et&&(t=i[0].toDataURL());this.load(t)},trigger:function(i,e){var s=t.Event(i,e);return this.$element.trigger(s),s},load:function(i){var e,s,h=this.options,r=this.$element,p=\"\";i&&(this.url=i,r.one(k,h.build),this.trigger(k).isDefaultPrevented()||(h.checkCrossOrigin&&o(i)&&(p=r.prop(\"crossOrigin\"),p||(p=\"anonymous\",e=a(i))),this.crossOrigin=p,this.$clone=s=t(\"<img\"+n(p)+' src=\"'+(e||i)+'\">'),this.isImg?r[0].complete?this.start():r.one(Y,t.proxy(this.start,this)):s.one(Y,t.proxy(this.start,this)).one(X,t.proxy(this.stop,this)).addClass(w).insertAfter(r)))},start:function(){var i=this.$element,e=this.$clone;this.isImg||(e.off(X,this.stop),i=e),r(i[0],t.proxy(function(t,i){this.image={naturalWidth:t,naturalHeight:i,aspectRatio:t/i},this.isLoaded=!0,this.build()},this))},stop:function(){this.$clone.remove(),this.$clone=null}}),t.extend(dt,{build:function(){var i,e,s,h=this.options,o=this.$element,a=this.$clone;this.isLoaded&&(this.isBuilt&&this.unbuild(),this.$container=o.parent(),this.$cropper=i=t(c.TEMPLATE),this.$canvas=i.find(\".cropper-canvas\").append(a),this.$dragBox=i.find(\".cropper-drag-box\"),this.$cropBox=e=i.find(\".cropper-crop-box\"),this.$viewBox=i.find(\".cropper-view-box\"),this.$face=s=e.find(\".cropper-face\"),o.addClass(x).after(i),this.isImg||a.removeClass(w),this.initPreview(),this.bind(),h.aspectRatio=ot(0,h.aspectRatio)||NaN,h.viewMode=ot(0,ht(3,lt(h.viewMode)))||0,h.autoCrop?(this.isCropped=!0,h.modal&&this.$dragBox.addClass(v)):e.addClass(x),h.guides||e.find(\".cropper-dashed\").addClass(x),h.center||e.find(\".cropper-center\").addClass(x),h.cropBoxMovable&&s.addClass(b).data(j,G),h.highlight||s.addClass(C),h.background&&i.addClass(y),h.cropBoxResizable||e.find(\".cropper-line, .cropper-point\").addClass(x),this.setDragMode(h.dragMode),this.render(),this.isBuilt=!0,this.setData(h.data),o.one(z,h.built),setTimeout(t.proxy(function(){this.trigger(z),this.isCompleted=!0},this),0))},unbuild:function(){this.isBuilt&&(this.isBuilt=!1,this.initialImage=null,this.initialCanvas=null,this.initialCropBox=null,this.container=null,this.canvas=null,this.cropBox=null,this.unbind(),this.resetPreview(),this.$preview=null,this.$viewBox=null,this.$cropBox=null,this.$dragBox=null,this.$canvas=null,this.$container=null,this.$cropper.remove(),this.$cropper=null)}}),t.extend(dt,{render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.isCropped&&this.renderCropBox()},initContainer:function(){var t=this.options,i=this.$element,e=this.$container,s=this.$cropper;s.addClass(x),i.removeClass(x),s.css(this.container={width:ot(e.width(),st(t.minContainerWidth)||200),height:ot(e.height(),st(t.minContainerHeight)||100)}),i.addClass(x),s.removeClass(x)},initCanvas:function(){var i=this.options.viewMode,e=this.container,s=e.width,h=e.height,o=this.image,a=o.aspectRatio,n={naturalWidth:o.naturalWidth,naturalHeight:o.naturalHeight,aspectRatio:a,width:s,height:h};h*a>s?3===i?n.width=h*a:n.height=s/a:3===i?n.height=s/a:n.width=h*a,n.oldLeft=n.left=(s-n.width)/2,n.oldTop=n.top=(h-n.height)/2,this.canvas=n,this.isLimited=1===i||2===i,this.limitCanvas(!0,!0),this.initialImage=t.extend({},o),this.initialCanvas=t.extend({},n)},limitCanvas:function(t,i){var e,s,h,o,a=this.options,n=a.viewMode,r=this.container,p=r.width,l=r.height,d=this.canvas,c=d.aspectRatio,g=this.cropBox,u=this.isCropped&&g;t&&(e=st(a.minCanvasWidth)||0,s=st(a.minCanvasHeight)||0,n&&(n>1?(e=ot(e,p),s=ot(s,l),3===n&&(s*c>e?e=s*c:s=e/c)):e?e=ot(e,u?g.width:0):s?s=ot(s,u?g.height:0):u&&(e=g.width,s=g.height,s*c>e?e=s*c:s=e/c)),e&&s?s*c>e?s=e/c:e=s*c:e?s=e/c:s&&(e=s*c),d.minWidth=e,d.minHeight=s,d.maxWidth=1/0,d.maxHeight=1/0),i&&(n?(h=p-d.width,o=l-d.height,d.minLeft=ht(0,h),d.minTop=ht(0,o),d.maxLeft=ot(0,h),d.maxTop=ot(0,o),u&&this.isLimited&&(d.minLeft=ht(g.left,g.left+g.width-d.width),d.minTop=ht(g.top,g.top+g.height-d.height),d.maxLeft=g.left,d.maxTop=g.top,2===n&&(d.width>=p&&(d.minLeft=ht(0,h),d.maxLeft=ot(0,h)),d.height>=l&&(d.minTop=ht(0,o),d.maxTop=ot(0,o))))):(d.minLeft=-d.width,d.minTop=-d.height,d.maxLeft=p,d.maxTop=l))},renderCanvas:function(t){var i,e,s=this.canvas,h=this.image,o=h.rotate,a=h.naturalWidth,n=h.naturalHeight;this.isRotated&&(this.isRotated=!1,e=l({width:h.width,height:h.height,degree:o}),i=e.width/e.height,i!==s.aspectRatio&&(s.left-=(e.width-s.width)/2,s.top-=(e.height-s.height)/2,s.width=e.width,s.height=e.height,s.aspectRatio=i,s.naturalWidth=a,s.naturalHeight=n,o%180&&(e=l({width:a,height:n,degree:o}),s.naturalWidth=e.width,s.naturalHeight=e.height),this.limitCanvas(!0,!1))),(s.width>s.maxWidth||s.width<s.minWidth)&&(s.left=s.oldLeft),(s.height>s.maxHeight||s.height<s.minHeight)&&(s.top=s.oldTop),s.width=ht(ot(s.width,s.minWidth),s.maxWidth),s.height=ht(ot(s.height,s.minHeight),s.maxHeight),this.limitCanvas(!1,!0),s.oldLeft=s.left=ht(ot(s.left,s.minLeft),s.maxLeft),s.oldTop=s.top=ht(ot(s.top,s.minTop),s.maxTop),this.$canvas.css({width:s.width,height:s.height,left:s.left,top:s.top}),this.renderImage(),this.isCropped&&this.isLimited&&this.limitCropBox(!0,!0),t&&this.output()},renderImage:function(i){var e,s=this.canvas,h=this.image;h.rotate&&(e=l({width:s.width,height:s.height,degree:h.rotate,aspectRatio:h.aspectRatio},!0)),t.extend(h,e?{width:e.width,height:e.height,left:(s.width-e.width)/2,top:(s.height-e.height)/2}:{width:s.width,height:s.height,left:0,top:0}),this.$clone.css({width:h.width,height:h.height,marginLeft:h.left,marginTop:h.top,transform:p(h)}),i&&this.output()},initCropBox:function(){var i=this.options,e=this.canvas,s=i.aspectRatio,h=st(i.autoCropArea)||.8,o={width:e.width,height:e.height};s&&(e.height*s>e.width?o.height=o.width/s:o.width=o.height*s),this.cropBox=o,this.limitCropBox(!0,!0),o.width=ht(ot(o.width,o.minWidth),o.maxWidth),o.height=ht(ot(o.height,o.minHeight),o.maxHeight),o.width=ot(o.minWidth,o.width*h),o.height=ot(o.minHeight,o.height*h),o.oldLeft=o.left=e.left+(e.width-o.width)/2,o.oldTop=o.top=e.top+(e.height-o.height)/2,this.initialCropBox=t.extend({},o)},limitCropBox:function(t,i){var e,s,h,o,a=this.options,n=a.aspectRatio,r=this.container,p=r.width,l=r.height,d=this.canvas,c=this.cropBox,g=this.isLimited;t&&(e=st(a.minCropBoxWidth)||0,s=st(a.minCropBoxHeight)||0,e=ht(e,p),s=ht(s,l),h=ht(p,g?d.width:p),o=ht(l,g?d.height:l),n&&(e&&s?s*n>e?s=e/n:e=s*n:e?s=e/n:s&&(e=s*n),o*n>h?o=h/n:h=o*n),c.minWidth=ht(e,h),c.minHeight=ht(s,o),c.maxWidth=h,c.maxHeight=o),i&&(g?(c.minLeft=ot(0,d.left),c.minTop=ot(0,d.top),c.maxLeft=ht(p,d.left+d.width)-c.width,c.maxTop=ht(l,d.top+d.height)-c.height):(c.minLeft=0,c.minTop=0,c.maxLeft=p-c.width,c.maxTop=l-c.height))},renderCropBox:function(){var t=this.options,i=this.container,e=i.width,s=i.height,h=this.cropBox;(h.width>h.maxWidth||h.width<h.minWidth)&&(h.left=h.oldLeft),(h.height>h.maxHeight||h.height<h.minHeight)&&(h.top=h.oldTop),h.width=ht(ot(h.width,h.minWidth),h.maxWidth),h.height=ht(ot(h.height,h.minHeight),h.maxHeight),this.limitCropBox(!1,!0),h.oldLeft=h.left=ht(ot(h.left,h.minLeft),h.maxLeft),h.oldTop=h.top=ht(ot(h.top,h.minTop),h.maxTop),t.movable&&t.cropBoxMovable&&this.$face.data(j,h.width===e&&h.height===s?V:G),this.$cropBox.css({width:h.width,height:h.height,left:h.left,top:h.top}),this.isCropped&&this.isLimited&&this.limitCanvas(!0,!0),this.isDisabled||this.output()},output:function(){this.preview(),this.isCompleted?this.trigger(E,this.getData()):this.isBuilt||this.$element.one(z,t.proxy(function(){this.trigger(E,this.getData())},this))}}),t.extend(dt,{initPreview:function(){var i=n(this.crossOrigin),e=this.url;this.$preview=t(this.options.preview),this.$viewBox.html(\"<img\"+i+' src=\"'+e+'\">'),this.$preview.each(function(){var s=t(this);s.data(S,{width:s.width(),height:s.height(),html:s.html()}),s.html(\"<img\"+i+' src=\"'+e+'\" style=\"display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;\">')})},resetPreview:function(){this.$preview.each(function(){var i=t(this),e=i.data(S);i.css({width:e.width,height:e.height}).html(e.html).removeData(S)})},preview:function(){var i=this.image,e=this.canvas,s=this.cropBox,h=s.width,o=s.height,a=i.width,n=i.height,r=s.left-e.left-i.left,l=s.top-e.top-i.top;this.isCropped&&!this.isDisabled&&(this.$viewBox.find(\"img\").css({width:a,height:n,marginLeft:-r,marginTop:-l,transform:p(i)}),this.$preview.each(function(){var e=t(this),s=e.data(S),d=s.width,c=s.height,g=d,u=c,f=1;h&&(f=d/h,u=o*f),o&&u>c&&(f=c/o,g=h*f,u=c),e.css({width:g,height:u}).find(\"img\").css({width:a*f,height:n*f,marginLeft:-r*f,marginTop:-l*f,transform:p(i)})}))}}),t.extend(dt,{bind:function(){var i=this.options,e=this.$element,s=this.$cropper;t.isFunction(i.cropstart)&&e.on(H,i.cropstart),t.isFunction(i.cropmove)&&e.on(O,i.cropmove),t.isFunction(i.cropend)&&e.on(P,i.cropend),t.isFunction(i.crop)&&e.on(E,i.crop),t.isFunction(i.zoom)&&e.on(I,i.zoom),s.on($,t.proxy(this.cropStart,this)),i.zoomable&&i.zoomOnWheel&&s.on(M,t.proxy(this.wheel,this)),i.toggleDragModeOnDblclick&&s.on(W,t.proxy(this.dblclick,this)),u.on(L,this._cropMove=h(this.cropMove,this)).on(T,this._cropEnd=h(this.cropEnd,this)),i.responsive&&g.on(R,this._resize=h(this.resize,this))},unbind:function(){var i=this.options,e=this.$element,s=this.$cropper;t.isFunction(i.cropstart)&&e.off(H,i.cropstart),t.isFunction(i.cropmove)&&e.off(O,i.cropmove),t.isFunction(i.cropend)&&e.off(P,i.cropend),t.isFunction(i.crop)&&e.off(E,i.crop),t.isFunction(i.zoom)&&e.off(I,i.zoom),s.off($,this.cropStart),i.zoomable&&i.zoomOnWheel&&s.off(M,this.wheel),i.toggleDragModeOnDblclick&&s.off(W,this.dblclick),u.off(L,this._cropMove).off(T,this._cropEnd),i.responsive&&g.off(R,this._resize)}}),t.extend(dt,{resize:function(){var i,e,s,h=this.$container,o=this.container;!this.isDisabled&&o&&(s=h.width()/o.width,(1!==s||h.height()!==o.height)&&(i=this.getCanvasData(),e=this.getCropBoxData(),this.render(),this.setCanvasData(t.each(i,function(t,e){i[t]=e*s})),this.setCropBoxData(t.each(e,function(t,i){e[t]=i*s}))))},dblclick:function(){this.isDisabled||(this.$dragBox.hasClass(B)?this.setDragMode(V):this.setDragMode(J))},wheel:function(t){var i=t.originalEvent,e=i||t,s=st(this.options.wheelZoomRatio)||.1,h=1;this.isDisabled||(t.preventDefault(),e.deltaY?h=e.deltaY>0?1:-1:e.wheelDelta?h=-e.wheelDelta/120:e.detail&&(h=e.detail>0?1:-1),this.zoom(-h*s,i))},cropStart:function(i){var e,s,h=this.options,o=i.originalEvent,a=o&&o.touches,n=i;if(!this.isDisabled){if(a){if(e=a.length,e>1){if(!h.zoomable||!h.zoomOnTouch||2!==e)return;n=a[1],this.startX2=n.pageX,this.startY2=n.pageY,s=tt}n=a[0]}if(s=s||t(n.target).data(j),F.test(s)){if(this.trigger(H,{originalEvent:o,action:s}).isDefaultPrevented())return;i.preventDefault(),this.action=s,this.cropping=!1,this.startX=n.pageX||o&&o.pageX,this.startY=n.pageY||o&&o.pageY,s===J&&(this.cropping=!0,this.$dragBox.addClass(v))}}},cropMove:function(t){var i,e=this.options,s=t.originalEvent,h=s&&s.touches,o=t,a=this.action;if(!this.isDisabled){if(h){if(i=h.length,i>1){if(!e.zoomable||!e.zoomOnTouch||2!==i)return;o=h[1],this.endX2=o.pageX,this.endY2=o.pageY}o=h[0]}if(a){if(this.trigger(O,{originalEvent:s,action:a}).isDefaultPrevented())return;t.preventDefault(),this.endX=o.pageX||s&&s.pageX,this.endY=o.pageY||s&&s.pageY,this.change(o.shiftKey,a===tt?s:null)}}},cropEnd:function(t){var i=t.originalEvent,e=this.action;this.isDisabled||e&&(t.preventDefault(),this.cropping&&(this.cropping=!1,this.$dragBox.toggleClass(v,this.isCropped&&this.options.modal)),this.action=\"\",this.trigger(P,{originalEvent:i,action:e}))}}),t.extend(dt,{change:function(t,i){var e,s,h=this.options,o=h.aspectRatio,a=this.action,n=this.container,r=this.canvas,p=this.cropBox,l=p.width,d=p.height,c=p.left,g=p.top,u=c+l,f=g+d,m=0,v=0,w=n.width,C=n.height,b=!0;switch(!o&&t&&(o=l&&d?l/d:1),this.limited&&(m=p.minLeft,v=p.minTop,w=m+ht(n.width,r.width),C=v+ht(n.height,r.height)),s={x:this.endX-this.startX,y:this.endY-this.startY},o&&(s.X=s.y*o,s.Y=s.x/o),a){case G:c+=s.x,g+=s.y;break;case A:if(s.x>=0&&(u>=w||o&&(v>=g||f>=C))){b=!1;break}l+=s.x,o&&(d=l/o,g-=s.Y/2),0>l&&(a=N,l=0);break;case _:if(s.y<=0&&(v>=g||o&&(m>=c||u>=w))){b=!1;break}d-=s.y,g+=s.y,o&&(l=d*o,c+=s.X/2),0>d&&(a=U,d=0);break;case N:if(s.x<=0&&(m>=c||o&&(v>=g||f>=C))){b=!1;break}l-=s.x,c+=s.x,o&&(d=l/o,g+=s.Y/2),0>l&&(a=A,l=0);break;case U:if(s.y>=0&&(f>=C||o&&(m>=c||u>=w))){b=!1;break}d+=s.y,o&&(l=d*o,c-=s.X/2),0>d&&(a=_,d=0);break;case K:if(o){if(s.y<=0&&(v>=g||u>=w)){b=!1;break}d-=s.y,g+=s.y,l=d*o}else s.x>=0?w>u?l+=s.x:s.y<=0&&v>=g&&(b=!1):l+=s.x,s.y<=0?g>v&&(d-=s.y,g+=s.y):(d-=s.y,g+=s.y);0>l&&0>d?(a=Z,d=0,l=0):0>l?(a=Q,l=0):0>d&&(a=q,d=0);break;case Q:if(o){if(s.y<=0&&(v>=g||m>=c)){b=!1;break}d-=s.y,g+=s.y,l=d*o,c+=s.X}else s.x<=0?c>m?(l-=s.x,c+=s.x):s.y<=0&&v>=g&&(b=!1):(l-=s.x,c+=s.x),s.y<=0?g>v&&(d-=s.y,g+=s.y):(d-=s.y,g+=s.y);0>l&&0>d?(a=q,d=0,l=0):0>l?(a=K,l=0):0>d&&(a=Z,d=0);break;case Z:if(o){if(s.x<=0&&(m>=c||f>=C)){b=!1;break}l-=s.x,c+=s.x,d=l/o}else s.x<=0?c>m?(l-=s.x,c+=s.x):s.y>=0&&f>=C&&(b=!1):(l-=s.x,c+=s.x),s.y>=0?C>f&&(d+=s.y):d+=s.y;0>l&&0>d?(a=K,d=0,l=0):0>l?(a=q,l=0):0>d&&(a=Q,d=0);break;case q:if(o){if(s.x>=0&&(u>=w||f>=C)){b=!1;break}l+=s.x,d=l/o}else s.x>=0?w>u?l+=s.x:s.y>=0&&f>=C&&(b=!1):l+=s.x,s.y>=0?C>f&&(d+=s.y):d+=s.y;0>l&&0>d?(a=Q,d=0,l=0):0>l?(a=Z,l=0):0>d&&(a=K,d=0);break;case V:this.move(s.x,s.y),b=!1;break;case tt:this.zoom(function(t,i,e,s){var h=pt(t*t+i*i),o=pt(e*e+s*s);return(o-h)/h}(at(this.startX-this.startX2),at(this.startY-this.startY2),at(this.endX-this.endX2),at(this.endY-this.endY2)),i),this.startX2=this.endX2,this.startY2=this.endY2,b=!1;break;case J:if(!s.x||!s.y){b=!1;break}e=this.$cropper.offset(),c=this.startX-e.left,g=this.startY-e.top,l=p.minWidth,d=p.minHeight,s.x>0?a=s.y>0?q:K:s.x<0&&(c-=l,a=s.y>0?Z:Q),s.y<0&&(g-=d),this.isCropped||(this.$cropBox.removeClass(x),this.isCropped=!0,this.limited&&this.limitCropBox(!0,!0))}b&&(p.width=l,p.height=d,p.left=c,p.top=g,this.action=a,this.renderCropBox()),this.startX=this.endX,this.startY=this.endY}}),t.extend(dt,{crop:function(){this.isBuilt&&!this.isDisabled&&(this.isCropped||(this.isCropped=!0,this.limitCropBox(!0,!0),this.options.modal&&this.$dragBox.addClass(v),this.$cropBox.removeClass(x)),this.setCropBoxData(this.initialCropBox))},reset:function(){this.isBuilt&&!this.isDisabled&&(this.image=t.extend({},this.initialImage),this.canvas=t.extend({},this.initialCanvas),this.cropBox=t.extend({},this.initialCropBox),this.renderCanvas(),this.isCropped&&this.renderCropBox())},clear:function(){this.isCropped&&!this.isDisabled&&(t.extend(this.cropBox,{left:0,top:0,width:0,height:0}),this.isCropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),this.$dragBox.removeClass(v),this.$cropBox.addClass(x))},replace:function(t){!this.isDisabled&&t&&(this.isImg&&(this.isReplaced=!0,this.$element.attr(\"src\",t)),this.options.data=null,this.load(t))},enable:function(){this.isBuilt&&(this.isDisabled=!1,this.$cropper.removeClass(D))},disable:function(){this.isBuilt&&(this.isDisabled=!0,this.$cropper.addClass(D))},destroy:function(){var t=this.$element;this.isLoaded?(this.isImg&&this.isReplaced&&t.attr(\"src\",this.originalUrl),this.unbuild(),t.removeClass(x)):this.isImg?t.off(Y,this.start):this.$clone&&this.$clone.remove(),t.removeData(m)},move:function(t,i){var s=this.canvas;this.moveTo(e(t)?t:s.left+st(t),e(i)?i:s.top+st(i))},moveTo:function(t,s){var h=this.canvas,o=!1;e(s)&&(s=t),t=st(t),s=st(s),this.isBuilt&&!this.isDisabled&&this.options.movable&&(i(t)&&(h.left=t,o=!0),i(s)&&(h.top=s,o=!0),o&&this.renderCanvas(!0))},zoom:function(t,i){var e=this.canvas;t=st(t),t=0>t?1/(1-t):1+t,this.zoomTo(e.width*t/e.naturalWidth,i)},zoomTo:function(t,i){var e,s,h=this.options,o=this.canvas,a=o.width,n=o.height,r=o.naturalWidth,p=o.naturalHeight;if(t=st(t),t>=0&&this.isBuilt&&!this.isDisabled&&h.zoomable){if(e=r*t,s=p*t,this.trigger(I,{originalEvent:i,oldRatio:a/r,ratio:e/r}).isDefaultPrevented())return;o.left-=(e-a)/2,o.top-=(s-n)/2,o.width=e,o.height=s,this.renderCanvas(!0)}},rotate:function(t){this.rotateTo((this.image.rotate||0)+st(t))},rotateTo:function(t){t=st(t),i(t)&&this.isBuilt&&!this.isDisabled&&this.options.rotatable&&(this.image.rotate=t%360,this.isRotated=!0,this.renderCanvas(!0))},scale:function(t,s){var h=this.image,o=!1;e(s)&&(s=t),t=st(t),s=st(s),this.isBuilt&&!this.isDisabled&&this.options.scalable&&(i(t)&&(h.scaleX=t,o=!0),i(s)&&(h.scaleY=s,o=!0),o&&this.renderImage(!0))},scaleX:function(t){var e=this.image.scaleY;this.scale(t,i(e)?e:1)},scaleY:function(t){var e=this.image.scaleX;this.scale(i(e)?e:1,t)},getData:function(i){var e,s,h=this.options,o=this.image,a=this.canvas,n=this.cropBox;return this.isBuilt&&this.isCropped?(s={x:n.left-a.left,y:n.top-a.top,width:n.width,height:n.height},e=o.width/o.naturalWidth,t.each(s,function(t,h){h/=e,s[t]=i?lt(h):h})):s={x:0,y:0,width:0,height:0},h.rotatable&&(s.rotate=o.rotate||0),h.scalable&&(s.scaleX=o.scaleX||1,s.scaleY=o.scaleY||1),s},setData:function(e){var s,h,o,a=this.options,n=this.image,r=this.canvas,p={};t.isFunction(e)&&(e=e.call(this.element)),this.isBuilt&&!this.isDisabled&&t.isPlainObject(e)&&(a.rotatable&&i(e.rotate)&&e.rotate!==n.rotate&&(n.rotate=e.rotate,this.isRotated=s=!0),a.scalable&&(i(e.scaleX)&&e.scaleX!==n.scaleX&&(n.scaleX=e.scaleX,h=!0),i(e.scaleY)&&e.scaleY!==n.scaleY&&(n.scaleY=e.scaleY,h=!0)),s?this.renderCanvas():h&&this.renderImage(),o=n.width/n.naturalWidth,i(e.x)&&(p.left=e.x*o+r.left),i(e.y)&&(p.top=e.y*o+r.top),i(e.width)&&(p.width=e.width*o),i(e.height)&&(p.height=e.height*o),this.setCropBoxData(p))},getContainerData:function(){return this.isBuilt?this.container:{}},getImageData:function(){return this.isLoaded?this.image:{}},getCanvasData:function(){var i=this.canvas,e={};return this.isBuilt&&t.each([\"left\",\"top\",\"width\",\"height\",\"naturalWidth\",\"naturalHeight\"],function(t,s){e[s]=i[s]}),e},setCanvasData:function(e){var s=this.canvas,h=s.aspectRatio;t.isFunction(e)&&(e=e.call(this.$element)),this.isBuilt&&!this.isDisabled&&t.isPlainObject(e)&&(i(e.left)&&(s.left=e.left),i(e.top)&&(s.top=e.top),i(e.width)?(s.width=e.width,s.height=e.width/h):i(e.height)&&(s.height=e.height,s.width=e.height*h),this.renderCanvas(!0))},getCropBoxData:function(){var t,i=this.cropBox;return this.isBuilt&&this.isCropped&&(t={left:i.left,top:i.top,width:i.width,height:i.height}),t||{}},setCropBoxData:function(e){var s,h,o=this.cropBox,a=this.options.aspectRatio;t.isFunction(e)&&(e=e.call(this.$element)),this.isBuilt&&this.isCropped&&!this.isDisabled&&t.isPlainObject(e)&&(i(e.left)&&(o.left=e.left),i(e.top)&&(o.top=e.top),i(e.width)&&e.width!==o.width&&(s=!0,o.width=e.width),i(e.height)&&e.height!==o.height&&(h=!0,o.height=e.height),a&&(s?o.height=o.width/a:h&&(o.width=o.height*a)),this.renderCropBox())},getCroppedCanvas:function(i){var e,s,h,o,a,n,r,p,l,c,g;return this.isBuilt&&this.isCropped&&et?(t.isPlainObject(i)||(i={}),g=this.getData(),e=g.width,s=g.height,p=e/s,t.isPlainObject(i)&&(a=i.width,n=i.height,a?(n=a/p,r=a/e):n&&(a=n*p,r=n/s)),h=lt(a||e),o=lt(n||s),l=t(\"<canvas>\")[0],l.width=h,l.height=o,c=l.getContext(\"2d\"),i.fillColor&&(c.fillStyle=i.fillColor,c.fillRect(0,0,h,o)),c.drawImage.apply(c,function(){var t,i,h,o,a,n,p=d(this.$clone[0],this.image),l=p.width,c=p.height,u=[p],f=g.x,m=g.y;return-e>=f||f>l?f=t=h=a=0:0>=f?(h=-f,f=0,t=a=ht(l,e+f)):l>=f&&(h=0,t=a=ht(e,l-f)),0>=t||-s>=m||m>c?m=i=o=n=0:0>=m?(o=-m,m=0,i=n=ht(c,s+m)):c>=m&&(o=0,i=n=ht(s,c-m)),u.push(f,m,t,i),r&&(h*=r,o*=r,a*=r,n*=r),a>0&&n>0&&u.push(h,o,a,n),u}.call(this)),l):void 0},setAspectRatio:function(t){var i=this.options;this.isDisabled||e(t)||(i.aspectRatio=ot(0,t)||NaN,this.isBuilt&&(this.initCropBox(),this.isCropped&&this.renderCropBox()))},setDragMode:function(t){var i,e,s=this.options;this.isLoaded&&!this.isDisabled&&(i=t===J,e=s.movable&&t===V,t=i||e?t:it,this.$dragBox.data(j,t).toggleClass(B,i).toggleClass(b,e),s.cropBoxMovable||this.$face.data(j,t).toggleClass(B,i).toggleClass(b,e))}}),t.extend(c.prototype,dt),c.DEFAULTS={viewMode:0,dragMode:\"crop\",aspectRatio:NaN,data:null,preview:\"\",responsive:!0,checkCrossOrigin:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,build:null,built:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},c.setDefaults=function(i){t.extend(c.DEFAULTS,i)},c.TEMPLATE='<div class=\"cropper-container\"><div class=\"cropper-wrap-box\"><div class=\"cropper-canvas\"></div></div><div class=\"cropper-drag-box\"></div><div class=\"cropper-crop-box\"><span class=\"cropper-view-box\"></span><span class=\"cropper-dashed dashed-h\"></span><span class=\"cropper-dashed dashed-v\"></span><span class=\"cropper-center\"></span><span class=\"cropper-face\"></span><span class=\"cropper-line line-e\" data-action=\"e\"></span><span class=\"cropper-line line-n\" data-action=\"n\"></span><span class=\"cropper-line line-w\" data-action=\"w\"></span><span class=\"cropper-line line-s\" data-action=\"s\"></span><span class=\"cropper-point point-e\" data-action=\"e\"></span><span class=\"cropper-point point-n\" data-action=\"n\"></span><span class=\"cropper-point point-w\" data-action=\"w\"></span><span class=\"cropper-point point-s\" data-action=\"s\"></span><span class=\"cropper-point point-ne\" data-action=\"ne\"></span><span class=\"cropper-point point-nw\" data-action=\"nw\"></span><span class=\"cropper-point point-sw\" data-action=\"sw\"></span><span class=\"cropper-point point-se\" data-action=\"se\"></span></div></div>',c.other=t.fn.cropper,t.fn.cropper=function(i){var h,o=s(arguments,1);return this.each(function(){var e,s=t(this),a=s.data(m);if(!a){if(/destroy/.test(i))return;s.data(m,a=new c(this,i))}\"string\"==typeof i&&t.isFunction(e=a[i])&&(h=e.apply(a,o))}),e(h)?this:h},t.fn.cropper.Constructor=c,t.fn.cropper.setDefaults=c.setDefaults,t.fn.cropper.noConflict=function(){return t.fn.cropper=c.other,this}});","/* http://keith-wood.name/maxlength.html\r\n   Textarea Max Length for jQuery v1.1.0.\r\n   Written by Keith Wood (kwood{at}iinet.com.au) May 2009.\r\n   Dual licensed under the GPL (http://dev.jquery.com/browser/trunk/jquery/GPL-LICENSE.txt) and \r\n   MIT (http://dev.jquery.com/browser/trunk/jquery/MIT-LICENSE.txt) licenses. \r\n   Please attribute the author if you use it. */\r\n(function($){function MaxLength(){this.regional=[];this.regional['']={feedbackText:'{r} characters remaining ({m} maximum)',overflowText:'{o} characters too many ({m} maximum)'};this._defaults={max:200,truncate:true,showFeedback:true,feedbackTarget:null,onFull:null};$.extend(this._defaults,this.regional[''])}$.extend(MaxLength.prototype,{markerClassName:'hasMaxLength',propertyName:'maxlength',_feedbackClass:'maxlength-feedback',_fullClass:'maxlength-full',_overflowClass:'maxlength-overflow',_disabledClass:'maxlength-disabled',setDefaults:function(a){$.extend(this._defaults,a||{});return this},_attachPlugin:function(c,d){c=$(c);if(c.hasClass(this.markerClassName)){return}var e={options:$.extend({},this._defaults),feedbackTarget:$([])};c.addClass(this.markerClassName).data(this.propertyName,e).bind('keypress.'+this.propertyName,function(a){if(!e.options.truncate){return true}var b=String.fromCharCode(a.charCode==undefined?a.keyCode:a.charCode);return(a.ctrlKey||a.metaKey||b=='\\u0000'||$(this).val().length<e.options.max)}).bind('keyup.'+this.propertyName,function(){j._checkLength($(this))});this._optionPlugin(c,d)},_optionPlugin:function(a,b,c){a=$(a);var d=a.data(this.propertyName);if(!b||(typeof b=='string'&&c==null)){var e=b;b=(d||{}).options;return(b&&e?b[e]:b)}if(!a.hasClass(this.markerClassName)){return}b=b||{};if(typeof b=='string'){var e=b;b={};b[e]=c}$.extend(d.options,b);if(d.feedbackTarget.length>0){if(d.hadFeedbackTarget){d.feedbackTarget.empty().val('').removeClass(this._feedbackClass+' '+this._fullClass+' '+this._overflowClass)}else{d.feedbackTarget.remove()}d.feedbackTarget=$([])}if(d.options.showFeedback){d.hadFeedbackTarget=!!d.options.feedbackTarget;if($.isFunction(d.options.feedbackTarget)){d.feedbackTarget=d.options.feedbackTarget.apply(a[0],[])}else if(d.options.feedbackTarget){d.feedbackTarget=$(d.options.feedbackTarget)}else{d.feedbackTarget=$('<span></span>').insertAfter(a)}d.feedbackTarget.addClass(this._feedbackClass)}a.unbind('mouseover.'+this.propertyName+' focus.'+this.propertyName+'mouseout.'+this.propertyName+' blur.'+this.propertyName);if(d.options.showFeedback=='active'){a.bind('mouseover.'+this.propertyName,function(){d.feedbackTarget.css('visibility','visible')}).bind('mouseout.'+this.propertyName,function(){if(!d.focussed){d.feedbackTarget.css('visibility','hidden')}}).bind('focus.'+this.propertyName,function(){d.focussed=true;d.feedbackTarget.css('visibility','visible')}).bind('blur.'+this.propertyName,function(){d.focussed=false;d.feedbackTarget.css('visibility','hidden')});d.feedbackTarget.css('visibility','hidden')}this._checkLength(a)},_curLengthPlugin:function(a){var b=a.data(this.propertyName);var c=a.val();var d=c.replace(/\\r\\n/g,'~~').replace(/\\n/g,'~~').length;return{used:d,remaining:b.options.max-d}},_checkLength:function(a){var b=a.data(this.propertyName);var c=a.val();var d=c.replace(/\\r\\n/g,'~~').replace(/\\n/g,'~~').length;a.toggleClass(this._fullClass,d>=b.options.max).toggleClass(this._overflowClass,d>b.options.max);if(d>b.options.max&&b.options.truncate){var f=a.val().split(/\\r\\n|\\n/);c='';var i=0;while(c.length<b.options.max&&i<f.length){c+=f[i].substring(0,b.options.max-c.length)+'\\r\\n';i++}a.val(c.substring(0,b.options.max));a[0].scrollTop=a[0].scrollHeight;d=b.options.max}b.feedbackTarget.toggleClass(this._fullClass,d>=b.options.max).toggleClass(this._overflowClass,d>b.options.max);var g=(d>b.options.max?b.options.overflowText:b.options.feedbackText).replace(/\\{c\\}/,d).replace(/\\{m\\}/,b.options.max).replace(/\\{r\\}/,b.options.max-d).replace(/\\{o\\}/,d-b.options.max);try{b.feedbackTarget.text(g)}catch(e){}try{b.feedbackTarget.val(g)}catch(e){}if(d>=b.options.max&&$.isFunction(b.options.onFull)){b.options.onFull.apply(a,[d>b.options.max])}},_enablePlugin:function(a){a=$(a);if(!a.hasClass(this.markerClassName)){return}a.prop('disabled',false).removeClass(this.propertyName+'-disabled');var b=a.data(this.propertyName);b.feedbackTarget.removeClass(this.propertyName+'-disabled')},_disablePlugin:function(a){a=$(a);if(!a.hasClass(this.markerClassName)){return}a.prop('disabled',true).addClass(this.propertyName+'-disabled');var b=a.data(this.propertyName);b.feedbackTarget.addClass(this.propertyName+'-disabled')},_destroyPlugin:function(a){a=$(a);if(!a.hasClass(this.markerClassName)){return}var b=a.data(this.propertyName);if(b.feedbackTarget.length>0){if(b.hadFeedbackTarget){b.feedbackTarget.empty().val('').css('visibility','visible').removeClass(this._feedbackClass+' '+this._fullClass+' '+this._overflowClass)}else{b.feedbackTarget.remove()}}a.removeClass(this.markerClassName+' '+this._fullClass+' '+this._overflowClass).removeData(this.propertyName).unbind('.'+this.propertyName)}});var h=['curLength'];function isNotChained(a,b){if(a=='option'&&(b.length==0||(b.length==1&&typeof b[0]=='string'))){return true}return $.inArray(a,h)>-1}$.fn.maxlength=function(a){var b=Array.prototype.slice.call(arguments,1);if(isNotChained(a,b)){return j['_'+a+'Plugin'].apply(j,[this[0]].concat(b))}return this.each(function(){if(typeof a=='string'){if(!j['_'+a+'Plugin']){throw'Unknown method: '+a;}j['_'+a+'Plugin'].apply(j,[this].concat(b))}else{j._attachPlugin(this,a||{})}})};var j=$.maxlength=new MaxLength()})(jQuery);","/*! Copyright (c) 2013 Brandon Aaron (http://brandonaaron.net)\r\n * Licensed under the MIT License (LICENSE.txt).\r\n *\r\n * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.\r\n * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.\r\n * Thanks to: Seamus Leahy for adding deltaX and deltaY\r\n *\r\n * Version: 3.1.3\r\n *\r\n * Requires: 1.2.2+\r\n */\r\n\r\n(function (factory) {\r\n    if ( typeof define === 'function' && define.amd ) {\r\n        // AMD. Register as an anonymous module.\r\n        define(['jquery'], factory);\r\n    } else if (typeof exports === 'object') {\r\n        // Node/CommonJS style for Browserify\r\n        module.exports = factory;\r\n    } else {\r\n        // Browser globals\r\n        factory(jQuery);\r\n    }\r\n}(function ($) {\r\n\r\n    var toFix = ['wheel', 'mousewheel', 'DOMMouseScroll', 'MozMousePixelScroll'];\r\n    var toBind = 'onwheel' in document || document.documentMode >= 9 ? ['wheel'] : ['mousewheel', 'DomMouseScroll', 'MozMousePixelScroll'];\r\n    var lowestDelta, lowestDeltaXY;\r\n\r\n    if ( $.event.fixHooks ) {\r\n        for ( var i = toFix.length; i; ) {\r\n            $.event.fixHooks[ toFix[--i] ] = $.event.mouseHooks;\r\n        }\r\n    }\r\n\r\n    $.event.special.mousewheel = {\r\n        setup: function() {\r\n            if ( this.addEventListener ) {\r\n                for ( var i = toBind.length; i; ) {\r\n                    this.addEventListener( toBind[--i], handler, false );\r\n                }\r\n            } else {\r\n                this.onmousewheel = handler;\r\n            }\r\n        },\r\n\r\n        teardown: function() {\r\n            if ( this.removeEventListener ) {\r\n                for ( var i = toBind.length; i; ) {\r\n                    this.removeEventListener( toBind[--i], handler, false );\r\n                }\r\n            } else {\r\n                this.onmousewheel = null;\r\n            }\r\n        }\r\n    };\r\n\r\n    $.fn.extend({\r\n        mousewheel: function(fn) {\r\n            return fn ? this.bind(\"mousewheel\", fn) : this.trigger(\"mousewheel\");\r\n        },\r\n\r\n        unmousewheel: function(fn) {\r\n            return this.unbind(\"mousewheel\", fn);\r\n        }\r\n    });\r\n\r\n\r\n    function handler(event) {\r\n        var orgEvent = event || window.event,\r\n            args = [].slice.call(arguments, 1),\r\n            delta = 0,\r\n            deltaX = 0,\r\n            deltaY = 0,\r\n            absDelta = 0,\r\n            absDeltaXY = 0,\r\n            fn;\r\n        event = $.event.fix(orgEvent);\r\n        event.type = \"mousewheel\";\r\n\r\n        // Old school scrollwheel delta\r\n        if ( orgEvent.wheelDelta ) { delta = orgEvent.wheelDelta; }\r\n        if ( orgEvent.detail )     { delta = orgEvent.detail * -1; }\r\n\r\n        // New school wheel delta (wheel event)\r\n        if ( orgEvent.deltaY ) {\r\n            deltaY = orgEvent.deltaY * -1;\r\n            delta  = deltaY;\r\n        }\r\n        if ( orgEvent.deltaX ) {\r\n            deltaX = orgEvent.deltaX;\r\n            delta  = deltaX * -1;\r\n        }\r\n\r\n        // Webkit\r\n        if ( orgEvent.wheelDeltaY !== undefined ) { deltaY = orgEvent.wheelDeltaY; }\r\n        if ( orgEvent.wheelDeltaX !== undefined ) { deltaX = orgEvent.wheelDeltaX * -1; }\r\n\r\n        // Look for lowest delta to normalize the delta values\r\n        absDelta = Math.abs(delta);\r\n        if ( !lowestDelta || absDelta < lowestDelta ) { lowestDelta = absDelta; }\r\n        absDeltaXY = Math.max(Math.abs(deltaY), Math.abs(deltaX));\r\n        if ( !lowestDeltaXY || absDeltaXY < lowestDeltaXY ) { lowestDeltaXY = absDeltaXY; }\r\n\r\n        // Get a whole value for the deltas\r\n        fn = delta > 0 ? 'floor' : 'ceil';\r\n        delta  = Math[fn](delta / lowestDelta);\r\n        deltaX = Math[fn](deltaX / lowestDeltaXY);\r\n        deltaY = Math[fn](deltaY / lowestDeltaXY);\r\n\r\n        // Add event and delta to the front of the arguments\r\n        args.unshift(event, delta, deltaX, deltaY);\r\n\r\n        return ($.event.dispatch || $.event.handle).apply(this, args);\r\n    }\r\n\r\n}));\r\n","/**\r\n * @license\r\n * Lo-Dash 1.3.1 (Custom Build) lodash.com/license\r\n * Build: `lodash modern -o ./dist/lodash.js`\r\n * Underscore.js 1.4.4 underscorejs.org/LICENSE\r\n */\r\n;!function(n){function t(n,t,e){e=(e||0)-1;for(var r=n.length;++e<r;)if(n[e]===t)return e;return-1}function e(n,e){var r=typeof e;if(n=n.k,\"boolean\"==r||e==h)return n[e];\"number\"!=r&&\"string\"!=r&&(r=\"object\");var u=\"number\"==r?e:j+e;return n=n[r]||(n[r]={}),\"object\"==r?n[u]&&-1<t(n[u],e)?0:-1:n[u]?0:-1}function r(n){var t=this.k,e=typeof n;if(\"boolean\"==e||n==h)t[n]=y;else{\"number\"!=e&&\"string\"!=e&&(e=\"object\");var r=\"number\"==e?n:j+n,u=t[e]||(t[e]={});\"object\"==e?(u[r]||(u[r]=[])).push(n)==this.b.length&&(t[e]=b):u[r]=y\r\n}}function u(n){return n.charCodeAt(0)}function a(n,t){var e=n.m,r=t.m;if(n=n.l,t=t.l,n!==t){if(n>t||typeof n==\"undefined\")return 1;if(n<t||typeof t==\"undefined\")return-1}return e<r?-1:1}function o(n){var t=-1,e=n.length,u=l();u[\"false\"]=u[\"null\"]=u[\"true\"]=u.undefined=b;var a=l();for(a.b=n,a.k=u,a.push=r;++t<e;)a.push(n[t]);return u.object===false?(p(a),h):a}function i(n){return\"\\\\\"+Q[n]}function f(){return m.pop()||[]}function l(){return d.pop()||{b:h,k:h,l:h,\"false\":b,m:0,leading:b,maxWait:0,\"null\":b,number:h,object:h,push:h,string:h,trailing:b,\"true\":b,undefined:b,n:h}\r\n}function c(n){n.length=0,m.length<C&&m.push(n)}function p(n){var t=n.k;t&&p(t),n.b=n.k=n.l=n.object=n.number=n.string=n.n=h,d.length<C&&d.push(n)}function s(n,t,e){t||(t=0),typeof e==\"undefined\"&&(e=n?n.length:0);var r=-1;e=e-t||0;for(var u=Array(0>e?0:e);++r<e;)u[r]=n[t+r];return u}function v(r){function m(n){if(!n||ve.call(n)!=V)return b;var t=n.valueOf,e=typeof t==\"function\"&&(e=fe(t))&&fe(e);return e?n==e||fe(n)==e:it(n)}function d(n,t,e){if(!n||!L[typeof n])return n;t=t&&typeof e==\"undefined\"?t:tt.createCallback(t,e);\r\nfor(var r=-1,u=L[typeof n]&&Se(n),a=u?u.length:0;++r<a&&(e=u[r],!(t(n[e],e,n)===false)););return n}function C(n,t,e){var r;if(!n||!L[typeof n])return n;t=t&&typeof e==\"undefined\"?t:tt.createCallback(t,e);for(r in n)if(t(n[r],r,n)===false)break;return n}function Q(n,t,e){var r,u=n,a=u;if(!u)return a;for(var o=arguments,i=0,f=typeof e==\"number\"?2:o.length;++i<f;)if((u=o[i])&&L[typeof u])for(var l=-1,c=L[typeof u]&&Se(u),p=c?c.length:0;++l<p;)r=c[l],\"undefined\"==typeof a[r]&&(a[r]=u[r]);return a}function X(n,t,e){var r,u=n,a=u;\r\nif(!u)return a;var o=arguments,i=0,f=typeof e==\"number\"?2:o.length;if(3<f&&\"function\"==typeof o[f-2])var l=tt.createCallback(o[--f-1],o[f--],2);else 2<f&&\"function\"==typeof o[f-1]&&(l=o[--f]);for(;++i<f;)if((u=o[i])&&L[typeof u])for(var c=-1,p=L[typeof u]&&Se(u),s=p?p.length:0;++c<s;)r=p[c],a[r]=l?l(a[r],u[r]):u[r];return a}function Z(n){var t,e=[];if(!n||!L[typeof n])return e;for(t in n)le.call(n,t)&&e.push(t);return e}function tt(n){return n&&typeof n==\"object\"&&!Ee(n)&&le.call(n,\"__wrapped__\")?n:new et(n)\r\n}function et(n){this.__wrapped__=n}function rt(n,t,e,r){function u(){var r=arguments,l=o?this:t;return a||(n=t[i]),e.length&&(r=r.length?(r=Ce.call(r),f?r.concat(e):e.concat(r)):e),this instanceof u?(l=gt(n.prototype)?ye(n.prototype):{},r=n.apply(l,r),gt(r)?r:l):n.apply(l,r)}var a=vt(n),o=!e,i=t;if(o){var f=r;e=t}else if(!a){if(!r)throw new Yt;t=n}return u}function ut(n){return Ie[n]}function at(){var n=(n=tt.indexOf)===$t?t:n;return n}function ot(n){return function(t,e,r,u){return typeof e!=\"boolean\"&&e!=h&&(u=r,r=u&&u[e]===t?g:e,e=b),r!=h&&(r=tt.createCallback(r,u)),n(t,e,r,u)\r\n}}function it(n){var t,e;return n&&ve.call(n)==V&&(t=n.constructor,!vt(t)||t instanceof t)?(C(n,function(n,t){e=t}),e===g||le.call(n,e)):b}function ft(n){return Ae[n]}function lt(n,t,e,r,u,a){var o=n;if(typeof t!=\"boolean\"&&t!=h&&(r=e,e=t,t=b),typeof e==\"function\"){if(e=typeof r==\"undefined\"?e:tt.createCallback(e,r,1),o=e(o),typeof o!=\"undefined\")return o;o=n}if(r=gt(o)){var i=ve.call(o);if(!J[i])return o;var l=Ee(o)}if(!r||!t)return r?l?s(o):X({},o):o;switch(r=xe[i],i){case P:case K:return new r(+o);\r\ncase U:case H:return new r(o);case G:return r(o.source,A.exec(o))}i=!u,u||(u=f()),a||(a=f());for(var p=u.length;p--;)if(u[p]==n)return a[p];return o=l?r(o.length):{},l&&(le.call(n,\"index\")&&(o.index=n.index),le.call(n,\"input\")&&(o.input=n.input)),u.push(n),a.push(o),(l?wt:d)(n,function(n,r){o[r]=lt(n,t,e,g,u,a)}),i&&(c(u),c(a)),o}function ct(n){var t=[];return C(n,function(n,e){vt(n)&&t.push(e)}),t.sort()}function pt(n){for(var t=-1,e=Se(n),r=e.length,u={};++t<r;){var a=e[t];u[n[a]]=a}return u}function st(n,t,e,r,u,a){var o=e===k;\r\nif(typeof e==\"function\"&&!o){e=tt.createCallback(e,r,2);var i=e(n,t);if(typeof i!=\"undefined\")return!!i}if(n===t)return 0!==n||1/n==1/t;var l=typeof n,p=typeof t;if(n===n&&(!n||\"function\"!=l&&\"object\"!=l)&&(!t||\"function\"!=p&&\"object\"!=p))return b;if(n==h||t==h)return n===t;if(p=ve.call(n),l=ve.call(t),p==z&&(p=V),l==z&&(l=V),p!=l)return b;switch(p){case P:case K:return+n==+t;case U:return n!=+n?t!=+t:0==n?1/n==1/t:n==+t;case G:case H:return n==Xt(t)}if(l=p==W,!l){if(le.call(n,\"__wrapped__\")||le.call(t,\"__wrapped__\"))return st(n.__wrapped__||n,t.__wrapped__||t,e,r,u,a);\r\nif(p!=V)return b;var p=n.constructor,s=t.constructor;if(p!=s&&(!vt(p)||!(p instanceof p&&vt(s)&&s instanceof s)))return b}for(s=!u,u||(u=f()),a||(a=f()),p=u.length;p--;)if(u[p]==n)return a[p]==t;var v=0,i=y;if(u.push(n),a.push(t),l){if(p=n.length,v=t.length,i=v==n.length,!i&&!o)return i;for(;v--;)if(l=p,s=t[v],o)for(;l--&&!(i=st(n[l],s,e,r,u,a)););else if(!(i=st(n[v],s,e,r,u,a)))break;return i}return C(t,function(t,o,f){return le.call(f,o)?(v++,i=le.call(n,o)&&st(n[o],t,e,r,u,a)):void 0}),i&&!o&&C(n,function(n,t,e){return le.call(e,t)?i=-1<--v:void 0\r\n}),s&&(c(u),c(a)),i}function vt(n){return typeof n==\"function\"}function gt(n){return!(!n||!L[typeof n])}function yt(n){return typeof n==\"number\"||ve.call(n)==U}function ht(n){return typeof n==\"string\"||ve.call(n)==H}function bt(n,t,e){var r=arguments,u=0,a=2;if(!gt(n))return n;if(e===k)var o=r[3],i=r[4],l=r[5];else{var p=y,i=f(),l=f();typeof e!=\"number\"&&(a=r.length),3<a&&\"function\"==typeof r[a-2]?o=tt.createCallback(r[--a-1],r[a--],2):2<a&&\"function\"==typeof r[a-1]&&(o=r[--a])}for(;++u<a;)(Ee(r[u])?wt:d)(r[u],function(t,e){var r,u,a=t,f=n[e];\r\nif(t&&((u=Ee(t))||m(t))){for(a=i.length;a--;)if(r=i[a]==t){f=l[a];break}if(!r){var c;o&&(a=o(f,t),c=typeof a!=\"undefined\")&&(f=a),c||(f=u?Ee(f)?f:[]:m(f)?f:{}),i.push(t),l.push(f),c||(f=bt(f,t,k,o,i,l))}}else o&&(a=o(f,t),typeof a==\"undefined\"&&(a=t)),typeof a!=\"undefined\"&&(f=a);n[e]=f});return p&&(c(i),c(l)),n}function mt(n){for(var t=-1,e=Se(n),r=e.length,u=Mt(r);++t<r;)u[t]=n[e[t]];return u}function dt(n,t,e){var r=-1,u=at(),a=n?n.length:0,o=b;return e=(0>e?_e(0,a+e):e)||0,a&&typeof a==\"number\"?o=-1<(ht(n)?n.indexOf(t,e):u(n,t,e)):d(n,function(n){return++r<e?void 0:!(o=n===t)\r\n}),o}function _t(n,t,e){var r=y;t=tt.createCallback(t,e),e=-1;var u=n?n.length:0;if(typeof u==\"number\")for(;++e<u&&(r=!!t(n[e],e,n)););else d(n,function(n,e,u){return r=!!t(n,e,u)});return r}function kt(n,t,e){var r=[];t=tt.createCallback(t,e),e=-1;var u=n?n.length:0;if(typeof u==\"number\")for(;++e<u;){var a=n[e];t(a,e,n)&&r.push(a)}else d(n,function(n,e,u){t(n,e,u)&&r.push(n)});return r}function jt(n,t,e){t=tt.createCallback(t,e),e=-1;var r=n?n.length:0;if(typeof r!=\"number\"){var u;return d(n,function(n,e,r){return t(n,e,r)?(u=n,b):void 0\r\n}),u}for(;++e<r;){var a=n[e];if(t(a,e,n))return a}}function wt(n,t,e){var r=-1,u=n?n.length:0;if(t=t&&typeof e==\"undefined\"?t:tt.createCallback(t,e),typeof u==\"number\")for(;++r<u&&t(n[r],r,n)!==false;);else d(n,t);return n}function Ct(n,t,e){var r=-1,u=n?n.length:0;if(t=tt.createCallback(t,e),typeof u==\"number\")for(var a=Mt(u);++r<u;)a[r]=t(n[r],r,n);else a=[],d(n,function(n,e,u){a[++r]=t(n,e,u)});return a}function xt(n,t,e){var r=-1/0,a=r;if(!t&&Ee(n)){e=-1;for(var o=n.length;++e<o;){var i=n[e];i>a&&(a=i)\r\n}}else t=!t&&ht(n)?u:tt.createCallback(t,e),wt(n,function(n,e,u){e=t(n,e,u),e>r&&(r=e,a=n)});return a}function Ot(n,t){var e=-1,r=n?n.length:0;if(typeof r==\"number\")for(var u=Mt(r);++e<r;)u[e]=n[e][t];return u||Ct(n,t)}function Et(n,t,e,r){if(!n)return e;var u=3>arguments.length;t=tt.createCallback(t,r,4);var a=-1,o=n.length;if(typeof o==\"number\")for(u&&(e=n[++a]);++a<o;)e=t(e,n[a],a,n);else d(n,function(n,r,a){e=u?(u=b,n):t(e,n,r,a)});return e}function St(n,t,e,r){var u=n?n.length:0,a=3>arguments.length;\r\nif(typeof u!=\"number\")var o=Se(n),u=o.length;return t=tt.createCallback(t,r,4),wt(n,function(r,i,f){i=o?o[--u]:--u,e=a?(a=b,n[i]):t(e,n[i],i,f)}),e}function It(n,t,e){var r;t=tt.createCallback(t,e),e=-1;var u=n?n.length:0;if(typeof u==\"number\")for(;++e<u&&!(r=t(n[e],e,n)););else d(n,function(n,e,u){return!(r=t(n,e,u))});return!!r}function At(n){var r=-1,u=at(),a=n?n.length:0,i=ae.apply(Zt,Ce.call(arguments,1)),f=[],l=a>=w&&u===t;if(l){var c=o(i);c?(u=e,i=c):l=b}for(;++r<a;)c=n[r],0>u(i,c)&&f.push(c);\r\nreturn l&&p(i),f}function Nt(n,t,e){if(n){var r=0,u=n.length;if(typeof t!=\"number\"&&t!=h){var a=-1;for(t=tt.createCallback(t,e);++a<u&&t(n[a],a,n);)r++}else if(r=t,r==h||e)return n[0];return s(n,0,ke(_e(0,r),u))}}function $t(n,e,r){if(typeof r==\"number\"){var u=n?n.length:0;r=0>r?_e(0,u+r):r||0}else if(r)return r=Ft(n,e),n[r]===e?r:-1;return n?t(n,e,r):-1}function Bt(n,t,e){if(typeof t!=\"number\"&&t!=h){var r=0,u=-1,a=n?n.length:0;for(t=tt.createCallback(t,e);++u<a&&t(n[u],u,n);)r++}else r=t==h||e?1:_e(0,t);\r\nreturn s(n,r)}function Ft(n,t,e,r){var u=0,a=n?n.length:u;for(e=e?tt.createCallback(e,r,1):Wt,t=e(t);u<a;)r=u+a>>>1,e(n[r])<t?u=r+1:a=r;return u}function Rt(n){for(var t=-1,e=n?xt(Ot(n,\"length\")):0,r=Mt(0>e?0:e);++t<e;)r[t]=Ot(n,t);return r}function Tt(n,t){for(var e=-1,r=n?n.length:0,u={};++e<r;){var a=n[e];t?u[a]=t[e]:u[a[0]]=a[1]}return u}function qt(n,t){return Oe.fastBind||ge&&2<arguments.length?ge.call.apply(ge,arguments):rt(n,t,Ce.call(arguments,2))}function Dt(n,t,e){function r(){ue(s),ue(v),l=0,s=v=h\r\n}function u(){var t=g&&(!m||1<l);r(),t&&(p!==false&&(c=new Vt),i=n.apply(f,o))}function a(){r(),(g||p!==t)&&(c=new Vt,i=n.apply(f,o))}var o,i,f,l=0,c=0,p=b,s=h,v=h,g=y;if(t=_e(0,t||0),e===y)var m=y,g=b;else gt(e)&&(m=e.leading,p=\"maxWait\"in e&&_e(t,e.maxWait||0),g=\"trailing\"in e?e.trailing:g);return function(){if(o=arguments,f=this,l++,ue(v),p===false)m&&2>l&&(i=n.apply(f,o));else{var e=new Vt;!s&&!m&&(c=e);var r=p-(e-c);0<r?s||(s=se(a,r)):(ue(s),s=h,c=e,i=n.apply(f,o))}return t!==p&&(v=se(u,t)),i}}function zt(n){var t=Ce.call(arguments,1);\r\nreturn se(function(){n.apply(g,t)},1)}function Wt(n){return n}function Pt(n){wt(ct(n),function(t){var e=tt[t]=n[t];tt.prototype[t]=function(){var n=this.__wrapped__,t=[n];return ce.apply(t,arguments),t=e.apply(tt,t),n&&typeof n==\"object\"&&n===t?this:new et(t)}})}function Kt(){return this.__wrapped__}r=r?nt.defaults(n.Object(),r,nt.pick(n,D)):n;var Mt=r.Array,Ut=r.Boolean,Vt=r.Date,Gt=r.Function,Ht=r.Math,Jt=r.Number,Lt=r.Object,Qt=r.RegExp,Xt=r.String,Yt=r.TypeError,Zt=[],ne=Lt.prototype,te=r._,ee=Qt(\"^\"+Xt(ne.valueOf).replace(/[.*+?^${}()|[\\]\\\\]/g,\"\\\\$&\").replace(/valueOf|for [^\\]]+/g,\".+?\")+\"$\"),re=Ht.ceil,ue=r.clearTimeout,ae=Zt.concat,oe=Ht.floor,ie=Gt.prototype.toString,fe=ee.test(fe=Lt.getPrototypeOf)&&fe,le=ne.hasOwnProperty,ce=Zt.push,pe=r.setImmediate,se=r.setTimeout,ve=ne.toString,ge=ee.test(ge=ve.bind)&&ge,ye=ee.test(ye=Lt.create)&&ye,he=ee.test(he=Mt.isArray)&&he,be=r.isFinite,me=r.isNaN,de=ee.test(de=Lt.keys)&&de,_e=Ht.max,ke=Ht.min,je=r.parseInt,we=Ht.random,Ce=Zt.slice,Ht=ee.test(r.attachEvent),Ht=ge&&!/\\n|true/.test(ge+Ht),xe={};\r\nxe[W]=Mt,xe[P]=Ut,xe[K]=Vt,xe[M]=Gt,xe[V]=Lt,xe[U]=Jt,xe[G]=Qt,xe[H]=Xt,et.prototype=tt.prototype;var Oe=tt.support={};Oe.fastBind=ge&&!Ht,tt.templateSettings={escape:/<%-([\\s\\S]+?)%>/g,evaluate:/<%([\\s\\S]+?)%>/g,interpolate:N,variable:\"\",imports:{_:tt}};var Ee=he,Se=de?function(n){return gt(n)?de(n):[]}:Z,Ie={\"&\":\"&amp;\",\"<\":\"&lt;\",\">\":\"&gt;\",'\"':\"&quot;\",\"'\":\"&#39;\"},Ae=pt(Ie),Ut=ot(function $e(n,t,e){for(var r=-1,u=n?n.length:0,a=[];++r<u;){var o=n[r];e&&(o=e(o,r,n)),Ee(o)?ce.apply(a,t?o:$e(o)):a.push(o)\r\n}return a}),Ne=ot(function(n,r,u){var a=-1,i=at(),l=n?n.length:0,s=[],v=!r&&l>=w&&i===t,g=u||v?f():s;if(v){var y=o(g);y?(i=e,g=y):(v=b,g=u?g:(c(g),s))}for(;++a<l;){var y=n[a],h=u?u(y,a,n):y;(r?!a||g[g.length-1]!==h:0>i(g,h))&&((u||v)&&g.push(h),s.push(y))}return v?(c(g.b),p(g)):u&&c(g),s});return Ht&&Y&&typeof pe==\"function\"&&(zt=qt(pe,r)),pe=8==je(B+\"08\")?je:function(n,t){return je(ht(n)?n.replace(F,\"\"):n,t||0)},tt.after=function(n,t){return 1>n?t():function(){return 1>--n?t.apply(this,arguments):void 0\r\n}},tt.assign=X,tt.at=function(n){for(var t=-1,e=ae.apply(Zt,Ce.call(arguments,1)),r=e.length,u=Mt(r);++t<r;)u[t]=n[e[t]];return u},tt.bind=qt,tt.bindAll=function(n){for(var t=1<arguments.length?ae.apply(Zt,Ce.call(arguments,1)):ct(n),e=-1,r=t.length;++e<r;){var u=t[e];n[u]=qt(n[u],n)}return n},tt.bindKey=function(n,t){return rt(n,t,Ce.call(arguments,2),k)},tt.compact=function(n){for(var t=-1,e=n?n.length:0,r=[];++t<e;){var u=n[t];u&&r.push(u)}return r},tt.compose=function(){var n=arguments;return function(){for(var t=arguments,e=n.length;e--;)t=[n[e].apply(this,t)];\r\nreturn t[0]}},tt.countBy=function(n,t,e){var r={};return t=tt.createCallback(t,e),wt(n,function(n,e,u){e=Xt(t(n,e,u)),le.call(r,e)?r[e]++:r[e]=1}),r},tt.createCallback=function(n,t,e){if(n==h)return Wt;var r=typeof n;if(\"function\"!=r){if(\"object\"!=r)return function(t){return t[n]};var u=Se(n);return function(t){for(var e=u.length,r=b;e--&&(r=st(t[u[e]],n[u[e]],k)););return r}}return typeof t==\"undefined\"||$&&!$.test(ie.call(n))?n:1===e?function(e){return n.call(t,e)}:2===e?function(e,r){return n.call(t,e,r)\r\n}:4===e?function(e,r,u,a){return n.call(t,e,r,u,a)}:function(e,r,u){return n.call(t,e,r,u)}},tt.debounce=Dt,tt.defaults=Q,tt.defer=zt,tt.delay=function(n,t){var e=Ce.call(arguments,2);return se(function(){n.apply(g,e)},t)},tt.difference=At,tt.filter=kt,tt.flatten=Ut,tt.forEach=wt,tt.forIn=C,tt.forOwn=d,tt.functions=ct,tt.groupBy=function(n,t,e){var r={};return t=tt.createCallback(t,e),wt(n,function(n,e,u){e=Xt(t(n,e,u)),(le.call(r,e)?r[e]:r[e]=[]).push(n)}),r},tt.initial=function(n,t,e){if(!n)return[];\r\nvar r=0,u=n.length;if(typeof t!=\"number\"&&t!=h){var a=u;for(t=tt.createCallback(t,e);a--&&t(n[a],a,n);)r++}else r=t==h||e?1:t||r;return s(n,0,ke(_e(0,u-r),u))},tt.intersection=function(n){for(var r=arguments,u=r.length,a=-1,i=f(),l=-1,s=at(),v=n?n.length:0,g=[],y=f();++a<u;){var h=r[a];i[a]=s===t&&(h?h.length:0)>=w&&o(a?r[a]:y)}n:for(;++l<v;){var b=i[0],h=n[l];if(0>(b?e(b,h):s(y,h))){for(a=u,(b||y).push(h);--a;)if(b=i[a],0>(b?e(b,h):s(r[a],h)))continue n;g.push(h)}}for(;u--;)(b=i[u])&&p(b);return c(i),c(y),g\r\n},tt.invert=pt,tt.invoke=function(n,t){var e=Ce.call(arguments,2),r=-1,u=typeof t==\"function\",a=n?n.length:0,o=Mt(typeof a==\"number\"?a:0);return wt(n,function(n){o[++r]=(u?t:n[t]).apply(n,e)}),o},tt.keys=Se,tt.map=Ct,tt.max=xt,tt.memoize=function(n,t){function e(){var r=e.cache,u=j+(t?t.apply(this,arguments):arguments[0]);return le.call(r,u)?r[u]:r[u]=n.apply(this,arguments)}return e.cache={},e},tt.merge=bt,tt.min=function(n,t,e){var r=1/0,a=r;if(!t&&Ee(n)){e=-1;for(var o=n.length;++e<o;){var i=n[e];\r\ni<a&&(a=i)}}else t=!t&&ht(n)?u:tt.createCallback(t,e),wt(n,function(n,e,u){e=t(n,e,u),e<r&&(r=e,a=n)});return a},tt.omit=function(n,t,e){var r=at(),u=typeof t==\"function\",a={};if(u)t=tt.createCallback(t,e);else var o=ae.apply(Zt,Ce.call(arguments,1));return C(n,function(n,e,i){(u?!t(n,e,i):0>r(o,e))&&(a[e]=n)}),a},tt.once=function(n){var t,e;return function(){return t?e:(t=y,e=n.apply(this,arguments),n=h,e)}},tt.pairs=function(n){for(var t=-1,e=Se(n),r=e.length,u=Mt(r);++t<r;){var a=e[t];u[t]=[a,n[a]]\r\n}return u},tt.partial=function(n){return rt(n,Ce.call(arguments,1))},tt.partialRight=function(n){return rt(n,Ce.call(arguments,1),h,k)},tt.pick=function(n,t,e){var r={};if(typeof t!=\"function\")for(var u=-1,a=ae.apply(Zt,Ce.call(arguments,1)),o=gt(n)?a.length:0;++u<o;){var i=a[u];i in n&&(r[i]=n[i])}else t=tt.createCallback(t,e),C(n,function(n,e,u){t(n,e,u)&&(r[e]=n)});return r},tt.pluck=Ot,tt.range=function(n,t,e){n=+n||0,e=+e||1,t==h&&(t=n,n=0);var r=-1;t=_e(0,re((t-n)/e));for(var u=Mt(t);++r<t;)u[r]=n,n+=e;\r\nreturn u},tt.reject=function(n,t,e){return t=tt.createCallback(t,e),kt(n,function(n,e,r){return!t(n,e,r)})},tt.rest=Bt,tt.shuffle=function(n){var t=-1,e=n?n.length:0,r=Mt(typeof e==\"number\"?e:0);return wt(n,function(n){var e=oe(we()*(++t+1));r[t]=r[e],r[e]=n}),r},tt.sortBy=function(n,t,e){var r=-1,u=n?n.length:0,o=Mt(typeof u==\"number\"?u:0);for(t=tt.createCallback(t,e),wt(n,function(n,e,u){var a=o[++r]=l();a.l=t(n,e,u),a.m=r,a.n=n}),u=o.length,o.sort(a);u--;)n=o[u],o[u]=n.n,p(n);return o},tt.tap=function(n,t){return t(n),n\r\n},tt.throttle=function(n,t,e){var r=y,u=y;return e===false?r=b:gt(e)&&(r=\"leading\"in e?e.leading:r,u=\"trailing\"in e?e.trailing:u),e=l(),e.leading=r,e.maxWait=t,e.trailing=u,n=Dt(n,t,e),p(e),n},tt.times=function(n,t,e){n=-1<(n=+n)?n:0;var r=-1,u=Mt(n);for(t=tt.createCallback(t,e,1);++r<n;)u[r]=t(r);return u},tt.toArray=function(n){return n&&typeof n.length==\"number\"?s(n):mt(n)},tt.transform=function(n,t,e,r){var u=Ee(n);return t=tt.createCallback(t,r,4),e==h&&(u?e=[]:(r=n&&n.constructor,e=gt(r&&r.prototype)?ye(r&&r.prototype):{})),(u?wt:d)(n,function(n,r,u){return t(e,n,r,u)\r\n}),e},tt.union=function(n){return Ee(n)||(arguments[0]=n?Ce.call(n):Zt),Ne(ae.apply(Zt,arguments))},tt.uniq=Ne,tt.unzip=Rt,tt.values=mt,tt.where=kt,tt.without=function(n){return At(n,Ce.call(arguments,1))},tt.wrap=function(n,t){return function(){var e=[n];return ce.apply(e,arguments),t.apply(this,e)}},tt.zip=function(n){return n?Rt(arguments):[]},tt.zipObject=Tt,tt.collect=Ct,tt.drop=Bt,tt.each=wt,tt.extend=X,tt.methods=ct,tt.object=Tt,tt.select=kt,tt.tail=Bt,tt.unique=Ne,Pt(tt),tt.chain=tt,tt.prototype.chain=function(){return this\r\n},tt.clone=lt,tt.cloneDeep=function(n,t,e){return lt(n,y,t,e)},tt.contains=dt,tt.escape=function(n){return n==h?\"\":Xt(n).replace(T,ut)},tt.every=_t,tt.find=jt,tt.findIndex=function(n,t,e){var r=-1,u=n?n.length:0;for(t=tt.createCallback(t,e);++r<u;)if(t(n[r],r,n))return r;return-1},tt.findKey=function(n,t,e){var r;return t=tt.createCallback(t,e),d(n,function(n,e,u){return t(n,e,u)?(r=e,b):void 0}),r},tt.has=function(n,t){return n?le.call(n,t):b},tt.identity=Wt,tt.indexOf=$t,tt.isArguments=function(n){return ve.call(n)==z\r\n},tt.isArray=Ee,tt.isBoolean=function(n){return n===y||n===false||ve.call(n)==P},tt.isDate=function(n){return n?typeof n==\"object\"&&ve.call(n)==K:b},tt.isElement=function(n){return n?1===n.nodeType:b},tt.isEmpty=function(n){var t=y;if(!n)return t;var e=ve.call(n),r=n.length;return e==W||e==H||e==z||e==V&&typeof r==\"number\"&&vt(n.splice)?!r:(d(n,function(){return t=b}),t)},tt.isEqual=st,tt.isFinite=function(n){return be(n)&&!me(parseFloat(n))},tt.isFunction=vt,tt.isNaN=function(n){return yt(n)&&n!=+n\r\n},tt.isNull=function(n){return n===h},tt.isNumber=yt,tt.isObject=gt,tt.isPlainObject=m,tt.isRegExp=function(n){return n?typeof n==\"object\"&&ve.call(n)==G:b},tt.isString=ht,tt.isUndefined=function(n){return typeof n==\"undefined\"},tt.lastIndexOf=function(n,t,e){var r=n?n.length:0;for(typeof e==\"number\"&&(r=(0>e?_e(0,r+e):ke(e,r-1))+1);r--;)if(n[r]===t)return r;return-1},tt.mixin=Pt,tt.noConflict=function(){return r._=te,this},tt.parseInt=pe,tt.random=function(n,t){n==h&&t==h&&(t=1),n=+n||0,t==h?(t=n,n=0):t=+t||0;\r\nvar e=we();return n%1||t%1?n+ke(e*(t-n+parseFloat(\"1e-\"+((e+\"\").length-1))),t):n+oe(e*(t-n+1))},tt.reduce=Et,tt.reduceRight=St,tt.result=function(n,t){var e=n?n[t]:g;return vt(e)?n[t]():e},tt.runInContext=v,tt.size=function(n){var t=n?n.length:0;return typeof t==\"number\"?t:Se(n).length},tt.some=It,tt.sortedIndex=Ft,tt.template=function(n,t,e){var r=tt.templateSettings;n||(n=\"\"),e=Q({},e,r);var u,a=Q({},e.imports,r.imports),r=Se(a),a=mt(a),o=0,f=e.interpolate||R,l=\"__p+='\",f=Qt((e.escape||R).source+\"|\"+f.source+\"|\"+(f===N?I:R).source+\"|\"+(e.evaluate||R).source+\"|$\",\"g\");\r\nn.replace(f,function(t,e,r,a,f,c){return r||(r=a),l+=n.slice(o,c).replace(q,i),e&&(l+=\"'+__e(\"+e+\")+'\"),f&&(u=y,l+=\"';\"+f+\";__p+='\"),r&&(l+=\"'+((__t=(\"+r+\"))==null?'':__t)+'\"),o=c+t.length,t}),l+=\"';\\n\",f=e=e.variable,f||(e=\"obj\",l=\"with(\"+e+\"){\"+l+\"}\"),l=(u?l.replace(x,\"\"):l).replace(O,\"$1\").replace(E,\"$1;\"),l=\"function(\"+e+\"){\"+(f?\"\":e+\"||(\"+e+\"={});\")+\"var __t,__p='',__e=_.escape\"+(u?\",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}\":\";\")+l+\"return __p}\";try{var c=Gt(r,\"return \"+l).apply(g,a)\r\n}catch(p){throw p.source=l,p}return t?c(t):(c.source=l,c)},tt.unescape=function(n){return n==h?\"\":Xt(n).replace(S,ft)},tt.uniqueId=function(n){var t=++_;return Xt(n==h?\"\":n)+t},tt.all=_t,tt.any=It,tt.detect=jt,tt.findWhere=jt,tt.foldl=Et,tt.foldr=St,tt.include=dt,tt.inject=Et,d(tt,function(n,t){tt.prototype[t]||(tt.prototype[t]=function(){var t=[this.__wrapped__];return ce.apply(t,arguments),n.apply(tt,t)})}),tt.first=Nt,tt.last=function(n,t,e){if(n){var r=0,u=n.length;if(typeof t!=\"number\"&&t!=h){var a=u;\r\nfor(t=tt.createCallback(t,e);a--&&t(n[a],a,n);)r++}else if(r=t,r==h||e)return n[u-1];return s(n,_e(0,u-r))}},tt.take=Nt,tt.head=Nt,d(tt,function(n,t){tt.prototype[t]||(tt.prototype[t]=function(t,e){var r=n(this.__wrapped__,t,e);return t==h||e&&typeof t!=\"function\"?r:new et(r)})}),tt.VERSION=\"1.3.1\",tt.prototype.toString=function(){return Xt(this.__wrapped__)},tt.prototype.value=Kt,tt.prototype.valueOf=Kt,wt([\"join\",\"pop\",\"shift\"],function(n){var t=Zt[n];tt.prototype[n]=function(){return t.apply(this.__wrapped__,arguments)\r\n}}),wt([\"push\",\"reverse\",\"sort\",\"unshift\"],function(n){var t=Zt[n];tt.prototype[n]=function(){return t.apply(this.__wrapped__,arguments),this}}),wt([\"concat\",\"slice\",\"splice\"],function(n){var t=Zt[n];tt.prototype[n]=function(){return new et(t.apply(this.__wrapped__,arguments))}}),tt}var g,y=!0,h=null,b=!1,m=[],d=[],_=0,k={},j=+new Date+\"\",w=75,C=40,x=/\\b__p\\+='';/g,O=/\\b(__p\\+=)''\\+/g,E=/(__e\\(.*?\\)|\\b__t\\))\\+'';/g,S=/&(?:amp|lt|gt|quot|#39);/g,I=/\\$\\{([^\\\\}]*(?:\\\\.[^\\\\}]*)*)\\}/g,A=/\\w*$/,N=/<%=([\\s\\S]+?)%>/g,$=($=/\\bthis\\b/)&&$.test(v)&&$,B=\" \\t\\x0B\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\",F=RegExp(\"^[\"+B+\"]*0+(?=.$)\"),R=/($^)/,T=/[&<>\"']/g,q=/['\\n\\r\\t\\u2028\\u2029\\\\]/g,D=\"Array Boolean Date Function Math Number Object RegExp String _ attachEvent clearTimeout isFinite isNaN parseInt setImmediate setTimeout\".split(\" \"),z=\"[object Arguments]\",W=\"[object Array]\",P=\"[object Boolean]\",K=\"[object Date]\",M=\"[object Function]\",U=\"[object Number]\",V=\"[object Object]\",G=\"[object RegExp]\",H=\"[object String]\",J={};\r\nJ[M]=b,J[z]=J[W]=J[P]=J[K]=J[U]=J[V]=J[G]=J[H]=y;var L={\"boolean\":b,\"function\":y,object:y,number:b,string:b,undefined:b},Q={\"\\\\\":\"\\\\\",\"'\":\"'\",\"\\n\":\"n\",\"\\r\":\"r\",\"\\t\":\"t\",\"\\u2028\":\"u2028\",\"\\u2029\":\"u2029\"},X=L[typeof exports]&&exports,Y=L[typeof module]&&module&&module.exports==X&&module,Z=L[typeof global]&&global;!Z||Z.global!==Z&&Z.window!==Z||(n=Z);var nt=v();typeof define==\"function\"&&typeof define.amd==\"object\"&&define.amd?(n._=nt, define(function(){return nt})):X&&!X.nodeType?Y?(Y.exports=nt)._=nt:X._=nt:n._=nt\r\n}(this);","/**\r\n* Bootstrap.js by @fat & @mdo\r\n* plugins: bootstrap-tooltip.js\r\n* Copyright 2012 Twitter, Inc.\r\n* http://www.apache.org/licenses/LICENSE-2.0.txt\r\n*/\r\n!function(a){var b=function(a,b){this.init(\"tooltip\",a,b)};b.prototype={constructor:b,init:function(b,c,d){var e,f,g,h,i;this.type=b,this.$element=a(c),this.options=this.getOptions(d),this.enabled=!0,g=this.options.trigger.split(\" \");for(i=g.length;i--;)h=g[i],h==\"click\"?this.$element.on(\"click.\"+this.type,this.options.selector,a.proxy(this.toggle,this)):h!=\"manual\"&&(e=h==\"hover\"?\"mouseenter\":\"focus\",f=h==\"hover\"?\"mouseleave\":\"blur\",this.$element.on(e+\".\"+this.type,this.options.selector,a.proxy(this.enter,this)),this.$element.on(f+\".\"+this.type,this.options.selector,a.proxy(this.leave,this)));this.options.selector?this._options=a.extend({},this.options,{trigger:\"manual\",selector:\"\"}):this.fixTitle()},getOptions:function(b){return b=a.extend({},a.fn[this.type].defaults,this.$element.data(),b),b.delay&&typeof b.delay==\"number\"&&(b.delay={show:b.delay,hide:b.delay}),b},enter:function(b){var c=a.fn[this.type].defaults,d={},e;this._options&&a.each(this._options,function(a,b){c[a]!=b&&(d[a]=b)},this),e=a(b.currentTarget)[this.type](d).data(this.type);if(!e.options.delay||!e.options.delay.show)return e.show();clearTimeout(this.timeout),e.hoverState=\"in\",this.timeout=setTimeout(function(){e.hoverState==\"in\"&&e.show()},e.options.delay.show)},leave:function(b){var c=a(b.currentTarget)[this.type](this._options).data(this.type);this.timeout&&clearTimeout(this.timeout);if(!c.options.delay||!c.options.delay.hide)return c.hide();c.hoverState=\"out\",this.timeout=setTimeout(function(){c.hoverState==\"out\"&&c.hide()},c.options.delay.hide)},show:function(){var b,c,d,e,f,g,h=a.Event(\"show\");if(this.hasContent()&&this.enabled){this.$element.trigger(h);if(h.isDefaultPrevented())return;b=this.tip(),this.setContent(),this.options.animation&&b.addClass(\"fade\"),f=typeof this.options.placement==\"function\"?this.options.placement.call(this,b[0],this.$element[0]):this.options.placement,b.detach().css({top:0,left:0,display:\"block\"}),this.options.container?b.appendTo(this.options.container):b.insertAfter(this.$element),c=this.getPosition(),d=b[0].offsetWidth,e=b[0].offsetHeight;switch(f){case\"bottom\":g={top:c.top+c.height,left:c.left+c.width/2-d/2};break;case\"top\":g={top:c.top-e,left:c.left+c.width/2-d/2};break;case\"left\":g={top:c.top+c.height/2-e/2,left:c.left-d};break;case\"right\":g={top:c.top+c.height/2-e/2,left:c.left+c.width}}this.applyPlacement(g,f),this.$element.trigger(\"shown\")}},applyPlacement:function(a,b){var c=this.tip(),d=c[0].offsetWidth,e=c[0].offsetHeight,f,g,h,i;c.offset(a).addClass(b).addClass(\"in\"),f=c[0].offsetWidth,g=c[0].offsetHeight,b==\"top\"&&g!=e&&(a.top=a.top+e-g,i=!0),b==\"bottom\"||b==\"top\"?(h=0,a.left<0&&(h=a.left*-2,a.left=0,c.offset(a),f=c[0].offsetWidth,g=c[0].offsetHeight),this.replaceArrow(h-d+f,f,\"left\")):this.replaceArrow(g-e,g,\"top\"),i&&c.offset(a)},replaceArrow:function(a,b,c){this.arrow().css(c,a?50*(1-a/b)+\"%\":\"\")},setContent:function(){var a=this.tip(),b=this.getTitle();a.find(\".tooltip-inner\")[this.options.html?\"html\":\"text\"](b),a.removeClass(\"fade in top bottom left right\")},hide:function(){function e(){var b=setTimeout(function(){c.off(a.support.transition.end).detach()},500);c.one(a.support.transition.end,function(){clearTimeout(b),c.detach()})}var b=this,c=this.tip(),d=a.Event(\"hide\");this.$element.trigger(d);if(d.isDefaultPrevented())return;return c.removeClass(\"in\"),a.support.transition&&this.$tip.hasClass(\"fade\")?e():c.detach(),this.$element.trigger(\"hidden\"),this},fixTitle:function(){var a=this.$element;(a.attr(\"title\")||typeof a.attr(\"data-original-title\")!=\"string\")&&a.attr(\"data-original-title\",a.attr(\"title\")||\"\").attr(\"title\",\"\")},hasContent:function(){return this.getTitle()},getPosition:function(){var b=this.$element[0];return a.extend({},typeof b.getBoundingClientRect==\"function\"?b.getBoundingClientRect():{width:b.offsetWidth,height:b.offsetHeight},this.$element.offset())},getTitle:function(){var a,b=this.$element,c=this.options;return a=b.attr(\"data-original-title\")||(typeof c.title==\"function\"?c.title.call(b[0]):c.title),a},tip:function(){return this.$tip=this.$tip||a(this.options.template)},arrow:function(){return this.$arrow=this.$arrow||this.tip().find(\".tooltip-arrow\")},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(b){var c=b?a(b.currentTarget)[this.type](this._options).data(this.type):this;c.tip().hasClass(\"in\")?c.hide():c.show()},destroy:function(){this.hide().$element.off(\".\"+this.type).removeData(this.type)}};var c=a.fn.tooltip;a.fn.tooltip=function(c){return this.each(function(){var d=a(this),e=d.data(\"tooltip\"),f=typeof c==\"object\"&&c;e||d.data(\"tooltip\",e=new b(this,f)),typeof c==\"string\"&&e[c]()})},a.fn.tooltip.Constructor=b,a.fn.tooltip.defaults={animation:!0,placement:\"top\",selector:!1,template:'<div class=\"tooltip\"><div class=\"tooltip-arrow\"></div><div class=\"tooltip-inner\"></div></div>',trigger:\"hover focus\",title:\"\",delay:0,html:!1,container:!1},a.fn.tooltip.noConflict=function(){return a.fn.tooltip=c,this}}(window.jQuery)","/*\r\n\r\nCopyright (C) 2011 by Yehuda Katz\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in\r\nall copies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\nTHE SOFTWARE.\r\n\r\n*/\r\n\r\n// lib/handlebars/browser-prefix.js\r\nvar Handlebars = {};\r\n\r\n(function(Handlebars, undefined) {\r\n;\r\n// lib/handlebars/base.js\r\n\r\nHandlebars.VERSION = \"1.0.0\";\r\nHandlebars.COMPILER_REVISION = 4;\r\n\r\nHandlebars.REVISION_CHANGES = {\r\n  1: '<= 1.0.rc.2', // 1.0.rc.2 is actually rev2 but doesn't report it\r\n  2: '== 1.0.0-rc.3',\r\n  3: '== 1.0.0-rc.4',\r\n  4: '>= 1.0.0'\r\n};\r\n\r\nHandlebars.helpers  = {};\r\nHandlebars.partials = {};\r\n\r\nvar toString = Object.prototype.toString,\r\n    functionType = '[object Function]',\r\n    objectType = '[object Object]';\r\n\r\nHandlebars.registerHelper = function(name, fn, inverse) {\r\n  if (toString.call(name) === objectType) {\r\n    if (inverse || fn) { throw new Handlebars.Exception('Arg not supported with multiple helpers'); }\r\n    Handlebars.Utils.extend(this.helpers, name);\r\n  } else {\r\n    if (inverse) { fn.not = inverse; }\r\n    this.helpers[name] = fn;\r\n  }\r\n};\r\n\r\nHandlebars.registerPartial = function(name, str) {\r\n  if (toString.call(name) === objectType) {\r\n    Handlebars.Utils.extend(this.partials,  name);\r\n  } else {\r\n    this.partials[name] = str;\r\n  }\r\n};\r\n\r\nHandlebars.registerHelper('helperMissing', function(arg) {\r\n  if(arguments.length === 2) {\r\n    return undefined;\r\n  } else {\r\n    throw new Error(\"Missing helper: '\" + arg + \"'\");\r\n  }\r\n});\r\n\r\nHandlebars.registerHelper('blockHelperMissing', function(context, options) {\r\n  var inverse = options.inverse || function() {}, fn = options.fn;\r\n\r\n  var type = toString.call(context);\r\n\r\n  if(type === functionType) { context = context.call(this); }\r\n\r\n  if(context === true) {\r\n    return fn(this);\r\n  } else if(context === false || context == null) {\r\n    return inverse(this);\r\n  } else if(type === \"[object Array]\") {\r\n    if(context.length > 0) {\r\n      return Handlebars.helpers.each(context, options);\r\n    } else {\r\n      return inverse(this);\r\n    }\r\n  } else {\r\n    return fn(context);\r\n  }\r\n});\r\n\r\nHandlebars.K = function() {};\r\n\r\nHandlebars.createFrame = Object.create || function(object) {\r\n  Handlebars.K.prototype = object;\r\n  var obj = new Handlebars.K();\r\n  Handlebars.K.prototype = null;\r\n  return obj;\r\n};\r\n\r\nHandlebars.logger = {\r\n  DEBUG: 0, INFO: 1, WARN: 2, ERROR: 3, level: 3,\r\n\r\n  methodMap: {0: 'debug', 1: 'info', 2: 'warn', 3: 'error'},\r\n\r\n  // can be overridden in the host environment\r\n  log: function(level, obj) {\r\n    if (Handlebars.logger.level <= level) {\r\n      var method = Handlebars.logger.methodMap[level];\r\n      if (typeof console !== 'undefined' && console[method]) {\r\n        console[method].call(console, obj);\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nHandlebars.log = function(level, obj) { Handlebars.logger.log(level, obj); };\r\n\r\nHandlebars.registerHelper('each', function(context, options) {\r\n  var fn = options.fn, inverse = options.inverse;\r\n  var i = 0, ret = \"\", data;\r\n\r\n  var type = toString.call(context);\r\n  if(type === functionType) { context = context.call(this); }\r\n\r\n  if (options.data) {\r\n    data = Handlebars.createFrame(options.data);\r\n  }\r\n\r\n  if(context && typeof context === 'object') {\r\n    if(context instanceof Array){\r\n      for(var j = context.length; i<j; i++) {\r\n        if (data) { data.index = i; }\r\n        ret = ret + fn(context[i], { data: data });\r\n      }\r\n    } else {\r\n      for(var key in context) {\r\n        if(context.hasOwnProperty(key)) {\r\n          if(data) { data.key = key; }\r\n          ret = ret + fn(context[key], {data: data});\r\n          i++;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  if(i === 0){\r\n    ret = inverse(this);\r\n  }\r\n\r\n  return ret;\r\n});\r\n\r\nHandlebars.registerHelper('if', function(conditional, options) {\r\n  var type = toString.call(conditional);\r\n  if(type === functionType) { conditional = conditional.call(this); }\r\n\r\n  if(!conditional || Handlebars.Utils.isEmpty(conditional)) {\r\n    return options.inverse(this);\r\n  } else {\r\n    return options.fn(this);\r\n  }\r\n});\r\n\r\nHandlebars.registerHelper('unless', function(conditional, options) {\r\n  return Handlebars.helpers['if'].call(this, conditional, {fn: options.inverse, inverse: options.fn});\r\n});\r\n\r\nHandlebars.registerHelper('with', function(context, options) {\r\n  var type = toString.call(context);\r\n  if(type === functionType) { context = context.call(this); }\r\n\r\n  if (!Handlebars.Utils.isEmpty(context)) return options.fn(context);\r\n});\r\n\r\nHandlebars.registerHelper('log', function(context, options) {\r\n  var level = options.data && options.data.level != null ? parseInt(options.data.level, 10) : 1;\r\n  Handlebars.log(level, context);\r\n});\r\n;\r\n// lib/handlebars/compiler/parser.js\r\n/* Jison generated parser */\r\nvar handlebars = (function(){\r\nvar parser = {trace: function trace() { },\r\nyy: {},\r\nsymbols_: {\"error\":2,\"root\":3,\"program\":4,\"EOF\":5,\"simpleInverse\":6,\"statements\":7,\"statement\":8,\"openInverse\":9,\"closeBlock\":10,\"openBlock\":11,\"mustache\":12,\"partial\":13,\"CONTENT\":14,\"COMMENT\":15,\"OPEN_BLOCK\":16,\"inMustache\":17,\"CLOSE\":18,\"OPEN_INVERSE\":19,\"OPEN_ENDBLOCK\":20,\"path\":21,\"OPEN\":22,\"OPEN_UNESCAPED\":23,\"CLOSE_UNESCAPED\":24,\"OPEN_PARTIAL\":25,\"partialName\":26,\"params\":27,\"hash\":28,\"dataName\":29,\"param\":30,\"STRING\":31,\"INTEGER\":32,\"BOOLEAN\":33,\"hashSegments\":34,\"hashSegment\":35,\"ID\":36,\"EQUALS\":37,\"DATA\":38,\"pathSegments\":39,\"SEP\":40,\"$accept\":0,\"$end\":1},\r\nterminals_: {2:\"error\",5:\"EOF\",14:\"CONTENT\",15:\"COMMENT\",16:\"OPEN_BLOCK\",18:\"CLOSE\",19:\"OPEN_INVERSE\",20:\"OPEN_ENDBLOCK\",22:\"OPEN\",23:\"OPEN_UNESCAPED\",24:\"CLOSE_UNESCAPED\",25:\"OPEN_PARTIAL\",31:\"STRING\",32:\"INTEGER\",33:\"BOOLEAN\",36:\"ID\",37:\"EQUALS\",38:\"DATA\",40:\"SEP\"},\r\nproductions_: [0,[3,2],[4,2],[4,3],[4,2],[4,1],[4,1],[4,0],[7,1],[7,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,3],[13,4],[6,2],[17,3],[17,2],[17,2],[17,1],[17,1],[27,2],[27,1],[30,1],[30,1],[30,1],[30,1],[30,1],[28,1],[34,2],[34,1],[35,3],[35,3],[35,3],[35,3],[35,3],[26,1],[26,1],[26,1],[29,2],[21,1],[39,3],[39,1]],\r\nperformAction: function anonymous(yytext,yyleng,yylineno,yy,yystate,$$,_$) {\r\n\r\nvar $0 = $$.length - 1;\r\nswitch (yystate) {\r\ncase 1: return $$[$0-1]; \r\nbreak;\r\ncase 2: this.$ = new yy.ProgramNode([], $$[$0]); \r\nbreak;\r\ncase 3: this.$ = new yy.ProgramNode($$[$0-2], $$[$0]); \r\nbreak;\r\ncase 4: this.$ = new yy.ProgramNode($$[$0-1], []); \r\nbreak;\r\ncase 5: this.$ = new yy.ProgramNode($$[$0]); \r\nbreak;\r\ncase 6: this.$ = new yy.ProgramNode([], []); \r\nbreak;\r\ncase 7: this.$ = new yy.ProgramNode([]); \r\nbreak;\r\ncase 8: this.$ = [$$[$0]]; \r\nbreak;\r\ncase 9: $$[$0-1].push($$[$0]); this.$ = $$[$0-1]; \r\nbreak;\r\ncase 10: this.$ = new yy.BlockNode($$[$0-2], $$[$0-1].inverse, $$[$0-1], $$[$0]); \r\nbreak;\r\ncase 11: this.$ = new yy.BlockNode($$[$0-2], $$[$0-1], $$[$0-1].inverse, $$[$0]); \r\nbreak;\r\ncase 12: this.$ = $$[$0]; \r\nbreak;\r\ncase 13: this.$ = $$[$0]; \r\nbreak;\r\ncase 14: this.$ = new yy.ContentNode($$[$0]); \r\nbreak;\r\ncase 15: this.$ = new yy.CommentNode($$[$0]); \r\nbreak;\r\ncase 16: this.$ = new yy.MustacheNode($$[$0-1][0], $$[$0-1][1]); \r\nbreak;\r\ncase 17: this.$ = new yy.MustacheNode($$[$0-1][0], $$[$0-1][1]); \r\nbreak;\r\ncase 18: this.$ = $$[$0-1]; \r\nbreak;\r\ncase 19:\r\n    // Parsing out the '&' escape token at this level saves ~500 bytes after min due to the removal of one parser node.\r\n    this.$ = new yy.MustacheNode($$[$0-1][0], $$[$0-1][1], $$[$0-2][2] === '&');\r\n  \r\nbreak;\r\ncase 20: this.$ = new yy.MustacheNode($$[$0-1][0], $$[$0-1][1], true); \r\nbreak;\r\ncase 21: this.$ = new yy.PartialNode($$[$0-1]); \r\nbreak;\r\ncase 22: this.$ = new yy.PartialNode($$[$0-2], $$[$0-1]); \r\nbreak;\r\ncase 23: \r\nbreak;\r\ncase 24: this.$ = [[$$[$0-2]].concat($$[$0-1]), $$[$0]]; \r\nbreak;\r\ncase 25: this.$ = [[$$[$0-1]].concat($$[$0]), null]; \r\nbreak;\r\ncase 26: this.$ = [[$$[$0-1]], $$[$0]]; \r\nbreak;\r\ncase 27: this.$ = [[$$[$0]], null]; \r\nbreak;\r\ncase 28: this.$ = [[$$[$0]], null]; \r\nbreak;\r\ncase 29: $$[$0-1].push($$[$0]); this.$ = $$[$0-1]; \r\nbreak;\r\ncase 30: this.$ = [$$[$0]]; \r\nbreak;\r\ncase 31: this.$ = $$[$0]; \r\nbreak;\r\ncase 32: this.$ = new yy.StringNode($$[$0]); \r\nbreak;\r\ncase 33: this.$ = new yy.IntegerNode($$[$0]); \r\nbreak;\r\ncase 34: this.$ = new yy.BooleanNode($$[$0]); \r\nbreak;\r\ncase 35: this.$ = $$[$0]; \r\nbreak;\r\ncase 36: this.$ = new yy.HashNode($$[$0]); \r\nbreak;\r\ncase 37: $$[$0-1].push($$[$0]); this.$ = $$[$0-1]; \r\nbreak;\r\ncase 38: this.$ = [$$[$0]]; \r\nbreak;\r\ncase 39: this.$ = [$$[$0-2], $$[$0]]; \r\nbreak;\r\ncase 40: this.$ = [$$[$0-2], new yy.StringNode($$[$0])]; \r\nbreak;\r\ncase 41: this.$ = [$$[$0-2], new yy.IntegerNode($$[$0])]; \r\nbreak;\r\ncase 42: this.$ = [$$[$0-2], new yy.BooleanNode($$[$0])]; \r\nbreak;\r\ncase 43: this.$ = [$$[$0-2], $$[$0]]; \r\nbreak;\r\ncase 44: this.$ = new yy.PartialNameNode($$[$0]); \r\nbreak;\r\ncase 45: this.$ = new yy.PartialNameNode(new yy.StringNode($$[$0])); \r\nbreak;\r\ncase 46: this.$ = new yy.PartialNameNode(new yy.IntegerNode($$[$0])); \r\nbreak;\r\ncase 47: this.$ = new yy.DataNode($$[$0]); \r\nbreak;\r\ncase 48: this.$ = new yy.IdNode($$[$0]); \r\nbreak;\r\ncase 49: $$[$0-2].push({part: $$[$0], separator: $$[$0-1]}); this.$ = $$[$0-2]; \r\nbreak;\r\ncase 50: this.$ = [{part: $$[$0]}]; \r\nbreak;\r\n}\r\n},\r\ntable: [{3:1,4:2,5:[2,7],6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],22:[1,14],23:[1,15],25:[1,16]},{1:[3]},{5:[1,17]},{5:[2,6],7:18,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,6],22:[1,14],23:[1,15],25:[1,16]},{5:[2,5],6:20,8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,5],22:[1,14],23:[1,15],25:[1,16]},{17:23,18:[1,22],21:24,29:25,36:[1,28],38:[1,27],39:26},{5:[2,8],14:[2,8],15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],25:[2,8]},{4:29,6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,7],22:[1,14],23:[1,15],25:[1,16]},{4:30,6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,7],22:[1,14],23:[1,15],25:[1,16]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],25:[2,12]},{5:[2,13],14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],25:[2,13]},{5:[2,14],14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],25:[2,14]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],25:[2,15]},{17:31,21:24,29:25,36:[1,28],38:[1,27],39:26},{17:32,21:24,29:25,36:[1,28],38:[1,27],39:26},{17:33,21:24,29:25,36:[1,28],38:[1,27],39:26},{21:35,26:34,31:[1,36],32:[1,37],36:[1,28],39:26},{1:[2,1]},{5:[2,2],8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,2],22:[1,14],23:[1,15],25:[1,16]},{17:23,21:24,29:25,36:[1,28],38:[1,27],39:26},{5:[2,4],7:38,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,4],22:[1,14],23:[1,15],25:[1,16]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],25:[2,9]},{5:[2,23],14:[2,23],15:[2,23],16:[2,23],19:[2,23],20:[2,23],22:[2,23],23:[2,23],25:[2,23]},{18:[1,39]},{18:[2,27],21:44,24:[2,27],27:40,28:41,29:48,30:42,31:[1,45],32:[1,46],33:[1,47],34:43,35:49,36:[1,50],38:[1,27],39:26},{18:[2,28],24:[2,28]},{18:[2,48],24:[2,48],31:[2,48],32:[2,48],33:[2,48],36:[2,48],38:[2,48],40:[1,51]},{21:52,36:[1,28],39:26},{18:[2,50],24:[2,50],31:[2,50],32:[2,50],33:[2,50],36:[2,50],38:[2,50],40:[2,50]},{10:53,20:[1,54]},{10:55,20:[1,54]},{18:[1,56]},{18:[1,57]},{24:[1,58]},{18:[1,59],21:60,36:[1,28],39:26},{18:[2,44],36:[2,44]},{18:[2,45],36:[2,45]},{18:[2,46],36:[2,46]},{5:[2,3],8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,3],22:[1,14],23:[1,15],25:[1,16]},{14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],25:[2,17]},{18:[2,25],21:44,24:[2,25],28:61,29:48,30:62,31:[1,45],32:[1,46],33:[1,47],34:43,35:49,36:[1,50],38:[1,27],39:26},{18:[2,26],24:[2,26]},{18:[2,30],24:[2,30],31:[2,30],32:[2,30],33:[2,30],36:[2,30],38:[2,30]},{18:[2,36],24:[2,36],35:63,36:[1,64]},{18:[2,31],24:[2,31],31:[2,31],32:[2,31],33:[2,31],36:[2,31],38:[2,31]},{18:[2,32],24:[2,32],31:[2,32],32:[2,32],33:[2,32],36:[2,32],38:[2,32]},{18:[2,33],24:[2,33],31:[2,33],32:[2,33],33:[2,33],36:[2,33],38:[2,33]},{18:[2,34],24:[2,34],31:[2,34],32:[2,34],33:[2,34],36:[2,34],38:[2,34]},{18:[2,35],24:[2,35],31:[2,35],32:[2,35],33:[2,35],36:[2,35],38:[2,35]},{18:[2,38],24:[2,38],36:[2,38]},{18:[2,50],24:[2,50],31:[2,50],32:[2,50],33:[2,50],36:[2,50],37:[1,65],38:[2,50],40:[2,50]},{36:[1,66]},{18:[2,47],24:[2,47],31:[2,47],32:[2,47],33:[2,47],36:[2,47],38:[2,47]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],25:[2,10]},{21:67,36:[1,28],39:26},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],25:[2,11]},{14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],25:[2,16]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],25:[2,19]},{5:[2,20],14:[2,20],15:[2,20],16:[2,20],19:[2,20],20:[2,20],22:[2,20],23:[2,20],25:[2,20]},{5:[2,21],14:[2,21],15:[2,21],16:[2,21],19:[2,21],20:[2,21],22:[2,21],23:[2,21],25:[2,21]},{18:[1,68]},{18:[2,24],24:[2,24]},{18:[2,29],24:[2,29],31:[2,29],32:[2,29],33:[2,29],36:[2,29],38:[2,29]},{18:[2,37],24:[2,37],36:[2,37]},{37:[1,65]},{21:69,29:73,31:[1,70],32:[1,71],33:[1,72],36:[1,28],38:[1,27],39:26},{18:[2,49],24:[2,49],31:[2,49],32:[2,49],33:[2,49],36:[2,49],38:[2,49],40:[2,49]},{18:[1,74]},{5:[2,22],14:[2,22],15:[2,22],16:[2,22],19:[2,22],20:[2,22],22:[2,22],23:[2,22],25:[2,22]},{18:[2,39],24:[2,39],36:[2,39]},{18:[2,40],24:[2,40],36:[2,40]},{18:[2,41],24:[2,41],36:[2,41]},{18:[2,42],24:[2,42],36:[2,42]},{18:[2,43],24:[2,43],36:[2,43]},{5:[2,18],14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],25:[2,18]}],\r\ndefaultActions: {17:[2,1]},\r\nparseError: function parseError(str, hash) {\r\n    throw new Error(str);\r\n},\r\nparse: function parse(input) {\r\n    var self = this, stack = [0], vstack = [null], lstack = [], table = this.table, yytext = \"\", yylineno = 0, yyleng = 0, recovering = 0, TERROR = 2, EOF = 1;\r\n    this.lexer.setInput(input);\r\n    this.lexer.yy = this.yy;\r\n    this.yy.lexer = this.lexer;\r\n    this.yy.parser = this;\r\n    if (typeof this.lexer.yylloc == \"undefined\")\r\n        this.lexer.yylloc = {};\r\n    var yyloc = this.lexer.yylloc;\r\n    lstack.push(yyloc);\r\n    var ranges = this.lexer.options && this.lexer.options.ranges;\r\n    if (typeof this.yy.parseError === \"function\")\r\n        this.parseError = this.yy.parseError;\r\n    function popStack(n) {\r\n        stack.length = stack.length - 2 * n;\r\n        vstack.length = vstack.length - n;\r\n        lstack.length = lstack.length - n;\r\n    }\r\n    function lex() {\r\n        var token;\r\n        token = self.lexer.lex() || 1;\r\n        if (typeof token !== \"number\") {\r\n            token = self.symbols_[token] || token;\r\n        }\r\n        return token;\r\n    }\r\n    var symbol, preErrorSymbol, state, action, a, r, yyval = {}, p, len, newState, expected;\r\n    while (true) {\r\n        state = stack[stack.length - 1];\r\n        if (this.defaultActions[state]) {\r\n            action = this.defaultActions[state];\r\n        } else {\r\n            if (symbol === null || typeof symbol == \"undefined\") {\r\n                symbol = lex();\r\n            }\r\n            action = table[state] && table[state][symbol];\r\n        }\r\n        if (typeof action === \"undefined\" || !action.length || !action[0]) {\r\n            var errStr = \"\";\r\n            if (!recovering) {\r\n                expected = [];\r\n                for (p in table[state])\r\n                    if (this.terminals_[p] && p > 2) {\r\n                        expected.push(\"'\" + this.terminals_[p] + \"'\");\r\n                    }\r\n                if (this.lexer.showPosition) {\r\n                    errStr = \"Parse error on line \" + (yylineno + 1) + \":\\n\" + this.lexer.showPosition() + \"\\nExpecting \" + expected.join(\", \") + \", got '\" + (this.terminals_[symbol] || symbol) + \"'\";\r\n                } else {\r\n                    errStr = \"Parse error on line \" + (yylineno + 1) + \": Unexpected \" + (symbol == 1?\"end of input\":\"'\" + (this.terminals_[symbol] || symbol) + \"'\");\r\n                }\r\n                this.parseError(errStr, {text: this.lexer.match, token: this.terminals_[symbol] || symbol, line: this.lexer.yylineno, loc: yyloc, expected: expected});\r\n            }\r\n        }\r\n        if (action[0] instanceof Array && action.length > 1) {\r\n            throw new Error(\"Parse Error: multiple actions possible at state: \" + state + \", token: \" + symbol);\r\n        }\r\n        switch (action[0]) {\r\n        case 1:\r\n            stack.push(symbol);\r\n            vstack.push(this.lexer.yytext);\r\n            lstack.push(this.lexer.yylloc);\r\n            stack.push(action[1]);\r\n            symbol = null;\r\n            if (!preErrorSymbol) {\r\n                yyleng = this.lexer.yyleng;\r\n                yytext = this.lexer.yytext;\r\n                yylineno = this.lexer.yylineno;\r\n                yyloc = this.lexer.yylloc;\r\n                if (recovering > 0)\r\n                    recovering--;\r\n            } else {\r\n                symbol = preErrorSymbol;\r\n                preErrorSymbol = null;\r\n            }\r\n            break;\r\n        case 2:\r\n            len = this.productions_[action[1]][1];\r\n            yyval.$ = vstack[vstack.length - len];\r\n            yyval._$ = {first_line: lstack[lstack.length - (len || 1)].first_line, last_line: lstack[lstack.length - 1].last_line, first_column: lstack[lstack.length - (len || 1)].first_column, last_column: lstack[lstack.length - 1].last_column};\r\n            if (ranges) {\r\n                yyval._$.range = [lstack[lstack.length - (len || 1)].range[0], lstack[lstack.length - 1].range[1]];\r\n            }\r\n            r = this.performAction.call(yyval, yytext, yyleng, yylineno, this.yy, action[1], vstack, lstack);\r\n            if (typeof r !== \"undefined\") {\r\n                return r;\r\n            }\r\n            if (len) {\r\n                stack = stack.slice(0, -1 * len * 2);\r\n                vstack = vstack.slice(0, -1 * len);\r\n                lstack = lstack.slice(0, -1 * len);\r\n            }\r\n            stack.push(this.productions_[action[1]][0]);\r\n            vstack.push(yyval.$);\r\n            lstack.push(yyval._$);\r\n            newState = table[stack[stack.length - 2]][stack[stack.length - 1]];\r\n            stack.push(newState);\r\n            break;\r\n        case 3:\r\n            return true;\r\n        }\r\n    }\r\n    return true;\r\n}\r\n};\r\n/* Jison generated lexer */\r\nvar lexer = (function(){\r\nvar lexer = ({EOF:1,\r\nparseError:function parseError(str, hash) {\r\n        if (this.yy.parser) {\r\n            this.yy.parser.parseError(str, hash);\r\n        } else {\r\n            throw new Error(str);\r\n        }\r\n    },\r\nsetInput:function (input) {\r\n        this._input = input;\r\n        this._more = this._less = this.done = false;\r\n        this.yylineno = this.yyleng = 0;\r\n        this.yytext = this.matched = this.match = '';\r\n        this.conditionStack = ['INITIAL'];\r\n        this.yylloc = {first_line:1,first_column:0,last_line:1,last_column:0};\r\n        if (this.options.ranges) this.yylloc.range = [0,0];\r\n        this.offset = 0;\r\n        return this;\r\n    },\r\ninput:function () {\r\n        var ch = this._input[0];\r\n        this.yytext += ch;\r\n        this.yyleng++;\r\n        this.offset++;\r\n        this.match += ch;\r\n        this.matched += ch;\r\n        var lines = ch.match(/(?:\\r\\n?|\\n).*/g);\r\n        if (lines) {\r\n            this.yylineno++;\r\n            this.yylloc.last_line++;\r\n        } else {\r\n            this.yylloc.last_column++;\r\n        }\r\n        if (this.options.ranges) this.yylloc.range[1]++;\r\n\r\n        this._input = this._input.slice(1);\r\n        return ch;\r\n    },\r\nunput:function (ch) {\r\n        var len = ch.length;\r\n        var lines = ch.split(/(?:\\r\\n?|\\n)/g);\r\n\r\n        this._input = ch + this._input;\r\n        this.yytext = this.yytext.substr(0, this.yytext.length-len-1);\r\n        //this.yyleng -= len;\r\n        this.offset -= len;\r\n        var oldLines = this.match.split(/(?:\\r\\n?|\\n)/g);\r\n        this.match = this.match.substr(0, this.match.length-1);\r\n        this.matched = this.matched.substr(0, this.matched.length-1);\r\n\r\n        if (lines.length-1) this.yylineno -= lines.length-1;\r\n        var r = this.yylloc.range;\r\n\r\n        this.yylloc = {first_line: this.yylloc.first_line,\r\n          last_line: this.yylineno+1,\r\n          first_column: this.yylloc.first_column,\r\n          last_column: lines ?\r\n              (lines.length === oldLines.length ? this.yylloc.first_column : 0) + oldLines[oldLines.length - lines.length].length - lines[0].length:\r\n              this.yylloc.first_column - len\r\n          };\r\n\r\n        if (this.options.ranges) {\r\n            this.yylloc.range = [r[0], r[0] + this.yyleng - len];\r\n        }\r\n        return this;\r\n    },\r\nmore:function () {\r\n        this._more = true;\r\n        return this;\r\n    },\r\nless:function (n) {\r\n        this.unput(this.match.slice(n));\r\n    },\r\npastInput:function () {\r\n        var past = this.matched.substr(0, this.matched.length - this.match.length);\r\n        return (past.length > 20 ? '...':'') + past.substr(-20).replace(/\\n/g, \"\");\r\n    },\r\nupcomingInput:function () {\r\n        var next = this.match;\r\n        if (next.length < 20) {\r\n            next += this._input.substr(0, 20-next.length);\r\n        }\r\n        return (next.substr(0,20)+(next.length > 20 ? '...':'')).replace(/\\n/g, \"\");\r\n    },\r\nshowPosition:function () {\r\n        var pre = this.pastInput();\r\n        var c = new Array(pre.length + 1).join(\"-\");\r\n        return pre + this.upcomingInput() + \"\\n\" + c+\"^\";\r\n    },\r\nnext:function () {\r\n        if (this.done) {\r\n            return this.EOF;\r\n        }\r\n        if (!this._input) this.done = true;\r\n\r\n        var token,\r\n            match,\r\n            tempMatch,\r\n            index,\r\n            col,\r\n            lines;\r\n        if (!this._more) {\r\n            this.yytext = '';\r\n            this.match = '';\r\n        }\r\n        var rules = this._currentRules();\r\n        for (var i=0;i < rules.length; i++) {\r\n            tempMatch = this._input.match(this.rules[rules[i]]);\r\n            if (tempMatch && (!match || tempMatch[0].length > match[0].length)) {\r\n                match = tempMatch;\r\n                index = i;\r\n                if (!this.options.flex) break;\r\n            }\r\n        }\r\n        if (match) {\r\n            lines = match[0].match(/(?:\\r\\n?|\\n).*/g);\r\n            if (lines) this.yylineno += lines.length;\r\n            this.yylloc = {first_line: this.yylloc.last_line,\r\n                           last_line: this.yylineno+1,\r\n                           first_column: this.yylloc.last_column,\r\n                           last_column: lines ? lines[lines.length-1].length-lines[lines.length-1].match(/\\r?\\n?/)[0].length : this.yylloc.last_column + match[0].length};\r\n            this.yytext += match[0];\r\n            this.match += match[0];\r\n            this.matches = match;\r\n            this.yyleng = this.yytext.length;\r\n            if (this.options.ranges) {\r\n                this.yylloc.range = [this.offset, this.offset += this.yyleng];\r\n            }\r\n            this._more = false;\r\n            this._input = this._input.slice(match[0].length);\r\n            this.matched += match[0];\r\n            token = this.performAction.call(this, this.yy, this, rules[index],this.conditionStack[this.conditionStack.length-1]);\r\n            if (this.done && this._input) this.done = false;\r\n            if (token) return token;\r\n            else return;\r\n        }\r\n        if (this._input === \"\") {\r\n            return this.EOF;\r\n        } else {\r\n            return this.parseError('Lexical error on line '+(this.yylineno+1)+'. Unrecognized text.\\n'+this.showPosition(),\r\n                    {text: \"\", token: null, line: this.yylineno});\r\n        }\r\n    },\r\nlex:function lex() {\r\n        var r = this.next();\r\n        if (typeof r !== 'undefined') {\r\n            return r;\r\n        } else {\r\n            return this.lex();\r\n        }\r\n    },\r\nbegin:function begin(condition) {\r\n        this.conditionStack.push(condition);\r\n    },\r\npopState:function popState() {\r\n        return this.conditionStack.pop();\r\n    },\r\n_currentRules:function _currentRules() {\r\n        return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules;\r\n    },\r\ntopState:function () {\r\n        return this.conditionStack[this.conditionStack.length-2];\r\n    },\r\npushState:function begin(condition) {\r\n        this.begin(condition);\r\n    }});\r\nlexer.options = {};\r\nlexer.performAction = function anonymous(yy,yy_,$avoiding_name_collisions,YY_START) {\r\n\r\nvar YYSTATE=YY_START\r\nswitch($avoiding_name_collisions) {\r\ncase 0: yy_.yytext = \"\\\\\"; return 14; \r\nbreak;\r\ncase 1:\r\n                                   if(yy_.yytext.slice(-1) !== \"\\\\\") this.begin(\"mu\");\r\n                                   if(yy_.yytext.slice(-1) === \"\\\\\") yy_.yytext = yy_.yytext.substr(0,yy_.yyleng-1), this.begin(\"emu\");\r\n                                   if(yy_.yytext) return 14;\r\n                                 \r\nbreak;\r\ncase 2: return 14; \r\nbreak;\r\ncase 3:\r\n                                   if(yy_.yytext.slice(-1) !== \"\\\\\") this.popState();\r\n                                   if(yy_.yytext.slice(-1) === \"\\\\\") yy_.yytext = yy_.yytext.substr(0,yy_.yyleng-1);\r\n                                   return 14;\r\n                                 \r\nbreak;\r\ncase 4: yy_.yytext = yy_.yytext.substr(0, yy_.yyleng-4); this.popState(); return 15; \r\nbreak;\r\ncase 5: return 25; \r\nbreak;\r\ncase 6: return 16; \r\nbreak;\r\ncase 7: return 20; \r\nbreak;\r\ncase 8: return 19; \r\nbreak;\r\ncase 9: return 19; \r\nbreak;\r\ncase 10: return 23; \r\nbreak;\r\ncase 11: return 22; \r\nbreak;\r\ncase 12: this.popState(); this.begin('com'); \r\nbreak;\r\ncase 13: yy_.yytext = yy_.yytext.substr(3,yy_.yyleng-5); this.popState(); return 15; \r\nbreak;\r\ncase 14: return 22; \r\nbreak;\r\ncase 15: return 37; \r\nbreak;\r\ncase 16: return 36; \r\nbreak;\r\ncase 17: return 36; \r\nbreak;\r\ncase 18: return 40; \r\nbreak;\r\ncase 19: /*ignore whitespace*/ \r\nbreak;\r\ncase 20: this.popState(); return 24; \r\nbreak;\r\ncase 21: this.popState(); return 18; \r\nbreak;\r\ncase 22: yy_.yytext = yy_.yytext.substr(1,yy_.yyleng-2).replace(/\\\\\"/g,'\"'); return 31; \r\nbreak;\r\ncase 23: yy_.yytext = yy_.yytext.substr(1,yy_.yyleng-2).replace(/\\\\'/g,\"'\"); return 31; \r\nbreak;\r\ncase 24: return 38; \r\nbreak;\r\ncase 25: return 33; \r\nbreak;\r\ncase 26: return 33; \r\nbreak;\r\ncase 27: return 32; \r\nbreak;\r\ncase 28: return 36; \r\nbreak;\r\ncase 29: yy_.yytext = yy_.yytext.substr(1, yy_.yyleng-2); return 36; \r\nbreak;\r\ncase 30: return 'INVALID'; \r\nbreak;\r\ncase 31: return 5; \r\nbreak;\r\n}\r\n};\r\nlexer.rules = [/^(?:\\\\\\\\(?=(\\{\\{)))/,/^(?:[^\\x00]*?(?=(\\{\\{)))/,/^(?:[^\\x00]+)/,/^(?:[^\\x00]{2,}?(?=(\\{\\{|$)))/,/^(?:[\\s\\S]*?--\\}\\})/,/^(?:\\{\\{>)/,/^(?:\\{\\{#)/,/^(?:\\{\\{\\/)/,/^(?:\\{\\{\\^)/,/^(?:\\{\\{\\s*else\\b)/,/^(?:\\{\\{\\{)/,/^(?:\\{\\{&)/,/^(?:\\{\\{!--)/,/^(?:\\{\\{![\\s\\S]*?\\}\\})/,/^(?:\\{\\{)/,/^(?:=)/,/^(?:\\.(?=[}\\/ ]))/,/^(?:\\.\\.)/,/^(?:[\\/.])/,/^(?:\\s+)/,/^(?:\\}\\}\\})/,/^(?:\\}\\})/,/^(?:\"(\\\\[\"]|[^\"])*\")/,/^(?:'(\\\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=[}\\s]))/,/^(?:false(?=[}\\s]))/,/^(?:-?[0-9]+(?=[}\\s]))/,/^(?:[^\\s!\"#%-,\\.\\/;->@\\[-\\^`\\{-~]+(?=[=}\\s\\/.]))/,/^(?:\\[[^\\]]*\\])/,/^(?:.)/,/^(?:$)/];\r\nlexer.conditions = {\"mu\":{\"rules\":[5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],\"inclusive\":false},\"emu\":{\"rules\":[3],\"inclusive\":false},\"com\":{\"rules\":[4],\"inclusive\":false},\"INITIAL\":{\"rules\":[0,1,2,31],\"inclusive\":true}};\r\nreturn lexer;})()\r\nparser.lexer = lexer;\r\nfunction Parser () { this.yy = {}; }Parser.prototype = parser;parser.Parser = Parser;\r\nreturn new Parser;\r\n})();;\r\n// lib/handlebars/compiler/base.js\r\n\r\nHandlebars.Parser = handlebars;\r\n\r\nHandlebars.parse = function(input) {\r\n\r\n  // Just return if an already-compile AST was passed in.\r\n  if(input.constructor === Handlebars.AST.ProgramNode) { return input; }\r\n\r\n  Handlebars.Parser.yy = Handlebars.AST;\r\n  return Handlebars.Parser.parse(input);\r\n};\r\n;\r\n// lib/handlebars/compiler/ast.js\r\nHandlebars.AST = {};\r\n\r\nHandlebars.AST.ProgramNode = function(statements, inverse) {\r\n  this.type = \"program\";\r\n  this.statements = statements;\r\n  if(inverse) { this.inverse = new Handlebars.AST.ProgramNode(inverse); }\r\n};\r\n\r\nHandlebars.AST.MustacheNode = function(rawParams, hash, unescaped) {\r\n  this.type = \"mustache\";\r\n  this.escaped = !unescaped;\r\n  this.hash = hash;\r\n\r\n  var id = this.id = rawParams[0];\r\n  var params = this.params = rawParams.slice(1);\r\n\r\n  // a mustache is an eligible helper if:\r\n  // * its id is simple (a single part, not `this` or `..`)\r\n  var eligibleHelper = this.eligibleHelper = id.isSimple;\r\n\r\n  // a mustache is definitely a helper if:\r\n  // * it is an eligible helper, and\r\n  // * it has at least one parameter or hash segment\r\n  this.isHelper = eligibleHelper && (params.length || hash);\r\n\r\n  // if a mustache is an eligible helper but not a definite\r\n  // helper, it is ambiguous, and will be resolved in a later\r\n  // pass or at runtime.\r\n};\r\n\r\nHandlebars.AST.PartialNode = function(partialName, context) {\r\n  this.type         = \"partial\";\r\n  this.partialName  = partialName;\r\n  this.context      = context;\r\n};\r\n\r\nHandlebars.AST.BlockNode = function(mustache, program, inverse, close) {\r\n  var verifyMatch = function(open, close) {\r\n    if(open.original !== close.original) {\r\n      throw new Handlebars.Exception(open.original + \" doesn't match \" + close.original);\r\n    }\r\n  };\r\n\r\n  verifyMatch(mustache.id, close);\r\n  this.type = \"block\";\r\n  this.mustache = mustache;\r\n  this.program  = program;\r\n  this.inverse  = inverse;\r\n\r\n  if (this.inverse && !this.program) {\r\n    this.isInverse = true;\r\n  }\r\n};\r\n\r\nHandlebars.AST.ContentNode = function(string) {\r\n  this.type = \"content\";\r\n  this.string = string;\r\n};\r\n\r\nHandlebars.AST.HashNode = function(pairs) {\r\n  this.type = \"hash\";\r\n  this.pairs = pairs;\r\n};\r\n\r\nHandlebars.AST.IdNode = function(parts) {\r\n  this.type = \"ID\";\r\n\r\n  var original = \"\",\r\n      dig = [],\r\n      depth = 0;\r\n\r\n  for(var i=0,l=parts.length; i<l; i++) {\r\n    var part = parts[i].part;\r\n    original += (parts[i].separator || '') + part;\r\n\r\n    if (part === \"..\" || part === \".\" || part === \"this\") {\r\n      if (dig.length > 0) { throw new Handlebars.Exception(\"Invalid path: \" + original); }\r\n      else if (part === \"..\") { depth++; }\r\n      else { this.isScoped = true; }\r\n    }\r\n    else { dig.push(part); }\r\n  }\r\n\r\n  this.original = original;\r\n  this.parts    = dig;\r\n  this.string   = dig.join('.');\r\n  this.depth    = depth;\r\n\r\n  // an ID is simple if it only has one part, and that part is not\r\n  // `..` or `this`.\r\n  this.isSimple = parts.length === 1 && !this.isScoped && depth === 0;\r\n\r\n  this.stringModeValue = this.string;\r\n};\r\n\r\nHandlebars.AST.PartialNameNode = function(name) {\r\n  this.type = \"PARTIAL_NAME\";\r\n  this.name = name.original;\r\n};\r\n\r\nHandlebars.AST.DataNode = function(id) {\r\n  this.type = \"DATA\";\r\n  this.id = id;\r\n};\r\n\r\nHandlebars.AST.StringNode = function(string) {\r\n  this.type = \"STRING\";\r\n  this.original =\r\n    this.string =\r\n    this.stringModeValue = string;\r\n};\r\n\r\nHandlebars.AST.IntegerNode = function(integer) {\r\n  this.type = \"INTEGER\";\r\n  this.original =\r\n    this.integer = integer;\r\n  this.stringModeValue = Number(integer);\r\n};\r\n\r\nHandlebars.AST.BooleanNode = function(bool) {\r\n  this.type = \"BOOLEAN\";\r\n  this.bool = bool;\r\n  this.stringModeValue = bool === \"true\";\r\n};\r\n\r\nHandlebars.AST.CommentNode = function(comment) {\r\n  this.type = \"comment\";\r\n  this.comment = comment;\r\n};\r\n;\r\n// lib/handlebars/utils.js\r\n\r\nvar errorProps = ['description', 'fileName', 'lineNumber', 'message', 'name', 'number', 'stack'];\r\n\r\nHandlebars.Exception = function(message) {\r\n  var tmp = Error.prototype.constructor.apply(this, arguments);\r\n\r\n  // Unfortunately errors are not enumerable in Chrome (at least), so `for prop in tmp` doesn't work.\r\n  for (var idx = 0; idx < errorProps.length; idx++) {\r\n    this[errorProps[idx]] = tmp[errorProps[idx]];\r\n  }\r\n};\r\nHandlebars.Exception.prototype = new Error();\r\n\r\n// Build out our basic SafeString type\r\nHandlebars.SafeString = function(string) {\r\n  this.string = string;\r\n};\r\nHandlebars.SafeString.prototype.toString = function() {\r\n  return this.string.toString();\r\n};\r\n\r\nvar escape = {\r\n  \"&\": \"&amp;\",\r\n  \"<\": \"&lt;\",\r\n  \">\": \"&gt;\",\r\n  '\"': \"&quot;\",\r\n  \"'\": \"&#x27;\",\r\n  \"`\": \"&#x60;\"\r\n};\r\n\r\nvar badChars = /[&<>\"'`]/g;\r\nvar possible = /[&<>\"'`]/;\r\n\r\nvar escapeChar = function(chr) {\r\n  return escape[chr] || \"&amp;\";\r\n};\r\n\r\nHandlebars.Utils = {\r\n  extend: function(obj, value) {\r\n    for(var key in value) {\r\n      if(value.hasOwnProperty(key)) {\r\n        obj[key] = value[key];\r\n      }\r\n    }\r\n  },\r\n\r\n  escapeExpression: function(string) {\r\n    // don't escape SafeStrings, since they're already safe\r\n    if (string instanceof Handlebars.SafeString) {\r\n      return string.toString();\r\n    } else if (string == null || string === false) {\r\n      return \"\";\r\n    }\r\n\r\n    // Force a string conversion as this will be done by the append regardless and\r\n    // the regex test will do this transparently behind the scenes, causing issues if\r\n    // an object's to string has escaped characters in it.\r\n    string = string.toString();\r\n\r\n    if(!possible.test(string)) { return string; }\r\n    return string.replace(badChars, escapeChar);\r\n  },\r\n\r\n  isEmpty: function(value) {\r\n    if (!value && value !== 0) {\r\n      return true;\r\n    } else if(toString.call(value) === \"[object Array]\" && value.length === 0) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n};\r\n;\r\n// lib/handlebars/compiler/compiler.js\r\n\r\n/*jshint eqnull:true*/\r\nvar Compiler = Handlebars.Compiler = function() {};\r\nvar JavaScriptCompiler = Handlebars.JavaScriptCompiler = function() {};\r\n\r\n// the foundHelper register will disambiguate helper lookup from finding a\r\n// function in a context. This is necessary for mustache compatibility, which\r\n// requires that context functions in blocks are evaluated by blockHelperMissing,\r\n// and then proceed as if the resulting value was provided to blockHelperMissing.\r\n\r\nCompiler.prototype = {\r\n  compiler: Compiler,\r\n\r\n  disassemble: function() {\r\n    var opcodes = this.opcodes, opcode, out = [], params, param;\r\n\r\n    for (var i=0, l=opcodes.length; i<l; i++) {\r\n      opcode = opcodes[i];\r\n\r\n      if (opcode.opcode === 'DECLARE') {\r\n        out.push(\"DECLARE \" + opcode.name + \"=\" + opcode.value);\r\n      } else {\r\n        params = [];\r\n        for (var j=0; j<opcode.args.length; j++) {\r\n          param = opcode.args[j];\r\n          if (typeof param === \"string\") {\r\n            param = \"\\\"\" + param.replace(\"\\n\", \"\\\\n\") + \"\\\"\";\r\n          }\r\n          params.push(param);\r\n        }\r\n        out.push(opcode.opcode + \" \" + params.join(\" \"));\r\n      }\r\n    }\r\n\r\n    return out.join(\"\\n\");\r\n  },\r\n  equals: function(other) {\r\n    var len = this.opcodes.length;\r\n    if (other.opcodes.length !== len) {\r\n      return false;\r\n    }\r\n\r\n    for (var i = 0; i < len; i++) {\r\n      var opcode = this.opcodes[i],\r\n          otherOpcode = other.opcodes[i];\r\n      if (opcode.opcode !== otherOpcode.opcode || opcode.args.length !== otherOpcode.args.length) {\r\n        return false;\r\n      }\r\n      for (var j = 0; j < opcode.args.length; j++) {\r\n        if (opcode.args[j] !== otherOpcode.args[j]) {\r\n          return false;\r\n        }\r\n      }\r\n    }\r\n\r\n    len = this.children.length;\r\n    if (other.children.length !== len) {\r\n      return false;\r\n    }\r\n    for (i = 0; i < len; i++) {\r\n      if (!this.children[i].equals(other.children[i])) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  },\r\n\r\n  guid: 0,\r\n\r\n  compile: function(program, options) {\r\n    this.children = [];\r\n    this.depths = {list: []};\r\n    this.options = options;\r\n\r\n    // These changes will propagate to the other compiler components\r\n    var knownHelpers = this.options.knownHelpers;\r\n    this.options.knownHelpers = {\r\n      'helperMissing': true,\r\n      'blockHelperMissing': true,\r\n      'each': true,\r\n      'if': true,\r\n      'unless': true,\r\n      'with': true,\r\n      'log': true\r\n    };\r\n    if (knownHelpers) {\r\n      for (var name in knownHelpers) {\r\n        this.options.knownHelpers[name] = knownHelpers[name];\r\n      }\r\n    }\r\n\r\n    return this.program(program);\r\n  },\r\n\r\n  accept: function(node) {\r\n    return this[node.type](node);\r\n  },\r\n\r\n  program: function(program) {\r\n    var statements = program.statements, statement;\r\n    this.opcodes = [];\r\n\r\n    for(var i=0, l=statements.length; i<l; i++) {\r\n      statement = statements[i];\r\n      this[statement.type](statement);\r\n    }\r\n    this.isSimple = l === 1;\r\n\r\n    this.depths.list = this.depths.list.sort(function(a, b) {\r\n      return a - b;\r\n    });\r\n\r\n    return this;\r\n  },\r\n\r\n  compileProgram: function(program) {\r\n    var result = new this.compiler().compile(program, this.options);\r\n    var guid = this.guid++, depth;\r\n\r\n    this.usePartial = this.usePartial || result.usePartial;\r\n\r\n    this.children[guid] = result;\r\n\r\n    for(var i=0, l=result.depths.list.length; i<l; i++) {\r\n      depth = result.depths.list[i];\r\n\r\n      if(depth < 2) { continue; }\r\n      else { this.addDepth(depth - 1); }\r\n    }\r\n\r\n    return guid;\r\n  },\r\n\r\n  block: function(block) {\r\n    var mustache = block.mustache,\r\n        program = block.program,\r\n        inverse = block.inverse;\r\n\r\n    if (program) {\r\n      program = this.compileProgram(program);\r\n    }\r\n\r\n    if (inverse) {\r\n      inverse = this.compileProgram(inverse);\r\n    }\r\n\r\n    var type = this.classifyMustache(mustache);\r\n\r\n    if (type === \"helper\") {\r\n      this.helperMustache(mustache, program, inverse);\r\n    } else if (type === \"simple\") {\r\n      this.simpleMustache(mustache);\r\n\r\n      // now that the simple mustache is resolved, we need to\r\n      // evaluate it by executing `blockHelperMissing`\r\n      this.opcode('pushProgram', program);\r\n      this.opcode('pushProgram', inverse);\r\n      this.opcode('emptyHash');\r\n      this.opcode('blockValue');\r\n    } else {\r\n      this.ambiguousMustache(mustache, program, inverse);\r\n\r\n      // now that the simple mustache is resolved, we need to\r\n      // evaluate it by executing `blockHelperMissing`\r\n      this.opcode('pushProgram', program);\r\n      this.opcode('pushProgram', inverse);\r\n      this.opcode('emptyHash');\r\n      this.opcode('ambiguousBlockValue');\r\n    }\r\n\r\n    this.opcode('append');\r\n  },\r\n\r\n  hash: function(hash) {\r\n    var pairs = hash.pairs, pair, val;\r\n\r\n    this.opcode('pushHash');\r\n\r\n    for(var i=0, l=pairs.length; i<l; i++) {\r\n      pair = pairs[i];\r\n      val  = pair[1];\r\n\r\n      if (this.options.stringParams) {\r\n        if(val.depth) {\r\n          this.addDepth(val.depth);\r\n        }\r\n        this.opcode('getContext', val.depth || 0);\r\n        this.opcode('pushStringParam', val.stringModeValue, val.type);\r\n      } else {\r\n        this.accept(val);\r\n      }\r\n\r\n      this.opcode('assignToHash', pair[0]);\r\n    }\r\n    this.opcode('popHash');\r\n  },\r\n\r\n  partial: function(partial) {\r\n    var partialName = partial.partialName;\r\n    this.usePartial = true;\r\n\r\n    if(partial.context) {\r\n      this.ID(partial.context);\r\n    } else {\r\n      this.opcode('push', 'depth0');\r\n    }\r\n\r\n    this.opcode('invokePartial', partialName.name);\r\n    this.opcode('append');\r\n  },\r\n\r\n  content: function(content) {\r\n    this.opcode('appendContent', content.string);\r\n  },\r\n\r\n  mustache: function(mustache) {\r\n    var options = this.options;\r\n    var type = this.classifyMustache(mustache);\r\n\r\n    if (type === \"simple\") {\r\n      this.simpleMustache(mustache);\r\n    } else if (type === \"helper\") {\r\n      this.helperMustache(mustache);\r\n    } else {\r\n      this.ambiguousMustache(mustache);\r\n    }\r\n\r\n    if(mustache.escaped && !options.noEscape) {\r\n      this.opcode('appendEscaped');\r\n    } else {\r\n      this.opcode('append');\r\n    }\r\n  },\r\n\r\n  ambiguousMustache: function(mustache, program, inverse) {\r\n    var id = mustache.id,\r\n        name = id.parts[0],\r\n        isBlock = program != null || inverse != null;\r\n\r\n    this.opcode('getContext', id.depth);\r\n\r\n    this.opcode('pushProgram', program);\r\n    this.opcode('pushProgram', inverse);\r\n\r\n    this.opcode('invokeAmbiguous', name, isBlock);\r\n  },\r\n\r\n  simpleMustache: function(mustache) {\r\n    var id = mustache.id;\r\n\r\n    if (id.type === 'DATA') {\r\n      this.DATA(id);\r\n    } else if (id.parts.length) {\r\n      this.ID(id);\r\n    } else {\r\n      // Simplified ID for `this`\r\n      this.addDepth(id.depth);\r\n      this.opcode('getContext', id.depth);\r\n      this.opcode('pushContext');\r\n    }\r\n\r\n    this.opcode('resolvePossibleLambda');\r\n  },\r\n\r\n  helperMustache: function(mustache, program, inverse) {\r\n    var params = this.setupFullMustacheParams(mustache, program, inverse),\r\n        name = mustache.id.parts[0];\r\n\r\n    if (this.options.knownHelpers[name]) {\r\n      this.opcode('invokeKnownHelper', params.length, name);\r\n    } else if (this.options.knownHelpersOnly) {\r\n      throw new Error(\"You specified knownHelpersOnly, but used the unknown helper \" + name);\r\n    } else {\r\n      this.opcode('invokeHelper', params.length, name);\r\n    }\r\n  },\r\n\r\n  ID: function(id) {\r\n    this.addDepth(id.depth);\r\n    this.opcode('getContext', id.depth);\r\n\r\n    var name = id.parts[0];\r\n    if (!name) {\r\n      this.opcode('pushContext');\r\n    } else {\r\n      this.opcode('lookupOnContext', id.parts[0]);\r\n    }\r\n\r\n    for(var i=1, l=id.parts.length; i<l; i++) {\r\n      this.opcode('lookup', id.parts[i]);\r\n    }\r\n  },\r\n\r\n  DATA: function(data) {\r\n    this.options.data = true;\r\n    if (data.id.isScoped || data.id.depth) {\r\n      throw new Handlebars.Exception('Scoped data references are not supported: ' + data.original);\r\n    }\r\n\r\n    this.opcode('lookupData');\r\n    var parts = data.id.parts;\r\n    for(var i=0, l=parts.length; i<l; i++) {\r\n      this.opcode('lookup', parts[i]);\r\n    }\r\n  },\r\n\r\n  STRING: function(string) {\r\n    this.opcode('pushString', string.string);\r\n  },\r\n\r\n  INTEGER: function(integer) {\r\n    this.opcode('pushLiteral', integer.integer);\r\n  },\r\n\r\n  BOOLEAN: function(bool) {\r\n    this.opcode('pushLiteral', bool.bool);\r\n  },\r\n\r\n  comment: function() {},\r\n\r\n  // HELPERS\r\n  opcode: function(name) {\r\n    this.opcodes.push({ opcode: name, args: [].slice.call(arguments, 1) });\r\n  },\r\n\r\n  declare: function(name, value) {\r\n    this.opcodes.push({ opcode: 'DECLARE', name: name, value: value });\r\n  },\r\n\r\n  addDepth: function(depth) {\r\n    if(isNaN(depth)) { throw new Error(\"EWOT\"); }\r\n    if(depth === 0) { return; }\r\n\r\n    if(!this.depths[depth]) {\r\n      this.depths[depth] = true;\r\n      this.depths.list.push(depth);\r\n    }\r\n  },\r\n\r\n  classifyMustache: function(mustache) {\r\n    var isHelper   = mustache.isHelper;\r\n    var isEligible = mustache.eligibleHelper;\r\n    var options    = this.options;\r\n\r\n    // if ambiguous, we can possibly resolve the ambiguity now\r\n    if (isEligible && !isHelper) {\r\n      var name = mustache.id.parts[0];\r\n\r\n      if (options.knownHelpers[name]) {\r\n        isHelper = true;\r\n      } else if (options.knownHelpersOnly) {\r\n        isEligible = false;\r\n      }\r\n    }\r\n\r\n    if (isHelper) { return \"helper\"; }\r\n    else if (isEligible) { return \"ambiguous\"; }\r\n    else { return \"simple\"; }\r\n  },\r\n\r\n  pushParams: function(params) {\r\n    var i = params.length, param;\r\n\r\n    while(i--) {\r\n      param = params[i];\r\n\r\n      if(this.options.stringParams) {\r\n        if(param.depth) {\r\n          this.addDepth(param.depth);\r\n        }\r\n\r\n        this.opcode('getContext', param.depth || 0);\r\n        this.opcode('pushStringParam', param.stringModeValue, param.type);\r\n      } else {\r\n        this[param.type](param);\r\n      }\r\n    }\r\n  },\r\n\r\n  setupMustacheParams: function(mustache) {\r\n    var params = mustache.params;\r\n    this.pushParams(params);\r\n\r\n    if(mustache.hash) {\r\n      this.hash(mustache.hash);\r\n    } else {\r\n      this.opcode('emptyHash');\r\n    }\r\n\r\n    return params;\r\n  },\r\n\r\n  // this will replace setupMustacheParams when we're done\r\n  setupFullMustacheParams: function(mustache, program, inverse) {\r\n    var params = mustache.params;\r\n    this.pushParams(params);\r\n\r\n    this.opcode('pushProgram', program);\r\n    this.opcode('pushProgram', inverse);\r\n\r\n    if(mustache.hash) {\r\n      this.hash(mustache.hash);\r\n    } else {\r\n      this.opcode('emptyHash');\r\n    }\r\n\r\n    return params;\r\n  }\r\n};\r\n\r\nvar Literal = function(value) {\r\n  this.value = value;\r\n};\r\n\r\nJavaScriptCompiler.prototype = {\r\n  // PUBLIC API: You can override these methods in a subclass to provide\r\n  // alternative compiled forms for name lookup and buffering semantics\r\n  nameLookup: function(parent, name /* , type*/) {\r\n    if (/^[0-9]+$/.test(name)) {\r\n      return parent + \"[\" + name + \"]\";\r\n    } else if (JavaScriptCompiler.isValidJavaScriptVariableName(name)) {\r\n      return parent + \".\" + name;\r\n    }\r\n    else {\r\n      return parent + \"['\" + name + \"']\";\r\n    }\r\n  },\r\n\r\n  appendToBuffer: function(string) {\r\n    if (this.environment.isSimple) {\r\n      return \"return \" + string + \";\";\r\n    } else {\r\n      return {\r\n        appendToBuffer: true,\r\n        content: string,\r\n        toString: function() { return \"buffer += \" + string + \";\"; }\r\n      };\r\n    }\r\n  },\r\n\r\n  initializeBuffer: function() {\r\n    return this.quotedString(\"\");\r\n  },\r\n\r\n  namespace: \"Handlebars\",\r\n  // END PUBLIC API\r\n\r\n  compile: function(environment, options, context, asObject) {\r\n    this.environment = environment;\r\n    this.options = options || {};\r\n\r\n    Handlebars.log(Handlebars.logger.DEBUG, this.environment.disassemble() + \"\\n\\n\");\r\n\r\n    this.name = this.environment.name;\r\n    this.isChild = !!context;\r\n    this.context = context || {\r\n      programs: [],\r\n      environments: [],\r\n      aliases: { }\r\n    };\r\n\r\n    this.preamble();\r\n\r\n    this.stackSlot = 0;\r\n    this.stackVars = [];\r\n    this.registers = { list: [] };\r\n    this.compileStack = [];\r\n    this.inlineStack = [];\r\n\r\n    this.compileChildren(environment, options);\r\n\r\n    var opcodes = environment.opcodes, opcode;\r\n\r\n    this.i = 0;\r\n\r\n    for(l=opcodes.length; this.i<l; this.i++) {\r\n      opcode = opcodes[this.i];\r\n\r\n      if(opcode.opcode === 'DECLARE') {\r\n        this[opcode.name] = opcode.value;\r\n      } else {\r\n        this[opcode.opcode].apply(this, opcode.args);\r\n      }\r\n    }\r\n\r\n    return this.createFunctionContext(asObject);\r\n  },\r\n\r\n  nextOpcode: function() {\r\n    var opcodes = this.environment.opcodes;\r\n    return opcodes[this.i + 1];\r\n  },\r\n\r\n  eat: function() {\r\n    this.i = this.i + 1;\r\n  },\r\n\r\n  preamble: function() {\r\n    var out = [];\r\n\r\n    if (!this.isChild) {\r\n      var namespace = this.namespace;\r\n\r\n      var copies = \"helpers = this.merge(helpers, \" + namespace + \".helpers);\";\r\n      if (this.environment.usePartial) { copies = copies + \" partials = this.merge(partials, \" + namespace + \".partials);\"; }\r\n      if (this.options.data) { copies = copies + \" data = data || {};\"; }\r\n      out.push(copies);\r\n    } else {\r\n      out.push('');\r\n    }\r\n\r\n    if (!this.environment.isSimple) {\r\n      out.push(\", buffer = \" + this.initializeBuffer());\r\n    } else {\r\n      out.push(\"\");\r\n    }\r\n\r\n    // track the last context pushed into place to allow skipping the\r\n    // getContext opcode when it would be a noop\r\n    this.lastContext = 0;\r\n    this.source = out;\r\n  },\r\n\r\n  createFunctionContext: function(asObject) {\r\n    var locals = this.stackVars.concat(this.registers.list);\r\n\r\n    if(locals.length > 0) {\r\n      this.source[1] = this.source[1] + \", \" + locals.join(\", \");\r\n    }\r\n\r\n    // Generate minimizer alias mappings\r\n    if (!this.isChild) {\r\n      for (var alias in this.context.aliases) {\r\n        if (this.context.aliases.hasOwnProperty(alias)) {\r\n          this.source[1] = this.source[1] + ', ' + alias + '=' + this.context.aliases[alias];\r\n        }\r\n      }\r\n    }\r\n\r\n    if (this.source[1]) {\r\n      this.source[1] = \"var \" + this.source[1].substring(2) + \";\";\r\n    }\r\n\r\n    // Merge children\r\n    if (!this.isChild) {\r\n      this.source[1] += '\\n' + this.context.programs.join('\\n') + '\\n';\r\n    }\r\n\r\n    if (!this.environment.isSimple) {\r\n      this.source.push(\"return buffer;\");\r\n    }\r\n\r\n    var params = this.isChild ? [\"depth0\", \"data\"] : [\"Handlebars\", \"depth0\", \"helpers\", \"partials\", \"data\"];\r\n\r\n    for(var i=0, l=this.environment.depths.list.length; i<l; i++) {\r\n      params.push(\"depth\" + this.environment.depths.list[i]);\r\n    }\r\n\r\n    // Perform a second pass over the output to merge content when possible\r\n    var source = this.mergeSource();\r\n\r\n    if (!this.isChild) {\r\n      var revision = Handlebars.COMPILER_REVISION,\r\n          versions = Handlebars.REVISION_CHANGES[revision];\r\n      source = \"this.compilerInfo = [\"+revision+\",'\"+versions+\"'];\\n\"+source;\r\n    }\r\n\r\n    if (asObject) {\r\n      params.push(source);\r\n\r\n      return Function.apply(this, params);\r\n    } else {\r\n      var functionSource = 'function ' + (this.name || '') + '(' + params.join(',') + ') {\\n  ' + source + '}';\r\n      Handlebars.log(Handlebars.logger.DEBUG, functionSource + \"\\n\\n\");\r\n      return functionSource;\r\n    }\r\n  },\r\n  mergeSource: function() {\r\n    // WARN: We are not handling the case where buffer is still populated as the source should\r\n    // not have buffer append operations as their final action.\r\n    var source = '',\r\n        buffer;\r\n    for (var i = 0, len = this.source.length; i < len; i++) {\r\n      var line = this.source[i];\r\n      if (line.appendToBuffer) {\r\n        if (buffer) {\r\n          buffer = buffer + '\\n    + ' + line.content;\r\n        } else {\r\n          buffer = line.content;\r\n        }\r\n      } else {\r\n        if (buffer) {\r\n          source += 'buffer += ' + buffer + ';\\n  ';\r\n          buffer = undefined;\r\n        }\r\n        source += line + '\\n  ';\r\n      }\r\n    }\r\n    return source;\r\n  },\r\n\r\n  // [blockValue]\r\n  //\r\n  // On stack, before: hash, inverse, program, value\r\n  // On stack, after: return value of blockHelperMissing\r\n  //\r\n  // The purpose of this opcode is to take a block of the form\r\n  // `{{#foo}}...{{/foo}}`, resolve the value of `foo`, and\r\n  // replace it on the stack with the result of properly\r\n  // invoking blockHelperMissing.\r\n  blockValue: function() {\r\n    this.context.aliases.blockHelperMissing = 'helpers.blockHelperMissing';\r\n\r\n    var params = [\"depth0\"];\r\n    this.setupParams(0, params);\r\n\r\n    this.replaceStack(function(current) {\r\n      params.splice(1, 0, current);\r\n      return \"blockHelperMissing.call(\" + params.join(\", \") + \")\";\r\n    });\r\n  },\r\n\r\n  // [ambiguousBlockValue]\r\n  //\r\n  // On stack, before: hash, inverse, program, value\r\n  // Compiler value, before: lastHelper=value of last found helper, if any\r\n  // On stack, after, if no lastHelper: same as [blockValue]\r\n  // On stack, after, if lastHelper: value\r\n  ambiguousBlockValue: function() {\r\n    this.context.aliases.blockHelperMissing = 'helpers.blockHelperMissing';\r\n\r\n    var params = [\"depth0\"];\r\n    this.setupParams(0, params);\r\n\r\n    var current = this.topStack();\r\n    params.splice(1, 0, current);\r\n\r\n    // Use the options value generated from the invocation\r\n    params[params.length-1] = 'options';\r\n\r\n    this.source.push(\"if (!\" + this.lastHelper + \") { \" + current + \" = blockHelperMissing.call(\" + params.join(\", \") + \"); }\");\r\n  },\r\n\r\n  // [appendContent]\r\n  //\r\n  // On stack, before: ...\r\n  // On stack, after: ...\r\n  //\r\n  // Appends the string value of `content` to the current buffer\r\n  appendContent: function(content) {\r\n    this.source.push(this.appendToBuffer(this.quotedString(content)));\r\n  },\r\n\r\n  // [append]\r\n  //\r\n  // On stack, before: value, ...\r\n  // On stack, after: ...\r\n  //\r\n  // Coerces `value` to a String and appends it to the current buffer.\r\n  //\r\n  // If `value` is truthy, or 0, it is coerced into a string and appended\r\n  // Otherwise, the empty string is appended\r\n  append: function() {\r\n    // Force anything that is inlined onto the stack so we don't have duplication\r\n    // when we examine local\r\n    this.flushInline();\r\n    var local = this.popStack();\r\n    this.source.push(\"if(\" + local + \" || \" + local + \" === 0) { \" + this.appendToBuffer(local) + \" }\");\r\n    if (this.environment.isSimple) {\r\n      this.source.push(\"else { \" + this.appendToBuffer(\"''\") + \" }\");\r\n    }\r\n  },\r\n\r\n  // [appendEscaped]\r\n  //\r\n  // On stack, before: value, ...\r\n  // On stack, after: ...\r\n  //\r\n  // Escape `value` and append it to the buffer\r\n  appendEscaped: function() {\r\n    this.context.aliases.escapeExpression = 'this.escapeExpression';\r\n\r\n    this.source.push(this.appendToBuffer(\"escapeExpression(\" + this.popStack() + \")\"));\r\n  },\r\n\r\n  // [getContext]\r\n  //\r\n  // On stack, before: ...\r\n  // On stack, after: ...\r\n  // Compiler value, after: lastContext=depth\r\n  //\r\n  // Set the value of the `lastContext` compiler value to the depth\r\n  getContext: function(depth) {\r\n    if(this.lastContext !== depth) {\r\n      this.lastContext = depth;\r\n    }\r\n  },\r\n\r\n  // [lookupOnContext]\r\n  //\r\n  // On stack, before: ...\r\n  // On stack, after: currentContext[name], ...\r\n  //\r\n  // Looks up the value of `name` on the current context and pushes\r\n  // it onto the stack.\r\n  lookupOnContext: function(name) {\r\n    this.push(this.nameLookup('depth' + this.lastContext, name, 'context'));\r\n  },\r\n\r\n  // [pushContext]\r\n  //\r\n  // On stack, before: ...\r\n  // On stack, after: currentContext, ...\r\n  //\r\n  // Pushes the value of the current context onto the stack.\r\n  pushContext: function() {\r\n    this.pushStackLiteral('depth' + this.lastContext);\r\n  },\r\n\r\n  // [resolvePossibleLambda]\r\n  //\r\n  // On stack, before: value, ...\r\n  // On stack, after: resolved value, ...\r\n  //\r\n  // If the `value` is a lambda, replace it on the stack by\r\n  // the return value of the lambda\r\n  resolvePossibleLambda: function() {\r\n    this.context.aliases.functionType = '\"function\"';\r\n\r\n    this.replaceStack(function(current) {\r\n      return \"typeof \" + current + \" === functionType ? \" + current + \".apply(depth0) : \" + current;\r\n    });\r\n  },\r\n\r\n  // [lookup]\r\n  //\r\n  // On stack, before: value, ...\r\n  // On stack, after: value[name], ...\r\n  //\r\n  // Replace the value on the stack with the result of looking\r\n  // up `name` on `value`\r\n  lookup: function(name) {\r\n    this.replaceStack(function(current) {\r\n      return current + \" == null || \" + current + \" === false ? \" + current + \" : \" + this.nameLookup(current, name, 'context');\r\n    });\r\n  },\r\n\r\n  // [lookupData]\r\n  //\r\n  // On stack, before: ...\r\n  // On stack, after: data[id], ...\r\n  //\r\n  // Push the result of looking up `id` on the current data\r\n  lookupData: function(id) {\r\n    this.push('data');\r\n  },\r\n\r\n  // [pushStringParam]\r\n  //\r\n  // On stack, before: ...\r\n  // On stack, after: string, currentContext, ...\r\n  //\r\n  // This opcode is designed for use in string mode, which\r\n  // provides the string value of a parameter along with its\r\n  // depth rather than resolving it immediately.\r\n  pushStringParam: function(string, type) {\r\n    this.pushStackLiteral('depth' + this.lastContext);\r\n\r\n    this.pushString(type);\r\n\r\n    if (typeof string === 'string') {\r\n      this.pushString(string);\r\n    } else {\r\n      this.pushStackLiteral(string);\r\n    }\r\n  },\r\n\r\n  emptyHash: function() {\r\n    this.pushStackLiteral('{}');\r\n\r\n    if (this.options.stringParams) {\r\n      this.register('hashTypes', '{}');\r\n      this.register('hashContexts', '{}');\r\n    }\r\n  },\r\n  pushHash: function() {\r\n    this.hash = {values: [], types: [], contexts: []};\r\n  },\r\n  popHash: function() {\r\n    var hash = this.hash;\r\n    this.hash = undefined;\r\n\r\n    if (this.options.stringParams) {\r\n      this.register('hashContexts', '{' + hash.contexts.join(',') + '}');\r\n      this.register('hashTypes', '{' + hash.types.join(',') + '}');\r\n    }\r\n    this.push('{\\n    ' + hash.values.join(',\\n    ') + '\\n  }');\r\n  },\r\n\r\n  // [pushString]\r\n  //\r\n  // On stack, before: ...\r\n  // On stack, after: quotedString(string), ...\r\n  //\r\n  // Push a quoted version of `string` onto the stack\r\n  pushString: function(string) {\r\n    this.pushStackLiteral(this.quotedString(string));\r\n  },\r\n\r\n  // [push]\r\n  //\r\n  // On stack, before: ...\r\n  // On stack, after: expr, ...\r\n  //\r\n  // Push an expression onto the stack\r\n  push: function(expr) {\r\n    this.inlineStack.push(expr);\r\n    return expr;\r\n  },\r\n\r\n  // [pushLiteral]\r\n  //\r\n  // On stack, before: ...\r\n  // On stack, after: value, ...\r\n  //\r\n  // Pushes a value onto the stack. This operation prevents\r\n  // the compiler from creating a temporary variable to hold\r\n  // it.\r\n  pushLiteral: function(value) {\r\n    this.pushStackLiteral(value);\r\n  },\r\n\r\n  // [pushProgram]\r\n  //\r\n  // On stack, before: ...\r\n  // On stack, after: program(guid), ...\r\n  //\r\n  // Push a program expression onto the stack. This takes\r\n  // a compile-time guid and converts it into a runtime-accessible\r\n  // expression.\r\n  pushProgram: function(guid) {\r\n    if (guid != null) {\r\n      this.pushStackLiteral(this.programExpression(guid));\r\n    } else {\r\n      this.pushStackLiteral(null);\r\n    }\r\n  },\r\n\r\n  // [invokeHelper]\r\n  //\r\n  // On stack, before: hash, inverse, program, params..., ...\r\n  // On stack, after: result of helper invocation\r\n  //\r\n  // Pops off the helper's parameters, invokes the helper,\r\n  // and pushes the helper's return value onto the stack.\r\n  //\r\n  // If the helper is not found, `helperMissing` is called.\r\n  invokeHelper: function(paramSize, name) {\r\n    this.context.aliases.helperMissing = 'helpers.helperMissing';\r\n\r\n    var helper = this.lastHelper = this.setupHelper(paramSize, name, true);\r\n    var nonHelper = this.nameLookup('depth' + this.lastContext, name, 'context');\r\n\r\n    this.push(helper.name + ' || ' + nonHelper);\r\n    this.replaceStack(function(name) {\r\n      return name + ' ? ' + name + '.call(' +\r\n          helper.callParams + \") \" + \": helperMissing.call(\" +\r\n          helper.helperMissingParams + \")\";\r\n    });\r\n  },\r\n\r\n  // [invokeKnownHelper]\r\n  //\r\n  // On stack, before: hash, inverse, program, params..., ...\r\n  // On stack, after: result of helper invocation\r\n  //\r\n  // This operation is used when the helper is known to exist,\r\n  // so a `helperMissing` fallback is not required.\r\n  invokeKnownHelper: function(paramSize, name) {\r\n    var helper = this.setupHelper(paramSize, name);\r\n    this.push(helper.name + \".call(\" + helper.callParams + \")\");\r\n  },\r\n\r\n  // [invokeAmbiguous]\r\n  //\r\n  // On stack, before: hash, inverse, program, params..., ...\r\n  // On stack, after: result of disambiguation\r\n  //\r\n  // This operation is used when an expression like `{{foo}}`\r\n  // is provided, but we don't know at compile-time whether it\r\n  // is a helper or a path.\r\n  //\r\n  // This operation emits more code than the other options,\r\n  // and can be avoided by passing the `knownHelpers` and\r\n  // `knownHelpersOnly` flags at compile-time.\r\n  invokeAmbiguous: function(name, helperCall) {\r\n    this.context.aliases.functionType = '\"function\"';\r\n\r\n    this.pushStackLiteral('{}');    // Hash value\r\n    var helper = this.setupHelper(0, name, helperCall);\r\n\r\n    var helperName = this.lastHelper = this.nameLookup('helpers', name, 'helper');\r\n\r\n    var nonHelper = this.nameLookup('depth' + this.lastContext, name, 'context');\r\n    var nextStack = this.nextStack();\r\n\r\n    this.source.push('if (' + nextStack + ' = ' + helperName + ') { ' + nextStack + ' = ' + nextStack + '.call(' + helper.callParams + '); }');\r\n    this.source.push('else { ' + nextStack + ' = ' + nonHelper + '; ' + nextStack + ' = typeof ' + nextStack + ' === functionType ? ' + nextStack + '.apply(depth0) : ' + nextStack + '; }');\r\n  },\r\n\r\n  // [invokePartial]\r\n  //\r\n  // On stack, before: context, ...\r\n  // On stack after: result of partial invocation\r\n  //\r\n  // This operation pops off a context, invokes a partial with that context,\r\n  // and pushes the result of the invocation back.\r\n  invokePartial: function(name) {\r\n    var params = [this.nameLookup('partials', name, 'partial'), \"'\" + name + \"'\", this.popStack(), \"helpers\", \"partials\"];\r\n\r\n    if (this.options.data) {\r\n      params.push(\"data\");\r\n    }\r\n\r\n    this.context.aliases.self = \"this\";\r\n    this.push(\"self.invokePartial(\" + params.join(\", \") + \")\");\r\n  },\r\n\r\n  // [assignToHash]\r\n  //\r\n  // On stack, before: value, hash, ...\r\n  // On stack, after: hash, ...\r\n  //\r\n  // Pops a value and hash off the stack, assigns `hash[key] = value`\r\n  // and pushes the hash back onto the stack.\r\n  assignToHash: function(key) {\r\n    var value = this.popStack(),\r\n        context,\r\n        type;\r\n\r\n    if (this.options.stringParams) {\r\n      type = this.popStack();\r\n      context = this.popStack();\r\n    }\r\n\r\n    var hash = this.hash;\r\n    if (context) {\r\n      hash.contexts.push(\"'\" + key + \"': \" + context);\r\n    }\r\n    if (type) {\r\n      hash.types.push(\"'\" + key + \"': \" + type);\r\n    }\r\n    hash.values.push(\"'\" + key + \"': (\" + value + \")\");\r\n  },\r\n\r\n  // HELPERS\r\n\r\n  compiler: JavaScriptCompiler,\r\n\r\n  compileChildren: function(environment, options) {\r\n    var children = environment.children, child, compiler;\r\n\r\n    for(var i=0, l=children.length; i<l; i++) {\r\n      child = children[i];\r\n      compiler = new this.compiler();\r\n\r\n      var index = this.matchExistingProgram(child);\r\n\r\n      if (index == null) {\r\n        this.context.programs.push('');     // Placeholder to prevent name conflicts for nested children\r\n        index = this.context.programs.length;\r\n        child.index = index;\r\n        child.name = 'program' + index;\r\n        this.context.programs[index] = compiler.compile(child, options, this.context);\r\n        this.context.environments[index] = child;\r\n      } else {\r\n        child.index = index;\r\n        child.name = 'program' + index;\r\n      }\r\n    }\r\n  },\r\n  matchExistingProgram: function(child) {\r\n    for (var i = 0, len = this.context.environments.length; i < len; i++) {\r\n      var environment = this.context.environments[i];\r\n      if (environment && environment.equals(child)) {\r\n        return i;\r\n      }\r\n    }\r\n  },\r\n\r\n  programExpression: function(guid) {\r\n    this.context.aliases.self = \"this\";\r\n\r\n    if(guid == null) {\r\n      return \"self.noop\";\r\n    }\r\n\r\n    var child = this.environment.children[guid],\r\n        depths = child.depths.list, depth;\r\n\r\n    var programParams = [child.index, child.name, \"data\"];\r\n\r\n    for(var i=0, l = depths.length; i<l; i++) {\r\n      depth = depths[i];\r\n\r\n      if(depth === 1) { programParams.push(\"depth0\"); }\r\n      else { programParams.push(\"depth\" + (depth - 1)); }\r\n    }\r\n\r\n    return (depths.length === 0 ? \"self.program(\" : \"self.programWithDepth(\") + programParams.join(\", \") + \")\";\r\n  },\r\n\r\n  register: function(name, val) {\r\n    this.useRegister(name);\r\n    this.source.push(name + \" = \" + val + \";\");\r\n  },\r\n\r\n  useRegister: function(name) {\r\n    if(!this.registers[name]) {\r\n      this.registers[name] = true;\r\n      this.registers.list.push(name);\r\n    }\r\n  },\r\n\r\n  pushStackLiteral: function(item) {\r\n    return this.push(new Literal(item));\r\n  },\r\n\r\n  pushStack: function(item) {\r\n    this.flushInline();\r\n\r\n    var stack = this.incrStack();\r\n    if (item) {\r\n      this.source.push(stack + \" = \" + item + \";\");\r\n    }\r\n    this.compileStack.push(stack);\r\n    return stack;\r\n  },\r\n\r\n  replaceStack: function(callback) {\r\n    var prefix = '',\r\n        inline = this.isInline(),\r\n        stack;\r\n\r\n    // If we are currently inline then we want to merge the inline statement into the\r\n    // replacement statement via ','\r\n    if (inline) {\r\n      var top = this.popStack(true);\r\n\r\n      if (top instanceof Literal) {\r\n        // Literals do not need to be inlined\r\n        stack = top.value;\r\n      } else {\r\n        // Get or create the current stack name for use by the inline\r\n        var name = this.stackSlot ? this.topStackName() : this.incrStack();\r\n\r\n        prefix = '(' + this.push(name) + ' = ' + top + '),';\r\n        stack = this.topStack();\r\n      }\r\n    } else {\r\n      stack = this.topStack();\r\n    }\r\n\r\n    var item = callback.call(this, stack);\r\n\r\n    if (inline) {\r\n      if (this.inlineStack.length || this.compileStack.length) {\r\n        this.popStack();\r\n      }\r\n      this.push('(' + prefix + item + ')');\r\n    } else {\r\n      // Prevent modification of the context depth variable. Through replaceStack\r\n      if (!/^stack/.test(stack)) {\r\n        stack = this.nextStack();\r\n      }\r\n\r\n      this.source.push(stack + \" = (\" + prefix + item + \");\");\r\n    }\r\n    return stack;\r\n  },\r\n\r\n  nextStack: function() {\r\n    return this.pushStack();\r\n  },\r\n\r\n  incrStack: function() {\r\n    this.stackSlot++;\r\n    if(this.stackSlot > this.stackVars.length) { this.stackVars.push(\"stack\" + this.stackSlot); }\r\n    return this.topStackName();\r\n  },\r\n  topStackName: function() {\r\n    return \"stack\" + this.stackSlot;\r\n  },\r\n  flushInline: function() {\r\n    var inlineStack = this.inlineStack;\r\n    if (inlineStack.length) {\r\n      this.inlineStack = [];\r\n      for (var i = 0, len = inlineStack.length; i < len; i++) {\r\n        var entry = inlineStack[i];\r\n        if (entry instanceof Literal) {\r\n          this.compileStack.push(entry);\r\n        } else {\r\n          this.pushStack(entry);\r\n        }\r\n      }\r\n    }\r\n  },\r\n  isInline: function() {\r\n    return this.inlineStack.length;\r\n  },\r\n\r\n  popStack: function(wrapped) {\r\n    var inline = this.isInline(),\r\n        item = (inline ? this.inlineStack : this.compileStack).pop();\r\n\r\n    if (!wrapped && (item instanceof Literal)) {\r\n      return item.value;\r\n    } else {\r\n      if (!inline) {\r\n        this.stackSlot--;\r\n      }\r\n      return item;\r\n    }\r\n  },\r\n\r\n  topStack: function(wrapped) {\r\n    var stack = (this.isInline() ? this.inlineStack : this.compileStack),\r\n        item = stack[stack.length - 1];\r\n\r\n    if (!wrapped && (item instanceof Literal)) {\r\n      return item.value;\r\n    } else {\r\n      return item;\r\n    }\r\n  },\r\n\r\n  quotedString: function(str) {\r\n    return '\"' + str\r\n      .replace(/\\\\/g, '\\\\\\\\')\r\n      .replace(/\"/g, '\\\\\"')\r\n      .replace(/\\n/g, '\\\\n')\r\n      .replace(/\\r/g, '\\\\r')\r\n      .replace(/\\u2028/g, '\\\\u2028')   // Per Ecma-262 7.3 + 7.8.4\r\n      .replace(/\\u2029/g, '\\\\u2029') + '\"';\r\n  },\r\n\r\n  setupHelper: function(paramSize, name, missingParams) {\r\n    var params = [];\r\n    this.setupParams(paramSize, params, missingParams);\r\n    var foundHelper = this.nameLookup('helpers', name, 'helper');\r\n\r\n    return {\r\n      params: params,\r\n      name: foundHelper,\r\n      callParams: [\"depth0\"].concat(params).join(\", \"),\r\n      helperMissingParams: missingParams && [\"depth0\", this.quotedString(name)].concat(params).join(\", \")\r\n    };\r\n  },\r\n\r\n  // the params and contexts arguments are passed in arrays\r\n  // to fill in\r\n  setupParams: function(paramSize, params, useRegister) {\r\n    var options = [], contexts = [], types = [], param, inverse, program;\r\n\r\n    options.push(\"hash:\" + this.popStack());\r\n\r\n    inverse = this.popStack();\r\n    program = this.popStack();\r\n\r\n    // Avoid setting fn and inverse if neither are set. This allows\r\n    // helpers to do a check for `if (options.fn)`\r\n    if (program || inverse) {\r\n      if (!program) {\r\n        this.context.aliases.self = \"this\";\r\n        program = \"self.noop\";\r\n      }\r\n\r\n      if (!inverse) {\r\n       this.context.aliases.self = \"this\";\r\n        inverse = \"self.noop\";\r\n      }\r\n\r\n      options.push(\"inverse:\" + inverse);\r\n      options.push(\"fn:\" + program);\r\n    }\r\n\r\n    for(var i=0; i<paramSize; i++) {\r\n      param = this.popStack();\r\n      params.push(param);\r\n\r\n      if(this.options.stringParams) {\r\n        types.push(this.popStack());\r\n        contexts.push(this.popStack());\r\n      }\r\n    }\r\n\r\n    if (this.options.stringParams) {\r\n      options.push(\"contexts:[\" + contexts.join(\",\") + \"]\");\r\n      options.push(\"types:[\" + types.join(\",\") + \"]\");\r\n      options.push(\"hashContexts:hashContexts\");\r\n      options.push(\"hashTypes:hashTypes\");\r\n    }\r\n\r\n    if(this.options.data) {\r\n      options.push(\"data:data\");\r\n    }\r\n\r\n    options = \"{\" + options.join(\",\") + \"}\";\r\n    if (useRegister) {\r\n      this.register('options', options);\r\n      params.push('options');\r\n    } else {\r\n      params.push(options);\r\n    }\r\n    return params.join(\", \");\r\n  }\r\n};\r\n\r\nvar reservedWords = (\r\n  \"break else new var\" +\r\n  \" case finally return void\" +\r\n  \" catch for switch while\" +\r\n  \" continue function this with\" +\r\n  \" default if throw\" +\r\n  \" delete in try\" +\r\n  \" do instanceof typeof\" +\r\n  \" abstract enum int short\" +\r\n  \" boolean export interface static\" +\r\n  \" byte extends long super\" +\r\n  \" char final native synchronized\" +\r\n  \" class float package throws\" +\r\n  \" const goto private transient\" +\r\n  \" debugger implements protected volatile\" +\r\n  \" double import public let yield\"\r\n).split(\" \");\r\n\r\nvar compilerWords = JavaScriptCompiler.RESERVED_WORDS = {};\r\n\r\nfor(var i=0, l=reservedWords.length; i<l; i++) {\r\n  compilerWords[reservedWords[i]] = true;\r\n}\r\n\r\nJavaScriptCompiler.isValidJavaScriptVariableName = function(name) {\r\n  if(!JavaScriptCompiler.RESERVED_WORDS[name] && /^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(name)) {\r\n    return true;\r\n  }\r\n  return false;\r\n};\r\n\r\nHandlebars.precompile = function(input, options) {\r\n  if (input == null || (typeof input !== 'string' && input.constructor !== Handlebars.AST.ProgramNode)) {\r\n    throw new Handlebars.Exception(\"You must pass a string or Handlebars AST to Handlebars.precompile. You passed \" + input);\r\n  }\r\n\r\n  options = options || {};\r\n  if (!('data' in options)) {\r\n    options.data = true;\r\n  }\r\n  var ast = Handlebars.parse(input);\r\n  var environment = new Compiler().compile(ast, options);\r\n  return new JavaScriptCompiler().compile(environment, options);\r\n};\r\n\r\nHandlebars.compile = function(input, options) {\r\n  if (input == null || (typeof input !== 'string' && input.constructor !== Handlebars.AST.ProgramNode)) {\r\n    throw new Handlebars.Exception(\"You must pass a string or Handlebars AST to Handlebars.compile. You passed \" + input);\r\n  }\r\n\r\n  options = options || {};\r\n  if (!('data' in options)) {\r\n    options.data = true;\r\n  }\r\n  var compiled;\r\n  function compile() {\r\n    var ast = Handlebars.parse(input);\r\n    var environment = new Compiler().compile(ast, options);\r\n    var templateSpec = new JavaScriptCompiler().compile(environment, options, undefined, true);\r\n    return Handlebars.template(templateSpec);\r\n  }\r\n\r\n  // Template is only compiled on first use and cached after that point.\r\n  return function(context, options) {\r\n    if (!compiled) {\r\n      compiled = compile();\r\n    }\r\n    return compiled.call(this, context, options);\r\n  };\r\n};\r\n\r\n;\r\n// lib/handlebars/runtime.js\r\n\r\nHandlebars.VM = {\r\n  template: function(templateSpec) {\r\n    // Just add water\r\n    var container = {\r\n      escapeExpression: Handlebars.Utils.escapeExpression,\r\n      invokePartial: Handlebars.VM.invokePartial,\r\n      programs: [],\r\n      program: function(i, fn, data) {\r\n        var programWrapper = this.programs[i];\r\n        if(data) {\r\n          programWrapper = Handlebars.VM.program(i, fn, data);\r\n        } else if (!programWrapper) {\r\n          programWrapper = this.programs[i] = Handlebars.VM.program(i, fn);\r\n        }\r\n        return programWrapper;\r\n      },\r\n      merge: function(param, common) {\r\n        var ret = param || common;\r\n\r\n        if (param && common) {\r\n          ret = {};\r\n          Handlebars.Utils.extend(ret, common);\r\n          Handlebars.Utils.extend(ret, param);\r\n        }\r\n        return ret;\r\n      },\r\n      programWithDepth: Handlebars.VM.programWithDepth,\r\n      noop: Handlebars.VM.noop,\r\n      compilerInfo: null\r\n    };\r\n\r\n    return function(context, options) {\r\n      options = options || {};\r\n      var result = templateSpec.call(container, Handlebars, context, options.helpers, options.partials, options.data);\r\n\r\n      var compilerInfo = container.compilerInfo || [],\r\n          compilerRevision = compilerInfo[0] || 1,\r\n          currentRevision = Handlebars.COMPILER_REVISION;\r\n\r\n      if (compilerRevision !== currentRevision) {\r\n        if (compilerRevision < currentRevision) {\r\n          var runtimeVersions = Handlebars.REVISION_CHANGES[currentRevision],\r\n              compilerVersions = Handlebars.REVISION_CHANGES[compilerRevision];\r\n          throw \"Template was precompiled with an older version of Handlebars than the current runtime. \"+\r\n                \"Please update your precompiler to a newer version (\"+runtimeVersions+\") or downgrade your runtime to an older version (\"+compilerVersions+\").\";\r\n        } else {\r\n          // Use the embedded version info since the runtime doesn't know about this revision yet\r\n          throw \"Template was precompiled with a newer version of Handlebars than the current runtime. \"+\r\n                \"Please update your runtime to a newer version (\"+compilerInfo[1]+\").\";\r\n        }\r\n      }\r\n\r\n      return result;\r\n    };\r\n  },\r\n\r\n  programWithDepth: function(i, fn, data /*, $depth */) {\r\n    var args = Array.prototype.slice.call(arguments, 3);\r\n\r\n    var program = function(context, options) {\r\n      options = options || {};\r\n\r\n      return fn.apply(this, [context, options.data || data].concat(args));\r\n    };\r\n    program.program = i;\r\n    program.depth = args.length;\r\n    return program;\r\n  },\r\n  program: function(i, fn, data) {\r\n    var program = function(context, options) {\r\n      options = options || {};\r\n\r\n      return fn(context, options.data || data);\r\n    };\r\n    program.program = i;\r\n    program.depth = 0;\r\n    return program;\r\n  },\r\n  noop: function() { return \"\"; },\r\n  invokePartial: function(partial, name, context, helpers, partials, data) {\r\n    var options = { helpers: helpers, partials: partials, data: data };\r\n\r\n    if(partial === undefined) {\r\n      throw new Handlebars.Exception(\"The partial \" + name + \" could not be found\");\r\n    } else if(partial instanceof Function) {\r\n      return partial(context, options);\r\n    } else if (!Handlebars.compile) {\r\n      throw new Handlebars.Exception(\"The partial \" + name + \" could not be compiled when running in runtime-only mode\");\r\n    } else {\r\n      partials[name] = Handlebars.compile(partial, {data: data !== undefined});\r\n      return partials[name](context, options);\r\n    }\r\n  }\r\n};\r\n\r\nHandlebars.template = Handlebars.VM.template;\r\n;\r\n// lib/handlebars/browser-suffix.js\r\n})(Handlebars);\r\n;\r\n"],"sourceRoot":"/source/"}